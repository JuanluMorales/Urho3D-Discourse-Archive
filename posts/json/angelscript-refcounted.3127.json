{"post_stream":{"posts":[{"id":17838,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T00:17:49.263Z","cooked":"\u003cp\u003eAngelScript tries to delete my RefCounted object.\u003c/p\u003e\n\u003cp\u003eI register like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003etemplate\u0026lt;class A, class B\u0026gt;\nstatic B *refCast(A *a)\n{\n        if (!a)\n                return NULL;\n        B *b = dynamic_cast\u0026lt;B *\u0026gt;(a);\n        return b;\n}\n\n\ntemplate\u0026lt;class M\u0026gt;\nstatic M *ConstructSimple()\n{\n        return new M();\n}\n\ntemplate\u0026lt;class T\u0026gt;\nvoid RegisterBTNode(asIScriptEngine* engine, String name)\n{\n        RegisterRefCounted\u0026lt;T\u0026gt;(engine, name.CString());\n        engine-\u0026gt;RegisterObjectBehaviour(name.CString(), asBEHAVE_FACTORY, (name + \"@+ f()\").CString(), asFUNCTION(ConstructSimple\u0026lt;T\u0026gt;), asCALL_CDECL);\n        engine-\u0026gt;RegisterObjectMethod(name.CString(), \"BehaviorNode@+ opImplCast()\", asFUNCTION((refCast\u0026lt;T, BTBaseNode\u0026gt;)), asCALL_CDECL_OBJLAST);\n        engine-\u0026gt;RegisterObjectMethod(name.CString(), \"BehaviorNode@+ opCast()\", asFUNCTION((refCast\u0026lt;T, BTBaseNode\u0026gt;)), asCALL_CDECL_OBJLAST);\n        engine-\u0026gt;RegisterObjectMethod(name.CString(), \"BehaviorStatus Activate(BTBlackboard@+)\", asMETHOD(T, Activate), asCALL_THISCALL);\n}\n\ntemplate\u0026lt;class T\u0026gt;\nvoid RegisterBTCompositeNode(asIScriptEngine* engine, String name)\n{\n        RegisterBTNode\u0026lt;T\u0026gt;(engine, name);\n        engine-\u0026gt;RegisterObjectMethod(name.CString(), \"void AddChild(BehaviorNode@)\", asMETHOD(T, add_child), asCALL_THISCALL);\n        engine-\u0026gt;RegisterObjectMethod(name.CString(), \"CompositeNode@+ opImplCast()\", asFUNCTION((refCast\u0026lt;T, BTCompositeNode\u0026gt;)), asCALL_CDECL_OBJLAST);\n        engine-\u0026gt;RegisterObjectMethod(name.CString(), \"CompositeNode@+ opCast()\", asFUNCTION((refCast\u0026lt;T, BTCompositeNode\u0026gt;)), asCALL_CDECL_OBJLAST);\n}\n\nvoid RegisterScriptBehavior(Context *context)\n{\n...\n        /* CompositeNode */\n        RegisterBTNode\u0026lt;BTCompositeNode\u0026gt;(engine, \"CompositeNode\");\n...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAny ideas?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-05-15T00:17:49.263Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":48,"reads":38,"readers_count":37,"score":247.6,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17839,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T00:20:57.305Z","cooked":"\u003cp\u003e\u003ca class=\"mention\" href=\"/u/cadaver\"\u003e@cadaver\u003c/a\u003e could you please look and tell me how can I use RefCounted with AngelScript objects?\u003cbr\u003e\nAs pointer is out of scope it immediately calls object destructor, which produces assert error:\u003c/p\u003e\n\u003cp\u003eRefCounted.cpp:42: virtual Urho3D::RefCounted::~RefCounted(): Assertion `refCount_-\u0026gt;refs_ == 0’ failed.\u003c/p\u003e\n\u003cp\u003eSo while object is held it is still destroyed. I wonder what I miss here.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-05-15T00:20:57.305Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":34,"readers_count":33,"score":6.8,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17840,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T00:25:13.159Z","cooked":"\u003cp\u003eIn AngelScript I just put the pointer into array, and leave the scope. The array is object property,\u003cbr\u003e\nso it should remain. But AS is out for blood on my poor little RefCounted object and calls its destructor anyway…\u003cbr\u003e\nI wonder how to fight it…\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-05-15T00:25:13.159Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":34,"readers_count":33,"score":26.8,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17841,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T00:27:00.748Z","cooked":"\u003cp\u003eAlso, if objects are not put into array, nothing bad happens, they are just destroyed.\u003cbr\u003e\nIf I add them to array which remains, assertion happens when scope is left.\u003cbr\u003e\nOtherwise objects work perfectly well.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-05-15T00:27:00.748Z","reply_count":0,"reply_to_post_number":3,"quote_count":0,"incoming_link_count":0,"reads":32,"readers_count":31,"score":6.4,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17843,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T01:20:11.157Z","cooked":"\u003cp\u003eWhat happens to thhe object:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[Mon May 15 04:08:51 2017] INFO: AddRef: 0b06a6c0\n[Mon May 15 04:08:51 2017] INFO: AddRef: 0b06a6c0\n[Mon May 15 04:08:51 2017] INFO: ReleaseRef: count = 2 0b06a6c0\ndone calling constructor\n[Mon May 15 04:08:51 2017] INFO: Deleting: 0b06a6c0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe last line is call of destructor. (the hex number is pointer value/object address)\u003cbr\u003e\nThe actual deletion happens through AS engine, not through ReleaseRef:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    `RefCounted.cpp:45: virtual Urho3D::RefCounted::~RefCounted(): Assertion `refCount_-\u0026gt;refs_ == 0' failed.`\n\n    Program received signal SIGABRT, Aborted.\n    0x00007ffff69161c8 in raise () from /lib/x86_64-linux-gnu/libc.so.6\n    (gdb) bt\n    #0  0x00007ffff69161c8 in raise () from /lib/x86_64-linux-gnu/libc.so.6\n    #1  0x00007ffff691764a in abort () from /lib/x86_64-linux-gnu/libc.so.6\n    #2  0x00007ffff690f107 in __assert_fail_base () from /lib/x86_64-linux-gnu/libc.so.6\n    #3  0x00007ffff690f1b2 in __assert_fail () from /lib/x86_64-linux-gnu/libc.so.6\n    #4  0x0000000000b9434f in Urho3D::RefCounted::~RefCounted (this=0x99abf40, __in_chrg=\u0026lt;optimized out\u0026gt;) at /home/slapin/Urho3D/Source/Urho3D/Container/RefCounted.cpp:45\n    #5  0x00000000008bdeea in BTBaseNode::~BTBaseNode (this=0x99abf40, __in_chrg=\u0026lt;optimized out\u0026gt;) at /home/slapin/dungeon/rework/BehaviorTree.h:22\n    #6  0x00000000008c24d0 in BTCompositeNode::~BTCompositeNode (this=0x99abf40, __in_chrg=\u0026lt;optimized out\u0026gt;) at /home/slapin/dungeon/rework/BehaviorTree.h:36\n    #7  0x00000000008c79de in BTSequenceNode::~BTSequenceNode (this=0x99abf40, __in_chrg=\u0026lt;optimized out\u0026gt;) at /home/slapin/dungeon/rework/BehaviorTree.h:47\n    #8  0x0000000000f073c2 in asCScriptEngine::CallObjectMethod (this=0x239de30, obj=0x99abf40, i=0x23a2580, s=0x23a2600) at /home/slapin/Urho3D/Source/ThirdParty/AngelScript/source/as_scriptengine.cpp:4038\n    #9  0x0000000000f0729f in asCScriptEngine::CallObjectMethod (this=0x239de30, obj=0x99abf40, func=2) at /home/slapin/Urho3D/Source/ThirdParty/AngelScript/source/as_scriptengine.cpp:4010\n    #10 0x00000000008d7d38 in asCContext::ExecuteNext (this=0x30a25d0) at /home/slapin/Urho3D/Source/ThirdParty/AngelScript/source/as_context.cpp:4106\n    #11 0x00000000008d0c77 in asCContext::Execute (this=0x30a25d0) at /home/slapin/Urho3D/Source/ThirdParty/AngelScript/source/as_context.cpp:1297\n    #12 0x00000000009ad572 in Urho3D::ScriptFile::Execute (this=0x2f04070, function=0x30a2e60, parameters=..., unprepare=true) at /home/slapin/Urho3D/Source/Urho3D/AngelScript/ScriptFile.cpp:324\n    #13 0x00000000009b038a in Urho3D::ScriptEventInvoker::HandleScriptEvent (this=0x30d6790, eventType=..., eventData=...) at /home/slapin/Urho3D/Source/Urho3D/AngelScript/ScriptFile.cpp:956\n    #14 0x00000000009b4394 in Urho3D::EventHandlerImpl\u0026lt;Urho3D::ScriptEventInvoker\u0026gt;::Invoke (this=0x9009110, eventData=...) at /home/slapin/Urho3D/Source/Urho3D/AngelScript/../AngelScript/../Core/Object.h:307\n    #15 0x0000000000b6caeb in Urho3D::Object::OnEvent (this=0x30d6790, sender=0x1cbae10, eventType=..., eventData=...) at /home/slapin/Urho3D/Source/Urho3D/Core/Object.cpp:121\n    #16 0x0000000000b6d680 in Urho3D::Object::SendEvent (this=0x1cbae10, eventType=..., eventData=...) at /home/slapin/Urho3D/Source/Urho3D/Core/Object.cpp:355\n    #17 0x0000000000b8bfea in Urho3D::Engine::Update (this=0x1cbae10) at /home/slapin/Urho3D/Source/Urho3D/Engine/Engine.cpp:695\n    #18 0x0000000000b8b92a in Urho3D::Engine::RunFrame (this=0x1cbae10) at /home/slapin/Urho3D/Source/Urho3D/Engine/Engine.cpp:519\n    #19 0x0000000000b884ce in Urho3D::Application::Run (this=0x1cbaca0) at /home/slapin/Urho3D/Source/Urho3D/Engine/Application.cpp:86\n    #20 0x00000000008ca359 in RunApplication () at /home/slapin/dungeon/rework/Urho3DPlayer.cpp:46\n    #21 0x00000000008ca400 in main (argc=1, argv=0x7fffffffe248) at /home/slapin/dungeon/rework/Urho3DPlayer.cpp:46\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo this is kind of reaction on scope loss. Is there some way to prevent AS from deleting objects\u003cbr\u003e\nand just use reference counting behaviors?\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-05-15T01:20:11.157Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":31,"readers_count":30,"score":6.2,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17850,"name":"","username":"S.L.C","avatar_template":"/user_avatar/discourse.urho3d.io/s.l.c/{size}/1016_2.png","created_at":"2017-05-15T03:17:05.832Z","cooked":"\u003cp\u003eHave you considered the following behavior:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003estruct RefCounted\n{\n    void GrabRef()\n    {\n        ++m_RefCount;\n    }\n    void DropRef()\n    {\n        if (--m_RefCount == 0)\n        {\n            puts(\"Counter Reached 0...\");\n            delete this;\n        }\n    }\nprotected:\n\n    RefCounted()\n        : m_RefCount(1)\n    {\n        //...\n    }\n    virtual ~RefCounted()\n    {\n        puts(\"Deleting Object...\");\n    }\nprivate:\n\n    int m_RefCount;\n};\n\nstruct Foo : public RefCounted\n{\n    Foo()\n        : RefCounted()\n    {\n\n    }\n    virtual ~Foo()\n    {\n        puts(\"Deleting Foo...\");\n    }\n};\n\nstruct Bar : public RefCounted\n{\n    Bar()\n        : RefCounted()\n    {\n\n    }\n    virtual ~Bar()\n    {\n        puts(\"Deleting Bar...\");\n    }\n};\n\nstruct Baz : public Foo, public Bar\n{\n    Baz()\n        : Foo(), Bar()\n    {\n\n    }\n    virtual ~Baz()\n    {\n        puts(\"Deleting Baz...\");\n    }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eExample:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBaz * baz = new Baz();\n\nFoo * foo = baz;\nfoo-\u0026gt;GrabRef();\nfoo-\u0026gt;GrabRef();\nBar * bar = baz;\nbar-\u0026gt;DropRef();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOutput:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eCounter Reached 0...\nDeleting Baz...\nDeleting Bar...\nDeleting Object...\nDeleting Foo...\nDeleting Object...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSuch that you actually have several reference counters for the same instance. And depending through which base you modify the counter, you may not have a guarantee that you’re working with the same counter.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-05-15T06:31:03.529Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":29,"readers_count":28,"score":10.8,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":3,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":180,"hidden":false,"trust_level":0,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"user_suspended":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17854,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T12:26:16.802Z","cooked":"\u003cp\u003eIn such case the pointers would be different, as these are different objects.\u003cbr\u003e\nIn this case I see this happening on the same object. This looks like for some reason\u003cbr\u003e\nAS decided to delete the object, while it should just drop references. This means I miss something in API\u003cbr\u003e\nsetup. This is also indicated by assert - it would not happen if reference was dropped, it is direct deletion of object.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-05-15T12:26:16.802Z","reply_count":1,"reply_to_post_number":6,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":10.0,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"S.L.C","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/s.l.c/{size}/1016_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17855,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T12:27:13.447Z","cooked":"\u003cp\u003eI know it is possible to do as this works on Urho objects, I just trying to find what I miss there.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-05-15T12:27:13.447Z","reply_count":0,"reply_to_post_number":7,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":5.0,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17858,"name":"Yao Wei Tjong","username":"weitjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","created_at":"2017-05-15T14:12:15.441Z","cooked":"\u003cp\u003eYou may want to read this documentation page from AS.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.angelcode.com/angelscript/sdk/docs/manual/doc_obj_handle.html\" class=\"onebox\" target=\"_blank\"\u003ehttp://www.angelcode.com/angelscript/sdk/docs/manual/doc_obj_handle.html\u003c/a\u003e\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2017-05-15T14:12:15.441Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":10.0,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"Yao Wei Tjong","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://www.angelcode.com/angelscript/sdk/docs/manual/doc_obj_handle.html","internal":false,"reflection":false,"title":"AngelScript: Object handles to the application","clicks":6}],"read":true,"user_title":"Admin","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":4,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17862,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T18:34:38.409Z","cooked":"\u003cp\u003e\u003ca class=\"mention\" href=\"/u/weitjong\"\u003e@weitjong\u003c/a\u003e I have read all the docs. as I mentioned I register via urho RefCounted template, which registers behaviors intended to add/release reference automatically. What I don’t understand is why destructor is called directly instead of ReleaseRef().\u003cbr\u003e\nPlease see the original post.\u003cbr\u003e\nAlso in arificial example I could not reproduce this, which looks that there are some additional requirements which I currently investigate.\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2017-05-15T18:34:38.409Z","reply_count":0,"reply_to_post_number":9,"quote_count":0,"incoming_link_count":0,"reads":24,"readers_count":23,"score":4.8,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17865,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T20:26:27.372Z","cooked":"\u003cp\u003eWell, I solved this by using + in all function arguments taking objects, and not directly using pointers.\u003cbr\u003e\nBut it looks like I got dictionary corruption somehow, or something.\u003c/p\u003e\n\u003cp\u003eAngelScript/source/as_atomic.cpp:68: asDWORD asCAtomic::atomicInc(): Assertion `value \u0026lt; 1000000’ failed.\u003c/p\u003e\n\u003cp\u003eThis is not work with custom objects, it is just acquiring function pointer:\u003cbr\u003e\n\u003ccode\u003efuncdef BehaviorNode@ create_bvh_node(VariantMap props); create_bvh_node@ func = cast\u0026lt;create_bvh_node\u0026gt;(bhvnodes[nodetype]);\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003ebhvnode is Dictionary in style of\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eDictionary bhvnodes = {\n// group composites (Composites)\n// ------------------------------\n        // sequence (Sequence)\n        {\"bhv_sequence\", Create_sequence},\n\n        // memsequence (MemSequence)\n        {\"bhv_memsequence\", Create_memsequence},\n\n        // selection (Selection)\n        {\"bhv_selection\", Create_selection},\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand Create… functions are factories and look like\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBehaviorNode@ Create_sequence(VariantMap props)\n{\n        return SequenceNode();\n}\nBehaviorNode@ Create_memsequence(VariantMap props)\n{\n        return MemSequenceNode();\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis looks like not really directly related to Dictionary, but I wonder how come some Dictionary entry got corrupted…\u003cbr\u003e\nSo I have fun debugging again…\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2017-05-15T20:31:20.988Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":23,"readers_count":22,"score":4.6,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17866,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T20:44:01.693Z","cooked":"\u003cp\u003eThe strange thing is that If I do not run constructors at all, just pass through dictionary, it is still asserts.\u003cbr\u003e\nI wonder why…\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2017-05-15T20:44:01.693Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":23,"readers_count":22,"score":4.6,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":17869,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2017-05-15T22:09:18.278Z","cooked":"\u003cp\u003eSomething is definitely gets corrupted, but where…\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2017-05-15T22:09:18.278Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":22,"readers_count":21,"score":4.4,"yours":false,"topic_id":3127,"topic_slug":"angelscript-refcounted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[17838,17839,17840,17841,17843,17850,17854,17855,17858,17862,17865,17866,17869]},"timeline_lookup":[[1,2018],[10,2017]],"suggested_topics":[{"id":7097,"title":"View Physics event for ConvexCast","fancy_title":"View Physics event for ConvexCast","slug":"view-physics-event-for-convexcast","posts_count":11,"reply_count":5,"highest_post_number":11,"image_url":null,"created_at":"2021-12-09T23:56:27.507Z","last_posted_at":"2021-12-12T20:20:02.788Z","bumped":true,"bumped_at":"2021-12-12T20:20:02.788Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":206,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7104,"title":"Bug in my partial-model copying code","fancy_title":"Bug in my partial-model copying code","slug":"bug-in-my-partial-model-copying-code","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/5367e370779d64989e5c3ff2c1ebfb0689908c87.png","created_at":"2021-12-17T03:50:19.405Z","last_posted_at":"2021-12-17T13:50:49.662Z","bumped":true,"bumped_at":"2021-12-17T13:50:49.662Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":144,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7125,"title":"Android mobile shows jaggies in the instersection plane-terrain","fancy_title":"Android mobile shows jaggies in the instersection plane-terrain","slug":"android-mobile-shows-jaggies-in-the-instersection-plane-terrain","posts_count":5,"reply_count":3,"highest_post_number":5,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/d/d36aedb4e8cf5409efca6c976aae7e4a5c499eb9.png","created_at":"2022-01-11T11:59:18.993Z","last_posted_at":"2022-01-11T21:27:40.692Z","bumped":true,"bumped_at":"2022-01-12T07:36:41.695Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":129,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7129,"title":"Best Model Import Pipeline as of Jan 2022?","fancy_title":"Best Model Import Pipeline as of Jan 2022?","slug":"best-model-import-pipeline-as-of-jan-2022","posts_count":7,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2022-01-17T09:27:23.432Z","last_posted_at":"2022-01-17T20:37:59.458Z","bumped":true,"bumped_at":"2022-01-17T20:37:59.458Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":170,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}}]},{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]}],"tags_descriptions":{},"id":3127,"title":"AngelScript + RefCounted","fancy_title":"AngelScript + RefCounted","posts_count":13,"created_at":"2017-05-15T00:17:49.204Z","views":738,"reply_count":4,"like_count":1,"last_posted_at":"2017-05-15T22:09:18.278Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"angelscript-refcounted","category_id":10,"word_count":1295,"deleted_at":null,"user_id":554,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_3127","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":13,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":554,"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","post_count":11,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":4},{"id":180,"username":"S.L.C","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/s.l.c/{size}/1016_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":0}],"created_by":{"id":554,"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"last_poster":{"id":554,"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"links":[{"url":"http://www.angelcode.com/angelscript/sdk/docs/manual/doc_obj_handle.html","title":"AngelScript: Object handles to the application","internal":false,"attachment":false,"reflection":false,"clicks":6,"user_id":4,"domain":"www.angelcode.com","root_domain":"angelcode.com"}]}}