{"post_stream":{"posts":[{"id":24332,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-23T19:04:01.997Z","cooked":"\u003cp\u003eHi, all!\u003c/p\u003e\n\u003cp\u003eLets imagine I have imported some random characters off the net and I want to apply\u003cbr\u003e\nsome standard transforms to them (like neck rotation), without caring for skeleton structure\u003cbr\u003e\nand bone orientations. For this I need to calculate bone orientation, so to calculate inverse quat. So the question - is bone orientation information available somewhere?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2018-04-23T19:04:01.997Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":210,"reads":45,"readers_count":44,"score":1059.0,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24334,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-23T21:34:44.954Z","cooked":"\u003cp\u003eDid you look at this variable animation process to control simple animation? \u003ca href=\"https://discourse.urho3d.io/t/3rd-person-shooter-animation-wip/4027/4\"\u003e3rd person shooter animation WIP\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI chose to share that bit of code with you in mind because it alleviates knowing what the joint orientation/transofrm is and can be easily controlled by a key.  In that example, the \u003cstrong\u003epitchInv\u003c/strong\u003e is the key which is in the range[0:1].  And the since the neck is a single joint, the cost of the operation is one rotation multiplication.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2018-04-23T21:36:56.558Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":44,"readers_count":43,"score":13.8,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://discourse.urho3d.io/t/3rd-person-shooter-animation-wip/4027/4","internal":true,"reflection":false,"title":"3rd person shooter animation WIP","clicks":21}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24335,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-23T21:49:18.889Z","cooked":"\u003cp\u003eThank you so much for sharing.\u003c/p\u003e\n\u003cp\u003eThat is cool and makes whole thing much easier, but how many animations can AnimationController handle at the same time? As I have the same idea for character customization (body height, arms, legs size, face features (bone-based)), adding all these together, won’t it make everything very heavy on CPU/hit some limit? Making animations which do not change most of time is also looks like waste of resources, maybe it is possible to “bake” them into bones as changes complete?\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2018-04-23T21:49:18.889Z","reply_count":0,"reply_to_post_number":2,"quote_count":0,"incoming_link_count":2,"reads":44,"readers_count":43,"score":18.8,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Lumak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24336,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-23T22:01:30.730Z","cooked":"\u003cp\u003eIn regards to the neck animation, it’s very minimal with only one rotation multiplication, and you can even set the joint animation flag to false to save more time and turn it on only when you need. Limit with the layered animation is that there are eight layer channels that you can use.\u003c/p\u003e\n\u003cp\u003eBut for the remaining animation cost, I took some measurements here, \u003ca href=\"https://discourse.urho3d.io/t/what-if-there-was-animation-controller-proxy/4089\"\u003eWhat if -- there was animation controller proxy\u003c/a\u003e, and the entire animation process for a single frame (that model having ~40 joints, I think) was measure in terms of nano seconds.  What costs more is calling PlayExclusive() or Play() every frame because it evaulates fades if you have fade time. Merely checking if the animation is playing first then calling Play()/PlayExclusive() would optimize it.\u003c/p\u003e\n\u003cp\u003eedit: err, whole body animation per single frame is probably in terms of hundreds of nano seconds, not nano seconds because occasionally, it’ll pick up as 1 in high frequency timer.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2018-04-23T22:11:27.510Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":4,"reads":42,"readers_count":41,"score":33.4,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://discourse.urho3d.io/t/what-if-there-was-animation-controller-proxy/4089","internal":true,"reflection":false,"title":"What if -- there was animation controller proxy","clicks":2}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24337,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-23T22:15:52.733Z","cooked":"\u003cp\u003eAn additional problem with not knowing bone orientation is IK. I probably can do animations for all possible angles then  doinverse lerp but that looks way too weird.\u003c/p\u003e\n\u003cp\u003eI wonder how Unity MecAnim handles these - it imports any character I have like magic and all the controls work perfectly well. So there should be some way to calculate the values…\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2018-04-23T22:15:52.733Z","reply_count":1,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":1,"reads":39,"readers_count":38,"score":17.8,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Lumak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24338,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-23T22:24:40.660Z","cooked":"\u003cp\u003eHaven’t look at Unity MecAnim, but Unity is now open source, \u003ca href=\"https://blog.github.com/2017-06-28-github-for-unity-is-now-open-source/\"\u003ehttps://blog.github.com/2017-06-28-github-for-unity-is-now-open-source/\u003c/a\u003e , and perhaps you can learn from what they’re doing.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2018-04-23T22:24:40.660Z","reply_count":1,"reply_to_post_number":5,"quote_count":0,"incoming_link_count":0,"reads":35,"readers_count":34,"score":12.0,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://blog.github.com/2017-06-28-github-for-unity-is-now-open-source/","internal":false,"reflection":false,"title":"GitHub for Unity is now open source | The GitHub Blog","clicks":9}],"read":true,"user_title":null,"reply_to_user":{"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24339,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-23T22:26:56.389Z","cooked":"\u003cp\u003eWell, this is Github for Unity extension (which allows Unity to work with github), so no fish there…\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2018-04-23T22:26:56.389Z","reply_count":0,"reply_to_post_number":6,"quote_count":0,"incoming_link_count":1,"reads":35,"readers_count":34,"score":12.0,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Lumak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24340,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-23T22:30:15.551Z","cooked":"\u003cp\u003eI remember the news but had to google it to get the link, and apparently got the wrong one. Try this - \u003ca href=\"https://docs.unity3d.com/560/Documentation/Manual/OpenSourceRepositories.html\"\u003ehttps://docs.unity3d.com/560/Documentation/Manual/OpenSourceRepositories.html\u003c/a\u003e\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2018-04-23T22:30:15.551Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":34,"readers_count":33,"score":11.8,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://docs.unity3d.com/560/Documentation/Manual/OpenSourceRepositories.html","internal":false,"reflection":false,"title":"Unity - Manual: Open-source repositories","clicks":7}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24341,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-23T22:50:30.073Z","cooked":"\u003cp\u003eWell, looking at this I found no mecanim source, but it is possible I missed something.\u003cbr\u003e\nMost of source code in the repos are various demo projects.\u003c/p\u003e\n\u003cp\u003eThe other engine source I have before my eyes is UE4, which is HUGE and I still not had much luck looking it up for similar tools…\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2018-04-23T22:50:30.073Z","reply_count":0,"reply_to_post_number":8,"quote_count":0,"incoming_link_count":0,"reads":35,"readers_count":34,"score":7.0,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Lumak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24342,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-23T22:56:26.889Z","cooked":"\u003cp\u003eThe unity mecanim is free products at the unity asset store, \u003ca href=\"https://www.assetstore.unity3d.com/en/?stay#!/search/page=1/sortby=relevance/query=mecanim\u0026amp;price:0\"\u003ehttps://www.assetstore.unity3d.com/en/?stay#!/search/page=1/sortby=relevance/query=mecanim\u0026amp;price:0\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAnd now the engine is open source, you should be able to code trace the processes that you’re curious about.\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2018-04-23T22:56:26.889Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":34,"readers_count":33,"score":11.8,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://www.assetstore.unity3d.com/en/?stay#!/search/page=1/sortby=relevance/query=mecanim\u0026price:0","internal":false,"reflection":false,"clicks":4}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24343,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-24T02:06:35.109Z","cooked":"\u003cp\u003eAccording to “unity source code”, mecanim is part of native code which is unline C# stuff was not shown to public (only ones who paid for source license can see this). So I can’t see anything  there.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2018-04-24T02:06:35.109Z","reply_count":0,"reply_to_post_number":10,"quote_count":0,"incoming_link_count":0,"reads":34,"readers_count":33,"score":6.8,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Lumak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24344,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-24T03:15:45.405Z","cooked":"\u003cp\u003eOk, I read what it really means with \u003cem\u003e“Unity is now open source”\u003c/em\u003e – it’s BS! They should’ve just said that commonly used source projects with the Unity engine is open source.\u003c/p\u003e\n\u003cp\u003eHowever, I did download a \u003cstrong\u003eMecanim\u003c/strong\u003e example - \u003ca href=\"https://www.assetstore.unity3d.com/en/?stay#!/content/5328\"\u003ehttps://www.assetstore.unity3d.com/en/?stay#!/content/5328\u003c/a\u003e, and see there’s .cs code for every example given.  And you can cross reference with \u003ca href=\"https://github.com/Unity-Technologies/UnityCsReference\"\u003ehttps://github.com/Unity-Technologies/UnityCsReference\u003c/a\u003e to get a good idea what’s going on.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2018-04-24T03:15:45.405Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":32,"readers_count":31,"score":16.4,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/Unity-Technologies/UnityCsReference","internal":false,"reflection":false,"title":"GitHub - Unity-Technologies/UnityCsReference: Unity C# reference source code","clicks":3},{"url":"https://www.assetstore.unity3d.com/en/?stay#!/content/5328","internal":false,"reflection":false,"clicks":2}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24348,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-24T15:49:25.655Z","cooked":"\u003cp\u003eWell, after I got some sleep with the problem I was able to split it to better redefine it.\u003c/p\u003e\n\u003cp\u003eThe idea is the following - we have a character (lets assume we have very simple one), having 2 limbs and a set of bones which are parents to these limbs. All bones orientation is random (we want use skeletons made in different software). We have our controls which we want to use, which work always the same (I rotate control over X axis then my bone rotates over character-relative (local) X axis, not around bone X axis.\u003cbr\u003e\nSo idea is to find conversion quaternion, which would allow converting character space to bone local space. The conversion is required every frame as bone spaces change.\u003cbr\u003e\nSo LookAt approach will almost never work as it assumes that in local space Z is always front and Y is up. The magic will work for axis-oriented bones (fully vertical or horizontal for humanoid) with wrapping up vector so, that it points in bone direction, but it is not enough if bone’s front is reversed.\u003c/p\u003e\n\u003cp\u003eThe magic resolution to this problem is “inserting” a parent “bone” which is oriented in character space. if we rotate “child”, the “child” will obey and rotate in space we like.\u003cbr\u003e\nOf course we do not want to change actual skeleton to implement this, so this have to be done with quaternion math.\u003c/p\u003e\n\u003cp\u003eThe good thing about this approach is that we calculate the conversion only once, during skeleton load, we don’t need to convert this every frame. I think this is actual power behind mecanim.\u003c/p\u003e\n\u003cp\u003eBut now I need to find out which mith I need which is really complex for my poor brain now, but understanding that is a progress already.\u003c/p\u003e\n\u003cp\u003ebtw, mecanim is not a part f that C# code drop, grepping through that one can find that mecanim is native code (written in whatever compiled language they use, C, C++ or something).\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2018-04-24T15:49:25.655Z","reply_count":1,"reply_to_post_number":12,"quote_count":0,"incoming_link_count":1,"reads":27,"readers_count":26,"score":15.4,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Lumak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24351,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-24T18:01:28.442Z","cooked":"\u003cp\u003eI don’t know whether Mecanim is a class in Unity engine. I thought it was just project example on the asset store. Anyway, having bought many character packs in the past, one distinguishing feature that I can see common in all to test whether the char needs to be rotated 180 degrees or not is the direction of the toes.\u003cbr\u003e\npseudo code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eif ((toenode-\u0026gt;GetWorldDirection() - footnode-\u0026gt;GetWorldDirection()).DotProduct(Vector3::FORWARD)  \u0026gt;= near 1)\n // don't need to rotate 180\nelse\n// rotate 180\u003c/code\u003e\u003c/pre\u003e","post_number":14,"post_type":1,"updated_at":"2018-04-24T18:01:28.442Z","reply_count":0,"reply_to_post_number":13,"quote_count":0,"incoming_link_count":0,"reads":27,"readers_count":26,"score":5.4,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24352,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-24T21:19:06.762Z","cooked":"\u003cp\u003eTo illustrate the idea:\u003cbr\u003e\n\u003cimg src=\"//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/7/7fb30f8fe8b116bba96775de7ab51bf4665f2de8.png\" alt=\"extra-bone\" width=\"500\" height=\"1000\"\u003e\u003c/p\u003e\n\u003cp\u003eAdding extra “bone” allows easier procedural posing. Now I need to find the required math.\u003c/p\u003e\n\u003cp\u003eAs I understand I need wanted rotation (0, 0, 0 but YMMV, 0, 0, 0 mean direction 0, 0, 1), parent bone world rotation, and base character node rotation. so I need to multiply Quaternion(0, 0, 0) to\u003cbr\u003e\ninverse of (parent_world_rotation * character_world_rotation.Inverse()). So whole expression for extra node rotation will be Quaternion() * (parent_world_rotation * character_world_rotation.Inverse()).Inverse() is it correct? I never was able to properly catch quaternion math \u003cimg src=\"/images/emoji/twitter/frowning.png?v=9\" title=\":frowning:\" class=\"emoji\" alt=\":frowning:\"\u003e\u003c/p\u003e","post_number":15,"post_type":1,"updated_at":"2018-04-24T22:03:05.398Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":26,"readers_count":25,"score":5.2,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24353,"name":"","username":"Lumak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","created_at":"2018-04-24T21:49:46.520Z","cooked":"\u003cp\u003eI have no idea what you’re trying to do, and I don’t think more guessing would help. If you don’t think Unity or UE would be helpful then perhaps, learning how Urho3D’s IK handles rotation multiplication would help.\u003c/p\u003e","post_number":16,"post_type":1,"updated_at":"2018-04-24T21:49:46.520Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":5.0,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":256,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24354,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-24T22:44:41.036Z","cooked":"\u003cp\u003eWell the code for finding the transform for parent is this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e/* This is run at skeleton load time, not at run time to calculate the correction value\nthe character node should be at origin for this to work\ncontrol is initial control rotation */\nQuaternion correction(Node *bone, Quaternion control = Quaternion::IDENTITY)\n{\n        Node *parent = bone-\u0026gt;GetParent();\n        Quaternion parent_rotation = parent-\u0026gt;GetWorldRotation();\n        Quaternion local_rotation = parent_rotation.Inverse() * control;\n        return local_rotation;\n}\n...\n/* Fixup local rotation for a bone */\nQuaternion fixup_rotation(Quaternion control, Quaternion fixup)\n{\n        Quaternion rotation = control * fixup;\n        return rotation;\n}\n\n....\n/* use like this in main loop */\nbone-\u0026gt;SetRotation(fixup_rotation(control_data[bone].control, control_data[bone].fixup));\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe idea behind this is simple - we have manually-created or procedural “skeleton” where all bone “nodes” are set like it is easier for us to animate procedurally. This “skeleton” is the same for all characters. It might or might not be used for animations. It contains subset of bones which are important for average animations (not the highly detailed most important ones). It can be implemented as array of bone names or ids in real skeleton (which are used for procedural animation) and correction values. It is what is used to for procedural animations most of time (IK, ragdoll, etc).\u003c/p\u003e\n\u003cp\u003eWe also have our skeleton exported from application, which can have any topology and any number of bones. When procedural animation running (even on some of the bones) it gets rotations from “control” skeleton, converts them to actual rotations on real skeleton and apply them to bones.\u003cbr\u003e\nDoes it sound reasonable?\u003c/p\u003e","post_number":17,"post_type":1,"updated_at":"2018-04-24T22:46:33.743Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":5.0,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24355,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-25T00:17:48.392Z","cooked":"\u003cp\u003eWell, the code above is not quite correct, but I’m close as ever to implement what I need.\u003cbr\u003e\nI basically need node-\u0026gt;Rotate()-like code, but for absolute value, which will work as basis.\u003c/p\u003e","post_number":18,"post_type":1,"updated_at":"2018-04-25T00:17:48.392Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":5.0,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":24370,"name":"","username":"slapin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","created_at":"2018-04-26T05:34:51.879Z","cooked":"\u003cp\u003eLooks like I found proper way for bone rotation which does not make my brain explode.\u003cbr\u003e\nIt is quite simple actually\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e                protected:\n                        Urho3D::Quaternion proper_rotation(Urho3D::Node *bone, Urho3D::Quaternion control)\n                        {\n                                Urho3D::Quaternion  ret;\n                                ret = default_rot * world_rot_inv * control * world_rot;\n                                return ret;\n                        }\n                public:\n                        void update_transforms()\n                        {\n                                world_rot = node-\u0026gt;GetWorldRotation();\n                                world_rot_inv = world_rot.Inverse();\n                        }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eupdate_transforms() is run once on skeleton load while it is at origin.\u003cbr\u003e\nThen all the values stay the same. If the values are updated per frame,\u003cbr\u003e\nthe rotation is extremely unstable. But retaining the values allow quite intuitive rotations,\u003cbr\u003e\nwhich are not world space, but in local space, but they are rotated properly regardless of the\u003cbr\u003e\nskeleton.\u003c/p\u003e\n\u003cp\u003eWill work-out demo for this on a weekend, I think something nice should come out of it.\u003c/p\u003e","post_number":19,"post_type":1,"updated_at":"2018-04-26T05:34:51.879Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":23,"readers_count":22,"score":19.6,"yours":false,"topic_id":4193,"topic_slug":"how-can-i-detect-bone-orientation-in-skeleton","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":554,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[24332,24334,24335,24336,24337,24338,24339,24340,24341,24342,24343,24344,24348,24351,24352,24353,24354,24355,24370]},"timeline_lookup":[[1,1674],[14,1673],[19,1672]],"suggested_topics":[{"id":7086,"title":"Handling CrowdAgents that get stuck","fancy_title":"Handling CrowdAgents that get stuck","slug":"handling-crowdagents-that-get-stuck","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-04T01:26:23.062Z","last_posted_at":"2021-12-05T04:37:54.143Z","bumped":true,"bumped_at":"2021-12-05T04:37:54.143Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7065,"title":"Angelscript: Loading a char file into a 2D array: how?","fancy_title":"Angelscript: Loading a char file into a 2D array: how?","slug":"angelscript-loading-a-char-file-into-a-2d-array-how","posts_count":7,"reply_count":4,"highest_post_number":7,"image_url":null,"created_at":"2021-11-24T09:20:05.420Z","last_posted_at":"2021-11-28T11:19:39.689Z","bumped":true,"bumped_at":"2021-11-28T11:26:00.375Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":239,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1491,"username":"xlat","name":"Alex Kuch","avatar_template":"/user_avatar/discourse.urho3d.io/xlat/{size}/3620_2.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":983,"username":"tarzeron","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ecae2f/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7138,"title":"Build fails (linking phase) on Linux","fancy_title":"Build fails (linking phase) on Linux","slug":"build-fails-linking-phase-on-linux","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-01-20T03:08:29.663Z","last_posted_at":"2022-01-21T15:27:41.192Z","bumped":true,"bumped_at":"2022-01-21T15:27:41.192Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":178,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1502,"username":"jasperry","name":"Jason Perry","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/5fc32e/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}}]},{"id":7146,"title":"How create affordable comfortable and modern terrain?","fancy_title":"How create affordable comfortable and modern terrain?","slug":"how-create-affordable-comfortable-and-modern-terrain","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-01-21T15:20:08.910Z","last_posted_at":"2022-01-21T21:51:58.799Z","bumped":true,"bumped_at":"2022-01-21T22:03:14.896Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":193,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1497,"username":"timob256","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/b782af/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":230,"username":"Nerrik","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/958977/{size}.png"}}]},{"id":7204,"title":"How handle with multiple scenes?","fancy_title":"How handle with multiple scenes?","slug":"how-handle-with-multiple-scenes","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-02-23T16:15:02.697Z","last_posted_at":"2022-02-23T16:15:02.762Z","bumped":true,"bumped_at":"2022-02-23T16:15:02.762Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":131,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1508,"username":"killinbassou","name":"killin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/848f3c/{size}.png"}}]}],"tags_descriptions":{},"id":4193,"title":"How can I detect bone orientation in skeleton?","fancy_title":"How can I detect bone orientation in skeleton?","posts_count":19,"created_at":"2018-04-23T19:04:01.884Z","views":1315,"reply_count":8,"like_count":1,"last_posted_at":"2018-04-26T05:34:51.879Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"how-can-i-detect-bone-orientation-in-skeleton","category_id":10,"word_count":1725,"deleted_at":null,"user_id":554,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_4193","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":19,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":554,"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png","post_count":11,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":256,"username":"Lumak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/8491ac/{size}.png","post_count":8,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":554,"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"last_poster":{"id":554,"username":"slapin","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/dfb087/{size}.png"},"links":[{"url":"https://discourse.urho3d.io/t/3rd-person-shooter-animation-wip/4027/4","title":"3rd person shooter animation WIP","internal":true,"attachment":false,"reflection":false,"clicks":21,"user_id":256,"domain":"discourse.urho3d.io","root_domain":"urho3d.io"},{"url":"https://blog.github.com/2017-06-28-github-for-unity-is-now-open-source/","title":"GitHub for Unity is now open source | The GitHub Blog","internal":false,"attachment":false,"reflection":false,"clicks":9,"user_id":256,"domain":"blog.github.com","root_domain":"github.com"},{"url":"https://docs.unity3d.com/560/Documentation/Manual/OpenSourceRepositories.html","title":"Unity - Manual: Open-source repositories","internal":false,"attachment":false,"reflection":false,"clicks":7,"user_id":256,"domain":"docs.unity3d.com","root_domain":"unity3d.com"},{"url":"https://www.assetstore.unity3d.com/en/?stay#!/search/page=1/sortby=relevance/query=mecanim\u0026price:0","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":4,"user_id":256,"domain":"www.assetstore.unity3d.com","root_domain":"unity3d.com"},{"url":"https://github.com/Unity-Technologies/UnityCsReference","title":"GitHub - Unity-Technologies/UnityCsReference: Unity C# reference source code","internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":256,"domain":"github.com","root_domain":"github.com"},{"url":"https://discourse.urho3d.io/t/what-if-there-was-animation-controller-proxy/4089","title":"What if -- there was animation controller proxy","internal":true,"attachment":false,"reflection":false,"clicks":2,"user_id":256,"domain":"discourse.urho3d.io","root_domain":"urho3d.io"},{"url":"https://www.assetstore.unity3d.com/en/?stay#!/content/5328","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":2,"user_id":256,"domain":"www.assetstore.unity3d.com","root_domain":"unity3d.com"}]}}