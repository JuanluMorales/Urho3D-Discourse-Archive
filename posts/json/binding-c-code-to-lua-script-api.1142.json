{"post_stream":{"posts":[{"id":6570,"name":"","username":"setzer22","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ce7236/{size}.png","created_at":"2015-06-26T19:19:38.000Z","cooked":"\u003cp\u003eHello,\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003eEDIT:\u003c/span\u003e As I consider my questions were too vague, I made a reply asking for specific things after understanding a bit better how everything works with lua.\u003c/p\u003e\n\u003cp\u003eI’m learning Lua with Urho3D and right now I’m trying to bind my custom component’s API to the Lua script subsystem.\u003c/p\u003e\n\u003cp\u003eI’m reading through tolua++'s documentation and I get how it works: You provide it “cleaned up” header files it can parse and then generate auto binding code. But the problem is that I don’t know exactly how does Urho register its API.\u003c/p\u003e\n\u003cp\u003eMy question is, How would I go into registering my own API with pkg files, and adapt my build system so the bindings are generated, just like Urho does?\u003c/p\u003e\n\u003cp\u003eMy main concern is how should I go with including the Urho3D headers so tolua++ can use Urho’s types. For example if I’m using RigidBody in my component, does the pkg file need that reference? Or that’s just for my own defined classes (as Urho types are already bound by the engine).\u003c/p\u003e\n\u003cp\u003eThank you! \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/smiley.png?v=5\" title=\":smiley:\" class=\"emoji\" alt=\":smiley:\"\u003e\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:05:42.000Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":136,"reads":41,"readers_count":40,"score":688.2,"yours":false,"topic_id":1142,"topic_slug":"binding-c-code-to-lua-script-api","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":125,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":6571,"name":"","username":"setzer22","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ce7236/{size}.png","created_at":"2015-06-26T21:54:59.000Z","cooked":"\u003cp\u003eWith some help from the IRC, I’ve been able to understand a bit more how tolua++ works and when it’s called by Urho. Now I’m able to ask more specific questions.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e-  If I understood correctly, each call to tolua++ generates a C file with a function that receives a pointer to the lua \"context\" (actually called lua_state). That function adds everything that needs to be added to the Lua state. Am I right?\n\n- In order to actually do the binding, I should get the lua_state pointer (from the LuaScript class) and call the C generated function with it. To do so I can load the C generated function as an extern symbol into my game code, right?\n\n- Given Lua's weak typing, anything that's not a basic type (like int or float) will be interpreted as a table, so there's no need to include all the files that depend on a given pkg, for example, if a function receives an Urho3D::Rigidbody* as a parameter on the C++ side, ToLua++ will just interpret that as a table, and then it's the lua programmer's fault if it calls it with the wrong data. Did I get this right?\n\n- Due to my last point, I just assumed pkg includes in tolua++ are just a convenience so I can generate a C file that binds a bunch of classes right? In my case, would it be OK to just make a pkg that includes all the other pkgs so I generate a single C file to bind them all? (i.e. one C file to rule them all, and into the engine bind them... Sorry I couldn't help it  :smiley: ).\n\n- Do I have to do anything special to deal with String, Vector and the likes? I assume Urho just maps those types to its lua equivalents. If my pkgs just reference Urho3D::String and Urho3D::Vector without doing anything else will I get that behaviour?\n\n- Lastly, I saw some pkg files in Urho's source including header files and using \"using namespace\". That is done so the generated code is able to retrieve those symbols, right? In my case, all those symbols should already be in in memory when compiling the file, so there's no need for a .h include right?.\u003c/code\u003e\u003c/pre\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:05:42.067Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":41,"readers_count":40,"score":8.2,"yours":false,"topic_id":1142,"topic_slug":"binding-c-code-to-lua-script-api","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":125,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":6606,"name":"","username":"setzer22","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ce7236/{size}.png","created_at":"2015-06-30T11:17:33.000Z","cooked":"\u003cp\u003eIn order to share my knowledge to future readers I’ll just answer my own questions with what I’ve found out by trial and error:\u003c/p\u003e\n\u003caside class=\"quote\"\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIf I understood correctly, each call to tolua++ generates a C file with a function that receives a pointer to the lua “context” (actually called lua_state). That function adds everything that needs to be added to the Lua state. Am I right?\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIn order to actually do the binding, I should get the lua_state pointer (from the LuaScript class) and call the C generated function with it. To do so I can load the C generated function as an extern symbol into my game code, right?\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eAll what I said above works just as I expected. I just need to get the lua_state from the LuaScript subsystem after its instantiation and call the external function generated by tolua++. That makes the C++ API available to my Lua scripts.\u003c/p\u003e\n\u003cp\u003e[quote]- Given Lua’s weak typing, anything that’s not a basic type (like int or float) will be interpreted as a table, so there’s no need to include all the files that depend on a given pkg, for example, if a function receives an Urho3D::Rigidbody* as a parameter on the C++ side, ToLua++ will just interpret that as a table, and then it’s the lua programmer’s fault if it calls it with the wrong data. Did I get this right?\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDo I have to do anything special to deal with String, Vector and the likes? I assume Urho just maps those types to its lua equivalents. If my pkgs just reference Urho3D::String and Urho3D::Vector without doing anything else will I get that behaviour?[/quote]\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eRegarding all that, I’ve found out most of it is true. Sadly you can pass any type to the C++ side from Lua, and you can get a lot of crashes from silly mistakes as well. But that’s what comes with such a weak typing system in combination with C++ I guess. I think URH3D_SAFE_LUA flag prevents some of those.\u003c/p\u003e\n\u003cp\u003eEven though, some types are not interpreted as tables but userdata, which is then handled with metatables.\u003c/p\u003e\n\u003cp\u003eAlso, I had to do nothing to deal with Strings or Vectors, those seem to be already handled by ToLua++. I’ve had to call it with the command line option “-L ToCppHook.lua”, and I think all this is handled there.\u003c/p\u003e\n\u003caside class=\"quote\"\u003e\n\u003cblockquote\u003e\n\u003cp\u003e- Lastly, I saw some pkg files in Urho’s source including header files and using “using namespace”. That is done so the generated code is able to retrieve those symbols, right? In my case, all those symbols should already be in in memory when compiling the file, so there’s no need for a .h include right?.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eThere seems to be two kinds of includes in tolua++. There are the $pfile includes, which load a package file, and generate bindings for those as well in the same binder C code. Then there’s also $#include and $using, when those are present in a pkg file, they’re copied to the generated C code.\u003c/p\u003e\n\u003cp\u003eIn order for all symbols to be present in memory I’ve found useful to do (in MyComponent.pkg): $#include “MyComponent.h”. Also for that to work you should include the same $using directrives you have in your header file (I think).\u003c/p\u003e\n\u003cp\u003eAnd that’s all. I still don’t know much of the lua bindings, but I’ll try to make a small guide when I’m a bit more knowledgeable on the topic!\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:05:44.757Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":41,"readers_count":40,"score":13.2,"yours":false,"topic_id":1142,"topic_slug":"binding-c-code-to-lua-script-api","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":125,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26642,"name":"","username":"ezark","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/e/bc8723/{size}.png","created_at":"2018-11-16T12:18:53.619Z","cooked":"\u003cp\u003eMaybe it is created in the Urho3d/CMakeLists.txt.\u003cbr\u003e\ntolua++ uses .pkg file to generate ${DIR}LuaAPI.cpp.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2018-11-16T12:18:53.619Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":30,"readers_count":29,"score":8.0,"yours":false,"topic_id":1142,"topic_slug":"binding-c-code-to-lua-script-api","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1074,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[6570,6571,6606,26642]},"timeline_lookup":[[1,2706],[3,2703],[4,1468]],"suggested_topics":[{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7156,"title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","fancy_title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","slug":"manual-mesh-part-animation-e-g-rotate-a-propeller","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-01-26T23:50:29.343Z","last_posted_at":"2022-01-27T05:31:02.766Z","bumped":true,"bumped_at":"2022-01-27T05:31:02.766Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":155,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7092,"title":"Finding the World Space Coordinates of the Screen Edges","fancy_title":"Finding the World Space Coordinates of the Screen Edges","slug":"finding-the-world-space-coordinates-of-the-screen-edges","posts_count":6,"reply_count":2,"highest_post_number":6,"image_url":null,"created_at":"2021-12-07T20:53:49.453Z","last_posted_at":"2021-12-08T12:33:52.510Z","bumped":true,"bumped_at":"2021-12-08T12:33:52.510Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":210,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]},{"id":7098,"title":"Cartoon Fire Effect","fancy_title":"Cartoon Fire Effect","slug":"cartoon-fire-effect","posts_count":6,"reply_count":0,"highest_post_number":6,"image_url":null,"created_at":"2021-12-10T04:08:49.887Z","last_posted_at":"2021-12-12T02:49:51.076Z","bumped":true,"bumped_at":"2021-12-12T02:49:51.076Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":274,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7204,"title":"How handle with multiple scenes?","fancy_title":"How handle with multiple scenes?","slug":"how-handle-with-multiple-scenes","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-02-23T16:15:02.697Z","last_posted_at":"2022-02-23T16:15:02.762Z","bumped":true,"bumped_at":"2022-02-23T16:15:02.762Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":131,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1508,"username":"killinbassou","name":"killin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/848f3c/{size}.png"}}]}],"tags_descriptions":{},"id":1142,"title":"Binding C++ code to Lua script API","fancy_title":"Binding C++ code to Lua script API","posts_count":4,"created_at":"2015-06-26T19:19:38.000Z","views":695,"reply_count":0,"like_count":0,"last_posted_at":"2018-11-16T12:18:53.619Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"binding-c-code-to-lua-script-api","category_id":10,"word_count":1189,"deleted_at":null,"user_id":125,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1142","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":4,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":125,"username":"setzer22","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ce7236/{size}.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":1074,"username":"ezark","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/e/bc8723/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":125,"username":"setzer22","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ce7236/{size}.png"},"last_poster":{"id":1074,"username":"ezark","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/e/bc8723/{size}.png"}}}