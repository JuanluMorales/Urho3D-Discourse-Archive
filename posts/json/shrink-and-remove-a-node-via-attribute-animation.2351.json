{"post_stream":{"posts":[{"id":14183,"name":"","username":"vudugun","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/d07c76/{size}.png","created_at":"2016-10-21T21:02:23.000Z","cooked":"\u003cp\u003eHello,\u003cbr\u003e\nis this the proper way to shrink a node and remove it using attribute animation?\u003c/p\u003e\n\u003cp\u003e[code]void MyComponent::ShrinkAndRemove()\u003cbr\u003e\n{\u003cbr\u003e\nValueAnimation* anim{ new ValueAnimation{ context_ } };\u003cbr\u003e\nanim-\u0026gt;SetKeyFrame(0.0f, Vector3{ 1.0f, 1.0f, 1.0f });\u003cbr\u003e\nanim-\u0026gt;SetKeyFrame(0.5f, Vector3{ 0.2f, 0.2f, 0.2f });\u003cbr\u003e\nanim-\u0026gt;SetEventFrame(0.51f, E_SHRUNK);\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eGetNode()-\u0026gt;SetAttributeAnimation(\"Scale\", anim, WM_ONCE);\n\nSubscribeToEvent(GetNode(), E_SHRUNK, URHO3D_HANDLER(MyComponent, HandleShrunk));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}\u003c/p\u003e\n\u003cp\u003evoid MyComponent::HandleShrunk(StringHash eventType, VariantMap\u0026amp; eventData)\u003cbr\u003e\n{\u003cbr\u003e\nGetNode()-\u0026gt;Remove();\u003cbr\u003e\n}[/code]\u003cbr\u003e\nI am asking because I need two patches to get it working.\u003c/p\u003e\n\u003cp\u003e[size=150]Problem 1[/size]\u003c/p\u003e\n\u003cp\u003eThe event does not fire when time \u0026gt; 0.5. I traced the problem down to ValueAnimation::SetEventFrame(), where the begin/end times are \u003cspan class=\"bbcode-b\"\u003enot\u003c/span\u003e updated, unlike what happens in SetKeyFrame:\u003c/p\u003e\n\u003cp\u003e[code]bool ValueAnimation::SetKeyFrame(float time, const Variant\u0026amp; value)\u003cbr\u003e\n{\u003cbr\u003e\n…\u003cbr\u003e\nbeginTime_ = Min(time, beginTime_);\u003cbr\u003e\nendTime_ = Max(time, endTime_);\u003cbr\u003e\nsplineTangentsDirty_ = true;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ereturn true;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}\u003c/p\u003e\n\u003cp\u003evoid ValueAnimation::SetEventFrame(float time, const StringHash\u0026amp; eventType, const VariantMap\u0026amp; eventData)\u003cbr\u003e\n{\u003cbr\u003e\nVAnimEventFrame eventFrame;\u003cbr\u003e\neventFrame.time_ = time;\u003cbr\u003e\neventFrame.eventType_ = eventType;\u003cbr\u003e\neventFrame.eventData_ = eventData;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eif (eventFrames_.Empty() || time \u0026gt;= eventFrames_.Back().time_)\n    eventFrames_.Push(eventFrame);\nelse\n{\n    for (unsigned i = 0; i \u0026lt; eventFrames_.Size(); ++i)\n    {\n        if (time \u0026lt; eventFrames_[i].time_)\n        {\n            eventFrames_.Insert(i, eventFrame);\n            break;\n        }\n    }\n}\n\n// ****** NOTHING HERE?? ******\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}[/code]\u003cbr\u003e\nCopying the three lines from SetKetFrame() solved the problem.\u003c/p\u003e\n\u003cp\u003e[size=150]Problem 2[/size]\u003c/p\u003e\n\u003cp\u003eI am getting a crash inside Animatable::UpdateAttributeAnimations() just after my event handler is called (in the same loop):\u003c/p\u003e\n\u003cp\u003e[code]void Animatable::UpdateAttributeAnimations(float timeStep)\u003cbr\u003e\n{\u003cbr\u003e\nif (!animationEnabled_)\u003cbr\u003e\nreturn;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eSharedPtr\u0026lt;Animatable\u0026gt; self(this); // ****** PATCH\n\nVector\u0026lt;String\u0026gt; finishedNames;\nfor (HashMap\u0026lt;String, SharedPtr\u0026lt;AttributeAnimationInfo\u0026gt; \u0026gt;::ConstIterator i = attributeAnimationInfos_.Begin();\n     i != attributeAnimationInfos_.End(); ++i)\n{\n    if (i-\u0026gt;second_-\u0026gt;Update(timeStep))\n        finishedNames.Push(i-\u0026gt;second_-\u0026gt;GetAttributeInfo().name_); // ****** CRASH HERE\n}\n\nfor (unsigned i = 0; i \u0026lt; finishedNames.Size(); ++i)\n    SetAttributeAnimation(finishedNames[i], 0);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}[/code]\u003c/p\u003e\n\u003cp\u003eThe debugger shows the Animatable “this” pointer is invalid at that point because Node::Remove() deletes the node as well (no references left). So, I added the ugly line above to keep it alive.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:14:54.597Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":40,"reads":14,"readers_count":13,"score":202.8,"yours":false,"topic_id":2351,"topic_slug":"shrink-and-remove-a-node-via-attribute-animation","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":557,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14223,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-10-25T15:13:44.000Z","cooked":"\u003cp\u003eThanks, look like definite bugs! The common pattern we use in UI code is to always check for sender existence after returning from the event, no doubt it’s necessary here as well.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:14:57.353Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":2351,"topic_slug":"shrink-and-remove-a-node-via-attribute-animation","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14224,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-10-25T18:38:46.000Z","cooked":"\u003cp\u003eFixes are in the master branch.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:14:57.428Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":6,"reads":13,"readers_count":12,"score":32.6,"yours":false,"topic_id":2351,"topic_slug":"shrink-and-remove-a-node-via-attribute-animation","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14225,"name":"","username":"vudugun","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/d07c76/{size}.png","created_at":"2016-10-25T19:15:26.000Z","cooked":"\u003cp\u003eThanks for the reply and the quick fixes!\u003c/p\u003e\n\u003cp\u003eIn the meantime, I managed to crash in Material::HandleAttributeAnimationUpdate() as well, for the same reason as above (remove node at the end of material animation)\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:14:57.483Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":2351,"topic_slug":"shrink-and-remove-a-node-via-attribute-animation","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":557,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14226,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-10-25T21:02:30.000Z","cooked":"\u003cp\u003eShould be fixed as well. In addition in my testing I found that material animation event could be erroneously transmitted on the first frame, which got fixed too.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:14:57.541Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":11,"readers_count":10,"score":2.2,"yours":false,"topic_id":2351,"topic_slug":"shrink-and-remove-a-node-via-attribute-animation","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[14183,14223,14224,14225,14226]},"timeline_lookup":[[1,2223],[2,2220],[3,2219]],"suggested_topics":[{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7086,"title":"Handling CrowdAgents that get stuck","fancy_title":"Handling CrowdAgents that get stuck","slug":"handling-crowdagents-that-get-stuck","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-04T01:26:23.062Z","last_posted_at":"2021-12-05T04:37:54.143Z","bumped":true,"bumped_at":"2021-12-05T04:37:54.143Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7097,"title":"View Physics event for ConvexCast","fancy_title":"View Physics event for ConvexCast","slug":"view-physics-event-for-convexcast","posts_count":11,"reply_count":5,"highest_post_number":11,"image_url":null,"created_at":"2021-12-09T23:56:27.507Z","last_posted_at":"2021-12-12T20:20:02.788Z","bumped":true,"bumped_at":"2021-12-12T20:20:02.788Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":206,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7100,"title":"UI Sprites - Wrapping/Repeating Texture","fancy_title":"UI Sprites - Wrapping/Repeating Texture","slug":"ui-sprites-wrapping-repeating-texture","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/5d95641f056666c79c67a12520276d2d9f4729ae.png","created_at":"2021-12-15T20:32:37.485Z","last_posted_at":"2021-12-16T03:28:29.146Z","bumped":true,"bumped_at":"2021-12-16T03:28:29.146Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":193,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7123,"title":"Character hitboxes","fancy_title":"Character hitboxes","slug":"character-hitboxes","posts_count":24,"reply_count":16,"highest_post_number":24,"image_url":null,"created_at":"2022-01-10T19:34:24.617Z","last_posted_at":"2022-01-12T22:44:20.744Z","bumped":true,"bumped_at":"2022-01-12T22:44:20.744Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":275,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"}}]}],"tags_descriptions":{},"id":2351,"title":"Shrink and remove a node via attribute animation","fancy_title":"Shrink and remove a node via attribute animation","posts_count":5,"created_at":"2016-10-21T21:02:23.000Z","views":367,"reply_count":0,"like_count":0,"last_posted_at":"2016-10-25T21:02:30.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"shrink-and-remove-a-node-via-attribute-animation","category_id":10,"word_count":421,"deleted_at":null,"user_id":557,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_2351","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":5,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":557,"username":"vudugun","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/d07c76/{size}.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":557,"username":"vudugun","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/d07c76/{size}.png"},"last_poster":{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png"}}}