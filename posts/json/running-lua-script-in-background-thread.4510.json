{"post_stream":{"posts":[{"id":25796,"name":"Guilherme Freitas Nemeth","username":"glhrmfrts","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2018-08-30T18:41:26.380Z","cooked":"\u003cp\u003eHello, I‚Äôm making most of my game using lua, including my map generator, which takes some time and right now it‚Äôs blocking the main thread. I want to run it in the background and display a loading screen while it generates the map, so is it possible to run a lua script in a background thread? I‚Äôm using a customized version of the Urho3DPlayer and I have some experience with C++, I‚Äôm just not sure how I would approach this using the LuaScript subsystem.\u003c/p\u003e\n\u003cp\u003eThank you\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2018-08-30T18:41:26.380Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":227,"reads":29,"readers_count":28,"score":1140.8,"yours":false,"topic_id":4510,"topic_slug":"running-lua-script-in-background-thread","display_username":"Guilherme Freitas Nemeth","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1045,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":25800,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2018-08-31T02:36:02.086Z","cooked":"\u003cp\u003eI‚Äôm not sure how you would do that. The Lua script system just isn‚Äôt really designed that way. However, while someone more clever than me might be able to devise a solution, my recommendation is to move your map generation stuff into C++. The reason for this is tolua++. The Lua system uses tolua++ to generate the bindings, and as I‚Äôve discovered \u003ca href=\"https://github.com/urho3d/Urho3D/issues/649\" rel=\"nofollow noopener\"\u003ein the past\u003c/a\u003e it creates some tables behind the scenes to help it with management (tracking which classes are subclasses of others, etc‚Ä¶) that can grow pretty large. The bad part is, these tables don‚Äôt ever get compacted or resized, so as they grow they begin to bog down things like garbage collection.\u003c/p\u003e\n\u003cp\u003eUsage patterns that really trigger this behavior cropped up in my own map generation code. When I was generating tile map chunks, I would iterate a chunk on X and Y, and inside I would do Magic‚Ñ¢. However, if any of that Magic created any Urho3D objects that were to be managed by tolua++ (things such as Color or Vector3 returned by value from bound functions/methods or created inside the nested loops as locals) then those internal tables would grow huge, and cause nearly immediate performance problems. For that reason (as well as other general performance reasons) I moved all of my map generation logic into C++ routines, and reserved Lua for other, less garbage-intensive tasks.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2018-08-31T02:36:02.086Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":25,"readers_count":24,"score":10.0,"yours":false,"topic_id":4510,"topic_slug":"running-lua-script-in-background-thread","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/urho3d/Urho3D/issues/649","internal":false,"reflection":false,"title":"Lua: Objects not being garbage collected. ¬∑ Issue #649 ¬∑ urho3d/Urho3D ¬∑ GitHub","clicks":4}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[25796,25800]},"timeline_lookup":[[1,1545]],"suggested_topics":[{"id":7330,"title":"Is it Possible to Get New Bone Positions Directly After AnimationState.AddTime() Called?","fancy_title":"Is it Possible to Get New Bone Positions Directly After AnimationState.AddTime() Called?","slug":"is-it-possible-to-get-new-bone-positions-directly-after-animationstate-addtime-called","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-09-22T11:18:00.223Z","last_posted_at":"2022-09-22T13:40:17.428Z","bumped":true,"bumped_at":"2022-09-22T13:40:17.428Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":81,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}}]},{"id":7088,"title":"What Compiler is recommended for building Urho3D under Windows 7 32 bit?","fancy_title":"What Compiler is recommended for building Urho3D under Windows 7 32 bit?","slug":"what-compiler-is-recommended-for-building-urho3d-under-windows-7-32-bit","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-06T07:50:47.867Z","last_posted_at":"2021-12-06T13:55:20.901Z","bumped":true,"bumped_at":"2021-12-06T13:55:20.901Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":152,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1491,"username":"xlat","name":"Alex Kuch","avatar_template":"/user_avatar/discourse.urho3d.io/xlat/{size}/3620_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}}]},{"id":7245,"title":"Custom memory allocation","fancy_title":"Custom memory allocation","slug":"custom-memory-allocation","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-04-29T12:59:26.211Z","last_posted_at":"2022-04-29T23:01:14.486Z","bumped":true,"bumped_at":"2022-04-29T23:01:14.486Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":193,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1386,"username":"mohamed.chit","name":"Mohamed Chit","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/d6d6ee/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1363,"username":"vmost","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/5f9b8f/{size}.png"}}]},{"id":7104,"title":"Bug in my partial-model copying code","fancy_title":"Bug in my partial-model copying code","slug":"bug-in-my-partial-model-copying-code","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/5367e370779d64989e5c3ff2c1ebfb0689908c87.png","created_at":"2021-12-17T03:50:19.405Z","last_posted_at":"2021-12-17T13:50:49.662Z","bumped":true,"bumped_at":"2021-12-17T13:50:49.662Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":144,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7092,"title":"Finding the World Space Coordinates of the Screen Edges","fancy_title":"Finding the World Space Coordinates of the Screen Edges","slug":"finding-the-world-space-coordinates-of-the-screen-edges","posts_count":6,"reply_count":2,"highest_post_number":6,"image_url":null,"created_at":"2021-12-07T20:53:49.453Z","last_posted_at":"2021-12-08T12:33:52.510Z","bumped":true,"bumped_at":"2021-12-08T12:33:52.510Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":210,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]}],"tags_descriptions":{},"id":4510,"title":"Running lua script in background thread","fancy_title":"Running lua script in background thread","posts_count":2,"created_at":"2018-08-30T18:41:26.302Z","views":741,"reply_count":0,"like_count":0,"last_posted_at":"2018-08-31T02:36:02.086Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"running-lua-script-in-background-thread","category_id":7,"word_count":335,"deleted_at":null,"user_id":1045,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_4510","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":2,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":1045,"username":"glhrmfrts","name":"Guilherme Freitas Nemeth","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":1045,"username":"glhrmfrts","name":"Guilherme Freitas Nemeth","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"},"last_poster":{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png"},"links":[{"url":"https://github.com/urho3d/Urho3D/issues/649","title":"Lua: Objects not being garbage collected. ¬∑ Issue #649 ¬∑ urho3d/Urho3D ¬∑ GitHub","internal":false,"attachment":false,"reflection":false,"clicks":4,"user_id":30,"domain":"github.com","root_domain":"github.com"}]}}