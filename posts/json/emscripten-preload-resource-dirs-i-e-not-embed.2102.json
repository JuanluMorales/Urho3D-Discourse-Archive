{"post_stream":{"posts":[{"id":12693,"name":"","username":"godan","avatar_template":"/user_avatar/discourse.urho3d.io/godan/{size}/49_2.png","created_at":"2016-07-01T21:56:32.000Z","cooked":"\u003cp\u003eIs it possible to be able to swap out the Data/CoreData folders without rebuilding the UrhoPlayer with Emscripten? I was hoping that the EMSCRIPTE_SHARE_DATA option was related to this, and it does go part way (i.e. it creates the .js file and .data files that are referenced in the emscripten docs here: \u003ca href=\"https://kripken.github.io/emscripten-site/docs/porting/files/packaging_files.html\" rel=\"nofollow noopener\"\u003ekripken.github.io/emscripten-si … files.html\u003c/a\u003e). However, after building with this option, it still looks like the Data/Core Data pak files are embedded in the UrhoPlayer.js file.\u003c/p\u003e\n\u003cp\u003eIs there anyway to access the --preload compiler flag?\u003c/p\u003e\n\u003cp\u003eMore generally, I find it very hard to figure out what is happening in the Emscripten toolchain. Is it possible to write a few words about the general flow?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:13:05.450Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":585,"reads":20,"readers_count":19,"score":2919.0,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://kripken.github.io/emscripten-site/docs/porting/files/packaging_files.html","internal":false,"reflection":false,"title":"Packaging Files — Emscripten 1.36.14 documentation","clicks":6}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":134,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12694,"name":"","username":"godan","avatar_template":"/user_avatar/discourse.urho3d.io/godan/{size}/49_2.png","created_at":"2016-07-02T00:11:31.000Z","cooked":"\u003cp\u003eSome specific questions:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eat some point, the Package Tool is called (i.e to create the .pak files). Where does this happen? I can’t find anything in the CMake folder.\u003c/li\u003e\n\u003cli\u003ewhere are the compile flags passed to emcc?\u003c/li\u003e\n\u003c/ul\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:13:05.516Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":21,"readers_count":20,"score":9.2,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":134,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12695,"name":"","username":"godan","avatar_template":"/user_avatar/discourse.urho3d.io/godan/{size}/49_2.png","created_at":"2016-07-02T17:46:37.000Z","cooked":"\u003cp\u003eOk, I know a bit more now. I’ve been finding it quite difficult to understand the Emscripten build process, so in case it helps anyone else, I thought I’d write out my process and thoughts so far. It might all be wrong \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e, but even that might be useful.\u003c/p\u003e\n\u003cp\u003eJust to be clear, my goal is to build a Player.js file with the Emscripten toolchain, and be able to swap out different Data/CoreData folders WITHOUT rebuilding the Player.\u003c/p\u003e\n\u003cp\u003eK, so my little test project folder set up looks like this:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eScratchPad/\n        bin/\n               CoreData/\n               Data/\n        CMake/\n        SourceFile.h\n        SourceFile.cpp\n        CMakeLists.txt\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eMy CMakeLists.txt file is taken more or less directly from the Documentation, and looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e# Set project name\nproject (ScratchPad)\n# Set minimum version\ncmake_minimum_required (VERSION 2.8.6)\nif (COMMAND cmake_policy)\n    cmake_policy (SET CMP0003 NEW)\n    if (CMAKE_VERSION VERSION_GREATER 2.8.12 OR CMAKE_VERSION VERSION_EQUAL 2.8.12)\n        # INTERFACE_LINK_LIBRARIES defines the link interface\n        cmake_policy (SET CMP0022 NEW)\n    endif ()\n    if (CMAKE_VERSION VERSION_GREATER 3.0.0 OR CMAKE_VERSION VERSION_EQUAL 3.0.0)\n        # Disallow use of the LOCATION target property - therefore we set to OLD as we still need it\n        cmake_policy (SET CMP0026 OLD)\n        # MACOSX_RPATH is enabled by default\n        cmake_policy (SET CMP0042 NEW)\n    endif ()\nendif ()\n# Set CMake modules search path\nset (CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/CMake/Modules)\n# Include Urho3D Cmake common module\ninclude (Urho3D-CMake-common)\n# Find Urho3D library\nfind_package (Urho3D REQUIRED)\ninclude_directories (${URHO3D_INCLUDE_DIRS})\n\n# Define target name\nset (TARGET_NAME ScratchPad)\n# Define source files\ndefine_source_files ()\n\n#c11\nSET(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -std=c++11\")\n\n#pass console arg\nSET(URHO3D_WIN32_CONSOLE 1)\n# Setup target with resource copying\nsetup_main_executable ()\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs a sanity check, I compile this with VS and all is well. So, now I configure the project to be built with emscripten. To do this, I wrote a .bat file that looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003ecmake -Bbuild_player_em -H. -DURHO3D_HOME=\"C:/Dev/Urho3D/Build/emscripten\" -DEMSCRIPTEN=1 -DEMSCRIPTEN_ALLOW_MEMORY_GROWTH=1 -DEMSCRIPTEN_SHARE_DATA=1 -G \"MinGW Makefiles\" -DPLAYER_ONLY=1 -DCMAKE_TOOLCHAIN_FILE=\"CMake/Toolchains/emscripten.toolchain.cmake\"\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo answer my question in the previous post, the interaction between the various Emscripten options and the project compilation process seems to be mainly in the “setup_main_executable” macro in “Urho3D_cmake_common”. That’s where the PackageTool gets invoked, and where the SHARE_DATA option gets handled. Onwards!\u003c/p\u003e\n\u003cp\u003eSo, running that bat file, and then cd-ing in to the build folder and running “make”, successfully compiles the project. Ok, so here is where I start to get confused. The bin folder now looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eCoreData.pak\nData.pak\nScratchPad.html\nScratchPad.html.mem\nScratchPad.js\nScratchPad.js.data\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs I said, this will run in the browser. So, my first (naive) instinct was to simple replace the .pak files with new ones. This does nothing. And the reason is that emscripten compiler takes the .pak files and runs its own packaging tool, which creates the .data file and some javascript code to make it work. That means that web app is not actually referencing the .pak files, rather it is referencing .data file.\u003c/p\u003e\n\u003cp\u003eOr so I thought. The next thing I did was actually to delete all the pak files, AND the .data file, just to see if it is actually true that all the assets live in the data file. My bin folder now looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eScratchPad.html\nScratchPad.html.mem\nScratchPad.js\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd this runs fine - it seems to not care at all about the .pak OR the .data file. I guess this my main stumbling block right now - why is this? Where do the assets live if not in the data file or the pak files? In this project, the ScratchPad.js file is around 6MB, which suggests that the .pak files have been embedded in to this file (hence the title of the post). However, in “setup_main_executable”, it definitely looks like the --preload option is being used:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e            if (EMSCRIPTEN AND NOT EMSCRIPTEN_SHARE_DATA)\n                # Set the custom EMCC_OPTION property to preload the *.pak individually\n                set_source_files_properties (${RESOURCE_${DIR}_PATHNAME} PROPERTIES EMCC_OPTION preload-file EMCC_FILE_ALIAS \"@/${NAME}.pak --use-preload-cache\")\n            endif ()\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOk, so at this point it looks like there are a couple options:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eI’m not setting an option correctly, or I’m missing some flag, or something. Basically, I’m not using the build system correctly.\u003c/li\u003e\n\u003cli\u003eI AM using the build system correctly, but there is a bug.\u003c/li\u003e\n\u003cli\u003eBoth my cmake usage AND the build system are fine, and “preload” and “embed” do not mean what I think they mean.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSorry for the long post - just really close to a project milestone and this is one of the last items. All help welcome!\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:13:05.573Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":5,"reads":21,"readers_count":20,"score":29.2,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":134,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12710,"name":"Yao Wei Tjong","username":"weitjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","created_at":"2016-07-04T00:51:46.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/godan/40/49_1.png\" class=\"avatar\"\u003e godan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIs it possible to be able to swap out the Data/CoreData folders without rebuilding the UrhoPlayer with Emscripten?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI think it is possible, but you need to get your hand dirty. Do not expect the build system to work out all the use cases for you. As it is, our build system is able to embed or preload any input files, however, I believe in this case you actually don’t want to do that. Either embedding or preloading will make the input file in question becomes a dependency to the build, i.e. when it changes its timestamp then make will dutifully trigger a rule for relinking and unfortunately for Emscripten, linking phase is its slowest phase. And that’s exactly what you don’t want.\u003c/p\u003e\n\u003cp\u003eI think what you need is a custom shell.html and javascript function to swap in/out the assets in preRun module.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:13:06.622Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":2,"reads":18,"readers_count":17,"score":13.6,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"Yao Wei Tjong","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Admin","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":4,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12716,"name":"","username":"godan","avatar_template":"/user_avatar/discourse.urho3d.io/godan/{size}/49_2.png","created_at":"2016-07-04T12:52:03.000Z","cooked":"\u003cp\u003eAfter staring at auto generated js code for a while  \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/open_mouth.png?v=5\" title=\":open_mouth:\" class=\"emoji\" alt=\":open_mouth:\"\u003e , I made some progress.\u003c/p\u003e\n\u003cp\u003eTo answer a previous question: there is caching system built in to emscripten. I’m still not entirely sure how it works, but once you load your resources once, the default behaviour is to cache them (in Chrome temp folder?? On local machine??). So that means, if you delete the “.data” file, the app will still work as long as cache has not been cleared. So, step 1 of having new resources be loaded is to skip this caching part.\u003c/p\u003e\n\u003cp\u003eThe second step is to separate the resource loading js code and the player js code (as weitjong suggests). Now, the resource loading code is actually autogenerated and on the first line of the of Player.js file (i.e. the compiled app js code). I isolated this code and deleted it from the Player.js file. To do this, you find all the code that comes after (and includes) the first “var Module;” block. That is, there is a bunch of code on the first line: \"[color=#FF8040]var Module; …lots…of…code…;[/color] var Module … remove the orange bits. Btw, a good reference is the Atomic Engine Web Build code. After reading through that (and the Deployment assets) I was able to understand the flow of a emscripten web app a bit better.\u003c/p\u003e\n\u003cp\u003eThen, I copied that auto generated code in to a new file, called “ScratchPadResources.js”. I removed all the caching related code and what is left seems to be the resource loading mechanism:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003evar Module;\nif (typeof Module === \"undefined\") Module = {};\nif (!Module.expectedDataFileDownloads) {\n    Module.expectedDataFileDownloads = 0;\n    Module.finishedDataFileDownloads = 0\n}\nModule.expectedDataFileDownloads++;\n((function() {\n    var loadPackage = (function(metadata) {\n        var PACKAGE_PATH;\n        if (typeof window === \"object\") { PACKAGE_PATH = window[\"encodeURIComponent\"](window.location.pathname.toString().substring(0, window.location.pathname.toString().lastIndexOf(\"/\")) + \"/\") } else if (typeof location !== \"undefined\") { PACKAGE_PATH = encodeURIComponent(location.pathname.toString().substring(0, location.pathname.toString().lastIndexOf(\"/\")) + \"/\") } else {\n            throw \"using preloaded data can only be done on a web page or in a web worker\"\n        }\n        var PACKAGE_NAME = \"binScratchPad.data\";\n        var REMOTE_PACKAGE_BASE = \"ScratchPad.data\";\n        if (typeof Module[\"locateFilePackage\"] === \"function\" \u0026amp;\u0026amp; !Module[\"locateFile\"]) {\n            Module[\"locateFile\"] = Module[\"locateFilePackage\"];\n            Module.printErr(\"warning: you defined Module.locateFilePackage, that has been renamed to Module.locateFile (using your locateFilePackage for now)\")\n        }\n        var REMOTE_PACKAGE_NAME = typeof Module[\"locateFile\"] === \"function\" ? Module[\"locateFile\"](REMOTE_PACKAGE_BASE) : (Module[\"filePackagePrefixURL\"] || \"\") + REMOTE_PACKAGE_BASE;\n        var REMOTE_PACKAGE_SIZE = metadata.remote_package_size;\n        var PACKAGE_UUID = metadata.package_uuid;\n\n        function fetchRemotePackage(packageName, packageSize, callback, errback) {\n            var xhr = new XMLHttpRequest;\n            xhr.open(\"GET\", packageName, true);\n            xhr.responseType = \"arraybuffer\";\n            xhr.onprogress = (function(event) {\n                var url = packageName;\n                var size = packageSize;\n                if (event.total) size = event.total;\n                if (event.loaded) {\n                    if (!xhr.addedTotal) {\n                        xhr.addedTotal = true;\n                        if (!Module.dataFileDownloads) Module.dataFileDownloads = {};\n                        Module.dataFileDownloads[url] = { loaded: event.loaded, total: size }\n                    } else { Module.dataFileDownloads[url].loaded = event.loaded }\n                    var total = 0;\n                    var loaded = 0;\n                    var num = 0;\n                    for (var download in Module.dataFileDownloads) {\n                        var data = Module.dataFileDownloads[download];\n                        total += data.total;\n                        loaded += data.loaded;\n                        num++\n                    }\n                    total = Math.ceil(total * Module.expectedDataFileDownloads / num);\n                    if (Module[\"setStatus\"]) Module[\"setStatus\"](\"Downloading data... (\" + loaded + \"/\" + total + \")\")\n                } else if (!Module.dataFileDownloads) {\n                    if (Module[\"setStatus\"]) Module[\"setStatus\"](\"Downloading data...\")\n                }\n            });\n            xhr.onload = (function(event) {\n                var packageData = xhr.response;\n                callback(packageData)\n            });\n            xhr.send(null)\n        }\n\n        function handleError(error) { console.error(\"package error:\", error) }\n\n        var fetched = null,\n            fetchedCallback = null;\n        fetchRemotePackage(REMOTE_PACKAGE_NAME, REMOTE_PACKAGE_SIZE, function(data) {\n            if (fetchedCallback) {\n                fetchedCallback(data);\n                fetchedCallback = null;\n            } else {\n                fetched = data;\n            }\n        }, handleError);\n\n        function runWithFS() {\n            function assert(check, msg) {\n                if (!check) throw msg + (new Error).stack\n            }\n\n            function DataRequest(start, end, crunched, audio) {\n                this.start = start;\n                this.end = end;\n                this.crunched = crunched;\n                this.audio = audio\n            }\n            DataRequest.prototype = {\n                requests: {},\n                open: (function(mode, name) {\n                    this.name = name;\n                    this.requests[name] = this;\n                    Module[\"addRunDependency\"](\"fp \" + this.name)\n                }),\n                send: (function() {}),\n                onload: (function() {\n                    var byteArray = this.byteArray.subarray(this.start, this.end);\n                    this.finish(byteArray)\n                }),\n                finish: (function(byteArray) {\n                    var that = this;\n                    Module[\"FS_createDataFile\"](this.name, null, byteArray, true, true, true);\n                    Module[\"removeRunDependency\"](\"fp \" + that.name);\n                    this.requests[this.name] = null\n                })\n            };\n            var files = metadata.files;\n            for (i = 0; i \u0026lt; files.length; ++i) {\n                (new DataRequest(files[i].start, files[i].end, files[i].crunched, files[i].audio)).open(\"GET\", files[i].filename)\n            }\n\n            function processPackageData(arrayBuffer) {\n                Module.finishedDataFileDownloads++;\n                assert(arrayBuffer, \"Loading data file failed.\");\n                assert(arrayBuffer instanceof ArrayBuffer, \"bad input to processPackageData\");\n                var byteArray = new Uint8Array(arrayBuffer);\n                var curr;\n                if (Module[\"SPLIT_MEMORY\"]) Module.printErr(\"warning: you should run the file packager with --no-heap-copy when SPLIT_MEMORY is used, otherwise copying into the heap may fail due to the splitting\");\n                var ptr = Module[\"getMemory\"](byteArray.length);\n                Module[\"HEAPU8\"].set(byteArray, ptr);\n                DataRequest.prototype.byteArray = Module[\"HEAPU8\"].subarray(ptr, ptr + byteArray.length);\n                var files = metadata.files;\n                for (i = 0; i \u0026lt; files.length; ++i) { DataRequest.prototype.requests[files[i].filename].onload() }\n                Module[\"removeRunDependency\"](\"datafile_binScratchPad.data\")\n            }\n\n            Module[\"addRunDependency\"](\"datafile_binScratchPad.data\");\n            if (!Module.preloadResults) Module.preloadResults = {};\n\n            Module.preloadResults[PACKAGE_NAME] = { fromCache: false };\n            if (fetched) {\n                processPackageData(fetched);\n                fetched = null;\n            } else {\n                fetchedCallback = processPackageData;\n            }\n        }\n        if (Module[\"calledRun\"]) { runWithFS() } else {\n            if (!Module[\"preRun\"]) Module[\"preRun\"] = [];\n            Module[\"preRun\"].push(runWithFS)\n        }\n    });\n\n    loadPackage({ \"files\": [{ \"audio\": 0, \"start\": 0, \"crunched\": 0, \"end\": 157508, \"filename\": \"/CoreData.pak\" }, { \"audio\": 0, \"start\": 157508, \"crunched\": 0, \"end\": 11440897, \"filename\": \"/Data.pak\" }], \"remote_package_size\": 11440897, \"package_uuid\": \"7fd80462-f151-458c-8e32-73ec819b2b73\" })\n}))();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOk, so I now have a “ScratchPadResources.js” file and a “ScratchPad.js” player file. Then, you simply adjust the shell (i.e. the webpage that loads the js code) to first run the Resources script, and then the Player script. Here is the relevant lines way at the bottom of the autogenerated webpage:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e    \u0026lt;script async type=\"text/javascript\" src=\"ScratchPadResource.js\"\u0026gt;\u0026lt;/script\u0026gt;\n    \u0026lt;script async type=\"text/javascript\" src=\"ScratchPad.js\"\u0026gt;\u0026lt;/script\u0026gt;\n\n  \u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd that’s it! Start up a webserver, and I can now swap out the .data file with a new one, reload the page, and the new resources are used. So that’s good. What remains is to somehow call the emscripten packaging tool on the .pak files to create that new .data file…\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:13:07.086Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":6,"reads":19,"readers_count":18,"score":33.8,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":134,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12718,"name":"Yao Wei Tjong","username":"weitjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","created_at":"2016-07-04T14:13:13.000Z","cooked":"\u003cp\u003eGlad you made some progress there. Just want to point out that there is no need for step 1 to skip the caching part. The Emscripten caching logic is actually quite good last time I checked it. Unless your *.data files are identical, they should have different UUID assigned. The caching logic uses UUID to decide whether a local cache copy is still “fresh” or not. Just my two cents.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T01:13:07.272Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":16,"readers_count":15,"score":8.2,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"Yao Wei Tjong","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Admin","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":4,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12742,"name":"","username":"godan","avatar_template":"/user_avatar/discourse.urho3d.io/godan/{size}/49_2.png","created_at":"2016-07-07T12:57:45.000Z","cooked":"\u003cp\u003eSuccess! It’s a bit of a hack, but it works. Here’s what you need to do:\u003c/p\u003e\n\u003cp\u003eGOAL: To build a player (like the UrhoPlayer) once, and then be able to update the resources packages.\u003c/p\u003e\n\u003cp\u003eSTEPS:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBuild the Player with Empscripten with the following options: -DURHO3D_PACKAGING=1 -DEMSCRIPTEN=1 -DWEB=1 -DEMSCRIPTEN_ALLOW_MEMORY_GROWTH=1\u003c/li\u003e\n\u003cli\u003eDelete from your Player.js file the first Module definition:  \"[color=#FF0000]var Module; …lots…of…code…;[/color] var Module…\u003c/li\u003e\n\u003cli\u003eOpen up a console and navigate to your resource directories.\u003c/li\u003e\n\u003cli\u003eRun the Urho packaging tool on both resource dirs. You should now have two .pak files\u003c/li\u003e\n\u003cli\u003erun the Emscripten packaging tool manually: python file_packager.py AppAssets.data --preload Data.pak --preload CoreData.pak --js-output=“AppResources.js”\u003c/li\u003e\n\u003cli\u003eAdd this to the .html file line:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e    \u0026lt;script async type=\"text/javascript\" src=\"AppResources.js\"\u0026gt;\u0026lt;/script\u0026gt;\n    \u0026lt;script async type=\"text/javascript\" src=\"Player.js\"\u0026gt;\u0026lt;/script\u0026gt;\n  \u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd that’s it. All the various files should be in one directory, and then you can start a local server and test it out.\u003c/p\u003e\n\u003cp\u003eNOTE: It’s a real pain manually editing the Player.js file. Does that asset loading text get created because of URHO3D_PACKING=1? When I turn it off, Emscripten complains that ALLOW_MEMORY_GROWTH has not been set. Is that a bug?\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-01-02T01:13:09.100Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":17,"readers_count":16,"score":8.4,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":134,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12745,"name":"Yao Wei Tjong","username":"weitjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","created_at":"2016-07-08T09:09:53.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/godan/40/49_1.png\" class=\"avatar\"\u003e godan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhen I turn it off, Emscripten complains that ALLOW_MEMORY_GROWTH has not been set. Is that a bug?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eYes, it sounds like it.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-01-02T01:13:09.302Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":15,"readers_count":14,"score":3.0,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"Yao Wei Tjong","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Admin","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":4,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":12748,"name":"Yao Wei Tjong","username":"weitjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","created_at":"2016-07-08T13:56:30.000Z","cooked":"\u003cp\u003eA quick fix for this bug in question has been pushed to master branch just now.\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2017-01-02T01:13:09.508Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":3.0,"yours":false,"topic_id":2102,"topic_slug":"emscripten-preload-resource-dirs-i-e-not-embed","display_username":"Yao Wei Tjong","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Admin","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":4,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[12693,12694,12695,12710,12716,12718,12742,12745,12748]},"timeline_lookup":[[1,2335],[3,2334],[4,2333],[7,2330],[8,2329]],"suggested_topics":[{"id":7083,"title":"Using custom models in Xamarin.Forms shared project","fancy_title":"Using custom models in Xamarin.Forms shared project","slug":"using-custom-models-in-xamarin-forms-shared-project","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2021-12-03T08:34:21.895Z","last_posted_at":"2021-12-03T11:40:30.983Z","bumped":true,"bumped_at":"2021-12-03T11:40:30.983Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":198,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1493,"username":"Nikolai","name":"Nikolai Miroshnichenko","avatar_template":"/user_avatar/discourse.urho3d.io/nikolai/{size}/3632_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7254,"title":"Android :android:urho3d-lib:generateJsonModelDebug failed task","fancy_title":"Android :android:urho3d-lib:generateJsonModelDebug failed task","slug":"android-urho3d-lib-generatejsonmodeldebug-failed-task","posts_count":14,"reply_count":8,"highest_post_number":14,"image_url":null,"created_at":"2022-05-07T08:16:09.637Z","last_posted_at":"2022-08-31T13:37:02.824Z","bumped":true,"bumped_at":"2022-08-31T13:37:02.824Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"Android :android:urho3d-lib:generateJsonModelDebug failed task","tags_descriptions":{},"like_count":2,"views":344,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1518,"username":"Joshua-PotatoMan","name":"Joshua","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/e9c0ed/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1522,"username":"tungts1101","name":"tungts1101","avatar_template":"/user_avatar/discourse.urho3d.io/tungts1101/{size}/3803_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7132,"title":"How to Draw Anti-Aliased Outlined Line on the UI layer?","fancy_title":"How to Draw Anti-Aliased Outlined Line on the UI layer?","slug":"how-to-draw-anti-aliased-outlined-line-on-the-ui-layer","posts_count":8,"reply_count":5,"highest_post_number":8,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/c/c040fdbc2f1856c238ba6328fd7f5ff80b15858f_2_782x1024.jpeg","created_at":"2022-01-17T22:08:06.874Z","last_posted_at":"2022-01-20T20:13:30.614Z","bumped":true,"bumped_at":"2022-01-20T20:13:30.614Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":173,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7176,"title":"Orthographic scene slowing down when zooming out","fancy_title":"Orthographic scene slowing down when zooming out","slug":"orthographic-scene-slowing-down-when-zooming-out","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-01-30T10:05:50.218Z","last_posted_at":"2022-01-30T10:05:50.294Z","bumped":true,"bumped_at":"2022-01-30T10:05:50.294Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":127,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1351,"username":"Haukinger","name":"Haukinger","avatar_template":"/user_avatar/discourse.urho3d.io/haukinger/{size}/3670_2.png"}}]},{"id":7268,"title":"Get vertex position before Morph in shader","fancy_title":"Get vertex position before Morph in shader","slug":"get-vertex-position-before-morph-in-shader","posts_count":8,"reply_count":6,"highest_post_number":8,"image_url":null,"created_at":"2022-05-15T19:44:19.139Z","last_posted_at":"2022-05-16T06:11:07.099Z","bumped":true,"bumped_at":"2022-08-12T22:38:31.553Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":5,"views":209,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1205,"username":"Askhento","name":"Askhento","avatar_template":"/user_avatar/discourse.urho3d.io/askhento/{size}/3849_2.png"}},{"extras":"latest","description":"Most Recent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]}],"tags_descriptions":{},"id":2102,"title":"Emscripten preload resource dirs (i.e NOT embed)?","fancy_title":"Emscripten preload resource dirs (i.e NOT embed)?","posts_count":9,"created_at":"2016-07-01T21:56:32.000Z","views":1307,"reply_count":0,"like_count":0,"last_posted_at":"2016-07-08T13:56:30.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"emscripten-preload-resource-dirs-i-e-not-embed","category_id":10,"word_count":2402,"deleted_at":null,"user_id":134,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_2102","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":9,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":134,"username":"godan","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/godan/{size}/49_2.png","post_count":5,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","post_count":4,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":4}],"created_by":{"id":134,"username":"godan","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/godan/{size}/49_2.png"},"last_poster":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"},"links":[{"url":"https://kripken.github.io/emscripten-site/docs/porting/files/packaging_files.html","title":"Packaging Files — Emscripten 1.36.14 documentation","internal":false,"attachment":false,"reflection":false,"clicks":6,"user_id":134,"domain":"kripken.github.io","root_domain":"kripken.github.io"}]}}