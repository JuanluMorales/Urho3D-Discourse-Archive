{"post_stream":{"posts":[{"id":45543,"name":"","username":"hunkalloc","avatar_template":"/user_avatar/discourse.urho3d.io/hunkalloc/{size}/3817_2.png","created_at":"2022-07-01T22:18:42.708Z","cooked":"\u003cp\u003eHey y’all. I’m working on a small prototype to get my head around the engine and I was pleasantly surprise to know that it has built-in IK functionality, something that you have to pay for in Unity. I’ve been trying to implement a feature similar to this one:\u003c/p\u003e\n\u003cdiv class=\"onebox lazyYT lazyYT-container\" data-youtube-id=\"NWkLYcgMxUA\" data-youtube-title=\"Weapon Collision Changes | Escape From Tarkov Guide\" data-parameters=\"feature=oembed\u0026amp;wmode=opaque\"\u003e\n  \u003ca href=\"https://www.youtube.com/watch?v=NWkLYcgMxUA\" target=\"_blank\" rel=\"noopener nofollow ugc\"\u003e\n    \u003cimg class=\"ytp-thumbnail-image\" src=\"https://img.youtube.com/vi/NWkLYcgMxUA/hqdefault.jpg\" title=\"Weapon Collision Changes | Escape From Tarkov Guide\" width=\"480\" height=\"360\"\u003e\n  \u003c/a\u003e\n\u003c/div\u003e\n\n\u003cp\u003eYou’ll notice that, instead of using multiple cameras to avoid the weapon mesh from going through the walls, the dev team of Escape From Tarkov decided to turn this into a gameplay feature and have the muzzle go up by using IK on the player hand/elbow.\u003c/p\u003e\n\u003cp\u003eThe way I implemented this was, when there is a collision, I play an animation that basically makes the player go high ready, and prevent the shoot() method from ever working. However, I would love to be able to use IK, since that would be much smoother than be just playing the animation every single frame that I detect a collision, then playing the “back to aiming” animation. It feels laggish.\u003c/p\u003e\n\u003cp\u003eMy question is around the rotation of the bone itself. When there is a collision, can I just go directly to the bone of the player and apply a 70 degree rotation, for example? How does the IK “activate”?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2022-07-01T22:18:42.708Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":19,"readers_count":18,"score":13.8,"yours":false,"topic_id":7291,"topic_slug":"using-ik-to-deal-with-mesh-collision-how-to-detect-and-rotate","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://www.youtube.com/watch?v=NWkLYcgMxUA","internal":false,"reflection":false,"title":"Weapon Collision Changes | Escape From Tarkov Guide - YouTube","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1529,"hidden":false,"trust_level":0,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"user_suspended":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":45544,"name":"","username":"JSandusky","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png","created_at":"2022-07-02T01:45:17.023Z","cooked":"\u003cp\u003eIn this case you would likely set up 2 IK chains containing shoulder, elbow, and wrist (end effector), then keep updating the target position as you move the hand nodes around by the wrist. For this gun case you’d basically determine where the gun needs to be and then position the hands where they need to be according to whatever relative coordinates (ie. \u003ccode\u003ewristOffsetMatrix = inverseOldGunWorldTransform * wristWorldTransform; newWristWorldTransform = newGunWorldTransform * offsetMatrix;\u003c/code\u003e), then it doesn’t matter WTF you do with the gun, the hands are going to stay attached and your arms will track through their IK so long as you don’t go outside of reach.\u003c/p\u003e\n\u003cp\u003eThe IK is rotationally clueless, it only solves the rotations to position the points and nothing else like easing an rotation axis through the chain etc. If you look at the 45_InverseKinematics sample you can see that the sample has to explicitly deal with the foot orientation.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eAs to getting the contact information to reposition the weapon. Your best bet is going to be to use a Node user-variable (\u003ccode\u003eNode::GetVar\u003c/code\u003e and \u003ccode\u003eNode::SetVar\u003c/code\u003e) to store the the world-transform of the node at the end of the frame.\u003c/p\u003e\n\u003cp\u003eWhen updating you’ll do a \u003ccode\u003ePhysicsWorld::ConvexCast\u003c/code\u003e from the old position to the new position and use the contact information you get from that to decide how to correct position to resolve penetration. Then repeat the casting process until you’ve solved all penetrations or have hit a set limit. It’s the same task as a character controller (\u003ccode\u003eoutMuzzlePosition = inMuzzlePosition - contactNormal * inMuzzlePosition.DotProduct(contactNormal)\u003c/code\u003e), your character is now just the muzzle of a gun that you’re sliding along the surface.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2022-07-02T01:46:38.485Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":19,"readers_count":18,"score":3.8,"yours":false,"topic_id":7291,"topic_slug":"using-ik-to-deal-with-mesh-collision-how-to-detect-and-rotate","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1358,"hidden":false,"trust_level":0,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"user_suspended":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[45543,45544]},"timeline_lookup":[[1,144]],"suggested_topics":[{"id":7264,"title":"Mesh not rendering right and no idea why [SOLVED]","fancy_title":"Mesh not rendering right and no idea why [SOLVED]","slug":"mesh-not-rendering-right-and-no-idea-why-solved","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/5/58b096d0ea560021fc4301ffe097f4b1350670af_2_1024x519.jpeg","created_at":"2022-05-13T01:26:06.152Z","last_posted_at":"2022-05-13T20:26:12.059Z","bumped":true,"bumped_at":"2022-05-13T20:26:12.059Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":147,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1507,"username":"Kest","name":"Kest","avatar_template":"/user_avatar/discourse.urho3d.io/kest/{size}/3734_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]},{"id":7159,"title":"Urho3D 1.8 release","fancy_title":"Urho3D 1.8 release","slug":"urho3d-1-8-release","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2022-01-28T09:11:58.312Z","last_posted_at":"2022-08-03T12:48:01.717Z","bumped":true,"bumped_at":"2022-08-03T12:48:01.717Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":444,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7073,"title":"A plan to support static batching","fancy_title":"A plan to support static batching","slug":"a-plan-to-support-static-batching","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2021-12-01T03:43:48.579Z","last_posted_at":"2021-12-02T23:30:07.199Z","bumped":true,"bumped_at":"2021-12-02T23:30:07.199Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":180,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1490,"username":"Sunc","name":"DoubleSuper","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/df788c/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7227,"title":"How to use -s MAX_WEBGL_VERSION=2","fancy_title":"How to use -s MAX_WEBGL_VERSION=2","slug":"how-to-use-s-max-webgl-version-2","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-03-30T13:12:17.248Z","last_posted_at":"2022-03-30T14:09:14.646Z","bumped":true,"bumped_at":"2022-03-30T14:09:14.646Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":103,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":997,"username":"huminzheng","name":"huminzheng","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/h/9de0a6/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7338,"title":"About FSR support","fancy_title":"About FSR support","slug":"about-fsr-support","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-10-23T06:06:04.126Z","last_posted_at":"2022-11-11T21:42:39.142Z","bumped":true,"bumped_at":"2022-11-11T21:42:39.142Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":128,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1541,"username":"sergeyvolkovich","name":"Gray","avatar_template":"/user_avatar/discourse.urho3d.io/sergeyvolkovich/{size}/3852_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":789,"username":"codewalkerdan","name":"Codewalkerdan","avatar_template":"/user_avatar/discourse.urho3d.io/codewalkerdan/{size}/675_2.png"}}]}],"tags_descriptions":{},"id":7291,"title":"Using IK to deal with mesh collision: how to detect and rotate?","fancy_title":"Using IK to deal with mesh collision: how to detect and rotate?","posts_count":2,"created_at":"2022-07-01T22:18:42.620Z","views":98,"reply_count":0,"like_count":0,"last_posted_at":"2022-07-02T01:45:17.023Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"using-ik-to-deal-with-mesh-collision-how-to-detect-and-rotate","category_id":16,"word_count":496,"deleted_at":null,"user_id":1529,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_7291","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":2,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":0},{"id":1529,"username":"hunkalloc","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/hunkalloc/{size}/3817_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":0}],"created_by":{"id":1529,"username":"hunkalloc","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/hunkalloc/{size}/3817_2.png"},"last_poster":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}}