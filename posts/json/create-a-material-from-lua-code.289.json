{"post_stream":{"posts":[{"id":1560,"name":"","username":"robertotena","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/r/3bc359/{size}.png","created_at":"2014-06-02T21:50:15.000Z","cooked":"\u003cp\u003eHello, I’d like to create a custom material from Lua code instead of loading it from the ResourceCache, but I just don’t find a proper way.\u003c/p\u003e\n\u003cp\u003eI tried to modify a previously loaded one via ‘SetShaderParameter’, but it seems to modify the material to nullify its previous effects (I wouldn’t recommend this option, anyway, as it is a cached resource):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003elocal node = scene:CreateChild('CustomNode')\nlocal component = node:CreateComponent('CustomGeometry')\n\ncomponent:DefineVertex(Vector3(-1.2, 1.2, 0))\ncomponent:DefineVertex(Vector3(-1, 1.2, 0))\ncomponent:DefineVertex(Vector3(-1.2, -1, 0))\n\ncomponent.material = cache:GetResource('Material', 'Materials/RedUnlit.xml')\n\ncomponent.material:SetShaderParameter('MatDiffColor', Vector4(0, 1, 0, 1)) -- to make it green, for example\n\ncomponent:Commit()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI was trying to create it manually, but if I do\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003elocal material = Material()\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ethe engine crashes. I guess it is because they must be created via resource factory, but how? I read in the docs about the global CreateObject method, but it does not seems to work, either. A little example would be very much appreciated!\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T00:59:24.779Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":72,"reads":14,"readers_count":13,"score":362.8,"yours":false,"topic_id":289,"topic_slug":"create-a-material-from-lua-code","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":96,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":1561,"name":"","username":"friesencr","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png","created_at":"2014-06-03T02:35:04.000Z","cooked":"\u003cp\u003eThe engine should never crash (within reason) from script usage.  You should report a bug.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T00:59:24.840Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":13,"readers_count":12,"score":7.6,"yours":false,"topic_id":289,"topic_slug":"create-a-material-from-lua-code","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":15,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":1565,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-06-03T08:22:25.000Z","cooked":"\u003cp\u003eI’d put it this way that the engine should never crash, except in Lua bindings \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e They are rather unsafe as due to performance reasons type checks and even null checks need to be left out (use CMake option -DURHO3D_SAFE_LUA=1 to enable the checks, but it’ll be slower) so something as simple as forgetting to use : instead of . will easily crash.\u003c/p\u003e\n\u003cp\u003eIn this case I believe you’re being hit by the memory allocation behavior and interaction with the C++ side reference counting. To allocate an object that will be put into a C++ SharedPtr (in this case, the drawable component has a SharedPtr for holding the material) you should use the new() function instead of just constructing the object. This is explained on the “Lua scripting” documentation page.\u003c/p\u003e\n\u003cp\u003eSo the usage of creating a material and applying it to an object would go like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e        local mat = Material:new()\n        mat:SetShaderParameter(\"MatDiffColor\", Variant(Vector4(Random(1.0), Random(1.0), Random(1.0), 1.0)))\n        component.material = mat\u003c/code\u003e\u003c/pre\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T00:59:25.294Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":14,"readers_count":13,"score":7.8,"yours":false,"topic_id":289,"topic_slug":"create-a-material-from-lua-code","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":1566,"name":"","username":"aster2013","avatar_template":"/user_avatar/discourse.urho3d.io/aster2013/{size}/828_2.png","created_at":"2014-06-03T10:03:23.000Z","cooked":"\u003cp\u003ecadaver is right.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T00:59:25.369Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":14,"readers_count":13,"score":2.8,"yours":false,"topic_id":289,"topic_slug":"create-a-material-from-lua-code","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":1569,"name":"","username":"robertotena","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/r/3bc359/{size}.png","created_at":"2014-06-03T22:32:25.000Z","cooked":"\u003cp\u003eGreat, it works, thank you! \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e\n\u003cp\u003eAnd now that I’m able to create materials… I wanted to set a technique but I’m having problems:\u003c/p\u003e\n\u003cp\u003eFirst I tried to do the same as with the material:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003elocal tech = Technique:new()\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut its result is the message error:\u003cbr\u003e\nattempt to call method ‘new’ (a nil value)\u003c/p\u003e\n\u003cp\u003eCould it be because the constructor is not exposed? \u003ca href=\"https://github.com/urho3d/Urho3D/blob/master/Source/Engine/LuaScript/pkgs/Graphics/Technique.pkg\" rel=\"nofollow noopener\"\u003egithub.com/urho3d/Urho3D/blob/m … hnique.pkg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eLater, I tried to load it directly from the resource cache:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003elocal tech = cache:GetResource('Techinque', 'Techniques/NoTextureOverlay.xml')\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut the error message is:\u003cbr\u003e\nCould not load unknown resource type 94E6\u003c/p\u003e\n\u003cp\u003eIn the end, to make it work as I wanted, I loaded a material with a technique, and retrieved the technique from there:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e  component.material = Material:new()\n  component.material:SetShaderParameter('MatDiffColor', Variant(Vector4(1.0 , 1.0, 1.0, 1.0)))\n\n  local loadedMaterial = cache:GetResource('Material', 'Materials/RedUnlit.xml')\n  component.material:SetNumTechniques(1)\n  component.material:SetTechnique(0, loadedMaterial:GetTechnique(0))\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhat did I miss in order to create or load a custom Technique? Was this behavior expected?\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T00:59:25.617Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":14,"readers_count":13,"score":7.8,"yours":false,"topic_id":289,"topic_slug":"create-a-material-from-lua-code","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/urho3d/Urho3D/blob/master/Source/Engine/LuaScript/pkgs/Graphics/Technique.pkg","internal":false,"reflection":false,"clicks":1}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":96,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":1572,"name":"","username":"robertotena","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/r/3bc359/{size}.png","created_at":"2014-06-04T23:01:58.000Z","cooked":"\u003cp\u003eNevermind… there was a typo  \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/blush.png?v=5\" title=\":blush:\" class=\"emoji\" alt=\":blush:\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003elocal tech = cache:GetResource('Techinque', 'Techniques/NoTextureOverlay.xml')\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003emust be\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003elocal tech = cache:GetResource('Technique', 'Techniques/NoTextureOverlay.xml')\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003esorry for the waste, and thank you again\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T00:59:25.849Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":10,"readers_count":9,"score":2.0,"yours":false,"topic_id":289,"topic_slug":"create-a-material-from-lua-code","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":96,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[1560,1561,1565,1566,1569,1572]},"timeline_lookup":[[1,3095],[5,3094],[6,3093]],"suggested_topics":[{"id":7112,"title":"What is the proper way to add more source files(.cpp and .h) to a project?","fancy_title":"What is the proper way to add more source files(.cpp and .h) to a project?","slug":"what-is-the-proper-way-to-add-more-source-files-cpp-and-h-to-a-project","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2021-12-27T18:18:21.946Z","last_posted_at":"2021-12-28T12:19:43.514Z","bumped":true,"bumped_at":"2021-12-28T12:19:43.514Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":195,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1498,"username":"Tryout","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/85f322/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7160,"title":"RayCast trouble","fancy_title":"RayCast trouble","slug":"raycast-trouble","posts_count":17,"reply_count":9,"highest_post_number":19,"image_url":null,"created_at":"2022-01-29T00:06:00.367Z","last_posted_at":"2022-01-30T00:29:39.356Z","bumped":true,"bumped_at":"2022-01-30T00:29:39.356Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":260,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":627,"username":"George1","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/9e8a1a/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7193,"title":"Can Z-Axis Feasibly be \"Up\"?","fancy_title":"Can Z-Axis Feasibly be \u0026ldquo;Up\u0026rdquo;?","slug":"can-z-axis-feasibly-be-up","posts_count":4,"reply_count":2,"highest_post_number":4,"image_url":null,"created_at":"2022-02-14T05:17:28.054Z","last_posted_at":"2022-02-14T07:26:53.817Z","bumped":true,"bumped_at":"2022-02-14T07:26:53.817Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":161,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7296,"title":"What is the purpose of LitBase?","fancy_title":"What is the purpose of LitBase?","slug":"what-is-the-purpose-of-litbase","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-07-15T17:46:35.168Z","last_posted_at":"2022-07-15T18:00:02.695Z","bumped":true,"bumped_at":"2022-07-15T18:00:02.695Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":93,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":745,"username":"ChunFengTsin","name":"Chun Feng Tsin","avatar_template":"/user_avatar/discourse.urho3d.io/chunfengtsin/{size}/450_2.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]}],"tags_descriptions":{},"id":289,"title":"Create a material from Lua code","fancy_title":"Create a material from Lua code","posts_count":6,"created_at":"2014-06-02T21:50:15.000Z","views":480,"reply_count":0,"like_count":0,"last_posted_at":"2014-06-04T23:01:58.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"create-a-material-from-lua-code","category_id":10,"word_count":610,"deleted_at":null,"user_id":96,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_289","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":6,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":4,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":96,"username":"robertotena","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/r/3bc359/{size}.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":11,"username":"aster2013","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/aster2013/{size}/828_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":15,"username":"friesencr","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":96,"username":"robertotena","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/r/3bc359/{size}.png"},"last_poster":{"id":96,"username":"robertotena","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/r/3bc359/{size}.png"},"links":[{"url":"https://github.com/urho3d/Urho3D/blob/master/Source/Engine/LuaScript/pkgs/Graphics/Technique.pkg","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":96,"domain":"github.com","root_domain":"github.com"}]}}