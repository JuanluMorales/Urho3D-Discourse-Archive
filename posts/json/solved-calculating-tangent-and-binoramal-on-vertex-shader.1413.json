{"post_stream":{"posts":[{"id":8118,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2015-10-07T22:59:39.000Z","cooked":"\u003cp\u003eI’m writing my own billboards, and i want them to use normal maps for lighting. I’m having hard time figuring out how to calculate tangent and binormal vectors.\u003c/p\u003e\n\u003cp\u003eI assumed, I can take direction towards the camera as normal, and then calculate right and up vectors as tangent and binormal. All in world space.\u003c/p\u003e\n\u003cp\u003eI’ve got pretty close to wanted result with this GLSL code:\u003cbr\u003e\nVS:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e  vec3 camUp = vec3(cCameraRot[0][1],cCameraRot[1][1],cCameraRot[2][1]);\n  vec3 Dir = normalize(cCameraPos-worldPos);\n  vec3 Right = normalize( cross( Dir , camUp));\n  vec3 Up = normalize( cross( Right, Dir ) );\n  vNormal = Dir;\n  vBinormal = Up * -1;\n  vTangent = Right;\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePS:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\nvec4 nmMap = texture2D(sDiffMap, vTexCoord.xy);\n  if (nmMap.a \u0026lt; 0.5)\n      discard;\n  mat3 tbn = mat3(vTangent, vBinormal, vNormal);\n  vec3 normal = DecodeNormal(nmMap) * tbn;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eIt looks alright, from all directions, but only as long as camera stays in parallel with horison. Looking top-down or changing camera rool will break proper orientation.\u003c/p\u003e\n\u003cp\u003eI’ve tried many other things, my brain is boiling up from all this vectors and matrices, and result is always crooked.\u003c/p\u003e\n\u003cp\u003eSo, what am I missing here? What else can I try?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:07:34.613Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":942,"reads":19,"readers_count":18,"score":4713.8,"yours":false,"topic_id":1413,"topic_slug":"solved-calculating-tangent-and-binoramal-on-vertex-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8120,"name":"","username":"codingmonkey","avatar_template":"/user_avatar/discourse.urho3d.io/codingmonkey/{size}/119_2.png","created_at":"2015-10-08T07:48:16.000Z","cooked":"\u003cp\u003eDid you read this topic ? code from Mahagam also not working correctly ?\u003cbr\u003e\n\u003ca href=\"http://www.gamedev.ru/code/forum/?id=205849\"\u003egamedev.ru/code/forum/?id=205849\u003c/a\u003e\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:07:34.770Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":5,"reads":20,"readers_count":19,"score":29.0,"yours":false,"topic_id":1413,"topic_slug":"solved-calculating-tangent-and-binoramal-on-vertex-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://www.gamedev.ru/code/forum/?id=205849","internal":false,"reflection":false,"title":"Bump and Tangent Space / Форум / Программирование игр / GameDev.ru — Разработка игр","clicks":76}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":148,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8122,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2015-10-08T08:31:02.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eJust add the normals and tangents to the vertex stream. So much easier.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003e1)then I still need to calculate them\u003cbr\u003e\n2)I can’t with my solution. My mesh is bunch of quads, each shrinked to the point. The final vertex positions is calculated on vertex shader. It’s pretty cool, because there is no need to change buffers in every frame. But storing normals and tangents won’t make much sense.\u003c/p\u003e\n\u003cp\u003efull shader code, just in case:\u003c/p\u003e\n\u003cp\u003e[spoiler][code]\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “Uniforms.glsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “Samplers.glsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “Transform.glsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “ScreenPos.glsl”\u003c/p\u003e\n\u003cp\u003evarying vec4 vTexCoord;\u003cbr\u003e\nvarying vec4 vWorldPos;\u003cbr\u003e\nvarying vec3 vNormal;\u003cbr\u003e\nvarying vec3 vBinormal;\u003cbr\u003e\nvarying vec3 vTangent;\u003c/p\u003e\n\u003cp\u003evoid VS()\u003cbr\u003e\n{\u003cbr\u003e\nmat4 modelMatrix = iModelMatrix;\u003cbr\u003e\nvec3 worldPos = GetWorldPos(modelMatrix) +  vec3(6\u003cem\u003eiTexCoord.x, 6\u003c/em\u003eiTexCoord.y,0) * cCameraRot;\u003cbr\u003e\ngl_Position = GetClipPos(worldPos);\u003cbr\u003e\nvWorldPos = vec4(worldPos, GetDepth(gl_Position));\u003cbr\u003e\n//vec4 worldnorm = GetNearRay(gl_Position);\u003cbr\u003e\nvec3 camUp = vec3(cCameraRot[0][1],cCameraRot[1][1],cCameraRot[2][1]);\u003cbr\u003e\nvec3 Dir = normalize(cCameraPos-worldPos);\u003cbr\u003e\nvec3 Right = normalize( cross( Dir , camUp));\u003cbr\u003e\nvec3 Up = normalize( cross( Right, Dir ) );\u003cbr\u003e\nvNormal = Dir;\u003cbr\u003e\nvBinormal = Up * -1;\u003cbr\u003e\nvTangent = Right;\u003c/p\u003e\n\u003cp\u003evTexCoord = vec4(0.5 * iTexCoord + vec2(0.5,0.5),0,0);\u003c/p\u003e\n\u003cp\u003e}\u003c/p\u003e\n\u003cp\u003evoid PS()\u003cbr\u003e\n{\u003cbr\u003e\nvec4 nmMap = texture2D(sDiffMap, vTexCoord.xy);\u003cbr\u003e\nif (nmMap.a \u0026lt; 0.5)\u003cbr\u003e\ndiscard;\u003cbr\u003e\nmat3 tbn = mat3(vTangent, vBinormal, vNormal);\u003cbr\u003e\nvec3 normal = DecodeNormal(nmMap) * tbn;\u003c/p\u003e\n\u003cp\u003evec3 diffColor = vec3(1.0,1.0,1.0);\u003cbr\u003e\nvec3 ambient = diffColor.rgb * cAmbientColor * ( 0.5 * (normal.y + 1.0));\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"hashtag\"\u003e#if\u003c/span\u003e defined(PREPASS)\u003cbr\u003e\n// Fill light pre-pass G-Buffer\u003cbr\u003e\ngl_FragData[0] = vec4(0.5, 0.9, 0.5, 1.0);\u003cbr\u003e\ngl_FragData[1] = vec4(EncodeDepth(vWorldPos.w), 0.0);\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#elif\u003c/span\u003e defined(DEFERRED)\u003cbr\u003e\ngl_FragData[0] = vec4(ambient , 1.0);\u003cbr\u003e\ngl_FragData[1] = vec4(diffColor.rgb, 0.0);\u003cbr\u003e\ngl_FragData[2] = vec4(normal * 0.5 + 0.5, 1.0);\u003cbr\u003e\ngl_FragData[3] = vec4(EncodeDepth(vWorldPos.w), 0.0);\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#else\u003c/span\u003e\u003cbr\u003e\ngl_FragColor = vec4(diffColor.rgb, diffColor.a);\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#endif\u003c/span\u003e\u003cbr\u003e\n}\u003cbr\u003e\n[/code][/spoiler]\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:07:34.920Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":20,"reads":19,"readers_count":18,"score":103.8,"yours":false,"topic_id":1413,"topic_slug":"solved-calculating-tangent-and-binoramal-on-vertex-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8124,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2015-10-08T09:13:33.000Z","cooked":"\u003cp\u003e[quote=“codingmonkey”]Did you read this topic ? code from Mahagam also not working correctly ?\u003cbr\u003e\n\u003ca href=\"http://www.gamedev.ru/code/forum/?id=205849\" rel=\"nofollow noopener\"\u003egamedev.ru/code/forum/?id=205849\u003c/a\u003e[/quote]\u003cbr\u003e\nWill check that out, thank you.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:07:35.096Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":2,"reads":15,"readers_count":14,"score":13.0,"yours":false,"topic_id":1413,"topic_slug":"solved-calculating-tangent-and-binoramal-on-vertex-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://www.gamedev.ru/code/forum/?id=205849","internal":false,"reflection":false,"title":"Bump and Tangent Space / Форум / Программирование игр / GameDev.ru — Разработка игр","clicks":29}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8152,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2015-10-11T20:23:49.000Z","cooked":"\u003cp\u003eWell, turns out, my method was right. I only had to transpose final matrix (switch rows and columns). No Idea why it needed to be transposed. At this point I was desperately shuffling everything in the code.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:07:36.988Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":4,"reads":14,"readers_count":13,"score":22.8,"yours":false,"topic_id":1413,"topic_slug":"solved-calculating-tangent-and-binoramal-on-vertex-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[8118,8120,8122,8124,8152]},"timeline_lookup":[[1,2603],[5,2599]],"suggested_topics":[{"id":7178,"title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","fancy_title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","slug":"medium-quality-technique-for-semi-reflective-specular-glass-in-urho","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/51408fe152ba02eb8b92237cc9a9411c8ee922e6.jpeg","created_at":"2022-01-31T22:57:50.134Z","last_posted_at":"2022-02-01T04:32:37.418Z","bumped":true,"bumped_at":"2022-02-01T04:32:37.418Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":154,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]},{"id":7080,"title":"Build urho3d source on windows 10 - cmake - \"Error in configuration process, project files may be invalid\"","fancy_title":"Build urho3d source on windows 10 - cmake - \u0026ldquo;Error in configuration process, project files may be invalid\u0026rdquo;","slug":"build-urho3d-source-on-windows-10-cmake-error-in-configuration-process-project-files-may-be-invalid","posts_count":8,"reply_count":4,"highest_post_number":8,"image_url":null,"created_at":"2021-12-03T01:55:53.267Z","last_posted_at":"2021-12-06T22:46:59.584Z","bumped":true,"bumped_at":"2021-12-06T22:46:59.584Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":324,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1488,"username":"ToolmakerSteve","name":"ToolmakerSteve","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ba9def/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}}]},{"id":7081,"title":"Install Urho3D Library - Windows 10 - rake build - \"project does not exist\"","fancy_title":"Install Urho3D Library - Windows 10 - rake build - \u0026ldquo;project does not exist\u0026rdquo;","slug":"install-urho3d-library-windows-10-rake-build-project-does-not-exist","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-03T03:06:40.974Z","last_posted_at":"2021-12-03T17:53:10.844Z","bumped":true,"bumped_at":"2021-12-03T17:53:10.844Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":190,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1488,"username":"ToolmakerSteve","name":"ToolmakerSteve","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ba9def/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1491,"username":"xlat","name":"Alex Kuch","avatar_template":"/user_avatar/discourse.urho3d.io/xlat/{size}/3620_2.png"}}]},{"id":7156,"title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","fancy_title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","slug":"manual-mesh-part-animation-e-g-rotate-a-propeller","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-01-26T23:50:29.343Z","last_posted_at":"2022-01-27T05:31:02.766Z","bumped":true,"bumped_at":"2022-01-27T05:31:02.766Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":155,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7243,"title":"Android compile fails","fancy_title":"Android compile fails","slug":"android-compile-fails","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2022-04-25T08:46:07.947Z","last_posted_at":"2022-05-06T08:22:51.592Z","bumped":true,"bumped_at":"2022-05-06T08:22:51.592Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":181,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":1413,"title":"[SOLVED]calculating tangent and binoramal on vertex shader","fancy_title":"[SOLVED]calculating tangent and binoramal on vertex shader","posts_count":5,"created_at":"2015-10-07T22:59:39.000Z","views":1816,"reply_count":0,"like_count":0,"last_posted_at":"2015-10-11T20:23:49.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"solved-calculating-tangent-and-binoramal-on-vertex-shader","category_id":10,"word_count":598,"deleted_at":null,"user_id":165,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1413","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":5,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":165,"username":"Bananaft","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","post_count":4,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":148,"username":"codingmonkey","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/codingmonkey/{size}/119_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":165,"username":"Bananaft","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png"},"last_poster":{"id":165,"username":"Bananaft","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png"},"links":[{"url":"http://www.gamedev.ru/code/forum/?id=205849","title":"Bump and Tangent Space / Форум / Программирование игр / GameDev.ru — Разработка игр","internal":false,"attachment":false,"reflection":false,"clicks":105,"user_id":148,"domain":"www.gamedev.ru","root_domain":"gamedev.ru"}]}}