{"post_stream":{"posts":[{"id":5704,"name":"","username":"thebluefish","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","created_at":"2015-04-08T23:48:06.000Z","cooked":"\u003cp\u003eI‚Äôm attempting to finish up the C++ editor that scorvi put out. I added the ability to delete nodes, but it crashes when one node is a child of another and both are being deleted.\u003c/p\u003e\n\u003cp\u003eThe angelscript version works as follows:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e// Remove nodes\n    for (uint i = 0; i \u0026lt; selectedNodes.length; ++i)\n    {\n        Node@ node = selectedNodes[i];\n        if (node.parent is null || node.scene is null)\n            continue; // Root or already deleted\n\n        uint nodeIndex = GetListIndex(node);\n\n        // Create undo action\n        DeleteNodeAction action;\n        action.Define(node);\n        group.actions.Push(action);\n\n        node.Remove();\n        SetSceneModified();\n\n        // If deleting only one node, select the next item in the same index\n        if (selectedNodes.length == 1 \u0026amp;\u0026amp; selectedComponents.empty)\n            hierarchyList.selection = nodeIndex;\n    }\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd my code in C++:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eUrho3D::Vector\u0026lt;Urho3D::Node*\u0026gt; nodes = _editorSelection-\u0026gt;GetSelectedNodes();\nfor (unsigned int i = 0; i \u0026lt; nodes.Size(); i++)\n{\n\tUrho3D::Node* node = nodes[i];\n\n\tif (!node-\u0026gt;GetParent() || !node-\u0026gt;GetScene())\n\t\tcontinue;\n\n\tnode-\u0026gt;Remove();\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe crash appears to be caused by a bad pointer held by the child node. The parent node is already removed, and the child node‚Äôs parent_ pointer points to 0xfeeefeee instead of being null (This is a Visual Studio value). AFAIK the angelscript bindings uses the Node‚Äôs GetParent/SetParent methods. Does anyone see a problem with my approach?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:04:36.314Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":7,"reads":19,"readers_count":18,"score":38.8,"yours":false,"topic_id":983,"topic_slug":"deleting-nodes-recursively-in-c","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":80,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5709,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-04-09T07:42:30.000Z","cooked":"\u003cp\u003eAngelScript handles are equal to SharedPtr‚Äôs, so they force keeping the selectedNodes alive until they‚Äôre both removed from the scene, and selectedNodes has been cleared.\u003c/p\u003e\n\u003cp\u003eBut in this kind of operation it would be more correct to hold a vector of WeakPtr‚Äôs to all the nodes you want to delete. No need to sort by depth, and you don‚Äôt cause nodes to be left alive any longer than they should, you just check if each WeakPtr has expired (due to hierarchy already deleting the node) and if so skip to the next.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:04:36.673Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":16,"readers_count":15,"score":3.2,"yours":false,"topic_id":983,"topic_slug":"deleting-nodes-recursively-in-c","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://discourse.urho3d.io/t/remove-objects-node-from-scene/5816","internal":true,"reflection":true,"title":"Remove Objects/Node from Scene","clicks":0}],"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5717,"name":"","username":"thebluefish","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","created_at":"2015-04-09T14:47:59.000Z","cooked":"\u003cp\u003eAhhh ok, that makes sense. That‚Äôs good to know for future cases where I‚Äôm converting angelscript to C++. I now do it the following way:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eUrho3D::Vector\u0026lt;Urho3D::WeakPtr\u0026lt;Urho3D::Node\u0026gt;\u0026gt; nodePtrs;\nauto nodes = _editorSelection-\u0026gt;GetSelectedNodes();\nfor (auto itr = nodes.Begin(); itr != nodes.End(); itr++)\n{\n\tUrho3D::WeakPtr\u0026lt;Urho3D::Node\u0026gt; node(*itr);\n\tnodePtrs.Push(node);\n}\nfor (auto itr = nodePtrs.Begin(); itr != nodePtrs.End(); itr++)\n{\n\tUrho3D::WeakPtr\u0026lt;Urho3D::Node\u0026gt; node = *itr;\n\n\tif (!node || !node-\u0026gt;GetParent() || !node-\u0026gt;GetScene())\n\t\tcontinue;\n\n\tnode-\u0026gt;Remove();\n}\nnodes.Clear();\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis works great. Thanks again!\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:04:37.231Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":16,"readers_count":15,"score":3.2,"yours":false,"topic_id":983,"topic_slug":"deleting-nodes-recursively-in-c","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":80,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[5704,5709,5717]},"timeline_lookup":[[1,2785]],"suggested_topics":[{"id":7092,"title":"Finding the World Space Coordinates of the Screen Edges","fancy_title":"Finding the World Space Coordinates of the Screen Edges","slug":"finding-the-world-space-coordinates-of-the-screen-edges","posts_count":6,"reply_count":2,"highest_post_number":6,"image_url":null,"created_at":"2021-12-07T20:53:49.453Z","last_posted_at":"2021-12-08T12:33:52.510Z","bumped":true,"bumped_at":"2021-12-08T12:33:52.510Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":210,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]},{"id":7097,"title":"View Physics event for ConvexCast","fancy_title":"View Physics event for ConvexCast","slug":"view-physics-event-for-convexcast","posts_count":11,"reply_count":5,"highest_post_number":11,"image_url":null,"created_at":"2021-12-09T23:56:27.507Z","last_posted_at":"2021-12-12T20:20:02.788Z","bumped":true,"bumped_at":"2021-12-12T20:20:02.788Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":206,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7123,"title":"Character hitboxes","fancy_title":"Character hitboxes","slug":"character-hitboxes","posts_count":24,"reply_count":16,"highest_post_number":24,"image_url":null,"created_at":"2022-01-10T19:34:24.617Z","last_posted_at":"2022-01-12T22:44:20.744Z","bumped":true,"bumped_at":"2022-01-12T22:44:20.744Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":275,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"}}]},{"id":7129,"title":"Best Model Import Pipeline as of Jan 2022?","fancy_title":"Best Model Import Pipeline as of Jan 2022?","slug":"best-model-import-pipeline-as-of-jan-2022","posts_count":7,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2022-01-17T09:27:23.432Z","last_posted_at":"2022-01-17T20:37:59.458Z","bumped":true,"bumped_at":"2022-01-17T20:37:59.458Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":170,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}}]},{"id":7087,"title":"Android how to get error message sometimes little change gives me just crash","fancy_title":"Android how to get error message sometimes little change gives me just crash","slug":"android-how-to-get-error-message-sometimes-little-change-gives-me-just-crash","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-05T16:59:59.376Z","last_posted_at":"2021-12-05T18:17:02.335Z","bumped":true,"bumped_at":"2021-12-05T18:17:02.335Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":153,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1436,"username":"Maco","name":"Maco","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/90ced4/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]}],"tags_descriptions":{},"id":983,"title":"Deleting nodes recursively in C++","fancy_title":"Deleting nodes recursively in C++","posts_count":3,"created_at":"2015-04-08T23:48:06.000Z","views":338,"reply_count":0,"like_count":0,"last_posted_at":"2015-04-09T14:47:59.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"deleting-nodes-recursively-in-c","category_id":10,"word_count":394,"deleted_at":null,"user_id":80,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_983","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":3,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":80,"username":"thebluefish","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":3,"username":"cadaver","name":"Lasse √ñ√∂rni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2}],"created_by":{"id":80,"username":"thebluefish","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png"},"last_poster":{"id":80,"username":"thebluefish","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png"}}}