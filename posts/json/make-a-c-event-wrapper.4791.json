{"post_stream":{"posts":[{"id":27176,"name":"Anti Loxy","username":"AntiLoxy","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/7feea3/{size}.png","created_at":"2019-01-03T17:05:15.626Z","cooked":"\u003cp\u003eHey, i need to wrap an event handler into another one, but without success.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evoid ContextMenu::addItem(String name, String text, EventHandler* handler)\n{\n    ButtonText* item = CreateChild\u0026lt;ButtonText\u0026gt;(name);\n    item-\u0026gt;SetStyle(\"ActionItem\");\n    item-\u0026gt;SetFixedHeight(20);\n    item-\u0026gt;setLabel(text);\n    //item-\u0026gt;SetVar(VAR_ITEM_HANDLER, handler);\n\n    SubscribeToEvent(item, \"Released\", [\u0026amp;](StringHash, VariantMap\u0026amp; eventData)\n    {\n        handler-\u0026gt;Invoke(eventData); // crash at this point !\n        close();\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe function call :\u003cbr\u003e\n\u003ccode\u003econtextMenu_-\u0026gt;addItem(\"open\", \"Open file\", URHO3D_HANDLER(LocalWorldEditorState, handleOpenFile));\u003c/code\u003e\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2019-01-03T17:05:15.626Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":20,"reads":37,"readers_count":36,"score":107.4,"yours":false,"topic_id":4791,"topic_slug":"make-a-c-event-wrapper","display_username":"Anti Loxy","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1092,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27179,"name":"","username":"S.L.C","avatar_template":"/user_avatar/discourse.urho3d.io/s.l.c/{size}/1016_2.png","created_at":"2019-01-03T18:21:36.035Z","cooked":"\u003cp\u003eOf course it crashes. You capture a reference to \u003ccode\u003ehandler\u003c/code\u003e which is a variable (parameter) on the stack that dies at the end of that function. By the time that lambda gets called. That memory in the stack could be something else. And you still reference it and expect it to be a pointer to an \u003ccode\u003eEventHandler\u003c/code\u003e. Since a reference is a pointer and \u003ccode\u003ehandler\u003c/code\u003e is a pointer they occupy the same memory so there’s no benefit.\u003c/p\u003e\n\u003cp\u003eDrop the \u003ccode\u003e\u0026amp;\u003c/code\u003e from \u003ccode\u003e[\u0026amp;]\u003c/code\u003e and capture \u003ccode\u003ehandler\u003c/code\u003e by value. Or simply use \u003ccode\u003e[=]\u003c/code\u003e if you want to be a bit more verbose.\u003c/p\u003e\n\u003cp\u003eAnd I believe you’re supposed to use \u003ccode\u003eE_RELEASED\u003c/code\u003e instead of \u003ccode\u003e\"Released\"\u003c/code\u003e\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2019-01-03T18:27:39.900Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":36,"readers_count":35,"score":32.2,"yours":false,"topic_id":4791,"topic_slug":"make-a-c-event-wrapper","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":180,"hidden":false,"trust_level":0,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"user_suspended":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":true},{"id":27180,"name":"Anti Loxy","username":"AntiLoxy","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/7feea3/{size}.png","created_at":"2019-01-03T18:32:03.296Z","cooked":"\u003cp\u003eHo i see, i was misunderstood lambda capture symbol. thanks you.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2019-01-03T18:32:03.296Z","reply_count":1,"reply_to_post_number":2,"quote_count":0,"incoming_link_count":0,"reads":35,"readers_count":34,"score":12.0,"yours":false,"topic_id":4791,"topic_slug":"make-a-c-event-wrapper","display_username":"Anti Loxy","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"S.L.C","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/s.l.c/{size}/1016_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1092,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27200,"name":"","username":"rku","avatar_template":"/user_avatar/discourse.urho3d.io/rku/{size}/3200_2.png","created_at":"2019-01-05T10:57:25.895Z","cooked":"\u003cp\u003eBe aware of what you are doing. \u003ccode\u003eString name\u003c/code\u003e and \u003ccode\u003eString text\u003c/code\u003e copy strings for no good reason. You should use \u003ccode\u003econst String\u0026amp; text\u003c/code\u003e to take a string reference.\u003c/p\u003e\n\u003cp\u003eAs for lambdas - they easily can cause memory allocation. \u003ccode\u003estd::function\u0026lt;\u0026gt;\u003c/code\u003e has enough storage for two pointers. If you capture more pointers or use \u003ccode\u003e[=]\u003c/code\u003e - that will definitely allocate memory which depending on where you use this may snowball into something very slow.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2019-01-05T10:57:25.895Z","reply_count":1,"reply_to_post_number":3,"quote_count":0,"incoming_link_count":0,"reads":26,"readers_count":25,"score":40.2,"yours":false,"topic_id":4791,"topic_slug":"make-a-c-event-wrapper","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"AntiLoxy","name":"Anti Loxy","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/7feea3/{size}.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":2}],"moderator":false,"admin":false,"staff":false,"user_id":246,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27202,"name":"Anti Loxy","username":"AntiLoxy","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/7feea3/{size}.png","created_at":"2019-01-05T12:57:39.095Z","cooked":"\u003cp\u003eOk !\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003estd::function  is guaranteed to not allocate if constructed from a function pointer, which is also one word in size - Stackoverflow\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSo, i will use the classic way URHO3D_HANDLER(Class, method).\u003cbr\u003e\nThank you for enlightening me about the dangerous objects that are lambdas.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2019-01-05T12:57:39.095Z","reply_count":1,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":10.0,"yours":false,"topic_id":4791,"topic_slug":"make-a-c-event-wrapper","display_username":"Anti Loxy","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"rku","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/rku/{size}/3200_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1092,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27203,"name":"","username":"rku","avatar_template":"/user_avatar/discourse.urho3d.io/rku/{size}/3200_2.png","created_at":"2019-01-05T13:16:35.197Z","cooked":"\u003cp\u003eYou can safely use lambdas for events, just be aware of these things. \u003ccode\u003e[this](StringHash, VariantMap\u0026amp;) { }\u003c/code\u003e is a good bet. Wont allocate as \u003ccode\u003ethis\u003c/code\u003e is one pointer and it is enough most of the time. \u003ccode\u003eURHO3D_HANDLER(Class, method)\u003c/code\u003e is essentially the same.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2019-01-05T13:16:35.197Z","reply_count":0,"reply_to_post_number":5,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":20.0,"yours":false,"topic_id":4791,"topic_slug":"make-a-c-event-wrapper","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"AntiLoxy","name":"Anti Loxy","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/7feea3/{size}.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":246,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[27176,27179,27180,27200,27202,27203]},"timeline_lookup":[[1,1419],[4,1418]],"suggested_topics":[{"id":7086,"title":"Handling CrowdAgents that get stuck","fancy_title":"Handling CrowdAgents that get stuck","slug":"handling-crowdagents-that-get-stuck","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-04T01:26:23.062Z","last_posted_at":"2021-12-05T04:37:54.143Z","bumped":true,"bumped_at":"2021-12-05T04:37:54.143Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7097,"title":"View Physics event for ConvexCast","fancy_title":"View Physics event for ConvexCast","slug":"view-physics-event-for-convexcast","posts_count":11,"reply_count":5,"highest_post_number":11,"image_url":null,"created_at":"2021-12-09T23:56:27.507Z","last_posted_at":"2021-12-12T20:20:02.788Z","bumped":true,"bumped_at":"2021-12-12T20:20:02.788Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":206,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7098,"title":"Cartoon Fire Effect","fancy_title":"Cartoon Fire Effect","slug":"cartoon-fire-effect","posts_count":6,"reply_count":0,"highest_post_number":6,"image_url":null,"created_at":"2021-12-10T04:08:49.887Z","last_posted_at":"2021-12-12T02:49:51.076Z","bumped":true,"bumped_at":"2021-12-12T02:49:51.076Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":274,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7129,"title":"Best Model Import Pipeline as of Jan 2022?","fancy_title":"Best Model Import Pipeline as of Jan 2022?","slug":"best-model-import-pipeline-as-of-jan-2022","posts_count":7,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2022-01-17T09:27:23.432Z","last_posted_at":"2022-01-17T20:37:59.458Z","bumped":true,"bumped_at":"2022-01-17T20:37:59.458Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":170,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}}]},{"id":7204,"title":"How handle with multiple scenes?","fancy_title":"How handle with multiple scenes?","slug":"how-handle-with-multiple-scenes","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-02-23T16:15:02.697Z","last_posted_at":"2022-02-23T16:15:02.762Z","bumped":true,"bumped_at":"2022-02-23T16:15:02.762Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":131,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1508,"username":"killinbassou","name":"killin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/848f3c/{size}.png"}}]}],"tags_descriptions":{},"id":4791,"title":"Make a C++ event wrapper","fancy_title":"Make a C++ event wrapper","posts_count":6,"created_at":"2019-01-03T17:05:15.529Z","views":394,"reply_count":4,"like_count":4,"last_posted_at":"2019-01-05T13:16:35.197Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"make-a-c-event-wrapper","category_id":10,"word_count":344,"deleted_at":null,"user_id":1092,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_4791","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":6,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"accepted_answer":{"post_number":2,"username":"S.L.C","excerpt":"Of course it crashes. You capture a reference to handler which is a variable (parameter) on the stack that dies at the end of that function. By the time that lambda gets called. That memory in the stack could be something else. And you still reference it and expect it to be a pointer to an EventHand\u0026hellip;"},"details":{"can_edit":false,"notification_level":1,"participants":[{"id":1092,"username":"AntiLoxy","name":"Anti Loxy","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/7feea3/{size}.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":246,"username":"rku","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/rku/{size}/3200_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":180,"username":"S.L.C","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/s.l.c/{size}/1016_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":0}],"created_by":{"id":1092,"username":"AntiLoxy","name":"Anti Loxy","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/7feea3/{size}.png"},"last_poster":{"id":246,"username":"rku","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/rku/{size}/3200_2.png"}}}