{"post_stream":{"posts":[{"id":11804,"name":"hd_","username":"hdunderscore","avatar_template":"/user_avatar/discourse.urho3d.io/hdunderscore/{size}/1151_2.png","created_at":"2016-04-22T04:37:22.000Z","cooked":"\u003cp\u003eI’m trying to get this SSAO shader into urho: \u003ca href=\"http://john-chapman-graphics.blogspot.com.au/2013/01/ssao-tutorial.html\" rel=\"nofollow noopener\"\u003ejohn-chapman-graphics.blogspot.c … orial.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIt seems simple enough, find position in view space, make new points around that point in viewspace, convert to screen space to grab a depth sample for comparison. But I can’t seem to convert from viewspace (or world space) to screenspace in the pixel shader. Here is a simple example, although I did try a few other things already:\u003c/p\u003e\n\u003cp\u003e[code]\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “Uniforms.hlsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “Samplers.hlsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “Transform.hlsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “ScreenPos.hlsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “Lighting.hlsl”\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#line\u003c/span\u003e 7\u003c/p\u003e\n\u003cp\u003evoid VS(float4 iPos : POSITION,\u003cbr\u003e\nout float4 oScreenPos : TEXCOORD0,\u003cbr\u003e\nout float3 oFarRay : TEXCOORD1,\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#ifdef\u003c/span\u003e ORTHO\u003cbr\u003e\nout float3 oNearRay : TEXCOORD2,\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#endif\u003c/span\u003e\u003cbr\u003e\nout float4 oGBufferOffsets : TEXCOORD3,\u003cbr\u003e\nout float4x4 oViewProj : TEXCOORD4,\u003cbr\u003e\nout float4 oPos : OUTPOSITION)\u003cbr\u003e\n{\u003cbr\u003e\nfloat4x3 modelMatrix = iModelMatrix;\u003cbr\u003e\nfloat3 worldPos = GetWorldPos(modelMatrix);\u003cbr\u003e\noPos = GetClipPos(worldPos);\u003cbr\u003e\noScreenPos = GetScreenPos(oPos);\u003cbr\u003e\noFarRay = GetFarRay(oPos) * oPos.w;\u003cbr\u003e\noViewProj = cViewProj;\u003cbr\u003e\noGBufferOffsets = cGBufferOffsets;\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#ifdef\u003c/span\u003e ORTHO\u003cbr\u003e\noNearRay = GetNearRay(oPos) * oPos.w;\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#endif\u003c/span\u003e\u003cbr\u003e\n}\u003c/p\u003e\n\u003cp\u003evoid PS(\u003cbr\u003e\nfloat4 iScreenPos : TEXCOORD0,\u003cbr\u003e\nfloat3 iFarRay : TEXCOORD1,\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#ifdef\u003c/span\u003e ORTHO\u003cbr\u003e\nfloat3 iNearRay : TEXCOORD2,\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#endif\u003c/span\u003e\u003cbr\u003e\nfloat4 iGBufferOffsets : TEXCOORD3,\u003cbr\u003e\nfloat4x4 iViewProj : TEXCOORD4,\u003cbr\u003e\nout float4 oColor : OUTCOLOR0)\u003cbr\u003e\n{\u003cbr\u003e\nfloat depth = Sample2D(DepthBuffer, iScreenPos).r;\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#ifdef\u003c/span\u003e HWDEPTH\u003cbr\u003e\ndepth = ReconstructDepth(depth);\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#endif\u003c/span\u003e\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#ifdef\u003c/span\u003e ORTHO\u003cbr\u003e\nfloat3 worldPos = lerp(iNearRay, iFarRay, depth) / iScreenPos.w;\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#else\u003c/span\u003e\u003cbr\u003e\nfloat3 worldPos = iFarRay * depth / iScreenPos.w;\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#endif\u003c/span\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efloat3 somePosition = worldPos.xyz;\n\nfloat4 cPos = mul(float4(somePosition, 1.0), iViewProj);\n\nfloat4 sPos =  float4(\n    cPos.x * iGBufferOffsets.z + iGBufferOffsets.x * cPos.w,\n    -cPos.y * iGBufferOffsets.w + iGBufferOffsets.y * cPos.w,\n    0.0,\n    cPos.w);\n\noColor = float4(sPos.xy, 0.0, 1.0);\n// Trying to get:\n//oColor = float4(iScreenPos.xy, 0.0, 1.0);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}\u003cbr\u003e\n[/code]\u003c/p\u003e\n\u003cp\u003eSeems like the ‘worldPos’ in this example is really viewPos ?\u003c/p\u003e\n\u003cp\u003eThanks\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:12:01.040Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":24,"reads":13,"readers_count":12,"score":122.6,"yours":false,"topic_id":1977,"topic_slug":"deferred-shader-things","display_username":"hd_","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://john-chapman-graphics.blogspot.com.au/2013/01/ssao-tutorial.html","internal":false,"reflection":false,"title":"john-chapman-graphics: SSAO Tutorial","clicks":3}],"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":114,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11806,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-04-22T07:53:06.000Z","cooked":"\u003cp\u003eThe deferred shaders (or anything else that uses the camera near/far rays calculated in vertex shader) work in a “camera-centered world space” meaning you must add the camera position to get world space. Light world positions are adjusted accordingly in the batch preparation. This is rather confusing to get a negligible performance gain (one addition in PS) and since we don’t support pixel shader 2.0 anymore the instruction count shouldn’t be an issue, so I’d say it should be changed to true world space.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:12:01.176Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":1977,"topic_slug":"deferred-shader-things","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11808,"name":"hd_","username":"hdunderscore","avatar_template":"/user_avatar/discourse.urho3d.io/hdunderscore/{size}/1151_2.png","created_at":"2016-04-22T09:42:04.000Z","cooked":"\u003cp\u003eAm I mistaken to use the cViewProj matrix to try convert from world space to clip space? Am I maybe passing it along to the pixel shader incorrectly ? I get an error if I try to pass two matrices, or anything after a matrix. I feel like cViewProj is a unit matrix when I try to use it in the pixel shader.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:12:01.315Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":12,"readers_count":11,"score":7.4,"yours":false,"topic_id":1977,"topic_slug":"deferred-shader-things","display_username":"hd_","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":114,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11809,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-04-22T10:40:29.000Z","cooked":"\u003cp\u003eI believe I’ve never passed matrices in interpolators, so can’t outright comment what is the right approach for that. cViewProj should be appropriate for world-\u0026gt;clip conversion though. If you foresee it’s useful elsewhere you could also make it an actual pixel shader uniform (again, we’re no longer PS2.0, so it’s acceptable)\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:12:01.385Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":1977,"topic_slug":"deferred-shader-things","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11811,"name":"hd_","username":"hdunderscore","avatar_template":"/user_avatar/discourse.urho3d.io/hdunderscore/{size}/1151_2.png","created_at":"2016-04-22T13:44:14.000Z","cooked":"\u003cp\u003eThanks for the help ! I have exposed a cViewProjPS and have made progress on this.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:12:01.520Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":11,"readers_count":10,"score":2.2,"yours":false,"topic_id":1977,"topic_slug":"deferred-shader-things","display_username":"hd_","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":114,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[11804,11806,11808,11809,11811]},"timeline_lookup":[[1,2406]],"suggested_topics":[{"id":7178,"title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","fancy_title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","slug":"medium-quality-technique-for-semi-reflective-specular-glass-in-urho","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/51408fe152ba02eb8b92237cc9a9411c8ee922e6.jpeg","created_at":"2022-01-31T22:57:50.134Z","last_posted_at":"2022-02-01T04:32:37.418Z","bumped":true,"bumped_at":"2022-02-01T04:32:37.418Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":154,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]},{"id":7243,"title":"Android compile fails","fancy_title":"Android compile fails","slug":"android-compile-fails","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2022-04-25T08:46:07.947Z","last_posted_at":"2022-05-06T08:22:51.592Z","bumped":true,"bumped_at":"2022-05-06T08:22:51.592Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":181,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7212,"title":"Shadow Gap between Feet and Plane","fancy_title":"Shadow Gap between Feet and Plane","slug":"shadow-gap-between-feet-and-plane","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/8/897538cff25de49fafa7aa77574f822e99576b67_2_1024x686.jpeg","created_at":"2022-03-07T00:04:17.351Z","last_posted_at":"2022-03-07T00:17:57.413Z","bumped":true,"bumped_at":"2022-03-07T00:17:57.413Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}}]},{"id":7215,"title":"How to build rbfx?","fancy_title":"How to build rbfx?","slug":"how-to-build-rbfx","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-03-11T01:28:40.314Z","last_posted_at":"2022-03-12T19:16:39.360Z","bumped":true,"bumped_at":"2022-03-12T19:16:39.360Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":268,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1510,"username":"SoNewBee","name":"So New Bee","avatar_template":"/user_avatar/discourse.urho3d.io/sonewbee/{size}/3755_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1447,"username":"Batch","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f17d59/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7268,"title":"Get vertex position before Morph in shader","fancy_title":"Get vertex position before Morph in shader","slug":"get-vertex-position-before-morph-in-shader","posts_count":8,"reply_count":6,"highest_post_number":8,"image_url":null,"created_at":"2022-05-15T19:44:19.139Z","last_posted_at":"2022-05-16T06:11:07.099Z","bumped":true,"bumped_at":"2022-08-12T22:38:31.553Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":5,"views":209,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1205,"username":"Askhento","name":"Askhento","avatar_template":"/user_avatar/discourse.urho3d.io/askhento/{size}/3849_2.png"}},{"extras":"latest","description":"Most Recent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]}],"tags_descriptions":{},"id":1977,"title":"Deferred shader things","fancy_title":"Deferred shader things","posts_count":5,"created_at":"2016-04-22T04:37:22.000Z","views":295,"reply_count":0,"like_count":0,"last_posted_at":"2016-04-22T13:44:14.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"deferred-shader-things","category_id":10,"word_count":514,"deleted_at":null,"user_id":114,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1977","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":5,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":114,"username":"hdunderscore","name":"hd_","avatar_template":"/user_avatar/discourse.urho3d.io/hdunderscore/{size}/1151_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2}],"created_by":{"id":114,"username":"hdunderscore","name":"hd_","avatar_template":"/user_avatar/discourse.urho3d.io/hdunderscore/{size}/1151_2.png"},"last_poster":{"id":114,"username":"hdunderscore","name":"hd_","avatar_template":"/user_avatar/discourse.urho3d.io/hdunderscore/{size}/1151_2.png"},"links":[{"url":"http://john-chapman-graphics.blogspot.com.au/2013/01/ssao-tutorial.html","title":"john-chapman-graphics: SSAO Tutorial","internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":114,"domain":"john-chapman-graphics.blogspot.com.au","root_domain":"john-chapman-graphics.blogspot.com.au"}]}}