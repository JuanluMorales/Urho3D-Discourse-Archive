{"post_stream":{"posts":[{"id":202,"name":"","username":"szamq","avatar_template":"/user_avatar/discourse.urho3d.io/szamq/{size}/66_2.png","created_at":"2014-01-28T18:41:14.000Z","cooked":"\u003cp\u003eI implemented some handy water reflection scriptinstance class which can be added in the editor. Mostly it‚Äôs copied from 23_Water with some tweaks.\u003c/p\u003e\n\u003cp\u003eFeatures:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCreate water reflection just by adding one component to the node\u003c/li\u003e\n\u003cli\u003eMultiple water reflection surfaces supported\u003c/li\u003e\n\u003cli\u003eReflection will work after saving and loading\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUsage:\u003cbr\u003e\nadd it as ScriptInstance component to a node with StaticModel\u003c/p\u003e\n\u003cp\u003eHierarchy:\u003cbr\u003e\n-node\u003cbr\u003e\n‚ÄìStaticModel\u003cbr\u003e\n‚ÄìScriptInstance (WaterReflection)\u003c/p\u003e\n\u003cp\u003eEdit: Changed Start to DelayedStart. Does anyone know why Start creates null pointer exception after loading scene? It should work because components are created at creation time, but it says that reflectionCamera is null.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eclass WaterReflection : ScriptObject\n{\n\tNode@ reflectionCameraNode;\n\tCamera@ reflectionCamera;\n    WaterReflection(){}\n\t\n    void DelayedStart()\n\t{\n\t\tStaticModel@ water = node.GetComponent(\"StaticModel\");\n\t\tMaterial@ waterMaterial = cache.GetResource(\"Material\", \"Materials/Water.xml\");\n\t\twater.material=waterMaterial.Clone();\n\t\t// Set a different viewmask on the water plane to be able to hide it from the reflection camera\n\t\twater.viewMask = 0x80000000;\n\n\t\treflectionCameraNode = renderer.viewports[0].camera.node.CreateChild();\n\t\treflectionCameraNode.temporary=true;\n\t\treflectionCamera = reflectionCameraNode.CreateComponent(\"Camera\");\n\t\t\n\t\tTransformChanged();\n\t\t\n\t\treflectionCamera.farClip = 750.0;\n\t\treflectionCamera.viewMask = 0x7fffffff; // Hide objects with only bit 31 in the viewmask (the water plane)\n\t\treflectionCamera.autoAspectRatio = false;\n\t\treflectionCamera.useReflection = true;\n\t\treflectionCamera.useClipping = true; \n\t\treflectionCamera.aspectRatio = float(graphics.width) / float(graphics.height);\n\t\treflectionCamera.viewOverrideFlags = VO_DISABLE_SHADOWS;\n\t\t\n\t\tint texSize = 1024;\n\t\tTexture2D@ renderTexture = Texture2D();\n\t\trenderTexture.SetSize(texSize, texSize, GetRGBFormat(), TEXTURE_RENDERTARGET);\n\t\trenderTexture.filterMode = FILTER_BILINEAR;\n\t\tRenderSurface@ surface = renderTexture.renderSurface;\n\t\tViewport@ rttViewport = Viewport(renderer.viewports[0].scene, reflectionCamera);\n\t\tsurface.viewports[0] = rttViewport;\n\t\twater.materials[0].textures[TU_DIFFUSE] = renderTexture;\n\t}\n\t\n\tvoid Update(float timestep)\n\t{\n\t\treflectionCamera.aspectRatio = float(graphics.width) / float(graphics.height);\n\t}\n\t\n\tvoid TransformChanged()\n\t{\n\t\tStaticModel@ water = node.GetComponent(\"StaticModel\");\n\t\tfloat delta=(water.worldBoundingBox.max.y - water.worldBoundingBox.min.y)/2.f;\n\t\tPlane waterPlane = Plane(node.worldRotation * Vector3(0.0f, 1.0f, 0.0f), node.worldPosition+Vector3(0.0f, delta, 0.0f));\n\t\tPlane waterClipPlane = Plane(node.worldRotation * Vector3(0.0f, 1.0f, 0.0f), node.worldPosition +\tVector3(0.0f,delta- 0.1f, 0.0f));\n\t\treflectionCamera.reflectionPlane = waterPlane;\n\t\treflectionCamera.clipPlane = waterClipPlane;\n\t}\n}\u003c/code\u003e\u003c/pre\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T00:57:42.721Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":24,"reads":18,"readers_count":17,"score":123.6,"yours":false,"topic_id":62,"topic_slug":"water-reflection-script","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://discourse.urho3d.io/t/crash-with-waterreflection-as-script/3282","internal":true,"reflection":true,"title":"Crash with \"waterreflection.as\" script","clicks":2}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":13,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[202]},"timeline_lookup":[[1,3220]],"suggested_topics":[{"id":7110,"title":"Resource fetch define","fancy_title":"Resource fetch define","slug":"resource-fetch-define","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-27T12:28:55.126Z","last_posted_at":"2021-12-27T17:00:37.699Z","bumped":true,"bumped_at":"2021-12-27T17:00:37.699Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":7,"views":184,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}}]},{"id":7120,"title":"Log Error Once Macro","fancy_title":"Log Error Once Macro","slug":"log-error-once-macro","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-01-04T02:24:37.857Z","last_posted_at":"2022-01-04T02:24:37.925Z","bumped":true,"bumped_at":"2022-01-04T02:24:37.925Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":144,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7103,"title":":test_tube: DebugRenderer as GUI","fancy_title":":test_tube: DebugRenderer as GUI","slug":"debugrenderer-as-gui","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-17T02:25:06.606Z","last_posted_at":"2021-12-18T01:09:27.738Z","bumped":true,"bumped_at":"2021-12-18T01:09:27.738Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"üß™ DebugRenderer as GUI","tags_descriptions":{},"like_count":4,"views":267,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7099,"title":":fallen_leaf: Polynomials \u0026 Harmonics","fancy_title":":fallen_leaf: Polynomials \u0026amp; Harmonics","slug":"polynomials-harmonics","posts_count":6,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2021-12-13T05:06:04.641Z","last_posted_at":"2021-12-27T23:27:39.489Z","bumped":true,"bumped_at":"2021-12-27T23:27:39.489Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"üçÇ Polynomials \u0026 Harmonics","tags_descriptions":{},"like_count":6,"views":392,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7245,"title":"Custom memory allocation","fancy_title":"Custom memory allocation","slug":"custom-memory-allocation","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-04-29T12:59:26.211Z","last_posted_at":"2022-04-29T23:01:14.486Z","bumped":true,"bumped_at":"2022-04-29T23:01:14.486Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":193,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1386,"username":"mohamed.chit","name":"Mohamed Chit","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/d6d6ee/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1363,"username":"vmost","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/5f9b8f/{size}.png"}}]}],"tags_descriptions":{},"id":62,"title":"Water reflection script","fancy_title":"Water reflection script","posts_count":1,"created_at":"2014-01-28T18:41:14.000Z","views":524,"reply_count":0,"like_count":0,"last_posted_at":"2014-01-28T18:41:14.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"water-reflection-script","category_id":13,"word_count":318,"deleted_at":null,"user_id":13,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_62","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":1,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":13,"username":"szamq","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/szamq/{size}/66_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":13,"username":"szamq","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/szamq/{size}/66_2.png"},"last_poster":{"id":13,"username":"szamq","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/szamq/{size}/66_2.png"},"links":[{"url":"http://discourse.urho3d.io/t/crash-with-waterreflection-as-script/3282","title":"Crash with \"waterreflection.as\" script","internal":true,"attachment":false,"reflection":true,"clicks":2,"user_id":458,"domain":"discourse.urho3d.io","root_domain":"urho3d.io"}]}}