{"post_stream":{"posts":[{"id":4406,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-01-29T04:34:59.000Z","cooked":"\u003cp\u003eHello,\u003c/p\u003e\n\u003cp\u003eAfter some research, help for JTippett, and more looking online. I’m trying to make code that basically gets the normal and Y-up position to get a cosine, then run it through a threshold cutoff, and the last part I’m lost. Basically, I need to tell urho3d to change the terrain texture using a lerp method. I’m not sure if I have to change material, texture2d, or get two materials from the shader and create new material then apply it.\u003c/p\u003e\n\u003cp\u003eThis is to make a cliff texture to any  procedural terrain.\u003c/p\u003e\n\u003cp\u003eThe code I have so far is. Any help is appreciated.\u003c/p\u003e\n\u003cp\u003eVivienne\u003c/p\u003e\n\u003cp\u003e[code]float cutoff(float inputvalue, float pointmid, float range)\u003cbr\u003e\n{\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/// Create valuables to calculate\nfloat midpoint=pointmid;\n\nfloat midpoint_low=midpoint-range;\nfloat midpoint_max=midpoint+range;\n\nfloat midpoint_range;\nfloat result;\n\nif(midpoint_low\u0026lt;0){ midpoint_low=0;}\n\nif(midpoint_max\u0026gt;1){midpoint_max=1;}\n\nmidpoint_range=midpoint_max-midpoint_low;\n\n/// Calculate value to range\n\nif(inputvalue\u0026lt;midpoint_low)\n{\n    result=0;\n}\nelse if(inputvalue\u0026gt;midpoint_max)\n{\n    result=1;\n}\nelse\n{\n    result=(inputvalue-midpoint_low)/midpoint_range;\n}\n\nreturn result;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}\u003c/p\u003e\n\u003cp\u003eint main()\u003cbr\u003e\n{\u003cbr\u003e\n//rest of code\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/// testing\nfloat bw=2048;\nfloat bh=2048;\nfloat x=1024;\nfloat y=1024;\n\nVector2 nworld=Vector2(x/bw, y/bh);\nVector3 worldvalue=NormalizedToWorld( producedHeightMapImage,terrain,nworld);\nVector3 normalvalue=terrain -\u0026gt;GetNormal(Vector3(worldvalue));\nfloat steep=abs(normalvalue.DotProduct(Vector3(0,1,0)));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}[/code]\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:03:01.423Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":49,"reads":26,"readers_count":25,"score":250.2,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4412,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-01-29T16:27:08.000Z","cooked":"\u003cp\u003eI tried this. It’s still giving me a high steep value\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\tVector2 nworld=Vector2(x/bw, y/bh);\n    Vector3 worldvalue=NormalizedToWorld( producedHeightMapImage,terrain,nworld);\n    Vector3 normalvalue=terrain -\u0026gt;GetNormal(Vector3(worldvalue));\n    float steep=abs(normalvalue.DotProduct(Vector3(0,1,0)));\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eGitHub\u003cbr\u003e\n\u003ca href=\"https://github.com/vivienneanthony/Existence/tree/development\" rel=\"nofollow noopener\"\u003egithub.com/vivienneanthony/Exis … evelopment\u003c/a\u003e\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:03:01.829Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":24,"readers_count":23,"score":4.8,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/vivienneanthony/Existence/tree/development","internal":false,"reflection":false,"title":"GitHub - vivienneanthony/Existence at development","clicks":2}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4418,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-01-29T21:28:16.000Z","cooked":"\u003cp\u003eUpdate. Someone can tell me if it’s wrong. Now I have to figure out the texture mixing.\u003c/p\u003e\n\u003cp\u003e[code]    /// Testing\u003cbr\u003e\nfloat bw=2048.0f;\u003cbr\u003e\nfloat bh=2048.0f;\u003cbr\u003e\nfloat x=1024.0f;\u003cbr\u003e\nfloat y=1024.0f;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/// Get steepness\nVector2 nworld=Vector2(x/bw, y/bh);\nVector3 worldvalue=NormalizedToWorld( producedHeightMapImage,terrain,nworld);\nVector3 normalvalue=terrain -\u0026gt;GetNormal(Vector3(worldvalue));\nfloat steep=1.0f-abs(normalvalue.DotProduct(Vector3(0,1,0)));\n\ncout \u0026lt;\u0026lt; steep \u0026lt;\u0026lt; \" \"\u0026lt;\u0026lt; normalvalue.x_\u0026lt;\u0026lt; \" \" \u0026lt;\u0026lt; normalvalue.y_ \u0026lt;\u0026lt; \" \" \u0026lt;\u0026lt; normalvalue.z_;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e[/code]\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:03:02.265Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":5.0,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4422,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2015-01-30T00:13:01.000Z","cooked":"\u003cp\u003e[quote=“vivienneanthony”]Hello,\u003cbr\u003e\nI’m not sure if I have to change material, texture2d, or get two materials from the shader and create new material then apply it.\u003cbr\u003e\n[/quote]\u003c/p\u003e\n\u003cp\u003eYou don’t have to do any of that. All you need is a material that uses the TerrainBlend technique. You assign a texture for the blend texture, and give that texture an image. By modifying the colors of that image, you modify the terrain that is drawn. For example:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eterrain = terrainNode:CreateComponent(\"Terrain\")\n    terrain.patchSize = 64\n    terrain.spacing = Vector3(0.20, 0.08, 0.20)\n    terrain.smoothing = true\n    hmap=Image:new(context)\n    hmap:SetSize(1025,1025,3)\n    terrain.heightMap = hmap\n    terrain.material = cache:GetResource(\"Material\", \"Materials/TerrainEdit.xml\")\n\t\n    blendtex=Texture2D:new(context)\n    blendtex:SetSize(0,0,0,TEXTURE_DYNAMIC)\n    terrain:GetMaterial():SetTexture(0,blendtex)\n\t\n    blend=Image(context)\n    blend:SetSize(512,512,4)\n    blend:Clear(Color(1,0,0,0))\n    blendtex:SetData(blend, false)\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates a terrain, sets a blank heightmap, creates an image and a texture for the blend map. The terrain is given a material. That material specifies the 3 (or, in my case, 4) detail layers to use. The colors of the blend texture specify which detail layers to draw at a given location, with the blend texture being mapped across the entire terrain.\u003c/p\u003e\n\u003cp\u003eNow, the red channel of blend represents the 1st detail layer, the green channel represents the second, and so on. If a given pixel in blend is set to Color(1,0,0,0), that means it draws fully from the first detail layer. If set to Color(0,1,0,0) it draws fully from the second detail layer. If set to Color(0.5,0.5,0,0) then it mixes the first and second layers, each at 50% strength. So if your cliff texture is at the third detail layer, then setting the pixel to Color(0,0,1,0) will set it to full cliff.\u003c/p\u003e\n\u003cp\u003eAs for the steepness, one simplification that you can make is that for terrain normals that are generated on a terrain that occupies the XZ plane, you can get the angle of the normal relative to the ground plane by dot product against the UP vector, (0,1,0). The simplification is that this is equal to (0\u003cem\u003enormal.x + 1\u003c/em\u003enormal.y + 0*normal.z). Of course, the 0 multiplications equal zero, so the final result of the dot product operation is simply equal to the Y component of the normal vector. The dot product operation really isn’t necessary. You can just take the y and use that.\u003c/p\u003e\n\u003cp\u003eThe Lerp operation (and Urho3D’s Color class implements a Lerp method) is simply a linear fade from one color to the next. The t parameter (in the range of 0 to 1) determines where on the gradient scale between color A and color B to get the result. So if A=Color(1,0,0,0) and B=Color(0,1,0,0), then the operation A:Lerp(B, 0.5) will result in the color value Color(0.5,0.5,0,0), or a 50% blend between layer 1 and layer 2. Similarly, the operation A:Lerp(B,0.7) will result in a 30%/70% blend between layer 1 and 2. The closer the interpolant factor gets to 1, the more you get from layer 0, and the closer it gets to 1 the more you get from layer 2.\u003c/p\u003e\n\u003cp\u003eNow, when generating slope-based cliffs, what I do is I read the blend image to get the pixel at the current location. Usually, this is some mix of colors representing the blend of terrain I have applied to the map. Then, assuming the cliff detail layer is layer 3, represented by blend’s blue channel, then I can do an operation like \u003cspan class=\"bbcode-b\"\u003eresult=currentcol:Lerp(Color(0,0,1,0), normal.y)\u003c/span\u003e to get a smooth blend based entirely on the slope. Applying the change, then, is as simple as calling SetPixel() with the new color then, after the full pass is completed, calling \u003cspan class=\"bbcode-b\"\u003eblendtex:SetData(blend)\u003c/span\u003e to finalize the texture.\u003c/p\u003e\n\u003cp\u003eOf course, using a fade using the unmodified normal.y really isn’t that useful, so I apply the cutoff/fade factors I described to you earlier. It is important to note that the value of normal.y isn’t going to follow a linear progression. It represents the cosine of the angle, so as the angle decreases linearly the cosine follows the cosine curve. If you use a shallow terrain (not a large amount of Y variation) then a lot of your normal.y values will tend to cluster around the value of 1. For example, in \u003ca href=\"http://i.imgur.com/GeWzdoh.jpg\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003ethis image\u003c/a\u003e, the terrain is relatively shallow, with not a lot of steep variation. Thus, the cliff blend is applied in only a few very small places. By steepening the terrain, though, I get a lot larger variance in the normal and thus the cliff terrain is applied over \u003ca href=\"http://i.imgur.com/MoMGMgT.jpg\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003emuch larger areas\u003c/a\u003e. If you are seeing normal values mostly around the top end of the curve, then you might need to either steepen your terrain variance or adjust your cutoff value.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:03:02.556Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":3,"reads":24,"readers_count":23,"score":19.8,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/GeWzdoh.jpg","internal":false,"reflection":false,"title":"GeWzdoh.jpg","clicks":0},{"url":"http://i.imgur.com/MoMGMgT.jpg","internal":false,"reflection":false,"title":"MoMGMgT.jpg","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4426,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-01-30T02:41:22.000Z","cooked":"\u003cp\u003e[quote=“JTippetts”][quote=“vivienneanthony”]Hello,\u003cbr\u003e\nI’m not sure if I have to change material, texture2d, or get two materials from the shader and create new material then apply it.\u003cbr\u003e\n[/quote]\u003c/p\u003e\n\u003cp\u003eYou don’t have to do any of that. All you need is a material that uses the TerrainBlend technique. You assign a texture for the blend texture, and give that texture an image. By modifying the colors of that image, you modify the terrain that is drawn. For example:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eterrain = terrainNode:CreateComponent(\"Terrain\")\n    terrain.patchSize = 64\n    terrain.spacing = Vector3(0.20, 0.08, 0.20)\n    terrain.smoothing = true\n    hmap=Image:new(context)\n    hmap:SetSize(1025,1025,3)\n    terrain.heightMap = hmap\n    terrain.material = cache:GetResource(\"Material\", \"Materials/TerrainEdit.xml\")\n\t\n    blendtex=Texture2D:new(context)\n    blendtex:SetSize(0,0,0,TEXTURE_DYNAMIC)\n    terrain:GetMaterial():SetTexture(0,blendtex)\n\t\n    blend=Image(context)\n    blend:SetSize(512,512,4)\n    blend:Clear(Color(1,0,0,0))\n    blendtex:SetData(blend, false)\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates a terrain, sets a blank heightmap, creates an image and a texture for the blend map. The terrain is given a material. That material specifies the 3 (or, in my case, 4) detail layers to use. The colors of the blend texture specify which detail layers to draw at a given location, with the blend texture being mapped across the entire terrain.\u003c/p\u003e\n\u003cp\u003eNow, the red channel of blend represents the 1st detail layer, the green channel represents the second, and so on. If a given pixel in blend is set to Color(1,0,0,0), that means it draws fully from the first detail layer. If set to Color(0,1,0,0) it draws fully from the second detail layer. If set to Color(0.5,0.5,0,0) then it mixes the first and second layers, each at 50% strength. So if your cliff texture is at the third detail layer, then setting the pixel to Color(0,0,1,0) will set it to full cliff.\u003c/p\u003e\n\u003cp\u003eAs for the steepness, one simplification that you can make is that for terrain normals that are generated on a terrain that occupies the XZ plane, you can get the angle of the normal relative to the ground plane by dot product against the UP vector, (0,1,0). The simplification is that this is equal to (0\u003cem\u003enormal.x + 1\u003c/em\u003enormal.y + 0*normal.z). Of course, the 0 multiplications equal zero, so the final result of the dot product operation is simply equal to the Y component of the normal vector. The dot product operation really isn’t necessary. You can just take the y and use that.\u003c/p\u003e\n\u003cp\u003eThe Lerp operation (and Urho3D’s Color class implements a Lerp method) is simply a linear fade from one color to the next. The t parameter (in the range of 0 to 1) determines where on the gradient scale between color A and color B to get the result. So if A=Color(1,0,0,0) and B=Color(0,1,0,0), then the operation A:Lerp(B, 0.5) will result in the color value Color(0.5,0.5,0,0), or a 50% blend between layer 1 and layer 2. Similarly, the operation A:Lerp(B,0.7) will result in a 30%/70% blend between layer 1 and 2. The closer the interpolant factor gets to 1, the more you get from layer 0, and the closer it gets to 1 the more you get from layer 2.\u003c/p\u003e\n\u003cp\u003eNow, when generating slope-based cliffs, what I do is I read the blend image to get the pixel at the current location. Usually, this is some mix of colors representing the blend of terrain I have applied to the map. Then, assuming the cliff detail layer is layer 3, represented by blend’s blue channel, then I can do an operation like \u003cspan class=\"bbcode-b\"\u003eresult=currentcol:Lerp(Color(0,0,1,0), normal.y)\u003c/span\u003e to get a smooth blend based entirely on the slope. Applying the change, then, is as simple as calling SetPixel() with the new color then, after the full pass is completed, calling \u003cspan class=\"bbcode-b\"\u003eblendtex:SetData(blend)\u003c/span\u003e to finalize the texture.\u003c/p\u003e\n\u003cp\u003eOf course, using a fade using the unmodified normal.y really isn’t that useful, so I apply the cutoff/fade factors I described to you earlier. It is important to note that the value of normal.y isn’t going to follow a linear progression. It represents the cosine of the angle, so as the angle decreases linearly the cosine follows the cosine curve. If you use a shallow terrain (not a large amount of Y variation) then a lot of your normal.y values will tend to cluster around the value of 1. For example, in \u003ca href=\"http://i.imgur.com/GeWzdoh.jpg\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003ethis image\u003c/a\u003e, the terrain is relatively shallow, with not a lot of steep variation. Thus, the cliff blend is applied in only a few very small places. By steepening the terrain, though, I get a lot larger variance in the normal and thus the cliff terrain is applied over \u003ca href=\"http://i.imgur.com/MoMGMgT.jpg\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003emuch larger areas\u003c/a\u003e. If you are seeing normal values mostly around the top end of the curve, then you might need to either steepen your terrain variance or adjust your cutoff value.[/quote]\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe code I have do that partially. The heightmap is created procedurally to a image that’s applied to the terrain component.\u003c/li\u003e\n\u003cli\u003eUsing the NormalToWorld function I can get a slope of any given point.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThe last point is like you mentioned the material. Which I assume is?\u003c/p\u003e\n\u003cp\u003e[code]    terrain.material = cache:GetResource(“Material”, “Materials/TerrainEdit.xml”)\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eblendtex=Texture2D:new(context)\nblendtex:SetSize(0,0,0,TEXTURE_DYNAMIC)\nterrain:GetMaterial():SetTexture(0,blendtex)\n\nblend=Image(context)\nblend:SetSize(512,512,4)\nblend:Clear(Color(1,0,0,0))\nblendtex:SetData(blend, false)[/code]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe cutoff function that I made should be able to determine the cliff mix based on a threshold which again.\u003c/p\u003e\n\u003cp\u003e[quote]Now, when generating slope-based cliffs, what I do is I read the blend image to get the pixel at the current location. Usually, this is some mix of colors representing the blend of terrain I have applied to the map. Then, assuming the cliff detail layer is layer 3, represented by blend’s blue channel, then I can do an operation like \u003cspan class=\"bbcode-b\"\u003eresult=currentcol:Lerp(Color(0,0,1,0), normal.y)\u003c/span\u003e to get a smooth blend based entirely on the slope. Applying the change, then, is as simple as calling SetPixel() with the new color then, after the full pass is completed, calling \u003cspan class=\"bbcode-b\"\u003eblendtex:SetData(blend)\u003c/span\u003e to finalize the texture.\u003cbr\u003e\n[/quote]\u003c/p\u003e\n\u003cp\u003eI would have to go through x=0 to x=imagesize and I guess take the cutoff function then put it through the loop. Probably to blend between Color(1,0,0) and  Color(1,1,0);\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:03:02.859Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":18,"readers_count":17,"score":3.6,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/MoMGMgT.jpg","internal":false,"reflection":false,"title":"MoMGMgT.jpg","clicks":0},{"url":"http://i.imgur.com/GeWzdoh.jpg","internal":false,"reflection":false,"title":"GeWzdoh.jpg","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4444,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-01-31T08:57:41.000Z","cooked":"\u003cp\u003eThis is what I have. Hope it makes sense\u003c/p\u003e\n\u003cp\u003e[code]   /// generatescene\u003cbr\u003e\nterrain-\u0026gt;GenerateProceduralHeightMap(terrainrule);\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eImage * producedHeightMapImage = new Image(context_);\nproducedHeightMapImage -\u0026gt; SetSize(2048,2048, 1, 4);\nproducedHeightMapImage -\u0026gt; SetData(terrain -\u0026gt; GetData());\n\n/// Use Jtippet mthod\nterrain-\u0026gt;SetMaterial(cache-\u0026gt;GetResource\u0026lt;Material\u0026gt;(\"Materials/TerrainEdit.xml\"));\n\nint bw=2048,bh=2048;\n\nTexture2D * blendtex=new Texture2D(context_);\nblendtex -\u0026gt; SetSize(0,0,0,TEXTURE_DYNAMIC);\nterrain-\u0026gt; GetMaterial() -\u0026gt; SetTexture(TU_DIFFUSE ,blendtex);\n\nImage * blend = new Image(context_);\nblend -\u0026gt; SetSize(bw,bh,4);\nblend -\u0026gt; Clear(Color(1,0,0,0));\n\n/// create blend here\nfor(unsigned int x=0; x\u0026lt;bw; x++)\n{\n    for(unsigned int y=0; y\u0026lt;bh; y++)\n    {\n        Vector2 nworld=Vector2(x/bw, y/bh);\n        Vector3 worldvalue=NormalizedToWorld( producedHeightMapImage,terrain,nworld);\n        Vector3 normalvalue=terrain-\u0026gt;GetNormal(worldvalue);\n        float steep=1.0f-abs(normalvalue.DotProduct(Vector3(0,1,0)));\n\n        Color currentcolor = blend -\u0026gt; GetPixel(x,y);\n        Color resultcolor=currentcolor.Lerp(Color(0,0,1,0), cutoff(steep,.5,.2));\n\n        blend-\u0026gt; SetPixel(x,y,resultcolor);\n    }\n}\n\nblendtex -\u0026gt;SetData(blend -\u0026gt;GetNextLevel (), false);[/code]\u003c/code\u003e\u003c/pre\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T01:03:04.140Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":14,"readers_count":13,"score":2.8,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4470,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-01T17:48:44.000Z","cooked":"\u003cp\u003eIm having a problem. My code and JTippet code works. I loaded a image and inclination or steepness rendered in the blended text.\u003c/p\u003e\n\u003cp\u003eBut when I use the blend texture from the generated image. The math part works if i say any point but the texture isn’t blending.\u003c/p\u003e\n\u003cp\u003eI will compare the image from graphics program to the generated one.\u003c/p\u003e\n\u003cp\u003eCould the problem be MIP levels? How can I set to one?  Is get the function get the next MIP level correct?\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-01-02T01:03:06.052Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4471,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2015-02-01T19:50:53.000Z","cooked":"\u003cp\u003eblend-\u0026gt;GetNextLevel() gets the next mip level down from the current image. Perhaps you want to just do blendtex:SetData(blend,false) instead?\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-01-02T01:03:06.119Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":10,"readers_count":9,"score":2.0,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4472,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-01T21:03:13.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/jtippetts/40/357_1.png\" class=\"avatar\"\u003e JTippetts:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eblend-\u0026gt;GetNextLevel() gets the next mip level down from the current image. Perhaps you want to just do blendtex:SetData(blend,false) instead?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI am going try it when I get home. I’m going create a component that hold information for procedural generation.\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2017-01-02T01:03:06.189Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":12,"readers_count":11,"score":2.4,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4489,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-02T21:14:14.000Z","cooked":"\u003cp\u003eSomeone recommended another solution. For testing I am using a preformatted image. I’m not sure what’s causing a problem in scale. I’m post the code and example.\u003c/p\u003e\n\u003cp\u003eGallery\u003cbr\u003e\n\u003ca href=\"http://imgur.com/a/UEgzR\" rel=\"nofollow noopener\"\u003eimgur.com/a/UEgzR\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eBlack/White is the terrain texture\u003cbr\u003e\nRed/Blue is the lerped results\u003cbr\u003e\nMerged is a overlap\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003eFunction - Cutoff/Threshold\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e[code]\u003cbr\u003e\nfloat cutoff(float inputvalue, float pointmid, float range, bool debug)\u003cbr\u003e\n{\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/// Create valuables to calculate\nfloat midpoint=pointmid;\n\nfloat midpoint_low=midpoint-range;\nfloat midpoint_high=midpoint+range;\nfloat midpoint_range=midpoint_range=midpoint_high-midpoint_low;\n\nfloat result;\n\nif(midpoint_low\u0026lt;0.0f)\n{\n    midpoint_low=0.0f;\n}\n\nif(midpoint_high\u0026gt;1.0f)\n{\n    midpoint_high=1.0f;\n}\n\n\nif(midpoint_low\u0026gt;inputvalue)\n{\n    result=0;\n    cout \u0026lt;\u0026lt; \"set zero\";\n}\nelse if(inputvalue\u0026gt;midpoint_high)\n{\n    result=1;\n    cout \u0026lt;\u0026lt; \"set one\";\n}\nelse\n{\n    result=(inputvalue-midpoint_low)/midpoint_range;\n    cout \u0026lt;\u0026lt; \"set\" \u0026lt;\u0026lt; result;\n}\n\nreturn result;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}[/code]\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003eFunction - Normalized\u003c/span\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eVector3 NormalizedToWorld(Image *height, Terrain *terrain, Vector2 normalized)\n{\n    if(!terrain || !height) return Vector2(0,0);\n    Vector3 spacing=terrain-\u0026gt;GetSpacing();\n    int patchSize=terrain-\u0026gt;GetPatchSize();\n    IntVector2 numPatches=IntVector2((height-\u0026gt;GetWidth()-1) / patchSize, (height-\u0026gt;GetHeight()-1) / patchSize);\n    Vector2 patchWorldSize=Vector2(spacing.x_*(float)(patchSize*numPatches.x_), spacing.z_*(float)(patchSize*numPatches.y_));\n    Vector2 patchWorldOrigin=Vector2(-0.5f * patchWorldSize.x_, -0.5f * patchWorldSize.y_);\n    return Vector3(patchWorldOrigin.x_+normalized.x_*patchWorldSize.x_, 0, patchWorldOrigin.y_+normalized.y_*patchWorldSize.y_);\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003eMain Code\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e[code]  /// Generate Terrain\u003cbr\u003e\nNode* terrainNode = scene_-\u0026gt;CreateChild(“Terrain”);\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eTerrain* terrain = terrainNode-\u0026gt;CreateComponent\u0026lt;Terrain\u0026gt;();\nterrain-\u0026gt;SetPatchSize(64);\nterrain-\u0026gt;SetSpacing(Vector3(1.0f, 1.0f, 1.0f)); /// Spacing between vertices and vertical resolution of the height map\nterrain-\u0026gt;SetSmoothing(true);\nterrain-\u0026gt;SetCastShadows(true);\n\n/// generatescene\nterrain-\u0026gt;SetHeightMap(cache-\u0026gt;GetResource\u0026lt;Image\u0026gt;(\"Textures/terraintest.png\"));\nterrain-\u0026gt;ApplyHeightMap();\n\n//terrain-\u0026gt;GenerateProceduralHeightMap(terrainrule);\n\n//Image * producedHeightMapImage = new Image(context_);\nImage * producedHeightMapImage = cache-\u0026gt;GetResource\u0026lt;Image\u0026gt;(\"Textures/terraintest.png\");\nproducedHeightMapImage -\u0026gt; SetSize(2048,2048, 1, 4);\n\n/// Use Jtippet mthod\nterrain-\u0026gt;SetMaterial(cache-\u0026gt;GetResource\u0026lt;Material\u0026gt;(\"Materials/TerrainEdit.xml\"));\n\nint bw=2048,bh=2048;\n\nTexture2D * blendtex=new Texture2D(context_);\nblendtex -\u0026gt; SetNumLevels(1);\nblendtex -\u0026gt; SetSize(0,0,0,TEXTURE_DYNAMIC);\nterrain-\u0026gt; GetMaterial() -\u0026gt; SetTexture(TU_DIFFUSE ,blendtex);\n\n/// Shared pointer\nSharedPtr\u0026lt;Image\u0026gt; blend;\n\nblend = new Image(context_);\nblend -\u0026gt; SetSize(bw,bh,1,4);\nblend -\u0026gt; Clear(Color(1,0,0,1));\n\nfloat steep=0.0f;\nfloat steepforlerp=0.0f;\n\n/// create blend here\nfor(unsigned int x=0; x\u0026lt;bw; x++)\n{\n    for(unsigned int y=0; y\u0026lt;bh; y++)\n    {\n        Vector2 nworld=Vector2(x/(float)bw, y/(float)bh);\n        Vector3 worldvalue=NormalizedToWorld( producedHeightMapImage,terrain,nworld);\n        Vector3 normalvalue=terrain-\u0026gt;GetNormal(worldvalue);\n\n        steep=1.0f-fabs(normalvalue.DotProduct(Vector3(0,1,0)));\n        steepforlerp=cutoff(steep,0.5f,0.20f,false);\n\n        Color currentcolor = blend -\u0026gt; GetPixel(x,y);\n        Color resultcolor=currentcolor.Lerp(Color(0,0,1,1), steepforlerp);\n\n        blend-\u0026gt; SetPixel(x,y,resultcolor);\n    }\n}\n\nblend -\u0026gt; \tFlipVertical ();\nblend -\u0026gt; \tSavePNG (\"terrainsteep.png\");\n\n\nblendtex -\u0026gt;SetData(blend, true);[/code]\u003c/code\u003e\u003c/pre\u003e","post_number":10,"post_type":1,"updated_at":"2017-01-02T01:03:07.513Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":12,"readers_count":11,"score":12.4,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://imgur.com/a/UEgzR","internal":false,"reflection":false,"title":"Testing Urho Texture Blend - Album on Imgur","clicks":3}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4493,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-03T01:13:34.000Z","cooked":"\u003cp\u003eImage of difference\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/OhYJemF.png\" rel=\"nofollow noopener\"\u003ei.imgur.com/OhYJemF.png\u003c/a\u003e\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2017-01-02T01:03:07.789Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":9,"readers_count":8,"score":1.8,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/OhYJemF.png","internal":false,"reflection":false,"title":"OhYJemF.png","clicks":2}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4495,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2015-02-03T01:21:36.000Z","cooked":"\u003cp\u003eMake sure that your terrain heightmap is sized 2^n+1 rather than 2^n. That is, instead of using an image 2048x2048 for the heightmap, use one that’s 2049x2049. Otherwise, the last terrain patch row and column in X and Z won’t be generated, meaning that the blend map will extend out beyond the edges of the terrain itself.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2017-01-02T01:03:07.921Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4498,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-03T02:12:06.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/jtippetts/40/357_1.png\" class=\"avatar\"\u003e JTippetts:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMake sure that your terrain heightmap is sized 2^n+1 rather than 2^n. That is, instead of using an image 2048x2048 for the heightmap, use one that’s 2049x2049. Otherwise, the last terrain patch row and column in X and Z won’t be generated, meaning that the blend map will extend out beyond the edges of the terrain itself.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eSo, I should do it  for the procedual terrain heightmap image I created? Instead of 2048.\u003c/p\u003e\n\u003cp\u003eI’m just making sure.  I have to probably add the procedural seed as part of a component to Terrain. So,  information can be saved or retrieved. Additionally, create a better randomize system separate for mine for any procedural stuff for content generation.     (I kinda would like the math part to be part assembly so it can be super dirt fast). Oh well.\u003c/p\u003e\n\u003cp\u003eThat might be in the future.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2017-01-02T01:03:08.156Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":9,"readers_count":8,"score":1.8,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4524,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2015-02-03T13:16:21.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/vivienneanthony/40/942_1.png\" class=\"avatar\"\u003e vivienneanthony:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSo, I should do it  for the procedual terrain heightmap image I created? Instead of 2048.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eYes. Do it for any image that you use as a heightmap, whether you load it from a file or generate it procedurally. The way the terrain calculates the number of terrain patches to build is by \u003cspan class=\"bbcode-b\"\u003eIntVector2((heightMap_-\u0026gt;GetWidth() - 1) / patchSize_, (heightMap_-\u0026gt;GetHeight() - 1) / patchSize_)\u003c/span\u003e The size should be a number that if you subtract 1 from it, the result is evenly divisible by your patch size (default: 32). For instance, if you have a patch size of 32 and a heightmap size of 2049, the number of patches in X and Z comes out to (2049-1)/32, or 64 patches. However, if you use 2048, then you end up with only (2048-1)/32 or 63 patches (integer division). Meaning that the last patch row and column are not built, and the heightmap is trimmed off so that only the first 2017x2017 pixels of the heightmap are used in generating terrain (the size of 63 patches + 1 pixel).\u003c/p\u003e\n\u003cp\u003e[quote]\u003c/p\u003e\n\u003cp\u003eI’m just making sure.  I have to probably add the procedural seed as part of a component to Terrain. So,  information can be saved or retrieved. Additionally, create a better randomize system separate for mine for any procedural stuff for content generation.     (I kinda would like the math part to be part assembly so it can be super dirt fast). Oh well.\u003c/p\u003e\n\u003cp\u003eThat might be in the future.[/quote]\u003c/p\u003e\n\u003cp\u003eI wouldn’t really recommend adding anything directly to Terrain itself. I’d recommend instead writing your own separate component so you don’t have to modify the Urho3D library itself. Modifying the library means that every time you pull from upstream you have to do a merge, and given the amount of churn that Urho3D sometimes has in master, you might end up spending a lot more time than you really want to fixing conflicts. And besides, Terrain probably shouldn’t have to care exactly how the heightmap data is constructed. It can do what it needs to do without knowing the details, so from the perspective of the single responsibility principle, the procedural stuff just doesn’t belong in there.\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2017-01-02T01:03:09.962Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4529,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-03T14:11:38.000Z","cooked":"\u003cp\u003eAh. I agree with you 200%. I have to replace the diamond-method I use also because it expects the heightmap to be in square increments (1024,2048). As for component, maybe a TerrainProcedural component would work. When I’m finish I have to tie it into the Editor in the future.  The thing I haven’t figured out is getting the texture to look more decent not tiled weirdly.\u003c/p\u003e\n\u003cp\u003e[quote=“JTippetts”][quote=“vivienneanthony”]\u003cbr\u003e\nSo, I should do it  for the procedual terrain heightmap image I created? Instead of 2048.\u003cbr\u003e\n[/quote]\u003c/p\u003e\n\u003cp\u003eYes. Do it for any image that you use as a heightmap, whether you load it from a file or generate it procedurally. The way the terrain calculates the number of terrain patches to build is by \u003cspan class=\"bbcode-b\"\u003eIntVector2((heightMap_-\u0026gt;GetWidth() - 1) / patchSize_, (heightMap_-\u0026gt;GetHeight() - 1) / patchSize_)\u003c/span\u003e The size should be a number that if you subtract 1 from it, the result is evenly divisible by your patch size (default: 32). For instance, if you have a patch size of 32 and a heightmap size of 2049, the number of patches in X and Z comes out to (2049-1)/32, or 64 patches. However, if you use 2048, then you end up with only (2048-1)/32 or 63 patches (integer division). Meaning that the last patch row and column are not built, and the heightmap is trimmed off so that only the first 2017x2017 pixels of the heightmap are used in generating terrain (the size of 63 patches + 1 pixel).\u003c/p\u003e\n\u003cp\u003e[quote]\u003c/p\u003e\n\u003cp\u003eI’m just making sure.  I have to probably add the procedural seed as part of a component to Terrain. So,  information can be saved or retrieved. Additionally, create a better randomize system separate for mine for any procedural stuff for content generation.     (I kinda would like the math part to be part assembly so it can be super dirt fast). Oh well.\u003c/p\u003e\n\u003cp\u003eThat might be in the future.[/quote]\u003c/p\u003e\n\u003cp\u003eI wouldn’t really recommend adding anything directly to Terrain itself. I’d recommend instead writing your own separate component so you don’t have to modify the Urho3D library itself. Modifying the library means that every time you pull from upstream you have to do a merge, and given the amount of churn that Urho3D sometimes has in master, you might end up spending a lot more time than you really want to fixing conflicts. And besides, Terrain probably shouldn’t have to care exactly how the heightmap data is constructed. It can do what it needs to do without knowing the details, so from the perspective of the single responsibility principle, the procedural stuff just doesn’t belong in there.[/quote]\u003c/p\u003e","post_number":15,"post_type":1,"updated_at":"2017-01-02T01:03:10.309Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4556,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-05T04:30:52.000Z","cooked":"\u003cp\u003eHello.\u003c/p\u003e\n\u003cp\u003eI was able to implement the shader and elevation. A image is here \u003ca href=\"http://i.imgur.com/6sCwGne.png\" rel=\"nofollow noopener\"\u003ei.imgur.com/6sCwGne.png\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe only problem I have. When I try to get the normal for a spot I think it’s not being calculated correctly.  Basically I choose a random position like 17. Then I subtract half of it. So, I always get a position -X,+X, -Y,+Y to 0,0.\u003c/p\u003e\n\u003cp\u003e[code]   /// Pick a random spotskx\u003cbr\u003e\nSpotx=rand()%1024;\u003cbr\u003e\nSpotz=rand()%1024;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    /// Calculat z,x location\n    //randomSpotx=((float)Spotx/100)-768.0f;\n    //randomSpotz=((float)Spotz/100)-768.0f;\n\n    randomSpotx=(float)Spotx-512.0f;\n    randomSpotz=(float)Spotz-512.0f;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e[/code]\u003c/p\u003e\n\u003cp\u003eWhen I calculate the normal.  I use position+1024. So, it’s centered to the size of the height map dimensions since 0,0 is 1024,1024 half of 2048,2048. Since the original heightmap image is 2049. I’m trying to figuring out should I use 1023 or 1025.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e float xposition=position_x+1024.0f;\n float zposition=position_z+1024.0f;\n\n            Color terrainHeightvalue=terrainHeightMap-\u0026gt;GetPixel(xposition, zposition);\n\n            if(terrainHeightvalue.r_\u0026lt;.50)\n            {\n                continue;\n            }\n\n            Vector3 normalvalue=terrain -\u0026gt; GetNormal(Vector3(xposition+1.0f,0.0f,zposition+1.0f));\n\n            float steep=1.0f-normalvalue.y_;\n\n            if(steep\u0026gt;.009)\n            {\n                continue;\n            }\n\u003c/code\u003e\u003c/pre\u003e","post_number":16,"post_type":1,"updated_at":"2017-01-02T01:03:12.197Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":9,"readers_count":8,"score":6.8,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/6sCwGne.png","internal":false,"reflection":false,"title":"6sCwGne.png","clicks":3}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4557,"name":"","username":"vivienneanthony","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","created_at":"2015-02-05T04:44:32.000Z","cooked":"\u003cp\u003eI am placing my development code on Github. It has to be cleaned up. It looks like there is a offset of 1.\u003c/p\u003e\n\u003cp\u003eThe code I mentioned is at\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003e\u003ca href=\"https://github.com/vivienneanthony/Existence/blob/master/Source/ExistenceApps/ExistenceClient/ExistenceClient.cpp\" rel=\"nofollow noopener\"\u003ehttps://github.com/vivienneanthony/Existence/blob/master/Source/ExistenceApps/ExistenceClient/ExistenceClient.cpp\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/vivienneanthony/Existence/blob/master/Source/ExistenceApps/ExistenceClient/WorldBuild.cpp\" rel=\"nofollow noopener\"\u003egithub.com/vivienneanthony/Exis … dBuild.cpp\u003c/a\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003evoid ExistenceClient::GenerateScene(const time_t \u0026amp;timeseed, terrain_rule terrainrule)\nint WorldBuild::CreateTreeObjectAlongPath(float worldsize_x, float worldsize_y, float x, float z, float numberofobjects, float length, Image * terrainHeightMap)\n\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eI created a stripped down procedural component. So, I’m thinking of setting terrainrules and variables there. As a logiccomponent it can retrieved in the functions relating to content creation.\u003c/p\u003e","post_number":17,"post_type":1,"updated_at":"2017-01-02T01:03:12.306Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":9,"readers_count":8,"score":1.8,"yours":false,"topic_id":804,"topic_slug":"blending-material-and-applying-to-procedual-terrain","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/vivienneanthony/Existence/blob/master/Source/ExistenceApps/ExistenceClient/ExistenceClient.cpp","internal":false,"reflection":false,"title":"Existence/ExistenceClient.cpp at master · vivienneanthony/Existence · GitHub","clicks":4},{"url":"https://github.com/vivienneanthony/Existence/blob/master/Source/ExistenceApps/ExistenceClient/WorldBuild.cpp","internal":false,"reflection":false,"title":"Existence/WorldBuild.cpp at master · vivienneanthony/Existence · GitHub","clicks":3}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":88,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[4406,4412,4418,4422,4426,4444,4470,4471,4472,4489,4493,4495,4498,4524,4529,4556,4557]},"timeline_lookup":[[1,2855],[3,2854],[6,2853],[7,2851],[10,2850],[16,2848]],"suggested_topics":[{"id":7100,"title":"UI Sprites - Wrapping/Repeating Texture","fancy_title":"UI Sprites - Wrapping/Repeating Texture","slug":"ui-sprites-wrapping-repeating-texture","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/5d95641f056666c79c67a12520276d2d9f4729ae.png","created_at":"2021-12-15T20:32:37.485Z","last_posted_at":"2021-12-16T03:28:29.146Z","bumped":true,"bumped_at":"2021-12-16T03:28:29.146Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":193,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7105,"title":"Multiple Application.UI Roots?","fancy_title":"Multiple Application.UI Roots?","slug":"multiple-application-ui-roots","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/7/74b10ce575f1b69fe43be4abcb07605d74a1d27c_2_1024x544.jpeg","created_at":"2021-12-20T08:55:14.707Z","last_posted_at":"2021-12-22T02:33:05.795Z","bumped":true,"bumped_at":"2021-12-22T02:33:05.795Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":243,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7112,"title":"What is the proper way to add more source files(.cpp and .h) to a project?","fancy_title":"What is the proper way to add more source files(.cpp and .h) to a project?","slug":"what-is-the-proper-way-to-add-more-source-files-cpp-and-h-to-a-project","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2021-12-27T18:18:21.946Z","last_posted_at":"2021-12-28T12:19:43.514Z","bumped":true,"bumped_at":"2021-12-28T12:19:43.514Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":195,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1498,"username":"Tryout","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/85f322/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7156,"title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","fancy_title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","slug":"manual-mesh-part-animation-e-g-rotate-a-propeller","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-01-26T23:50:29.343Z","last_posted_at":"2022-01-27T05:31:02.766Z","bumped":true,"bumped_at":"2022-01-27T05:31:02.766Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":155,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7176,"title":"Orthographic scene slowing down when zooming out","fancy_title":"Orthographic scene slowing down when zooming out","slug":"orthographic-scene-slowing-down-when-zooming-out","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-01-30T10:05:50.218Z","last_posted_at":"2022-01-30T10:05:50.294Z","bumped":true,"bumped_at":"2022-01-30T10:05:50.294Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":127,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1351,"username":"Haukinger","name":"Haukinger","avatar_template":"/user_avatar/discourse.urho3d.io/haukinger/{size}/3670_2.png"}}]}],"tags_descriptions":{},"id":804,"title":"Blending material and applying to procedual terrain","fancy_title":"Blending material and applying to procedual terrain","posts_count":17,"created_at":"2015-01-29T04:34:59.000Z","views":423,"reply_count":0,"like_count":0,"last_posted_at":"2015-02-05T04:44:32.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"blending-material-and-applying-to-procedual-terrain","category_id":10,"word_count":4539,"deleted_at":null,"user_id":88,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_804","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":17,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":88,"username":"vivienneanthony","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png","post_count":13,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","post_count":4,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":88,"username":"vivienneanthony","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png"},"last_poster":{"id":88,"username":"vivienneanthony","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/vivienneanthony/{size}/942_2.png"},"links":[{"url":"https://github.com/vivienneanthony/Existence/blob/master/Source/ExistenceApps/ExistenceClient/ExistenceClient.cpp","title":"Existence/ExistenceClient.cpp at master · vivienneanthony/Existence · GitHub","internal":false,"attachment":false,"reflection":false,"clicks":4,"user_id":88,"domain":"github.com","root_domain":"github.com"},{"url":"http://imgur.com/a/UEgzR","title":"Testing Urho Texture Blend - Album on Imgur","internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":88,"domain":"imgur.com","root_domain":"imgur.com"},{"url":"https://github.com/vivienneanthony/Existence/blob/master/Source/ExistenceApps/ExistenceClient/WorldBuild.cpp","title":"Existence/WorldBuild.cpp at master · vivienneanthony/Existence · GitHub","internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":88,"domain":"github.com","root_domain":"github.com"},{"url":"https://github.com/vivienneanthony/Existence/tree/development","title":"GitHub - vivienneanthony/Existence at development","internal":false,"attachment":false,"reflection":false,"clicks":2,"user_id":88,"domain":"github.com","root_domain":"github.com"}]}}