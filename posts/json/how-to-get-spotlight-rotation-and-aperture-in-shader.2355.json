{"post_stream":{"posts":[{"id":14203,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2016-10-23T18:48:31.000Z","cooked":"\u003cp\u003eI’m doing volumetric light scattering for deferred lighting (GLSL). Taking from this tutorial: \u003ca href=\"http://blog.mmacklin.com/2010/05/29/in-scattering-demo/\" rel=\"nofollow noopener\"\u003eblog.mmacklin.com/2010/05/29/in-scattering-demo/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI’ve got everything sort of working for point lights and almost for spotlights with default rotation and fov. Thing is,  for spotlights I need transformation matrix(position and rotation) and aperture (spot FOV), to draw a proper volumetric cone.\u003cbr\u003e\nI tried to use \u003cspan class=\"bbcode-b\"\u003ecLightMatricesPS[0]\u003c/span\u003e, but as I understand it is not a proper transform matrix, but some special one, that also has fov transformation in it. I also tried inversed \u003cspan class=\"bbcode-b\"\u003eiModelMatrix\u003c/span\u003e, but also with no luck.\u003c/p\u003e\n\u003cp\u003eWhile poking randomly, I was able to create a matrix that works with Miles Macklin’s code, but only for spotlights with default rotation. Here it is:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\nmat4 mymat = mat4(vec4( 1. , 0. , 0. , 0. ),\n                  vec4( 0. , 1. , 0. , 0. ),\n                  vec4( 0. , 0. , -1. , 0. ),\n                  vec4( -cLightPosPS.x ,-cLightPosPS.y , cLightPosPS.z , 1. ));\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eI will appreciate any hints and suggestions on how to get proper transform matrix. Should iModelMatrix work? Or does it also have additional information (like scale as range) in it?\u003cbr\u003e\nAs for fov, I have no idea where to get it. I thought, there should be an uniform for it, but there is not.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:14:56.057Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":22,"reads":13,"readers_count":12,"score":114.6,"yours":false,"topic_id":2355,"topic_slug":"how-to-get-spotlight-rotation-and-aperture-in-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://blog.mmacklin.com/2010/05/29/in-scattering-demo/","internal":false,"reflection":false,"title":"Miles Macklin » Blog Archive » In-Scattering Demo","clicks":3}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14205,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2016-10-23T21:26:59.000Z","cooked":"\u003cp\u003eJust in case, here is the function I need to feed with said parameters. It calculates intersection of ray and a cone.\u003c/p\u003e\n\u003cp\u003e[spoiler][code]void IntersectCone(vec3 rayOrigin, vec3 rayDir, mat4 invConeTransform, float aperture, float height, out float minT, out float maxT)\u003cbr\u003e\n{\u003cbr\u003e\nvec4 localOrigin = invConeTransform * vec4(rayOrigin, 1.0);\u003cbr\u003e\nvec4 localDir = invConeTransform * vec4(rayDir, 0.0);\u003cbr\u003e\n// could perform this on the cpu\u003cbr\u003e\nfloat tanTheta = tan(aperture);\u003cbr\u003e\ntanTheta *= tanTheta;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efloat a = localDir.x*localDir.x + localDir.y*localDir.y - localDir.z*localDir.z*tanTheta;\nfloat b = 2.0*(localOrigin.x*localDir.x + localOrigin.y*localDir.y - localOrigin.z*localDir.z*tanTheta);\nfloat c = localOrigin.x*localOrigin.x + localOrigin.y*localOrigin.y - localOrigin.z*localOrigin.z*tanTheta;\n\nSolveQuadratic(a, b, c, minT, maxT);\n\nfloat y1 = localOrigin.z + localDir.z*minT;\nfloat y2 = localOrigin.z + localDir.z*maxT;\n\n// should be possible to simplify these branches if the compiler isn't already doing it\n\nif (y1 \u0026gt; 0.0 \u0026amp;\u0026amp; y2 \u0026gt; 0.0)\n{\n\t// both intersections are in the reflected cone so return degenerate value\n\tminT = 0.0;\n\tmaxT = -1.0;\n}\nelse if (y1 \u0026gt; 0.0 \u0026amp;\u0026amp; y2 \u0026lt; 0.0)\n{\n\t// closest t on the wrong side, furthest on the right side =\u0026gt; ray enters volume but doesn't leave it (so set maxT arbitrarily large)\n\tminT = maxT;\n\tmaxT = 10000.0;\n}\nelse if (y1 \u0026lt; 0.0 \u0026amp;\u0026amp; y2 \u0026gt; 0.0)\n{\n\t// closest t on the right side, largest on the wrong side =\u0026gt; ray starts in volume and exits once\n\tmaxT = minT;\n\tminT = 0.0;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}[/code][/spoiler]\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:14:56.190Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":7,"reads":12,"readers_count":11,"score":37.4,"yours":false,"topic_id":2355,"topic_slug":"how-to-get-spotlight-rotation-and-aperture-in-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14206,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2016-10-23T21:50:56.000Z","cooked":"\u003cp\u003eAnd yes, it appears that iModelMatrix is affected by fov.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:14:56.251Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":11,"readers_count":10,"score":2.2,"yours":false,"topic_id":2355,"topic_slug":"how-to-get-spotlight-rotation-and-aperture-in-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14210,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-10-24T07:40:13.000Z","cooked":"\u003cp\u003eSpotlight attenuation in Urho is based on a projector texture, the texture transform matrix (in case of deferred rendering) is cLightMatricesPS[0] and should transform world space position to the projector coordinates. Otherwise the cone angle isn’t being transmitted as a uniform.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:14:56.504Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":12,"readers_count":11,"score":2.4,"yours":false,"topic_id":2355,"topic_slug":"how-to-get-spotlight-rotation-and-aperture-in-shader","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":14221,"name":"","username":"Bananaft","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","created_at":"2016-10-25T12:08:43.000Z","cooked":"\u003cp\u003eThank you for reply.\u003c/p\u003e\n\u003cp\u003eSo I guess, I need to dive into C++, to add this as uniforms.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:14:57.238Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":11,"readers_count":10,"score":2.2,"yours":false,"topic_id":2355,"topic_slug":"how-to-get-spotlight-rotation-and-aperture-in-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":165,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[14203,14205,14206,14210,14221]},"timeline_lookup":[[1,2221],[5,2220]],"suggested_topics":[{"id":7212,"title":"Shadow Gap between Feet and Plane","fancy_title":"Shadow Gap between Feet and Plane","slug":"shadow-gap-between-feet-and-plane","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/8/897538cff25de49fafa7aa77574f822e99576b67_2_1024x686.jpeg","created_at":"2022-03-07T00:04:17.351Z","last_posted_at":"2022-03-07T00:17:57.413Z","bumped":true,"bumped_at":"2022-03-07T00:17:57.413Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}}]},{"id":7104,"title":"Bug in my partial-model copying code","fancy_title":"Bug in my partial-model copying code","slug":"bug-in-my-partial-model-copying-code","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/5367e370779d64989e5c3ff2c1ebfb0689908c87.png","created_at":"2021-12-17T03:50:19.405Z","last_posted_at":"2021-12-17T13:50:49.662Z","bumped":true,"bumped_at":"2021-12-17T13:50:49.662Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":144,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7179,"title":"Need help with cusomized PBR renderpath","fancy_title":"Need help with cusomized PBR renderpath","slug":"need-help-with-cusomized-pbr-renderpath","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-02-01T09:04:58.692Z","last_posted_at":"2022-02-03T17:35:34.174Z","bumped":true,"bumped_at":"2022-02-03T17:35:34.174Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":13,"views":205,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":null,"description":"Original Poster, Accepted Answer","user":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7067,"title":"Can the latest Urho3D version be built with VS2013?","fancy_title":"Can the latest Urho3D version be built with VS2013?","slug":"can-the-latest-urho3d-version-be-built-with-vs2013","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":null,"created_at":"2021-11-25T18:00:24.336Z","last_posted_at":"2021-11-26T17:22:21.878Z","bumped":true,"bumped_at":"2021-11-26T17:22:21.878Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":157,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}}]},{"id":7254,"title":"Android :android:urho3d-lib:generateJsonModelDebug failed task","fancy_title":"Android :android:urho3d-lib:generateJsonModelDebug failed task","slug":"android-urho3d-lib-generatejsonmodeldebug-failed-task","posts_count":14,"reply_count":8,"highest_post_number":14,"image_url":null,"created_at":"2022-05-07T08:16:09.637Z","last_posted_at":"2022-08-31T13:37:02.824Z","bumped":true,"bumped_at":"2022-08-31T13:37:02.824Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"Android :android:urho3d-lib:generateJsonModelDebug failed task","tags_descriptions":{},"like_count":2,"views":344,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1518,"username":"Joshua-PotatoMan","name":"Joshua","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/e9c0ed/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1522,"username":"tungts1101","name":"tungts1101","avatar_template":"/user_avatar/discourse.urho3d.io/tungts1101/{size}/3803_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":2355,"title":"How to get spotlight rotation and aperture in shader?","fancy_title":"How to get spotlight rotation and aperture in shader?","posts_count":5,"created_at":"2016-10-23T18:48:31.000Z","views":354,"reply_count":0,"like_count":0,"last_posted_at":"2016-10-25T12:08:43.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"how-to-get-spotlight-rotation-and-aperture-in-shader","category_id":10,"word_count":539,"deleted_at":null,"user_id":165,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_2355","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":5,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":165,"username":"Bananaft","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png","post_count":4,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2}],"created_by":{"id":165,"username":"Bananaft","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png"},"last_poster":{"id":165,"username":"Bananaft","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/bananaft/{size}/222_2.png"},"links":[{"url":"http://blog.mmacklin.com/2010/05/29/in-scattering-demo/","title":"Miles Macklin » Blog Archive » In-Scattering Demo","internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":165,"domain":"blog.mmacklin.com","root_domain":"mmacklin.com"}]}}