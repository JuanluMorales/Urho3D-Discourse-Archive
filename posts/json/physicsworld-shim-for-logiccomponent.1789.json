{"post_stream":{"posts":[{"id":10256,"name":"","username":"thebluefish","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","created_at":"2016-02-19T00:13:25.000Z","cooked":"\u003cp\u003eI recently ran into a problem. I have a couple dozen components that do the bulk of their logic in LogicComponent::FixedUpdate. However I recently decided to forego the current Physics implementation in favour of a non-physics solution. My components do not rely on the physics, but suddenly the FixedUpdate function stopped working when I took out PhysicsWorld. So I wrote this little shim that continues to fire off fixed pre-step and post-step events allowing LogicComponent::FixedUpdate to continue to function properly without actually using Bullet physics.\u003c/p\u003e\n\u003cp\u003ePhysicsWorld.h\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e#ifndef _BLU_PHYSICSWORLD_H\n#define _BLU_PHYSICSWORLD_H\n\n#pragma once\n\n#include \u0026lt;Urho3D/Urho3D.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/Component.h\u0026gt;\n\nnamespace blu\n{\n    class PhysicsWorld : public Urho3D::Component\n    {\n        URHO3D_OBJECT(PhysicsWorld, Urho3D::Component);\n        \n    public:\n        PhysicsWorld(Urho3D::Context* context);\n        ~PhysicsWorld();\n\n        static void RegisterObject(Urho3D::Context* context);\n        \n        /// Set simulation substeps per second.\n        void SetFps(unsigned fps);\n        \n    protected:\n        /// Handle scene being assigned.\n        virtual void OnSceneSet(Urho3D::Scene* scene);\n\n    protected:\n        /// Handle the scene subsystem update event, step simulation here.\n        void HandleSceneSubsystemUpdate(Urho3D::StringHash eventType, Urho3D::VariantMap\u0026amp; eventData);\n        /// Trigger update before each physics simulation step.\n        void PreStep(float timeStep);\n        /// Trigger update after each physics simulation step.\n        void PostStep(float timeStep);\n        \n    private:\n    \n        /// Simulation substeps per second.\n        unsigned fps_;\n        \n        /// Internal timestep tracking\n        float accumulator_;\n    };\n}\n\n#endif // _BLU_PHYSICSWORLD_H\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePhysicsWorld.cpp\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e#include \"PhysicsWorld.h\"\n\n#include \u0026lt;Urho3D/Core/Context.h\u0026gt;\n#include \u0026lt;Urho3D/Core/Profiler.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/PhysicsEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/SceneEvents.h\u0026gt;\n\nnamespace blu\n{\n    static const int DEFAULT_FPS = 60;\n    \n    PhysicsWorld::PhysicsWorld(Urho3D::Context* context)\n    : Urho3D::Component(context)\n    , fps_(DEFAULT_FPS)\n    , accumulator_(0.f)\n    {\n        accumulator_ = 0.f;\n    }\n    \n    PhysicsWorld::~PhysicsWorld()\n    {\n        \n    }\n\n    void PhysicsWorld::RegisterObject(Urho3D::Context* context)\n    {\n        context-\u0026gt;RegisterFactory\u0026lt;PhysicsWorld\u0026gt;();\n    }\n    \n    /// Set simulation substeps per second.\n    void PhysicsWorld::SetFps(unsigned fps)\n    {\n        fps_ = (unsigned)Urho3D::Clamp(fps, 1, 1000);\n\n        MarkNetworkUpdate();\n    }\n    \n    void PhysicsWorld::OnSceneSet(Urho3D::Scene* scene)\n    {\n        // Subscribe to the scene subsystem update, which will trigger the physics simulation step\n        if (scene)\n        {\n            SubscribeToEvent((Urho3D::Object*)GetScene(), Urho3D::E_SCENESUBSYSTEMUPDATE, URHO3D_HANDLER(PhysicsWorld, HandleSceneSubsystemUpdate));\n        }\n        else\n            UnsubscribeFromEvent(Urho3D::E_SCENESUBSYSTEMUPDATE);\n    }\n\n    void PhysicsWorld::HandleSceneSubsystemUpdate(Urho3D::StringHash eventType, Urho3D::VariantMap\u0026amp; eventData)\n    {\n        using namespace Urho3D::SceneSubsystemUpdate;\n        \n        float timeStep = eventData[P_TIMESTEP].GetFloat();\n        \n        accumulator_ += timeStep;\n        \n        float internalTimeStep = 1.0f / fps_;\n\n        // Step\n        int iterations = floorf(accumulator_ / internalTimeStep);\n        for (int i = 0; i \u0026lt; iterations; i++)\n        {\n            PreStep(internalTimeStep);\n            PostStep(internalTimeStep);\n            \n            accumulator_ -= internalTimeStep;\n        }\n    }\n\n    void PhysicsWorld::PreStep(float timeStep)\n    {\n        // Send pre-step event\n        using namespace Urho3D::PhysicsPreStep;\n\n        Urho3D::VariantMap\u0026amp; eventData = GetEventDataMap();\n        eventData[P_WORLD] = this;\n        eventData[P_TIMESTEP] = timeStep;\n        SendEvent(Urho3D::E_PHYSICSPRESTEP, eventData);\n    }\n\n    void PhysicsWorld::PostStep(float timeStep)\n    {\n        // Send post-step event\n        using namespace Urho3D::PhysicsPostStep;\n\n        Urho3D::VariantMap\u0026amp; eventData = GetEventDataMap();\n        eventData[P_WORLD] = this;\n        eventData[P_TIMESTEP] = timeStep;\n        SendEvent(Urho3D::E_PHYSICSPOSTSTEP, eventData);\n    }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLicensed under the existing Urho3D MIT license.\u003c/p\u003e\n\u003cp\u003eDue to a check in LogicComponent::UpdateEventSubscription(), I can’t roll my own class name. Instead I provide it under the same class name but under a different namespace. This StringHash collision works well for this purpose.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:10:10.492Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":4,"reads":3,"readers_count":2,"score":20.6,"yours":false,"topic_id":1789,"topic_slug":"physicsworld-shim-for-logiccomponent","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":80,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":10270,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2016-02-19T17:27:55.000Z","cooked":"\u003cp\u003eA possible hack is to just have an empty physics world. Since there’re no bodies there’s no work to be done and shouldn’t affect performance.\u003cbr\u003e\nIt’s simpler since it doesn’t require any customization.\u003c/p\u003e\n\u003cp\u003eAn elegant solution would be to use a dedicated events with fixed framerate, instead of re-purposing the physics ones. If you’re not using physics, why are you using physics events? That’s just misleading.\u003cbr\u003e\nThis can be done simply by adding time to a variable every Update, and once the time is above frame duration, subtract the duration from the time and fire an event.\u003cbr\u003e\nIt also avoids breaking everything if you’ll ever need to enable physics again.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:10:11.592Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":2,"readers_count":1,"score":0.4,"yours":false,"topic_id":1789,"topic_slug":"physicsworld-shim-for-logiccomponent","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":10273,"name":"","username":"thebluefish","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","created_at":"2016-02-19T17:39:11.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/enhex/40/81_1.png\" class=\"avatar\"\u003e Enhex:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003e If you’re not using physics, why are you using physics events? That’s just misleading.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI 100% agree. However the alternative is fixing LogicComponent to use some other counter. While it would be a great idea to fix the issue at its root, this is just a quick n dirty little way of keeping LogicComponent happy while removing Bullet as a dependency for my project.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:10:11.827Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":2,"readers_count":1,"score":0.4,"yours":false,"topic_id":1789,"topic_slug":"physicsworld-shim-for-logiccomponent","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":80,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[10256,10270,10273]},"timeline_lookup":[[1,2469],[2,2468]],"suggested_topics":[{"id":7099,"title":":fallen_leaf: Polynomials \u0026 Harmonics","fancy_title":":fallen_leaf: Polynomials \u0026amp; Harmonics","slug":"polynomials-harmonics","posts_count":6,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2021-12-13T05:06:04.641Z","last_posted_at":"2021-12-27T23:27:39.489Z","bumped":true,"bumped_at":"2021-12-27T23:27:39.489Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"🍂 Polynomials \u0026 Harmonics","tags_descriptions":{},"like_count":6,"views":392,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7103,"title":":test_tube: DebugRenderer as GUI","fancy_title":":test_tube: DebugRenderer as GUI","slug":"debugrenderer-as-gui","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-17T02:25:06.606Z","last_posted_at":"2021-12-18T01:09:27.738Z","bumped":true,"bumped_at":"2021-12-18T01:09:27.738Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"🧪 DebugRenderer as GUI","tags_descriptions":{},"like_count":4,"views":267,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7110,"title":"Resource fetch define","fancy_title":"Resource fetch define","slug":"resource-fetch-define","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-27T12:28:55.126Z","last_posted_at":"2021-12-27T17:00:37.699Z","bumped":true,"bumped_at":"2021-12-27T17:00:37.699Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":7,"views":184,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}}]},{"id":7120,"title":"Log Error Once Macro","fancy_title":"Log Error Once Macro","slug":"log-error-once-macro","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-01-04T02:24:37.857Z","last_posted_at":"2022-01-04T02:24:37.925Z","bumped":true,"bumped_at":"2022-01-04T02:24:37.925Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":143,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7067,"title":"Can the latest Urho3D version be built with VS2013?","fancy_title":"Can the latest Urho3D version be built with VS2013?","slug":"can-the-latest-urho3d-version-be-built-with-vs2013","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":null,"created_at":"2021-11-25T18:00:24.336Z","last_posted_at":"2021-11-26T17:22:21.878Z","bumped":true,"bumped_at":"2021-11-26T17:22:21.878Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":157,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}}]}],"tags_descriptions":{},"id":1789,"title":"PhysicsWorld shim for LogicComponent","fancy_title":"PhysicsWorld shim for LogicComponent","posts_count":3,"created_at":"2016-02-19T00:13:25.000Z","views":462,"reply_count":0,"like_count":0,"last_posted_at":"2016-02-19T17:39:11.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"physicsworld-shim-for-logiccomponent","category_id":13,"word_count":649,"deleted_at":null,"user_id":80,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1789","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":3,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":80,"username":"thebluefish","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":184,"username":"Enhex","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":80,"username":"thebluefish","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png"},"last_poster":{"id":80,"username":"thebluefish","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png"}}}