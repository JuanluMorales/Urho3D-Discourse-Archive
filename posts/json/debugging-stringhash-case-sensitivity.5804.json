{"post_stream":{"posts":[{"id":34830,"name":"SirNate0","username":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","created_at":"2020-01-04T06:18:54.484Z","cooked":"\u003cp\u003eI recently rebuilt some older game code with a newer version of the library, and found a number of things broken by the (good) choice to switch to a case-sensitive StringHash implementation rather than a case-insensitive one. I thought I’d share some of the things I did to debug this and fix the problems I encountered.\u003c/p\u003e\n\u003cp\u003eFirstly, I rebuilt the library with URHO3D_HASH_DEBUG to enable the StringHash::Reverse() functionality, with one important change: I added the following to the StringHash constructors so that the old (lower-case) hashes are also added to the map. (Edit: It occured to me after I’d finished that instead of doing this the same behavior could be accomplished without modifying the engine beyond setting the flag by adding the lower case of every string as a hash in a for loop before going through and printing all of them)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e    // Add the lowercase form as well\n    Urho3D::String lower = String(str).ToLower();\n    if (lower != str)\n    {\n        auto hash = StringHash(lower);\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdetails\u003e\n\u003csummary\u003e\nFull constructors with the above code\u003c/summary\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eStringHash::StringHash(const char* str) noexcept :\n    value_(Calculate(str))\n{\n#ifdef URHO3D_HASH_DEBUG\n    Urho3D::GetGlobalStringHashRegister().RegisterString(*this, str);\n    // Add the lowercase form as well\n    Urho3D::String lower = String(str).ToLower();\n    if (lower != str)\n    {\n        auto hash = StringHash(lower);\n    }\n#endif\n}\n\nStringHash::StringHash(const String\u0026amp; str) noexcept :\n    value_(Calculate(str.CString()))\n{\n#ifdef URHO3D_HASH_DEBUG\n    Urho3D::GetGlobalStringHashRegister().RegisterString(*this, str.CString());\n    Urho3D::String lower = str.ToLower();\n    if (lower != str)\n    {\n        auto hash = StringHash(lower);\n    }\n#endif\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003eI then added the following code to the Stop() method of my application:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\n    auto reg = StringHash::GetGlobalStringHashRegister();\n    if (reg)\n    {\n        LOGINFO(\"String Hashes At Close:\");\n        for (auto\u0026amp; hashStr : reg-\u0026gt;GetInternalMap())\n        {\n//            LOGRAW(FormatString(\"{}: '{}',\\n\",hashStr.first_.Value(), hashStr.second_));\n            String val = hashStr.second_;\n            val.Replace(\"\\n\",\"\\\\n\");\n            val.Replace(\"\\\\\",\"\\\\\\\\\");\n            val.Replace(\"\\t\",\"\\\\t\");\n            val.Replace(\"'\",\"\\\\'\");\n            LOGRAW(FormatString(\"hashes[{}] = '{}'\\n\",hashStr.first_.Value(), val));\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCopying the results from the end of the log to the following python script, I was able to lookup the required hashes that I had saved in some old ValueAnimation XML files.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e#!/usr/bin/python3\nhashes = {}\n\n# ADD THE HASHES HERE (or in the {} above) as, for example hashes[9]='\\t'\n\ninv_map = {v: k for k, v in hashes.items()}\n\ndef urhohash(s):\n    def SDBMHash(hash, c):\n        return (0xffffffff\u0026amp;(0xffffffff\u0026amp;(c + (0xffffffff\u0026amp;(hash \u0026lt;\u0026lt; 6)) + (0xffffffff\u0026amp;(hash \u0026lt;\u0026lt; 16)))) - hash)\n    h = 0;\n    for c in map(ord,s):\n        h = SDBMHash(h,c)\n    return h\n\nimport sys\nif len(sys.argv) == 1:\n    print('Usage: hashLookup.py HASH_INTEGER_OR_STRING...')\n    exit()\nfor arg in sys.argv[1:]:\n    try:\n        print(arg+':')\n        print('  ' + repr(hashes[int(arg)]))\n    except KeyError:\n        print('HASH {} Not Found'.format(arg))\n    except ValueError:\n        #print('Could not convert {} to integer'.format(arg))\n        try:\n            print('  ' + str(inv_map[arg]))\n            print('  %d' % urhohash(arg))\n        except KeyError:\n            print('Could not convert {} to integer \u0026amp; not found as hash'.format(arg))\n            print('As hash: %d' % urhohash(arg))\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrike\u003eNote that for some reason (I don’t know if it was the log skipping some lines or some hashes not being added to the reverse map or if some code had been optimized out or what) but a few hashes that should have been in the list seemed to have been missed (but I was able to work out what they were, as there were only a few possibilities given my code).\u003c/strike\u003e Edit: I figured it out. I had some conditional logic that depended on matching some of the other hashes that was never actually matched and it was coincidental (due to some other code setting some values rather than loading from XML) that any of the hashes inside the if statement were reversible, not due to any other errors.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2020-01-04T17:07:49.898Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":5,"reads":25,"readers_count":24,"score":30.0,"yours":false,"topic_id":5804,"topic_slug":"debugging-stringhash-case-sensitivity","display_username":"SirNate0","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":628,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[34830]},"timeline_lookup":[[1,1054]],"suggested_topics":[{"id":7230,"title":"Issue with lighting in DiffAlpha","fancy_title":"Issue with lighting in DiffAlpha","slug":"issue-with-lighting-in-diffalpha","posts_count":12,"reply_count":5,"highest_post_number":12,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/1/1cdd13d06cf85c41cdc82209ea0e638e4bdc93ea.jpeg","created_at":"2022-04-01T23:36:26.647Z","last_posted_at":"2022-04-07T07:40:42.459Z","bumped":true,"bumped_at":"2022-04-07T07:40:42.459Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":210,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1513,"username":"emenninga","name":"Eric","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/e/f04885/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":230,"username":"Nerrik","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/958977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]},{"id":7087,"title":"Android how to get error message sometimes little change gives me just crash","fancy_title":"Android how to get error message sometimes little change gives me just crash","slug":"android-how-to-get-error-message-sometimes-little-change-gives-me-just-crash","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-05T16:59:59.376Z","last_posted_at":"2021-12-05T18:17:02.335Z","bumped":true,"bumped_at":"2021-12-05T18:17:02.335Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":153,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1436,"username":"Maco","name":"Maco","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/90ced4/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]},{"id":7107,"title":"Error: SDL/SDL_gamecontroller.h: No such file or directory #include \u003cSDL/SDL_gamecontroller.h\u003e","fancy_title":"Error: SDL/SDL_gamecontroller.h: No such file or directory #include \u0026lt;SDL/SDL_gamecontroller.h\u0026gt;","slug":"error-sdl-sdl-gamecontroller-h-no-such-file-or-directory-include-sdl-sdl-gamecontroller-h","posts_count":6,"reply_count":1,"highest_post_number":6,"image_url":null,"created_at":"2021-12-21T15:29:52.810Z","last_posted_at":"2021-12-22T15:32:44.818Z","bumped":true,"bumped_at":"2021-12-22T15:32:44.818Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":271,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1497,"username":"timob256","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/b782af/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7160,"title":"RayCast trouble","fancy_title":"RayCast trouble","slug":"raycast-trouble","posts_count":17,"reply_count":9,"highest_post_number":19,"image_url":null,"created_at":"2022-01-29T00:06:00.367Z","last_posted_at":"2022-01-30T00:29:39.356Z","bumped":true,"bumped_at":"2022-01-30T00:29:39.356Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":260,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":627,"username":"George1","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/9e8a1a/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7073,"title":"A plan to support static batching","fancy_title":"A plan to support static batching","slug":"a-plan-to-support-static-batching","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2021-12-01T03:43:48.579Z","last_posted_at":"2021-12-02T23:30:07.199Z","bumped":true,"bumped_at":"2021-12-02T23:30:07.199Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":180,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1490,"username":"Sunc","name":"DoubleSuper","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/df788c/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]}],"tags_descriptions":{},"id":5804,"title":"Debugging StringHash Case Sensitivity","fancy_title":"Debugging StringHash Case Sensitivity","posts_count":1,"created_at":"2020-01-04T06:18:54.404Z","views":196,"reply_count":0,"like_count":0,"last_posted_at":"2020-01-04T06:18:54.484Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"debugging-stringhash-case-sensitivity","category_id":7,"word_count":601,"deleted_at":null,"user_id":628,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_5804","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":1,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"},"last_poster":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}}