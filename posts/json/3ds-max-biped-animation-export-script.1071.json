{"post_stream":{"posts":[{"id":6202,"name":"","username":"Dave82","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png","created_at":"2015-05-22T03:48:37.000Z","cooked":"\u003cp\u003eHi everyone i’ve just finished my biped exporter for my game and i thought there may be other 3ds max users who will probably found this tool useful.\u003cbr\u003e\nSo basically what it does is searches the scene and exports the FIRST biped found in the scene hierarchy.\u003c/p\u003e\n\u003cp\u003eIt was tested with 3ds max 9 but should work with any version… let me know if you found some issues…\u003c/p\u003e\n\u003cp\u003eNOTE : Make sure your biped and the skined mesh’s biped have the axact same size otherwise the exported data will be invalid (but the result should be pretty funny \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/smiley.png?v=5\" title=\":smiley:\" class=\"emoji\" alt=\":smiley:\"\u003e long hands , legs etc)\u003c/p\u003e\n\u003cp\u003eI had the same issue with irrlicht as the bone positions changing in different biped sizes.I solved this by exporting the distance between the root node and the first spine bone.\u003cbr\u003e\nand calculate the scale between mesh and biped\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand by multiplying the positions with this value corrected the issue , although i don’t know how this should be done in Urho3D…\u003c/p\u003e\n\u003cp\u003eThere’s no option to add attachments so i just paste it here… copy , create new script, and run it\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\n-- counts all (maximum) frames in the biped.\n\nfn countFramesInBiped theBiped =\n(\n\tretFrames = 0\n\t\n\tfor c = 1 to 22 do\n\t(\n\t\tfor l = 1 to 4 do\n\t\t(\n\t\t\tbod = biped.getNode theBiped c link:l\n\t\t\tif bod != undefined then\n\t\t\t(\n\t\t\t\tif bod.controller.keys.count \u0026gt; 0 then\n\t\t\t\t(\n\t\t\t\t\tlastKey = bod.controller.keys[bod.controller.keys.count]\n\t\t\t\t\t\tif lastKey.time \u0026gt; retFrames then retFrames = lastKey.time\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t)\n\tretFrames\n)\n\n-- returns bone count\nfn countBonesInBiped theBiped =\n(\n\tretBones = 0\n\t\n\tfor c = 1 to 22 do\n\t(\n\t\t-- these are the com object so ignore it... we don't want to export them 3x times\n\t\tif c == 14 or c == 15 or c == 16 then continue\n\n\t\tfor l = 1 to 4 do\n\t\t(\n\t\t\tbod = biped.getNode theBiped c link:l\n\t\t\tif bod != undefined then\n\t\t\t(\n\t\t\t\tretBones += 1\n\t\t\t)\n\t\t)\n\t)\n\tretBones\n)\n\n\n-- Generates standard names for bones.Replaces spaces with _ (Bip01 Head = Bip01_Head)\nfn generateStandardName theString =\n(\n\tnArr = filterString theString \" \"\n\tfinString = \"\"\n\tfor z = 1 to nArr.count do\n\t(\n\t\tfinString += (nArr[z] + \"_\")\n\t)\n\t\n\tf = (substring finString 1 (finString.count-1))\n\tf\n)\n\n\n/*\nbyte[4]    Identifier \"UANI\"\ncstring    Animation name\nfloat      Length in seconds\nuint       Number of tracks\n\n  For each track:\n  cstring    Track name (practically same as the bone name that should be driven)\n  byte       Mask of included animation data. 1 = bone positions 2 = bone rotations 4 = bone scaling\n  uint       Number of keyframes\n\n    For each keyframe:\n    float      Time position in seconds\n    Vector3    Position (if included in data)\n    Quaternion Rotation (if included in data)\n    Vector3    Scale (if included in data)\n*/\n\n\nfn inf_ExportBipedAnim theFile animName=\n(\n\t\n\t-- find biped in the scene\n\tfor z = 1 to objects.count do\n\t(\n\t\tif objects[z].parent == undefined and classof objects[z] == Biped_Object then\n\t\t(\n\t\t\t-- We have our Biped COM object\n\t\t\ttheBiped = objects[z] -- points to com object\n\t\t\t\n\t\t\t-- calculate frame count\n\t\t\tframeCount = countFramesInBiped theBiped\n\n\t\t\tmagic = \"UANI\"\n\t\n\t\t\tfor x = 1 to magic.count do\n\t\t\t(\n\t\t\t\twriteByte theFile (bit.charAsInt magic[x])\n\t\t\t)\n\t\t\t\t\t\n\t\t\twriteString theFile animName -- animation name\n\t\t\t\n\t\t\t-- Only keyframe per frame is supported... so the length is equal to keyframes\n\t\t\t-- keysframes starting from 0 and not 1  \n\t\t\twriteFloat theFile (frameCount + 1)\n\t\t\t\n\t\t\t\n\t\t\tboneCount = countBonesInBiped theBiped\n\t\t\twriteLong theFile boneCount\t-- number of tracks\n\t\t\t\n\t\t\tprint\t\n\t\t\tprint (\"           Number of frames = \" + frameCount as string)\n\t\t\tprint (\"           Number of bones = \" + boneCount as string)\n \n\t\t\t-- export frames :\n\t\t\tfor a = 1 to 22 do\n\t\t\t(\n\t\t\t\t-- these are all the com object so ignore them\n\t\t\t\tif a == 14 or a == 15 or a == 16 then continue\n\t\t\t\t\n\t\t\t\tfor b = 1 to 4 do\n\t\t\t\t(\n\t\t\t\t\tbod = biped.getNode theBiped a link:b\n\t\t\t\t\tif bod != undefined then\n\t\t\t\t\t(\n\t\t\t\t\t\t-- we have a valid bone , so export its data\n\t\t\t\t\t\t-- write bone name \n\t\t\t\t\t\tst = generateStandardName bod.name\n\t\t\t\t\t\twriteString theFile st\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tprint (\"Exporting Bone : \" + st) \n\t\t\t\t\t\t\n\t\t\t\t\t\twriteByte theFile 3 -- mask : pos and rotate scale is ignored\n\n\t\t\t\t\t\twriteLong theFile (frameCount+1)\t-- keyframes count\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor fr = 0 to frameCount do\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tat time (fr)\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t-- claculate local transform for each body\n\t\t\t\t\t\t\t\ttransf = bod.transform\n\t\t\t\t\t\t\t\tif bod.parent != undefined then transf = bod.transform * (inverse bod.parent.transform)\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\twriteFloat theFile fr\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\twriteFloat theFile transf.pos.x\n\t\t\t\t\t\t\t\twriteFloat theFile transf.pos.z\n\t\t\t\t\t\t\t\twriteFloat theFile transf.pos.y\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\twriteFloat theFile transf.rotation.w\n\t\t\t\t\t\t\t\twriteFloat theFile transf.rotation.x\n\t\t\t\t\t\t\t\twriteFloat theFile transf.rotation.z\n\t\t\t\t\t\t\t\twriteFloat theFile transf.rotation.y\n\n\t\t\t\t\t\t\t)-- endof at time()\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t)-- endof frame count loop\n\t\t\t\t\t\n\t\t\t\t\t) -- body != undefined\n\n\t\t\t\t)-- for b = 1 to 4\t\n\n\t\t\t) -- for a = 1 to 22\n\t\t\t\n\t\t) -- if objects[z].parent == undefined and classof objects[z] == Biped_Object\n\t\t\n\t) -- scene objects loop\n\t\n)\n\n\n\nrollout unnamedRollout \"Urho3D Biped anim exporter 0.1\" width:482 height:160\n(\n\tlabel lbl1 \"Urho3D Biped animation exporter.\" pos:[155,9] width:166 height:19\n\tlabel lbl2 \"The script will automatically export the FIRST biped found in the scene ! Make sure your animated biped and the skined mesh's biped are the exact same size !\" pos:[11,44] width:426 height:34\n\tbutton btn_Export \"Export\" pos:[363,121] width:80 height:23\n\ton btn_Export pressed do\n\t(\n\t\tfname = getSaveFileName caption:\"Save As..\" types:\"*.ani|*.ani\"\n\t\tif fname != undefined then\n\t\t(\n\t\t\tfr = fopen fname \"wb\"\n\t\t\tinf_ExportBipedAnim fr (getFilenameFile fname)\n\t\t\tfclose fr\n\t\t)\n\t)\n)\n\ncreateDialog unnamedRollout \u003c/code\u003e\u003c/pre\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:05:14.357Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":199,"reads":10,"readers_count":9,"score":997.0,"yours":false,"topic_id":1071,"topic_slug":"3ds-max-biped-animation-export-script","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://discourse.urho3d.io/t/directx-model-files-with-urho3d/3702/2","internal":true,"reflection":true,"title":"DirectX model files with urho3d","clicks":1},{"url":"https://discourse.urho3d.io/t/change-coordinate-systems-of-biped-human-model-parts/2838/5","internal":true,"reflection":true,"title":"Change coordinate systems of biped human model parts","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":247,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[6202]},"timeline_lookup":[[1,2742]],"suggested_topics":[{"id":7344,"title":"Do we give up supporting dx11？","fancy_title":"Do we give up supporting dx11？","slug":"do-we-give-up-supporting-dx11","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-11-03T09:37:37.893Z","last_posted_at":"2022-11-03T13:09:15.153Z","bumped":true,"bumped_at":"2022-11-03T15:28:58.128Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":78,"category_id":9,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1510,"username":"SoNewBee","name":"So New Bee","avatar_template":"/user_avatar/discourse.urho3d.io/sonewbee/{size}/3755_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]},{"id":7347,"title":"How does Urho handle script objects each frame?","fancy_title":"How does Urho handle script objects each frame?","slug":"how-does-urho-handle-script-objects-each-frame","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-11-08T02:33:56.461Z","last_posted_at":"2022-11-08T14:46:09.857Z","bumped":true,"bumped_at":"2022-11-08T14:46:09.857Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":64,"category_id":9,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1292,"username":"evolgames","name":"evol","avatar_template":"/user_avatar/discourse.urho3d.io/evolgames/{size}/3169_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7304,"title":"Urho3D is crashing on Android 12","fancy_title":"Urho3D is crashing on Android 12","slug":"urho3d-is-crashing-on-android-12","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-28T10:03:51.280Z","last_posted_at":"2022-07-28T10:03:51.349Z","bumped":true,"bumped_at":"2022-07-28T10:38:06.014Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":126,"category_id":9,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}}]},{"id":7250,"title":"CMake freezes with -D options","fancy_title":"CMake freezes with -D options","slug":"cmake-freezes-with-d-options","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-05-02T16:47:01.579Z","last_posted_at":"2022-05-06T08:26:07.285Z","bumped":true,"bumped_at":"2022-05-06T08:26:07.285Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":138,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}}]},{"id":7296,"title":"What is the purpose of LitBase?","fancy_title":"What is the purpose of LitBase?","slug":"what-is-the-purpose-of-litbase","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-07-15T17:46:35.168Z","last_posted_at":"2022-07-15T18:00:02.695Z","bumped":true,"bumped_at":"2022-07-15T18:00:02.695Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":93,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":745,"username":"ChunFengTsin","name":"Chun Feng Tsin","avatar_template":"/user_avatar/discourse.urho3d.io/chunfengtsin/{size}/450_2.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]}],"tags_descriptions":{},"id":1071,"title":"3ds max biped animation export script","fancy_title":"3ds max biped animation export script","posts_count":1,"created_at":"2015-05-22T03:48:37.000Z","views":1088,"reply_count":0,"like_count":0,"last_posted_at":"2015-05-22T03:48:37.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"3ds-max-biped-animation-export-script","category_id":9,"word_count":838,"deleted_at":null,"user_id":247,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1071","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":1,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"},"last_poster":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"},"links":[{"url":"https://discourse.urho3d.io/t/directx-model-files-with-urho3d/3702/2","title":"DirectX model files with urho3d","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":247,"domain":"discourse.urho3d.io","root_domain":"urho3d.io"}]}}