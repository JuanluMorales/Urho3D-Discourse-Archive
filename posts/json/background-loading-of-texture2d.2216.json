{"post_stream":{"posts":[{"id":13430,"name":"Alexander@Urho","username":"Alexander","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/bc8723/{size}.png","created_at":"2016-08-29T11:03:33.000Z","cooked":"\u003cp\u003eHi,\u003c/p\u003e\n\u003cp\u003eWe are using Urho3D on a raspberry pi to animate planes with textures. As the pi has limited graphics memory we use the resource cache to load the textures in the background before they are needed, and unload them after they are used.\u003cbr\u003e\nThis works mostly fine.\u003c/p\u003e\n\u003cp\u003eWe just noticed that even if the loading part is done in the background, it finishes with an \u003ccode\u003eTexture2D::EndLoad()\u003c/code\u003e, that is performed in the main thread.\u003cbr\u003e\nIn EndLoad, the function \u003ccode\u003ebool success = SetData(loadImage_);\u003c/code\u003e is called, and on our platform that call takes between 20 ms to 50 ms. In our compilation on the PI, the code from \u003ccode\u003eOGLTexture2D.cpp\u003c/code\u003e is used.\u003cbr\u003e\nAs this is done in the main thread, we currently struggel to come under the 16.66 ms per frame we need to rech a 60 fps target. Actually we can not even reach a 30 fps target when the texture loading behaves like this. The texture we use is about 1920*1080, and in RGBA.\u003c/p\u003e\n\u003cp\u003eTherefore i wonder what is done during this face of the process, and what we can do to make it faster. Can we use other picture formats? Currently we use PNG. Or is the time spent copying raw image data from memory to graphics memory?\u003cbr\u003e\nDoes this process really need to be in the main thread?\u003c/p\u003e\n\u003cp\u003eI guess this is something that is unique to the raspberry pi, or at least not a commom problem on other platforms. Or do we miss something basic in how we work with textures and texture loading?\u003c/p\u003e\n\u003cp\u003eSincerely,\u003cbr\u003e\nAlexander\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:13:59.373Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":121,"reads":15,"readers_count":14,"score":608.0,"yours":false,"topic_id":2216,"topic_slug":"background-loading-of-texture2d","display_username":"Alexander@Urho","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":387,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":13431,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-08-29T11:34:38.000Z","cooked":"\u003cp\u003eYes, the OpenGL call to upload texture data (glTexImage2D) needs to be on the main thread, as OpenGL contexts can only exist attached to one thread at a time. Even if it was on another thread, the upload would have to complete before the next frame can render correctly (assuming the image will be used on the next frame)\u003c/p\u003e\n\u003cp\u003eThis is somewhat of a problem on all platforms, but more so on Raspberry Pi as it’s so underpowered.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:13:59.448Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":6,"reads":15,"readers_count":14,"score":33.0,"yours":false,"topic_id":2216,"topic_slug":"background-loading-of-texture2d","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":13432,"name":"Alexander@Urho","username":"Alexander","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/bc8723/{size}.png","created_at":"2016-08-29T11:43:54.000Z","cooked":"\u003cp\u003eHi there,\u003c/p\u003e\n\u003cp\u003eThanks for the quick reply!\u003c/p\u003e\n\u003cp\u003eYou mention that the data needs to be there before the next frame, as one can imagine \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003cbr\u003e\nBut the fact is tha we load the textures many frames ahead of there usage, so for us it would be no broblem to spread this proces over multiple frames. That would be much prefered to the current situation where the engine halts.\u003c/p\u003e\n\u003cp\u003eCan this behaviour be acheved  by parameter configuration of the engine, or can we reprogram the engine to work like this?\u003c/p\u003e\n\u003cp\u003eIs there something else we can do to shorten the time used in SetData()?\u003c/p\u003e\n\u003cp\u003eSincerely\u003cbr\u003e\nAlexander\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:13:59.537Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":3.0,"yours":false,"topic_id":2216,"topic_slug":"background-loading-of-texture2d","display_username":"Alexander@Urho","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":387,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":13433,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-08-29T11:51:20.000Z","cooked":"\u003cp\u003eNo, it’s rather the behavior of the graphics driver and there’s no direct control over it. Practically, what the driver offers to the application is “call glTexImage2D() to upload a texture” and it will take as long time as it needs. If the driver is smart then the function itself could complete fast (the graphics driver just stashes it to memory waiting for GPU upload) and avoid a graphics pipeline stall and a long frame in case you would not actually use the texture on the next frame. However the driver can just as well decide to not be that smart.\u003c/p\u003e\n\u003cp\u003eOne thing you could try would be to load the Image (CPU-side copy only) first, then SetData() it to the Texture2D in small pieces, and see whether that is faster.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:13:59.603Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":15,"readers_count":14,"score":13.0,"yours":false,"topic_id":2216,"topic_slug":"background-loading-of-texture2d","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":13435,"name":"Alexander@Urho","username":"Alexander","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/bc8723/{size}.png","created_at":"2016-08-29T12:12:46.000Z","cooked":"\u003cp\u003eOk.\u003c/p\u003e\n\u003cp\u003eWe will se if we can chop the work in smaller peices, and perhaps even spread them out over multiple frames using multiple textures instead.\u003c/p\u003e\n\u003cp\u003eCan you give a short explenation of the variable levels_? Or tell me where i can read more about its usage?\u003cbr\u003e\nI can se that my texture comes in 11 levels, but i dont understand why, and how that matters.\u003c/p\u003e\n\u003cp\u003eI se that levels_ are important in the loop:\u003c/p\u003e\n\u003cp\u003e[code]for (unsigned i = 0; i \u0026lt; levels_; ++i)\u003cbr\u003e\n{\u003cbr\u003e\nSetData(i, 0, 0, levelWidth, levelHeight, levelData);\u003cbr\u003e\nmemoryUse += levelWidth * levelHeight * components;\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e        if (i \u0026lt; levels_ - 1)\n        {\n            image = image-\u0026gt;GetNextLevel();\n            levelData = image-\u0026gt;GetData();\n            levelWidth = image-\u0026gt;GetWidth();\n            levelHeight = image-\u0026gt;GetHeight();\n        }\n    };[/code]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWould it be faster if the image had more or fever levels?\u003cbr\u003e\nForgive me for this question, as i am sure it is a stupid one… \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:13:59.758Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":13,"readers_count":12,"score":7.6,"yours":false,"topic_id":2216,"topic_slug":"background-loading-of-texture2d","display_username":"Alexander@Urho","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":387,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":13436,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-08-29T12:51:54.000Z","cooked":"\u003cp\u003eAmount of mip levels. If you don’t need them set amount of levels to 1, which means there’s just one image at the full resolution. By default textures have mip levels down to 1x1.\u003c/p\u003e\n\u003cp\u003eActually you could try disabling mips as a first step if you don’t need them, this could already speed up the upload. When ResourceCache is used to load textures, the texture configuration is specified by an accompanying .xml file, see for example bin\\Data\\Textures\\UI.xml (accompanying UI.png)\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T01:13:59.832Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":2216,"topic_slug":"background-loading-of-texture2d","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[13430,13431,13432,13433,13435,13436]},"timeline_lookup":[[1,2277]],"suggested_topics":[{"id":7210,"title":"Shadow Map Coverage Skewed to the Side","fancy_title":"Shadow Map Coverage Skewed to the Side","slug":"shadow-map-coverage-skewed-to-the-side","posts_count":8,"reply_count":5,"highest_post_number":8,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/6/640dc6184f3d70ce00e656555c22db772ea941a4_2_1024x545.jpeg","created_at":"2022-02-28T15:02:02.662Z","last_posted_at":"2022-03-06T04:51:22.096Z","bumped":true,"bumped_at":"2022-03-06T04:51:22.096Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":211,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":null,"description":"Original Poster, Accepted Answer","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]},{"id":7263,"title":"Is Steam integration like this possible?","fancy_title":"Is Steam integration like this possible?","slug":"is-steam-integration-like-this-possible","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-05-12T22:06:15.739Z","last_posted_at":"2022-05-14T22:02:38.197Z","bumped":true,"bumped_at":"2022-05-14T22:02:38.197Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":202,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1292,"username":"evolgames","name":"evol","avatar_template":"/user_avatar/discourse.urho3d.io/evolgames/{size}/3169_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":184,"username":"Enhex","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png"}}]},{"id":7146,"title":"How create affordable comfortable and modern terrain?","fancy_title":"How create affordable comfortable and modern terrain?","slug":"how-create-affordable-comfortable-and-modern-terrain","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-01-21T15:20:08.910Z","last_posted_at":"2022-01-21T21:51:58.799Z","bumped":true,"bumped_at":"2022-01-21T22:03:14.896Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":193,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1497,"username":"timob256","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/b782af/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":230,"username":"Nerrik","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/958977/{size}.png"}}]},{"id":7067,"title":"Can the latest Urho3D version be built with VS2013?","fancy_title":"Can the latest Urho3D version be built with VS2013?","slug":"can-the-latest-urho3d-version-be-built-with-vs2013","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":null,"created_at":"2021-11-25T18:00:24.336Z","last_posted_at":"2021-11-26T17:22:21.878Z","bumped":true,"bumped_at":"2021-11-26T17:22:21.878Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":157,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}}]},{"id":7268,"title":"Get vertex position before Morph in shader","fancy_title":"Get vertex position before Morph in shader","slug":"get-vertex-position-before-morph-in-shader","posts_count":8,"reply_count":6,"highest_post_number":8,"image_url":null,"created_at":"2022-05-15T19:44:19.139Z","last_posted_at":"2022-05-16T06:11:07.099Z","bumped":true,"bumped_at":"2022-08-12T22:38:31.553Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":5,"views":209,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1205,"username":"Askhento","name":"Askhento","avatar_template":"/user_avatar/discourse.urho3d.io/askhento/{size}/3849_2.png"}},{"extras":"latest","description":"Most Recent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]}],"tags_descriptions":{},"id":2216,"title":"Background loading of Texture2D","fancy_title":"Background loading of Texture2D","posts_count":6,"created_at":"2016-08-29T11:03:33.000Z","views":655,"reply_count":0,"like_count":0,"last_posted_at":"2016-08-29T12:51:54.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"background-loading-of-texture2d","category_id":10,"word_count":811,"deleted_at":null,"user_id":387,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_2216","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":6,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":387,"username":"Alexander","name":"Alexander@Urho","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/bc8723/{size}.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":387,"username":"Alexander","name":"Alexander@Urho","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/bc8723/{size}.png"},"last_poster":{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png"}}}