{"post_stream":{"posts":[{"id":37935,"name":"SirNate0","username":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","created_at":"2020-06-17T22:14:58.329Z","cooked":"\u003cp\u003eI was looking through the material code, and I was wondering why Material used a \u003ccode\u003eHashMap\u0026lt;TextureUnit, SharedPtr\u0026lt;Texture\u0026gt; \u0026gt;\u003c/code\u003e rather than a \u003ccode\u003eVector\u0026lt;SharedPtr\u0026lt;Texture\u0026gt;\u0026gt;\u003c/code\u003e or even just a \u003ccode\u003eSharedPtr\u0026lt;Texture\u0026gt;[(int)MAX_TEXTURE_UNITS]\u003c/code\u003e to store its textures?\u003c/p\u003e\n\u003cp\u003eEven on a 64 bit system that should only require 128 bytes on Desktop, so ~8000 materials to get 1 Megabyte of extra memory used by using the fixed size array (assuming there were no textures in any of the material - the more units that are used, the less the comparative increase, and presumably at the point of having thousands of materials that will be negligible compared to the number of textures in use). From my (limited) understanding, using an array of contiguous memory should be faster than using the HashMap, and that would reduce checking if a texture unit is present to simply checking against nullptr rather than having to check the map.\u003c/p\u003e\n\u003cp\u003eGranted, I may have just missed something that should make it obvious, or may be misunderstanding the map-vs-array tradeoff.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2020-06-17T22:14:58.329Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":6,"reads":32,"readers_count":31,"score":36.4,"yours":false,"topic_id":6211,"topic_slug":"material-texture-hashmap-vs-vector","display_username":"SirNate0","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":628,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":37940,"name":"QB'k Games","username":"QBkGames","avatar_template":"/user_avatar/discourse.urho3d.io/qbkgames/{size}/646_2.png","created_at":"2020-06-18T02:29:53.613Z","cooked":"\u003cp\u003eMy (semi-educated) guess is that Urho3D development started a while ago before all the latest engine design hype of ECS, procedural programming and CPU cache optimizations. And in order to develop a general purpose engine you sometimes have to compromise performance in order to have flexibility (see also the Godot engine design philosophy document).\u003c/p\u003e\n\u003cp\u003eHaving said that, I’m very convinced that there are many areas of performance improvement for Urho3D, but there just aren’t enough developers around with the necessary time (and maybe skills) to work on them. But the greatest benefit of a free, open source project is that you can always go into the code and hack anything you want.\u003cbr\u003e\nOne of the first things I’ve hacked into my custom branch is a StringView hack. If you think your material is not optimized, how about every time you pass a String around (and that’s everywhere), memory is allocated on the heap, the string is copied into that allocated block and that’s just to pass it to a function and then when you return from the function the memory is released to the heap.\u003cbr\u003e\nSo yeah, there are many areas of improvements for sure, but the good thing is no one is stopping you from fixing them (at least in your own branch \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=9\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e).\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2020-06-19T04:39:38.345Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":32,"readers_count":31,"score":21.4,"yours":false,"topic_id":6211,"topic_slug":"material-texture-hashmap-vs-vector","display_username":"QB'k Games","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":780,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":37941,"name":"Eugene Kozlov","username":"Eugene","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png","created_at":"2020-06-18T08:38:52.083Z","cooked":"\u003cp\u003eI think the only reason is being simpler to use. With hash map, one always know how many textures are set and can apply only them. With vector, one have to check all the slots.\u003c/p\u003e\n\u003cp\u003eHaving said that, I don’t believe that this is a place that needs to be fixed. Not until it’s proved otherwise.\u003cbr\u003e\nYou know, I can spend an evening listing things that are impacting performance \u003cem\u003emore\u003c/em\u003e than container used in material.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2020-06-19T09:48:07.542Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":30,"readers_count":29,"score":11.0,"yours":false,"topic_id":6211,"topic_slug":"material-texture-hashmap-vs-vector","display_username":"Eugene Kozlov","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":484,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":37950,"name":"QB'k Games","username":"QBkGames","avatar_template":"/user_avatar/discourse.urho3d.io/qbkgames/{size}/646_2.png","created_at":"2020-06-19T04:41:33.970Z","cooked":"\u003cp\u003eCan you list a few major ones, I’m trying to squeeze the maximum performance for my game so I might look into hacking a few things if possible (at least in my custom branch)!?\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2020-06-19T04:41:33.970Z","reply_count":1,"reply_to_post_number":3,"quote_count":0,"incoming_link_count":0,"reads":28,"readers_count":27,"score":25.6,"yours":false,"topic_id":6211,"topic_slug":"material-texture-hashmap-vs-vector","display_username":"QB'k Games","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":780,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":37952,"name":"Eugene Kozlov","username":"Eugene","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png","created_at":"2020-06-19T08:47:35.957Z","cooked":"\u003cp\u003eOkay.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eScene Octree is fully traversed two times: to collect zones and occluders, and to collect geometries and lights. Even if you have no occluders, or only a few, Urho checks every single geometry for being occluder. So, double work for drawable collection. See \u003ccode\u003eView::GetDrawables\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMoreover, Octree traversal tend to be slower than brute-force in multithreaded environment.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMajor part of \u003ccode\u003eView\u003c/code\u003e is single-threaded without any fundamental reason. Theoretically, all operations except rendering itself can be multithreaded. Practically, only \u003ccode\u003eUpdateBatches\u003c/code\u003e and \u003ccode\u003eUpdateGeometry\u003c/code\u003e are truly multithreaded in Urho. Lights processing is somewhat multithreaded too, but only if you have a lot of small lights. If you have single dominant light (i.e. any outdoors scene with sun), it’s not multithreaded.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThere’s no real lighting option except using per-pixel lights. And they cause x2-xN triangle and batch count. If you want to make mobile game, you have to ensure you have one draw call per object in 95% of cases. But how would you do so if you need more than one light? Urho has no baked lighting. Urho \u003cem\u003edoes\u003c/em\u003e have per-vertex lights, but they are worthless. First, per-vertex lights are literally broken now (but this is fixable). Second, when limit of per-vertex lights per-object is reached, they “fallback” to pixel lights. This defeats the point, a bit. Third, when you have per-vertex lights and per-pixel light(s), \u003cem\u003eobject is rendered at least twice, unconditionally\u003c/em\u003e. This completely defeats the point of using per-vertex lights on mobiles.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eConstant buffers are misused in Urho. Urho updates constant buffers before every draw op, even tho it is recommended to update constant buffers as rarely as possible.\u003cbr\u003e\nThis leads to one funny consequence. Constant buffers are supposed to be an optimization, but they actually make rendering slower and they are disabled in Urho OpenGL backend unconditionally. So, if you are using Urho DX11 backend, you receive penalty for using constant buffers all the time, because they are not optional in DX11. I actually did some crude testing with Urho Graphics backend. When I optimized constant buffers, I got about +10% FPS in stress test scenario. Don’t blindly trust this number, tho, because I didn’t do any propper testing and profiling.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis is what I remember right now. I’ll update my post here if I recall something else later.\u003c/p\u003e\n\u003cp\u003ePS. In (4) I ignore Deferred rendering because it’s not always acceptable option. But yea, you can use it and pray it will make things faster and not slower.\u003c/p\u003e\n\u003cp\u003ePPS. Yeah, I’m listing things that are hard to fix. If they were easy to fix, they would have already been fixed.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2020-06-19T08:53:45.849Z","reply_count":0,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":1,"reads":29,"readers_count":28,"score":70.8,"yours":false,"topic_id":6211,"topic_slug":"material-texture-hashmap-vs-vector","display_username":"Eugene Kozlov","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"reply_to_user":{"username":"QBkGames","name":"QB'k Games","avatar_template":"/user_avatar/discourse.urho3d.io/qbkgames/{size}/646_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":4}],"moderator":false,"admin":false,"staff":false,"user_id":484,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":37963,"name":"Eugene Kozlov","username":"Eugene","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png","created_at":"2020-06-20T15:10:55.814Z","cooked":"\u003cp\u003eOh, I’ve just remembered one more thing, about deferred render path this time.\u003c/p\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003eUrho cannot tell if drawable is opaque (and can use deferred rendering) or translucent (and must use forward rendering) until the very last moment. Therefore, even if you enable deferred rendering and have no translucent objects, Urho will do significant part of forward-rendering-only stuff even if the results will never be used.\u003c/li\u003e\n\u003c/ol\u003e","post_number":6,"post_type":1,"updated_at":"2020-06-20T15:10:55.814Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":26,"readers_count":25,"score":20.2,"yours":false,"topic_id":6211,"topic_slug":"material-texture-hashmap-vs-vector","display_username":"Eugene Kozlov","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":484,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[37935,37940,37941,37950,37952,37963]},"timeline_lookup":[[1,888],[4,887],[6,886]],"suggested_topics":[{"id":7262,"title":"iOS build cannot be installed on sim or device","fancy_title":"iOS build cannot be installed on sim or device","slug":"ios-build-cannot-be-installed-on-sim-or-device","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/d/d889ae74b8b75bfe705a15b4cee71e82faea0f4d.png","created_at":"2022-05-12T15:33:33.531Z","last_posted_at":"2022-05-12T16:13:22.078Z","bumped":true,"bumped_at":"2022-05-12T16:13:22.078Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":95,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1340,"username":"KatekovAnton","name":"KatekovAnton","avatar_template":"/user_avatar/discourse.urho3d.io/katekovanton/{size}/2988_2.png"}}]},{"id":7272,"title":"Normals causing mesh to go all over the place","fancy_title":"Normals causing mesh to go all over the place","slug":"normals-causing-mesh-to-go-all-over-the-place","posts_count":7,"reply_count":3,"highest_post_number":7,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/0/0a0a9a3dc40a56fb224dc7ab3b9b167551b57cb6_2_1024x863.png","created_at":"2022-05-30T22:50:15.428Z","last_posted_at":"2022-06-03T09:23:21.988Z","bumped":true,"bumped_at":"2022-06-03T09:42:18.150Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":172,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1507,"username":"Kest","name":"Kest","avatar_template":"/user_avatar/discourse.urho3d.io/kest/{size}/3734_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":653,"username":"extobias","name":"tobias alarcon","avatar_template":"/user_avatar/discourse.urho3d.io/extobias/{size}/2836_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}}]},{"id":7244,"title":"Overgrowth source released","fancy_title":"Overgrowth source released","slug":"overgrowth-source-released","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-04-25T14:10:33.749Z","last_posted_at":"2022-04-25T17:18:36.743Z","bumped":true,"bumped_at":"2022-04-25T17:18:36.743Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":190,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}}]},{"id":7218,"title":"Jolt Physics: physics engine from Horizon Forbidden West open-sourced","fancy_title":"Jolt Physics: physics engine from Horizon Forbidden West open-sourced","slug":"jolt-physics-physics-engine-from-horizon-forbidden-west-open-sourced","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-03-14T15:23:58.296Z","last_posted_at":"2022-03-21T03:18:16.555Z","bumped":true,"bumped_at":"2022-03-21T03:18:16.555Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":10,"views":439,"category_id":16,"featured_link":"https://github.com/jrouwe/JoltPhysics","featured_link_root_domain":"github.com","has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]},{"id":7285,"title":"Adding SFINAE for Container Operators","fancy_title":"Adding SFINAE for Container Operators","slug":"adding-sfinae-for-container-operators","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-06-22T02:05:49.368Z","last_posted_at":"2022-06-22T02:05:49.441Z","bumped":true,"bumped_at":"2022-06-22T02:05:49.441Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":98,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":6211,"title":"Material Texture HashMap vs Vector","fancy_title":"Material Texture HashMap vs Vector","posts_count":6,"created_at":"2020-06-17T22:14:58.240Z","views":303,"reply_count":2,"like_count":7,"last_posted_at":"2020-06-20T15:10:55.814Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"material-texture-hashmap-vs-vector","category_id":16,"word_count":1030,"deleted_at":null,"user_id":628,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_6211","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":6,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":780,"username":"QBkGames","name":"QB'k Games","avatar_template":"/user_avatar/discourse.urho3d.io/qbkgames/{size}/646_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"},"last_poster":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}}