{"post_stream":{"posts":[{"id":5376,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-03-15T10:30:46.000Z","cooked":"\u003cp\u003eHi,\u003c/p\u003e\n\u003cp\u003eI’m working on a CSP system for Urho3D. The system is pretty simple:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esend complete networked state snapshot with last input ID received\u003c/li\u003e\n\u003cli\u003eread it and re-applying all the inputs since the last ID received\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe problem is that I’m getting a stutter. It happens when snapshots of the moving player are received and a bit after that.\u003c/p\u003e\n\u003cp\u003eHere’s a video of the problem, using 1000ms latency:\u003cbr\u003e\n\u003cdiv class=\"lazyYT\" data-youtube-id=\"fho73G7ywPU\" data-youtube-title=\"Urho3D Client Side Prediction Attempt Problem\" data-width=\"480\" data-height=\"270\" data-parameters=\"feature=oembed\u0026amp;wmode=opaque\"\u003e\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eWith no latency the problem doesn’t exist.\u003cbr\u003e\nWith 100ms it barely happens and when it does it’s barely noticeable.\u003c/p\u003e\n\u003cp\u003eanyone got any idea what could cause it?\u003cbr\u003e\nCould it be the network attributes’ previous state?\u003cbr\u003e\nCould it have anything to do with the smooth transform component?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-08-21T11:41:20.937Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":92,"reads":17,"readers_count":16,"score":463.4,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://www.youtube.com/watch?v=fho73G7ywPU","internal":false,"reflection":false,"clicks":1}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5380,"name":"","username":"GoogleBot42","avatar_template":"/user_avatar/discourse.urho3d.io/googlebot42/{size}/62_2.png","created_at":"2015-03-15T17:45:40.000Z","cooked":"\u003cp\u003eHmmm I think it would help others help you if you posted some code… Although it does seem that the problem happens when you change your velocity.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:04:12.464Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":197,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5381,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-03-15T21:35:45.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/googlebot42/40/62_1.png\" class=\"avatar\"\u003e GoogleBot42:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eHmmm I think it would help others help you if you posted some code… Although it does seem that the problem happens when you change your velocity.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI’ve uploaded the Subsystem to Github:\u003cbr\u003e\n\u003ca href=\"https://github.com/Enhex/Urho3D-CSP-Attempt\" rel=\"nofollow noopener\"\u003egithub.com/Enhex/Urho3D-CSP-Attempt\u003c/a\u003e\u003cbr\u003e\nNote that it isn’t refined or anything. Also note that I wrote it using some stdlib and stdlib style.\u003c/p\u003e\n\u003cp\u003eActually in order to simplify re-applying inputs I’m changing position instead of velocity, so no physical simulation time is required (which is another whole level of problem).\u003cbr\u003e\nConsidering we have the same fixed time step on both sides (1/60), we should have the same result.\u003c/p\u003e\n\u003cp\u003eAlso inputs are re-applied instantly after the state snapshot is read on the client side.\u003c/p\u003e\n\u003cp\u003eEDIT:\u003cbr\u003e\nSomething I just noticed is ApplyAttributes(), could it be somewhat related?\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:04:12.530Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":1,"reads":18,"readers_count":17,"score":8.6,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/Enhex/Urho3D-CSP-Attempt","internal":false,"reflection":false,"clicks":10}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5390,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-03-16T11:54:57.000Z","cooked":"\u003cp\u003eCheck the SmoothedTransform component, which is created to networked client nodes and whose purpose is to smoothly lerp the current transform toward the last value received from server. It may be interfering, so you may need to add a way to turn it off when predicting the character on the client.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:04:13.191Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":19,"readers_count":18,"score":3.8,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5403,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-03-16T18:14:37.000Z","cooked":"\u003caside class=\"quote\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/cadaver/40/3_1.png\" class=\"avatar\"\u003e cadaver:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCheck the SmoothedTransform component, which is created to networked client nodes and whose purpose is to smoothly lerp the current transform toward the last value received from server. It may be interfering, so you may need to add a way to turn it off when predicting the character on the client.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI tried removing SmoothedTransform but it didn’t help. Is there anything else that could get in the way?\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:04:14.157Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5425,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-03-18T00:50:20.000Z","cooked":"\u003cp\u003eAfter doing a bit more testing with higher latency it appears that the problem is a jump between the received state and the predicted state.\u003cbr\u003e\nThe prediction happens immediately after the received state is read, so why does the received state gets rendered?\u003cbr\u003e\nAre events threaded, so it’s possible that the scene is being rendered before the prediction takes place?\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T01:04:15.833Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":16,"readers_count":15,"score":3.2,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5428,"name":"","username":"GoogleBot42","avatar_template":"/user_avatar/discourse.urho3d.io/googlebot42/{size}/62_2.png","created_at":"2015-03-18T02:47:27.000Z","cooked":"\u003cp\u003e[quote=“Enhex”]After doing a bit more testing with higher latency it appears that the problem is a jump between the received state and the predicted state.\u003cbr\u003e\nThe prediction happens immediately after the received state is read, so why does the received state gets rendered?\u003cbr\u003e\nAre events threaded, so it’s possible that the scene is being rendered before the prediction takes place?[/quote]\u003c/p\u003e\n\u003cp\u003eOne second after you change direction/speed the jumps would be expected I think…  It seems that may be the source of your problems… doesn’t the problem happen if you move in a constant direction and speed?\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-01-02T01:04:16.032Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":18,"readers_count":17,"score":3.6,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":197,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5431,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-03-18T09:18:53.000Z","cooked":"\u003cp\u003eThere is no threading, the sequence on each frame is always:\u003c/p\u003e\n\u003cp\u003eUpdate network (read packets, apply attributes)\u003cbr\u003e\nUpdate scene (includes physics update)\u003cbr\u003e\nRender\u003c/p\u003e\n\u003cp\u003eIf you have rigidbodies, note that Bullet is also doing its own interpolation. I recommend debugging through a frame and setting a breakpoint on functions that modify Node transform (Node::SetPosition, SetRotation, SetTransform etc.) so that you see exactly what is being changed and when.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-01-02T01:04:16.234Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5433,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-03-18T23:54:06.000Z","cooked":"\u003cp\u003etried lowering the physics FPS to 5, and there’s a noticeable mismatch between the number of inputs sent to the number of inputs processed by the server.\u003cbr\u003e\nSo the CSP buffers more inputs than it should in this case.\u003cbr\u003e\nBasically Urho was sending inputs at 30 fps while applying them at 60 fps, which caused to buffer more input than the server actually applies.\u003c/p\u003e\n\u003cp\u003eThe solution is custom input sending message that doesn’t wait for Urho’s Network system to be sent. Then send and process inputs at the same rate. And it works!\u003c/p\u003e\n\u003cp\u003eI built the system on top of Urho and it lives alongside Urho’s Network system. Well since I don’t have access to the connection’s sendMode_/position_/rotation_ I couldn’t include setting net priority with the custom input message.\u003c/p\u003e\n\u003cp\u003eI’d love to see Urho having client side prediction because network system without CSP is like a car without wheels (unless you’re making LAN/non-real-time MP game, which are rather rare use cases).\u003cbr\u003e\nMy CSP system uses much simpler networking, sending a complete state snapshot of the CSP nodes in a single message. No create/update/remove node/component, no delta/latest.\u003cbr\u003e\nThe client can deduce which nodes are new and which needs to be removed like this:\u003cbr\u003e\n\u003cdiv class=\"lightbox-wrapper\"\u003e\u003ca class=\"lightbox\" href=\"http://i.imgur.com/hvld64c.png?1\" title=\"\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"http://i.imgur.com/hvld64c.png?1\" alt=\"\" width=\"690\" height=\"492\"\u003e\u003cdiv class=\"meta\"\u003e\u003csvg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"\u003e\u003cuse xlink:href=\"#far-image\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003cspan class=\"filename\"\u003e\u003c/span\u003e\u003cspan class=\"informations\"\u003e800×571\u003c/span\u003e\u003csvg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"\u003e\u003cuse xlink:href=\"#discourse-expand\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/div\u003e\u003c/a\u003e\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eOf course that means it doesn’t scale well with increased number of nodes \u0026amp; components, but it’s enough to only use it on player controlled objects since it can work alongside urho’s network system, so it should be fine.\u003cbr\u003e\n(tho ideally everything should be client side predicted)\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2017-01-02T01:04:16.391Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":16,"readers_count":15,"score":13.2,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/hvld64c.png?1","internal":false,"reflection":false,"clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5434,"name":"","username":"thebluefish","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","created_at":"2015-03-19T00:02:15.000Z","cooked":"\u003cp\u003eYou would be surprised how cheap those updated can be made. There’s no reason this couldn’t be done in such a way that an entire scene is client-side-predicted with little overhead. Of course, that all depends on who wants to dedicate that kind of time \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/stuck_out_tongue.png?v=5\" title=\":stuck_out_tongue:\" class=\"emoji\" alt=\":stuck_out_tongue:\"\u003e\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2017-01-02T01:04:16.458Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":14,"readers_count":13,"score":2.8,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":80,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5437,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-03-19T09:19:56.000Z","cooked":"\u003cp\u003eIt’s great that you found a solution that worked for you.\u003c/p\u003e\n\u003cp\u003eUrho itself has to be a bit wary so that it doesn’t come to include a networking model that doesn’t scale well to begin with. Whole scene prediction could be interesting, but it basically means that on every server update, the client has to rewind and instantly simulate physics with a timestep that’s equal to the latency. This may be extreme, because even the normal physics timestep from frame to frame can be punishing on the client CPU in a complex scene.\u003c/p\u003e\n\u003cp\u003eFor things that are lacking in the existing Urho network interface, I suggest modifying the classes like you need, and making a pull request.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2017-01-02T01:04:16.662Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":6,"reads":17,"readers_count":16,"score":33.4,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5438,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-03-19T11:06:00.000Z","cooked":"\u003cp\u003eWell yeah that depends on the scale of the game, but if you look at a lot of multiplayer games which are real time and use physics engines, like shooters for examples, they don’t have a lot of physical objects or things that need to be CSP’d. Quake, Counter-Strike, MOBA games, and pretty much every multiplayer game I can think of. Heck some of them don’t even use physics engines (or only for client side effects). The point is that it isn’t a new problem, and all mutliplayer games deal with it.\u003cbr\u003e\nAnother way around re-running the whole simulation is to have kinematic body for the player with custom movement, so you can reapply inputs only on the player object.\u003cbr\u003e\nOr maybe your game doesn’t even use rigid bodies for the players, or at all (e.g. real time strategy games).\u003cbr\u003e\nFor things which don’t need to be predicted accurately you could have complete client side simulation. And it goes on…\u003c/p\u003e\n\u003cp\u003eThe problem with implementing CSP with the existing Network system is that you need a complete state snapshot. For example you can’t use delta updates on the predicted state, because the predicted state might be wrong and the whole point of sending the state is to correct it (If you’re 100% deterministic you don’t need to send anything for the most part, deterministic lockstep).\u003cbr\u003e\nA possible way around it is to maintain two states, CSP state and replication state. the replication state gets replicated as it does in Urho but does not affect the scene, just sits in the background so the CSP can copy it each frame and perform a prediction on it, and the CSP state will be the one used by the scene. As long as Urho’s network updates create complete, or maybe at least near complete snapshots of the server state, the client will be able to predict it accurately enough.\u003cbr\u003e\nIf you want to give this approach a try that would be great if it works, it will enjoy Urho’s already existing network efficiency, and won’t change the API that much, probably just adding PREDICTED to LOCAL and REPLICATED.\u003cbr\u003e\n(For now I spent way more time than planned on the CSP thing and I need to move on with my project, so I’m not going to try it)\u003c/p\u003e\n\u003cp\u003eThe most important thing to keep in mind is that it’s better to have something that doesn’t scale well than something that doesn’t work at all. It’s nice and dandy to have a car that uses 90% less fuel but if it doesn’t have wheels it won’t get anywhere.\u003cbr\u003e\nWithout client side prediction real time games over the internet aren’t an option, and that’s a much much smaller possibility space than games that can handle the overhead. CSP is essential.\u003c/p\u003e\n\u003cp\u003eWell I hope it helped to convince you that CSP is a must, and if it didn’t try to think about multiplayer games you know and ask two questions:\u003cbr\u003e\nAre they playable over the internet without CSP?\u003cbr\u003e\nCan they handle the overhead of CSP?\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2017-01-02T01:04:16.732Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":3,"reads":17,"readers_count":16,"score":18.4,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5439,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-03-19T12:22:46.000Z","cooked":"\u003cp\u003eIt is frankly unnecessary to argue for the importance of client-side prediction, because it is a given for certain types of games. The real question is how it can be achieved without sacrificing the generic usability of the networking subsystem, and in the presence of a physics simulation. In extreme cases throwing away Urho’s inbuilt networking completely could be a very valid solution. As is picking another engine that \u003cem\u003edoes\u003c/em\u003e have CSP already built in. It’s probably not what you want to hear, though \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e but remember that Urho is a voluntarily maintained project and the best course of action to make sure it proceeds in the direction you want, is to actually put in the time and contribute, instead of writing on the forums of what it \u003cem\u003eshould\u003c/em\u003e have.\u003c/p\u003e\n\u003cp\u003eWhat could be added quite easily would be user-assignable hooks or events to the reception of server-\u0026gt;client network updates, which would allow the client to maintain the necessary state for prediction, and apply the updates selectively. Also, adding a minimal timestamp (8bit) to the updates, that corresponds to the last client-\u0026gt;server input update the server has seen.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2017-01-02T01:04:16.804Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":17,"readers_count":16,"score":13.4,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5441,"name":"","username":"GoogleBot42","avatar_template":"/user_avatar/discourse.urho3d.io/googlebot42/{size}/62_2.png","created_at":"2015-03-19T17:00:44.000Z","cooked":"\u003cp\u003eHey Enhex could you post the source code?  It might be helpful to others and I would like to see how you did it as I will need to do it sooner or later.  \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2017-01-02T01:04:16.945Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":3.0,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":197,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5442,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-03-19T18:11:00.000Z","cooked":"\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003e\u003ca class=\"mention\" href=\"/u/cadaver\"\u003e@cadaver\u003c/a\u003e\u003c/span\u003e\u003cbr\u003e\nWell I did spend about 2 weeks (lost track already) attempting to make a CSP system on top of Urho3D, so it’s not like I’m all talk no walk.\u003cbr\u003e\nThe first attempt was to apply prediction on the state after it got replicated, which is almost the same approach as you suggest, but it didn’t work (possibly I did something wrong).\u003cbr\u003e\nThe second attempt was to remove as many unknown factors as possible in order to be able to know exactly what’s going on by implementing a custom straight forward network system, without modifying Urho3D so it can be an “addon” that won’t conflict when updating the engine to newer versions. And I almost gave up on it and indeed thought about picking an engine that already have proper multiplayer or implement authoritative client-side objects but at the last moment I figured what went wrong, and gladly I don’t have to go with the lesser alternatives.\u003cbr\u003e\nThese two weeks were mainly debugging hell.\u003c/p\u003e\n\u003cp\u003eI’m offering to contribute my work to be adopted by the engine, and I try to point out that it’s better to start with a useful naively implemented and inefficient system than a nearly useless efficient system, and heck they don’t even conflict. I also offered a way to have a more efficient CSP system based on the existing replication code by having two states, but that requires modifying Urho and if it doesn’t get in I’ll just have to deal with merge conflicts when updating, and I already offer a system which doesn’t conflict.\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003e\u003ca class=\"mention\" href=\"/u/googlebot42\"\u003e@GoogleBot42\u003c/a\u003e\u003c/span\u003e\u003cbr\u003e\nAs you requested I made a repo on Github with some instructions:\u003cbr\u003e\n\u003ca href=\"https://github.com/Enhex/Urho3D-CSP\" rel=\"nofollow noopener\"\u003egithub.com/Enhex/Urho3D-CSP\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI’ll also post it on the code exchange.\u003c/p\u003e","post_number":15,"post_type":1,"updated_at":"2017-01-02T01:04:17.016Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":14,"readers_count":13,"score":12.8,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/Enhex/Urho3D-CSP","internal":false,"reflection":false,"title":"GitHub - Enhex/Urho3D-CSP: Urho3D Client Side Prediction Subsystem","clicks":5}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":5448,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-03-19T23:09:22.000Z","cooked":"\u003cp\u003eThe changes I wrote about are now in. Server attribute updates can be redirected to events on the client on a per-attribute basis.\u003c/p\u003e\n\u003cp\u003eBeware, this breaks protocol due to the additional 8-bit timestamp in the updates.\u003c/p\u003e","post_number":16,"post_type":1,"updated_at":"2017-01-02T01:04:17.474Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":15,"readers_count":14,"score":8.0,"yours":false,"topic_id":933,"topic_slug":"solved-need-help-with-implementing-client-side-prediction","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[5376,5380,5381,5390,5403,5425,5428,5431,5433,5434,5437,5438,5439,5441,5442,5448]},"timeline_lookup":[[1,2810],[2,2809],[5,2808],[6,2807],[9,2806],[15,2805]],"suggested_topics":[{"id":7212,"title":"Shadow Gap between Feet and Plane","fancy_title":"Shadow Gap between Feet and Plane","slug":"shadow-gap-between-feet-and-plane","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/8/897538cff25de49fafa7aa77574f822e99576b67_2_1024x686.jpeg","created_at":"2022-03-07T00:04:17.351Z","last_posted_at":"2022-03-07T00:17:57.413Z","bumped":true,"bumped_at":"2022-03-07T00:17:57.413Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}}]},{"id":7177,"title":"Attaching a shader to a BorderImage","fancy_title":"Attaching a shader to a BorderImage","slug":"attaching-a-shader-to-a-borderimage","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-01-31T17:49:50.734Z","last_posted_at":"2022-02-01T02:22:10.927Z","bumped":true,"bumped_at":"2022-02-01T02:22:10.927Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":151,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}}]},{"id":7185,"title":"Update Ray ray direction","fancy_title":"Update Ray ray direction","slug":"update-ray-ray-direction","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-02-05T00:28:45.414Z","last_posted_at":"2022-02-05T20:19:51.238Z","bumped":true,"bumped_at":"2022-02-05T20:19:51.238Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":144,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7243,"title":"Android compile fails","fancy_title":"Android compile fails","slug":"android-compile-fails","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2022-04-25T08:46:07.947Z","last_posted_at":"2022-05-06T08:22:51.592Z","bumped":true,"bumped_at":"2022-05-06T08:22:51.592Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":181,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":933,"title":"[Solved] Need help with implementing client side prediction","fancy_title":"[Solved] Need help with implementing client side prediction","posts_count":16,"created_at":"2015-03-15T10:30:46.000Z","views":519,"reply_count":0,"like_count":0,"last_posted_at":"2015-03-19T23:09:22.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"solved-need-help-with-implementing-client-side-prediction","category_id":10,"word_count":2211,"deleted_at":null,"user_id":184,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_933","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":16,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":4,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":184,"username":"Enhex","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","post_count":7,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":5,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":197,"username":"GoogleBot42","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/googlebot42/{size}/62_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":80,"username":"thebluefish","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/f04885/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":184,"username":"Enhex","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png"},"last_poster":{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png"},"links":[{"url":"https://github.com/Enhex/Urho3D-CSP-Attempt","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":10,"user_id":184,"domain":"github.com","root_domain":"github.com"},{"url":"https://github.com/Enhex/Urho3D-CSP","title":"GitHub - Enhex/Urho3D-CSP: Urho3D Client Side Prediction Subsystem","internal":false,"attachment":false,"reflection":false,"clicks":5,"user_id":184,"domain":"github.com","root_domain":"github.com"},{"url":"https://www.youtube.com/watch?v=fho73G7ywPU","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":184,"domain":"www.youtube.com","root_domain":"youtube.com"}]}}