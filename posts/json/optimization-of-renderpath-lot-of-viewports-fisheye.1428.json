{"post_stream":{"posts":[{"id":8205,"name":"","username":"Bart","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f19dbf/{size}.png","created_at":"2015-10-15T13:51:20.000Z","cooked":"\u003cp\u003eHi All!\u003c/p\u003e\n\u003cp\u003eI would like to know if you get any idea on optimisation of rendering process when rendering a lot of views. My objective is to create a fisheye camera with 180? FOV (or more). I succeeded doing so using process descibed here:  \u003ca href=\"http://strlen.com/gfxengine/fisheyequake/\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003ehttp://strlen.com/gfxengine/fisheyequake/\u003c/a\u003e. In short, you create 5 cameras instead of one, each 90? FOV and pointing in directions front, left, right, top, bottom (and optionally rear). The cameras originate in single point. Output of these cameras is rendered on sides of TextureCube. Then I sample it from the texture cube in a simple shader and display to output Texture2D. I share the code if anyone finds it useful:\u003c/p\u003e\n\u003cp\u003eSample(camera mounted on grill of brown car, 180? FOV):\u003cbr\u003e\n\u003cimg src=\"http://urho.czweb.org/CubeCamera.png\" alt=\"\" width=\"\" height=\"\"\u003e\u003c/p\u003e\n\u003cdetails\u003e\n\u003csummary\u003e\nCubeCamera.h\u003c/summary\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e#pragma once\n\n#include \u0026lt;Urho3D/Container/Str.h\u0026gt;\n#include \u0026lt;Urho3D/Core/Context.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/Camera.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/Graphics.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/RenderPath.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/RenderSurface.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/Texture2D.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/TextureCube.h\u0026gt;\n#include \u0026lt;Urho3D/Resource/ResourceCache.h\u0026gt;\n#include \u0026lt;Urho3D/Resource/XMLFile.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/Scene.h\u0026gt;\n\nusing namespace Urho3D;\n\nclass CubeCamera\n{\n\npublic:\n    /// Construct.\n\tCubeCamera(Context * context, Scene * scene, Node * parent_node, String name);\n\n\tTexture2D * GetOutputTexture();\n\nprotected:\n\nprivate:\n\tContext * context_;\n\tString name_;\n\tScene * scene_;\n\tSharedPtr\u0026lt;TextureCube\u0026gt; cubeRenderTex_;\n\tSharedPtr\u0026lt;Texture2D\u0026gt; cubeResultRenderTex_;\n\tSharedPtr\u0026lt;Viewport\u0026gt; cubeViewport_;\n\tSharedPtr\u0026lt;Node\u0026gt; parentNode_;\n\tSharedPtr\u0026lt;Node\u0026gt; frontCubeCameraNode_;\n\tSharedPtr\u0026lt;Node\u0026gt; leftCubeCameraNode_;\n\tSharedPtr\u0026lt;Node\u0026gt; rightCubeCameraNode_;\n\tSharedPtr\u0026lt;Node\u0026gt; topCubeCameraNode_;\n\tSharedPtr\u0026lt;Node\u0026gt; bottomCubeCameraNode_;\n\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003e\nCubeCamera.cpp\u003c/summary\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e#include \u0026lt;Urho3D/Urho3D.h\u0026gt;\n\n#include \"CubeCamera.h\"\n\n#define CAM_W 1280\n#define CAM_H 1280\n#define CAM_FAR_CLIP 100.0f\n#define CUBE_SIZE 1280\n\nCubeCamera::CubeCamera(Context * context, Scene * scene, Node * parent_node, String name) :\ncontext_(context),\nscene_(scene),\nparentNode_(parent_node),\nname_(name)\n{\n\tResourceCache* cache = context-\u0026gt;GetSubsystem\u0026lt;ResourceCache\u0026gt;();\n\n\t// Create perpendicular cameras with FOV of 90deg\n\tfrontCubeCameraNode_ = parent_node-\u0026gt;CreateChild(name + \"FrontCubeSide\");\n\tfrontCubeCameraNode_-\u0026gt;Rotate(Quaternion(0.0f, Vector3::RIGHT), TS_PARENT);\n\tCamera* frontCubeCamera = frontCubeCameraNode_-\u0026gt;CreateComponent\u0026lt;Camera\u0026gt;();\n\tfrontCubeCamera-\u0026gt;SetFarClip(CAM_FAR_CLIP);\n\tfrontCubeCamera-\u0026gt;SetFov(90.0f);\n\tleftCubeCameraNode_ = parent_node-\u0026gt;CreateChild(name + \"LeftCubeSide\");\n\tleftCubeCameraNode_-\u0026gt;Rotate(Quaternion(-90.0f, Vector3::UP), TS_PARENT);\n\tCamera* leftCubeCamera = leftCubeCameraNode_-\u0026gt;CreateComponent\u0026lt;Camera\u0026gt;();\n\tleftCubeCamera-\u0026gt;SetFarClip(CAM_FAR_CLIP);\n\tleftCubeCamera-\u0026gt;SetFov(90.0f);\n\trightCubeCameraNode_ = parent_node-\u0026gt;CreateChild(name + \"RightCubeSide\");\n\trightCubeCameraNode_-\u0026gt;Rotate(Quaternion(90.0f, Vector3::UP), TS_PARENT);\n\tCamera* rightCubeCamera = rightCubeCameraNode_-\u0026gt;CreateComponent\u0026lt;Camera\u0026gt;();\n\trightCubeCamera-\u0026gt;SetFarClip(CAM_FAR_CLIP);\n\trightCubeCamera-\u0026gt;SetFov(90.0f);\n\ttopCubeCameraNode_ = parent_node-\u0026gt;CreateChild(name + \"TopCubeSide\");\n\ttopCubeCameraNode_-\u0026gt;Rotate(Quaternion(-90.0f, Vector3::RIGHT), TS_PARENT);\n\ttopCubeCameraNode_-\u0026gt;Rotate(Quaternion(-90.0f, Vector3::FORWARD), TS_LOCAL);\n\tCamera* topCubeCamera = topCubeCameraNode_-\u0026gt;CreateComponent\u0026lt;Camera\u0026gt;();\n\ttopCubeCamera-\u0026gt;SetFarClip(CAM_FAR_CLIP);\n\ttopCubeCamera-\u0026gt;SetFov(90.0f);\n\tbottomCubeCameraNode_ = parent_node-\u0026gt;CreateChild(name + \"BottomCubeSide\");\n\tbottomCubeCameraNode_-\u0026gt;Rotate(Quaternion(90.0f, Vector3::RIGHT), TS_PARENT);\n\tbottomCubeCameraNode_-\u0026gt;Rotate(Quaternion(90.0f, Vector3::FORWARD), TS_LOCAL);\n\tCamera* bottomCubeCamera = bottomCubeCameraNode_-\u0026gt;CreateComponent\u0026lt;Camera\u0026gt;();\n\tbottomCubeCamera-\u0026gt;SetFarClip(CAM_FAR_CLIP);\n\tbottomCubeCamera-\u0026gt;SetFov(90.0f);\n\n\t// Create cube texture (intermediate render target)\n\tcubeRenderTex_ = new TextureCube(context);\n\tcubeRenderTex_-\u0026gt;SetSize(CUBE_SIZE, Graphics::GetRGBAFormat(), TEXTURE_RENDERTARGET);\n\tcubeRenderTex_-\u0026gt;SetName(name + \"CubeTex\");\n\tcache-\u0026gt;AddManualResource(cubeRenderTex_);\n\n\t// Create render surfaces on individual sides of the cube texture\n\tRenderSurface* surface = cubeRenderTex_-\u0026gt;GetRenderSurface(CubeMapFace::FACE_POSITIVE_X);\n\tSharedPtr\u0026lt;Viewport\u0026gt; cubeFrontViewport(new Viewport(context, scene, frontCubeCamera));\n\tsurface-\u0026gt;SetViewport(0, cubeFrontViewport);\n\tsurface-\u0026gt;SetUpdateMode(SURFACE_UPDATEALWAYS);\n\tsurface = cubeRenderTex_-\u0026gt;GetRenderSurface(CubeMapFace::FACE_POSITIVE_Z);\n\tSharedPtr\u0026lt;Viewport\u0026gt; cubeLeftViewport(new Viewport(context, scene, leftCubeCamera));\n\tsurface-\u0026gt;SetViewport(0, cubeLeftViewport);\n\tsurface-\u0026gt;SetUpdateMode(SURFACE_UPDATEALWAYS);\n\tsurface = cubeRenderTex_-\u0026gt;GetRenderSurface(CubeMapFace::FACE_NEGATIVE_Z);\n\tSharedPtr\u0026lt;Viewport\u0026gt; cubeRightViewport(new Viewport(context, scene, rightCubeCamera));\n\tsurface-\u0026gt;SetViewport(0, cubeRightViewport);\n\tsurface-\u0026gt;SetUpdateMode(SURFACE_UPDATEALWAYS);\n\tsurface = cubeRenderTex_-\u0026gt;GetRenderSurface(CubeMapFace::FACE_POSITIVE_Y);\n\tSharedPtr\u0026lt;Viewport\u0026gt; cubeTopViewport(new Viewport(context, scene, topCubeCamera));\n\tsurface-\u0026gt;SetViewport(0, cubeTopViewport);\n\tsurface-\u0026gt;SetUpdateMode(SURFACE_UPDATEALWAYS);\n\tsurface = cubeRenderTex_-\u0026gt;GetRenderSurface(CubeMapFace::FACE_NEGATIVE_Y);\n\tSharedPtr\u0026lt;Viewport\u0026gt; cubeBottomViewport(new Viewport(context, scene, bottomCubeCamera));\n\tsurface-\u0026gt;SetViewport(0, cubeBottomViewport);\n\tsurface-\u0026gt;SetUpdateMode(SURFACE_UPDATEALWAYS);\n\n\tSharedPtr\u0026lt;RenderPath\u0026gt; cubeRenderPath = cubeFrontViewport-\u0026gt;GetRenderPath()-\u0026gt;Clone();\n\tcubeRenderPath-\u0026gt;Append(cache-\u0026gt;GetResource\u0026lt;XMLFile\u0026gt;(\"PostProcess/FXAA3.xml\"));\n\tcubeRenderPath-\u0026gt;SetEnabled(\"FXAA3\", true);\n\t\n\t// Use RenderPath with FXAA3 enabled\n\tcubeFrontViewport-\u0026gt;SetRenderPath(cubeRenderPath);\n\tcubeLeftViewport-\u0026gt;SetRenderPath(cubeRenderPath);\n\tcubeRightViewport-\u0026gt;SetRenderPath(cubeRenderPath);\n\tcubeTopViewport-\u0026gt;SetRenderPath(cubeRenderPath);\n\tcubeBottomViewport-\u0026gt;SetRenderPath(cubeRenderPath);\n\n\t// Render result image to single Texture2D\n\tRenderPathCommand rrpc;\n\trrpc.type_ = CMD_QUAD;\n\trrpc.tag_ = \"FisheyeCube\";\n\trrpc.vertexShaderName_ = \"FisheyeCube\";\n\trrpc.pixelShaderName_ = \"FisheyeCube\";\n\trrpc.SetOutput(0, \"viewport\");\n\trrpc.SetTextureName(TU_DIFFUSE, name + \"CubeTex\");\n\n\tRenderPath * rrp = new RenderPath();\n\trrp-\u0026gt;AddCommand(rrpc);\n\n\tcubeViewport_ = new Viewport(context_, scene_, frontCubeCameraNode_-\u0026gt;GetComponent\u0026lt;Camera\u0026gt;(), rrp);\n\n\tcubeResultRenderTex_ = new Texture2D(context_);\n\tcubeResultRenderTex_-\u0026gt;SetSize(CAM_W, CAM_H, Graphics::GetRGBAFormat(), TEXTURE_RENDERTARGET);\n\tsurface = cubeResultRenderTex_-\u0026gt;GetRenderSurface();\n\tsurface-\u0026gt;SetViewport(0, cubeViewport_);\n\tsurface-\u0026gt;SetUpdateMode(SURFACE_UPDATEALWAYS);\n\n\n}\n\nTexture2D * CubeCamera::GetOutputTexture()\n{\n\treturn cubeResultRenderTex_;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003e\nFisheyeCube.hlsl\u003c/summary\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e#include \"Uniforms.hlsl\"\n#include \"Samplers.hlsl\"\n#include \"Transform.hlsl\"\n#include \"ScreenPos.hlsl\"\n#include \"Lighting.hlsl\"\n\n#define M_PI 3.141592654\n\nvoid VS(float4 iPos : POSITION,\n\tout float2 oScreenPos : TEXCOORD0,\n\tout float4 oPos : OUTPOSITION)\n{\n\tfloat4x3 modelMatrix = iModelMatrix;\n\tfloat3 worldPos = GetWorldPos(modelMatrix);\n\toPos = GetClipPos(worldPos);\n\toScreenPos = GetScreenPosPreDiv(oPos);\n}\n\nvoid PS(float2 iScreenPos : TEXCOORD0,\n    out float4 oColor : OUTCOLOR0)\n{\n\tfloat Z = -2.0*iScreenPos.x + 1.0;\n\tfloat Y = -2.0*iScreenPos.y + 1.0;\n\tfloat X = 0.85 * sqrt(1.0 - Y*Y - Z*Z);  //Manipulate coeffitient to get different \"zoom\"\n\tX = X*X;                                            //Manipulate power to get different \"zoom progression\"\n\tfloat3 vec = { X, Y, Z };\n\n\tfloat3 color;\n\n\tif (sqrt(Z*Z + Y*Y)\u0026lt;=1.0)\n\t{\n\t\toColor = float4(SampleCube(DiffCubeMap, vec).rgb, 1.0);\n\t}\n\telse\n\t{\n\t\toColor = float4(0.0, 0.0, 0.0, 0.0);\n\t}\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003eEverything works, so far so good. Only issue I have with this is that it is quite demanding on the processing power, as there are many independent viewports that must be rendered. I would like to know wheter there are some ways to optimize the process. I get a huge rise in steps like ExecuteRenderPaths, RenderScenePass, an I would like to know wheter some of these steps could be combined to save time. Especially when the 5 views are sampled from the same point and are only rotated. I tried something to set multiple outputs in RenderCommands but without success. I’d like to know if there is principally anything I could do to improve efficiency.\u003c/p\u003e\n\u003cp\u003eThanks for ideas!\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2019-06-30T20:42:54.435Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":56,"reads":22,"readers_count":21,"score":299.4,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://strlen.com/gfxengine/fisheyequake/","internal":false,"reflection":false,"title":"Fisheye Quake","clicks":13}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":304,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8206,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-10-15T14:41:37.000Z","cooked":"\u003cp\u003eIt should be possible to modify the View class to allow a “replay” of another View with a different camera matrix. This would only have the cost of actually rendering, skipping the redundant CPU-side work of culling, occlusion, light processing, batch queue building etc. However I don’t know the cleanest way how this should be exposed in the engine, considering that there’s a separation into the view preparation, and rendering at the end of frame.\u003c/p\u003e\n\u003cp\u003eIt would be rather easy if there would be imperative “Cull()” and “Render()” functions each taking a camera, and the “Render()” function taking the destination texture. However now there’s rather the mechanism of the engine detecting the necessary views during the frame, then rendering them in the end taking care of the dependencies.\u003c/p\u003e\n\u003cp\u003eBtw. I like small cars so your example picture was very pleasing \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:07:40.781Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":21,"readers_count":20,"score":4.2,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8208,"name":"","username":"Bart","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f19dbf/{size}.png","created_at":"2015-10-15T16:55:23.000Z","cooked":"\u003cp\u003eThanks for the info. So that means I would have to create my own fork of the engine, which is something I’d rather avoid. Unless you come up with a clean way how to implement this, I would enjoy to implement it then and share with others. Will take look in the engine code tomorrow, if I am able to comprehend it in the first place  \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e\n\u003cp\u003eAnother idea: would it be possible to implement this in a shader code? First rendering 180deg view to have correct culling, shadows, etc, then having a vertex shader chop it up into 5 different rendertargets (cube faces) and then joining it the way I already do? But that would require manipulating camera matrix in the VS, and I dont know if that is possible or is already too late?\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:07:40.909Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":22,"readers_count":21,"score":4.4,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":304,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8209,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-10-15T22:44:58.000Z","cooked":"\u003cp\u003eGot interested in this and already implemented it in the master branch. There was some trickiness involved, and I don’t guarantee it’s 100% bugfree yet.\u003c/p\u003e\n\u003cp\u003eDocumentation will be added later, but the basic idea is that you can call Viewport::SetCullCamera() to set a separate camera for culling. When multiple viewports set the same cull camera, the view will only be prepared once. Obviously they will also need the same renderpath or the sharing will be disabled.\u003c/p\u003e\n\u003cp\u003eNote that simply using the same camera (without SetCullCamera) on two viewports will not automatically trigger this optimization, as the viewports could be using the same camera with different auto aspect ratios and therefore different culling.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:07:40.970Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":18,"readers_count":17,"score":48.6,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8210,"name":"","username":"boberfly","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/aeb1de/{size}.png","created_at":"2015-10-16T01:21:24.000Z","cooked":"\u003cp\u003eThanks for implementing this cadaver! When I was doing some porting to Oculus Rift DK2 I was thinking along the lines of a ‘cull camera’ for an optimisation, where you’d have a camera matrix which is the size of the two eyes, then render with left/right eye matrices onto the same framebuffers using glViewport (to prevent so many framebuffer changes and 2x culling).\u003c/p\u003e\n\u003cp\u003eI’ll open up that branch again and play with this change as well.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:07:41.035Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":69,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8214,"name":"","username":"Bart","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f19dbf/{size}.png","created_at":"2015-10-16T14:31:47.000Z","cooked":"\u003cp\u003eHi, thanks for such quick implementation, you’re the best \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=9\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e\n\u003cp\u003eHowever, I made a test and it is actually little slower than before. Although we can see drop in count of GetDrawables, ProcessLights, GetLightBatches and GetBaseBatches, the overall fps is lower. For comparison:\u003c/p\u003e\n\u003cp\u003e4 fisheyes, SetCullCamera, No shadows (=27fps)\u003c/p\u003e\n\u003cdiv class=\"spoiler\"\u003e\n\u003cp\u003e\u003cimg src=\"http://urho.czweb.org/4cam_noshadow_cullcamera.png\" alt=\"\" width=\"\" height=\"\"\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003e4 fisheyes, No shadows (=30fps)\u003c/p\u003e\n\u003cdiv class=\"spoiler\"\u003e\n\u003cp\u003e\u003cimg src=\"http://urho.czweb.org/4cam_noshadow_nocullcamera.png\" alt=\"\" width=\"\" height=\"\"\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003e4 fisheyes, SetCullCamera, Shadows (=13fps)\u003c/p\u003e\n\u003cdiv class=\"spoiler\"\u003e\n\u003cp\u003e\u003cimg src=\"http://urho.czweb.org/4cam_shadow_cullcamera.png\" alt=\"\" width=\"\" height=\"\"\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003e4 fisheyes, Shadows (=15fps)\u003c/p\u003e\n\u003cdiv class=\"spoiler\"\u003e\n\u003cp\u003e\u003cimg src=\"http://urho.czweb.org/4cam_shadow_nocullcamera.png\" alt=\"\" width=\"\" height=\"\"\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003eThese result numbers are quite stable, so I would trust it. Is there anything I could do to optimize the calculations in Render section, or is this strictly bound to each view? I am also curious about the Present step, what does it do, and why is it so much longer when shadows are enabled (45ms with shadows, 16ms without shadows)?\u003c/p\u003e\n\u003cp\u003eDo you think my shader solution of the fisheye problem mentioned in my previous post would be viable or is it impossible for some reason? Could it be like this?:\u003cbr\u003e\n[ul][li]Create 180deg view - all verices get into gpu stream[/li]\u003cbr\u003e\n[li]In render path, run vertex shader 5 times, each time processing vertices from region of interest and transform them in such way that we get 5x 90deg camera view into 5 different render targets (cube sides). This is the trickiest part - is this even possible? [/li]\u003cbr\u003e\n[li]Unite these 5 rendertargets into one in pixel shader (i do this already). Output into viewport[/li][/ul]\u003c/p\u003e\n\u003cp\u003eThank you\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T01:07:41.318Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":304,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8215,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-10-16T15:01:04.000Z","cooked":"\u003cp\u003eUrho doesn’t implement geometry shaders, so you can’t render into several rendertargets at the same time sensibly, only MRT output for e.g. deferred rendering.\u003c/p\u003e\n\u003cp\u003eActually I’m not surprised by this result, because now it means that the whole view’s objects are rendered for each fisheye face, which can result in a lot more triangles and draw calls (check your stats in the top-left corner!) In cubemap rendering the culling per face can help a lot to eliminate unnecessary objects, and furthermore the View is quite intelligent to e.g. disable shadows if there are no shadow casters / receivers visible. In this case the view preparation sharing would only help if you’re CPU bound and your GPU is so powerful that it can take the extra object rendering without much slowdown.\u003c/p\u003e\n\u003cp\u003eThe view preparation saving would be most significant in stereoscopic applications because in that case the views are nearly identical and there are no (or very little) wasted objects being drawn.\u003c/p\u003e\n\u003cp\u003eIf you can take a bit wrong output the fastest would be to just render a forward view, perhaps with extra-wide FOV, and use a pixel shader to incorrectly warp it into a fisheye.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-01-02T01:07:41.398Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":13,"readers_count":12,"score":7.6,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8216,"name":"","username":"Bart","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f19dbf/{size}.png","created_at":"2015-10-16T17:21:04.000Z","cooked":"\u003cp\u003eOk, thank you very much for the claricifaction, thats what I needed to hear.\u003c/p\u003e\n\u003cp\u003eHave a nice weekend!\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-01-02T01:07:41.461Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":12,"readers_count":11,"score":7.4,"yours":false,"topic_id":1428,"topic_slug":"optimization-of-renderpath-lot-of-viewports-fisheye","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":304,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[8205,8206,8208,8209,8210,8214,8215,8216]},"timeline_lookup":[[1,2596],[4,2595],[8,2594]],"suggested_topics":[{"id":7105,"title":"Multiple Application.UI Roots?","fancy_title":"Multiple Application.UI Roots?","slug":"multiple-application-ui-roots","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/7/74b10ce575f1b69fe43be4abcb07605d74a1d27c_2_1024x544.jpeg","created_at":"2021-12-20T08:55:14.707Z","last_posted_at":"2021-12-22T02:33:05.795Z","bumped":true,"bumped_at":"2021-12-22T02:33:05.795Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":243,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7112,"title":"What is the proper way to add more source files(.cpp and .h) to a project?","fancy_title":"What is the proper way to add more source files(.cpp and .h) to a project?","slug":"what-is-the-proper-way-to-add-more-source-files-cpp-and-h-to-a-project","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2021-12-27T18:18:21.946Z","last_posted_at":"2021-12-28T12:19:43.514Z","bumped":true,"bumped_at":"2021-12-28T12:19:43.514Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":195,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1498,"username":"Tryout","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/85f322/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7129,"title":"Best Model Import Pipeline as of Jan 2022?","fancy_title":"Best Model Import Pipeline as of Jan 2022?","slug":"best-model-import-pipeline-as-of-jan-2022","posts_count":7,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2022-01-17T09:27:23.432Z","last_posted_at":"2022-01-17T20:37:59.458Z","bumped":true,"bumped_at":"2022-01-17T20:37:59.458Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":170,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}}]},{"id":7160,"title":"RayCast trouble","fancy_title":"RayCast trouble","slug":"raycast-trouble","posts_count":17,"reply_count":9,"highest_post_number":19,"image_url":null,"created_at":"2022-01-29T00:06:00.367Z","last_posted_at":"2022-01-30T00:29:39.356Z","bumped":true,"bumped_at":"2022-01-30T00:29:39.356Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":260,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":627,"username":"George1","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/9e8a1a/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]}],"tags_descriptions":{},"id":1428,"title":"Optimization of RenderPath/Lot of Viewports/Fisheye","fancy_title":"Optimization of RenderPath/Lot of Viewports/Fisheye","posts_count":8,"created_at":"2015-10-15T13:51:20.000Z","views":450,"reply_count":0,"like_count":2,"last_posted_at":"2015-10-16T17:21:04.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"optimization-of-renderpath-lot-of-viewports-fisheye","category_id":10,"word_count":1913,"deleted_at":null,"user_id":304,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1428","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":8,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":304,"username":"Bart","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f19dbf/{size}.png","post_count":4,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":69,"username":"boberfly","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/aeb1de/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":304,"username":"Bart","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f19dbf/{size}.png"},"last_poster":{"id":304,"username":"Bart","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f19dbf/{size}.png"},"links":[{"url":"http://strlen.com/gfxengine/fisheyequake/","title":"Fisheye Quake","internal":false,"attachment":false,"reflection":false,"clicks":13,"user_id":304,"domain":"strlen.com","root_domain":"strlen.com"}]}}