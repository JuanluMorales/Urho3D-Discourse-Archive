{"post_stream":{"posts":[{"id":26539,"name":"lhlvieira","username":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png","created_at":"2018-11-07T21:10:25.933Z","cooked":"\u003cp\u003eHello there,\u003cbr\u003e\nI am trying to create a dismemberment effect for a zombie game. Let’s use the ragdoll sample for reference. I have successfully detached 2 bones (simply used ‘Enabled = false’ on a constraint). Problem: the mesh follows the bones around, stretching itself to them. This is obviously expected to happen. So, how could I prevent this ?\u003c/p\u003e\n\u003cp\u003eWell, I think the solution lies in modifying a bone’s influence on the vertices and then detaching some vertices, but…\u003cbr\u003e\n1- Is it even possible to edit a model’s mesh at runtime ?\u003cbr\u003e\n2- Is it possible to access the vertices a bone has influence to and modify them, specifically bone weights ?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2018-11-07T21:10:45.468Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":49,"reads":45,"readers_count":44,"score":259.0,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"lhlvieira","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1059,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26540,"name":"","username":"orefkov","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png","created_at":"2018-11-07T21:25:07.465Z","cooked":"\u003cp\u003eImho, personally, I would just prepare two different models in advance, at design time, with different weights. And at the moment of dismemberment simply replaced one model with another.\u003cbr\u003e\nAlthough, of course, nothing prevents you from creating a copy of the vertex buffer at run time, changing the weights during copying, and then assigning a new vertex buffer to the geometry.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2018-11-07T21:29:54.837Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":45,"readers_count":44,"score":14.0,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":584,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26541,"name":"Jonathan","username":"Sinoid","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/{size}.png","created_at":"2018-11-07T21:52:13.895Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"lhlvieira\" data-post=\"1\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/lhlvieira/40/1832_2.png\" class=\"avatar\"\u003e lhlvieira:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003e1- Is it even possible to edit a model’s mesh at runtime ?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eYes, but you’re not going to want to.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e2- Is it possible to access the vertices a bone has influence to and modify them, specifically bone weights ?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eYes, but you’re not going to want to.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eHow to detach/disconnect skinned geometry\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eYou can realistically (in Urho3D) only do this if you’re separating distinct geometries from an aggregate model, such as multiple AnimatedModel’s attached to a master.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eYou cannot trivially piece-meal an arbitrary mesh.\u003c/p\u003e\n\u003col start=\"0\"\u003e\n\u003cli\u003e\n\u003cp\u003eMake a whole ton of models and swap them\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOnly even remotely viable if you use 3dsMax, the modifier stack can actually cope with some crazy trees of edits\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCSG is tempting, don’t waste your time\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eyou have to deal with vertex-attributes, which are non-trivial and most changes you’ll want to do will involve such\u003c/li\u003e\n\u003cli\u003efake CSG can work (discard triangles and close the open-loop)\n\u003cul\u003e\n\u003cli\u003estupid when the options below exist (open-loop finding is hard)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ehave to isolate \u003cem\u003efloating\u003c/em\u003e geometries (from severing) into discrete meshes and then fit a physics collider to them in a tight time-span\n\u003cul\u003e\n\u003cli\u003eCSG on organics is stupid slow, it’s much faster on inorganics which are less tri-soupy\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe easiest approach will be to scale the the joint at the severing point to 0 (which will collapse all geometry weighted to it or downstream to nothing) then spawning a \u003cem\u003esevered-limb\u003c/em\u003e with the orientation of the severed joint had and then adding a \u003cem\u003egore-flower\u003c/em\u003e at the point the joint collapsed down to.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNot very granular though\u003c/li\u003e\n\u003cli\u003eNot sure if it ended up there in the end but that approach was used early on in the new Doom, there’s 3 variations of a paper on that - all behind pay-walls though (1 book, 2 acad).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRoll a custom exporter and write out a crap-load of different combinations of index-buffers. The old Ghoul2 system worked this way by changing the indices drawn, all vertex data was always present and gore just changed what the triangle layout was.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAgain, you have to spawn stuff (limb parts, gore-flowers, etc)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eValve’s Left4Dead2 slides are easy to find, they’re shader based though and they’ll make a mess of batching (though animated models already do that … so not a ton of loss).\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eYou still have to spawn stuff (limb parts, gore-flowers, etc)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNo, you can’t really use bullet softbodies for this\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMorph targets and texture swaps are plenty for superficial gore, and complementary to anything else\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cp\u003eRealistically you’re going to have to make use of a whole bunch of different things.\u003c/p\u003e\n\u003cp\u003eI’m trying out a combination of Ghoul2-esque index swapping, morph-targets, Left4Dead2’s ellipsoid method, and prefab scenes for spawn-lists. I was previously using too much CSG and that was a waste of time, now I’ve moved to just using volume selections to filter triangles and then fill the open-loops for a base geo. Though my gore requirements are closer to MK than a zombie game.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2018-11-07T21:52:13.895Z","reply_count":1,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":2,"reads":42,"readers_count":41,"score":23.4,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"Jonathan","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":669,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26542,"name":"lhlvieira","username":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png","created_at":"2018-11-07T22:10:09.610Z","cooked":"\u003caside class=\"quote no-group\" data-post=\"2\" data-topic=\"4655\" data-full=\"true\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/orefkov/40/1164_1.png\" class=\"avatar\"\u003e orefkov:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eImho, personally, I would just prepare two different models in advance, at design time, with different weights. And at the moment of dismemberment simply replaced one model with another.\u003cbr\u003e\nAlthough, of course, nothing prevents you from creating a copy of the vertex buffer at run time, changing the weights during copying, and then assigning a new vertex buffer to the geometry.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI have thought of that method too, but it is really inefficient in my opinion. Imagine having to create all sorts of variations for every zombie model in the game. I think Chivalry Medieval Warfare used this approach, but in their case, it is rather ok due to low amount of models in the game.\u003c/p\u003e\n\u003cp\u003eEDIT 1: Added quotes\u003cbr\u003e\nEDIT 2: Added game reference\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2018-11-07T23:23:10.655Z","reply_count":1,"reply_to_post_number":2,"quote_count":1,"incoming_link_count":0,"reads":37,"readers_count":36,"score":12.4,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"lhlvieira","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":3,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1059,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26544,"name":"","username":"orefkov","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png","created_at":"2018-11-07T22:32:26.951Z","cooked":"\u003cp\u003eOnly one additional model for every zombie model. Just copy of usual model, but for vertexes leave only one weight, every vertex leave linked only to one bone. And loop cut vertex groups one from another. After it you can subst model and move bones in any way.\u003cbr\u003e\nAnd still it would be possible to add morph animation of different injuries for each limb.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2018-11-07T22:38:31.457Z","reply_count":1,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":0,"reads":36,"readers_count":35,"score":12.2,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"lhlvieira","name":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":584,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26545,"name":"lhlvieira","username":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png","created_at":"2018-11-07T23:21:01.427Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"Sinoid\" data-post=\"3\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/40.png\" class=\"avatar\"\u003e Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMake a whole ton of models and swap them\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eSimiliar to orefkov ideal I think, but yeah, I thought of this approach too but meh, really bad in opinion, I cant imagine myself creating every variation by hand. If I am not mistaken, Chivalry Medieval Warfare used something similar to this.\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"Sinoid\" data-post=\"3\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/40.png\" class=\"avatar\"\u003e Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCSG is tempting, don’t waste your time\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eYou mean performing boolean operations and all that ? Not gonna lie, such system would be perfect for gore games, but if I am not mistaken, the mesh has to be water-tight and non-self-intersecting, and that is a nono already. Can’t even imagine how complicated must to even implement it.\u003cbr\u003e\nI actually have this pending idea/project in my mind of implementing an object slicer (which I believe would be easier than CSG), inspired on the one in Shadow Warrior 2. Slicing the object itself is probably easy, the biggest problem is doing that to an actual skinned and ragdolled object.\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"Sinoid\" data-post=\"3\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/40.png\" class=\"avatar\"\u003e Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe easiest approach will be to scale the the joint at the severing point to 0 (which will collapse all geometry weighted to it or downstream to nothing) then spawning a \u003cem\u003esevered-limb\u003c/em\u003e with the orientation of the severed joint had and then adding a \u003cem\u003egore-flower\u003c/em\u003e at the point the joint collapsed down to.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI also thought of that, but I see this approach as a hack more than anything else. I have seen this technique being used in some games, cant remember which though. Actually, one day I almost made a Skyrim mod that would utilize this idea of shrinking to 0, I’ve never finished the mod though.\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"Sinoid\" data-post=\"3\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/40.png\" class=\"avatar\"\u003e Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRoll a custom exporter and write out a crap-load of different combinations of index-buffers. The old Ghoul2 system worked this way by changing the indices drawn, all vertex data was always present and gore just changed what the triangle layout was.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI think I don’t fully understand the idea. You mean I could have multiple geometries in one place, but choose which one to render ? Is it similiar to Fallout 3’s approach ? Where artist had to define the vertices that could get removed, and also manually place the \u003cem\u003egore-caps\u003c/em\u003e ?.\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"Sinoid\" data-post=\"3\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/40.png\" class=\"avatar\"\u003e Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eValve’s Left4Dead2 slides are easy to find, they’re shader based though and they’ll make a mess of batching (though animated models already do that … so not a ton of loss).\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eThis is the best gore method I know of, it is really modular, and if done right it works with every model in the game. I have seen this approach being used in MK9 and X, Dying Light and Shadow Warrior too. I noted it has a small disadvantage though, since pixels get ‘dicarded’, no actual geometry gets disconnect from the mesh, meaning you probably will have to spawn a generic limb.\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"Sinoid\" data-post=\"3\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/40.png\" class=\"avatar\"\u003e Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNo, you can’t really use bullet softbodies for this\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI figured. I don’t plan to make a boobs game \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/joy.png?v=10\" title=\":joy:\" class=\"emoji\" alt=\":joy:\"\u003e.\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"Sinoid\" data-post=\"3\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/40.png\" class=\"avatar\"\u003e Sinoid:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRealistically you’re going to have to make use of a whole bunch of different things.\u003c/p\u003e\n\u003cp\u003eI’m trying out a combination of Ghoul2-esque index swapping, morph-targets, Left4Dead2’s ellipsoid method, and prefab scenes for spawn-lists. I was previously using too much CSG and that was a waste of time, now I’ve moved to just using volume selections to filter triangles and then fill the open-loops for a base geo. Though my gore requirements are closer to MK than a zombie game.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eNice, good luck in your journey. Truth is, I am a noob at programming, I started out recently so I have all this ideas in my head but I cant really do the maths and codes to get them working. Plus, I am actually using UrhoSharp because its noob-friendlier.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2018-11-07T23:21:01.427Z","reply_count":0,"reply_to_post_number":3,"quote_count":1,"incoming_link_count":0,"reads":35,"readers_count":34,"score":7.0,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"lhlvieira","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1059,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26546,"name":"lhlvieira","username":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png","created_at":"2018-11-07T23:43:52.865Z","cooked":"\u003caside class=\"quote no-group\" data-post=\"5\" data-topic=\"4655\" data-full=\"true\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/orefkov/40/1164_1.png\" class=\"avatar\"\u003e orefkov:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eOnly one additional model for every zombie model. Just copy of usual model, but for vertexes leave only one weight, every vertex leave linked only to one bone. And loop cut vertex groups one from another. After it you can subst model and move bones in any way.\u003cbr\u003e\nAnd still it would be possible to add morph animation of different injuries for each limb.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eOk help me understand your idea. Correct me if I am wrong, you are saying to:\u003cbr\u003e\n1- At design time, create a second model that has only 1 bone weight per vertex OR at runtime copy vertex-buffer and modify its vertices-weight to only 1 bone.\u003cbr\u003e\n2- Loop cut vertex groups \u0026lt;-- this I dont quite understand. Do you mean I should separate/cut/slice the vertices per bone ? So I could have, like, one vertex-buffer/geometry per character limb ?\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2018-11-07T23:43:52.865Z","reply_count":2,"reply_to_post_number":5,"quote_count":1,"incoming_link_count":2,"reads":31,"readers_count":30,"score":26.2,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"lhlvieira","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1059,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26550,"name":"","username":"orefkov","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png","created_at":"2018-11-08T06:34:10.073Z","cooked":"\u003cp\u003eI record small video how I make it in Blender on the example of the left hand.\u003cbr\u003e\n\u003c/p\u003e\u003cdiv class=\"lazyYT\" data-youtube-id=\"UmaSabmIHls\" data-youtube-title=\"Make dismemberment body for Urho3D\" data-width=\"480\" data-height=\"270\" data-parameters=\"feature=oembed\u0026amp;wmode=opaque\"\u003e\u003c/div\u003e\n\u003cp\u003eFirst I make copy of mesh.\u003cbr\u003e\nThen select left arm part of mesh and separate it to different mesh.\u003cbr\u003e\nIn new mesh all vertexes add to group “lowerarm_l” and remove from others groups.\u003cbr\u003e\nIn old mesh (without left arm) - select vertices from lowerarm_l group and remove it from that group.\u003cbr\u003e\nAfter I join two meshes back to one and export old mesh and new copy.\u003cbr\u003e\nIn editor create two AnimatedModel componen on one node.\u003cbr\u003e\nFor first component set usual model, for second - new model.\u003cbr\u003e\nAnd then move the lowerarm_l node, alternately setting models enabled.\u003c/p\u003e\n\u003cp\u003eIn principle, this process can be automated, and you can write a script for the Blender or right in Urho3D. However, you need to know for which vertices and by how mach you need to change weights.\u003c/p\u003e\n\u003cp\u003eAlthough now I thought - in the detachable hand it was possible not to change all the weights, it was enough to exclude the vertices from the group of the upperarm_l, and in the remaining body to exclude the vertices from the group of lowerarm_l.\u003c/p\u003e\n\u003cp\u003eThe main problem is that the vertices in the place where the lowarm and the upperarm are connected must be doubled, as they initially belong to both groups, but in order for the model to break when the dismemberment occurs, there must be two vertices - one remains in one part , the other - in the other. That’s what I meant by the “loop cut”\u003c/p\u003e\n\u003cp\u003eThus, it is possible to prepare a single model, divided into several parts, and use this model to implement the dismemberment effect.\u003cbr\u003e\nYou can also add several different morph animations to this new model.\u003c/p\u003e\n\u003cp\u003eImho - best way create script for Blender, where you just select loop edge, where you need divide model, and script will do the rest.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2018-11-08T07:15:30.899Z","reply_count":0,"reply_to_post_number":7,"quote_count":0,"incoming_link_count":0,"reads":36,"readers_count":35,"score":52.2,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":4,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://www.youtube.com/watch?v=UmaSabmIHls","internal":false,"reflection":false,"title":"YouTube","clicks":0}],"read":true,"user_title":null,"reply_to_user":{"username":"lhlvieira","name":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":584,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26551,"name":"","username":"orefkov","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png","created_at":"2018-11-08T07:53:58.128Z","cooked":"\u003cp\u003eAlso I record process of adding shape keys in Blender for that model.\u003cbr\u003e\nThen, in the game, in each specific case of separating a part of the body, you can set a random set of values for these keys in order to give individuality to each case and avoid sameness.\u003cbr\u003e\n\u003c/p\u003e\u003cdiv class=\"lazyYT\" data-youtube-id=\"U1Bkc0XWfkU\" data-youtube-title=\"Add shape keys for divided model\" data-width=\"480\" data-height=\"270\" data-parameters=\"feature=oembed\u0026amp;wmode=opaque\"\u003e\u003c/div\u003e\n\u003cp\u003eWell, for all that beauty, you need to create polygons at the point of separation in this model to close the hole. Well, apply on them a blood-meat texture, well, or whatever happens in a zombie. And add the particle effect of course.\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2018-11-08T08:04:38.620Z","reply_count":0,"reply_to_post_number":7,"quote_count":0,"incoming_link_count":0,"reads":34,"readers_count":33,"score":6.8,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://www.youtube.com/watch?v=U1Bkc0XWfkU","internal":false,"reflection":false,"title":"YouTube","clicks":0}],"read":true,"user_title":null,"reply_to_user":{"username":"lhlvieira","name":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":584,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26552,"name":"Fernando Nadal Testa","username":"fnadalt","avatar_template":"/user_avatar/discourse.urho3d.io/fnadalt/{size}/2113_2.png","created_at":"2018-11-08T11:23:10.535Z","cooked":"\u003cp\u003ePanda3D uses this approach:\u003cbr\u003e\n\u003ca href=\"https://www.panda3d.org/manual/index.php/Multi-Part_Actors\" class=\"onebox\" target=\"_blank\" rel=\"nofollow noopener\"\u003ehttps://www.panda3d.org/manual/index.php/Multi-Part_Actors\u003c/a\u003e\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2018-11-08T11:23:10.535Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":32,"readers_count":31,"score":11.4,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"Fernando Nadal Testa","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://www.panda3d.org/manual/index.php/Multi-Part_Actors","internal":false,"reflection":false,"title":"Multi-Part Actors - Panda3D Manual","clicks":13}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":863,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26553,"name":"","username":"orefkov","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png","created_at":"2018-11-08T11:52:48.071Z","cooked":"\u003cp\u003eThis is not a little for that. In Urho3D, you can also manage several models tied to individual bones of a skeleton with a single master skeleton.\u003cbr\u003e\nIf you use this mechanism, you still need to prepare several models in advance, each separately for the part of the body to be separated.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2018-11-08T11:52:48.071Z","reply_count":1,"reply_to_post_number":10,"quote_count":0,"incoming_link_count":2,"reads":29,"readers_count":28,"score":20.8,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"fnadalt","name":"Fernando Nadal Testa","avatar_template":"/user_avatar/discourse.urho3d.io/fnadalt/{size}/2113_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":584,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26566,"name":"Jonathan","username":"Sinoid","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/{size}.png","created_at":"2018-11-08T21:03:38.452Z","cooked":"\u003cp\u003e\u003ca class=\"mention\" href=\"/u/orefkov\"\u003e@orefkov\u003c/a\u003e, you do know that Blender has arbitrary vertex-groups right? You can setup vertex groups and write a script to go through all of them based on naming convention, fill holes, chart the hole-fill faces, and dump the fill info like the edges and centroid (for flowers/caps/particle emitters) to read.\u003c/p\u003e\n\u003cp\u003eUnfortunately Blender’s shoddy FBX export doesn’t write groups into FBX selection-sets like it should.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2018-11-08T21:03:38.452Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":29,"readers_count":28,"score":5.8,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"Jonathan","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":669,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26567,"name":"lhlvieira","username":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png","created_at":"2018-11-08T21:34:36.338Z","cooked":"\u003cp\u003eNice video, I understand you now. I still think it is is similar to Chivalry, when a model gets dismembered devs replace it with a 2nd model that have disconnected limbs. It is a rather good approach, but I really wanted to do that at runtime instead of setting everything up in blender like that.\u003c/p\u003e\n\u003cp\u003eI am gonna study Urho capabilities deeper and initially try 2 approaches:\u003c/p\u003e\n\u003cp\u003e1- At model creation, separate mesh into geometries for each dismember-able limb. Similar to Fallout 3 engine, where artists had to highlight/select which vertices could get dismembered. And then, with code, try some tricks to get the geometry to detach from the model.\u003c/p\u003e\n\u003cp\u003e2- Instead of dealing with geometries, I could also just use a bone-weight information of vertex and do what you did in Blender with code instead. I think this approach would be better, but I haven’t wrapped my head around it yet.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2018-11-08T21:34:36.338Z","reply_count":1,"reply_to_post_number":11,"quote_count":0,"incoming_link_count":0,"reads":29,"readers_count":28,"score":10.8,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"lhlvieira","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"orefkov","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1059,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26571,"name":"","username":"orefkov","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png","created_at":"2018-11-09T06:15:21.238Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"lhlvieira\" data-post=\"13\" data-topic=\"4655\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/lhlvieira/40/1832_2.png\" class=\"avatar\"\u003e lhlvieira:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003ebut I really wanted to do that at runtime instead of setting everything up in blender like that\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eClear. It’s just that my main use is mobile games, and for performance I profess the principle - everything that can be calculated in advance - should be calculated in advance.\u003cbr\u003e\nThen I can offer another such idea.\u003cbr\u003e\nYou can create own version of the shader for drawing, in which the parameter will be worked out - which part of the model to draw and which not.\u003cbr\u003e\nsimilar like this\u003c/p\u003e\u003cdiv class=\"onebox lazyYT lazyYT-container\" data-youtube-id=\"SmR_Xa-_Cgs\" data-youtube-title=\"Urho3D Models Dissolving Like Doom 3\" data-parameters=\"feature=oembed\u0026amp;wmode=opaque\"\u003e\n  \u003ca href=\"https://www.youtube.com/watch?v=SmR_Xa-_Cgs\" target=\"_blank\" rel=\"noopener nofollow ugc\"\u003e\n    \u003cimg class=\"ytp-thumbnail-image\" src=\"https://img.youtube.com/vi/SmR_Xa-_Cgs/hqdefault.jpg\" title=\"Urho3D Models Dissolving Like Doom 3\" width=\"480\" height=\"360\"\u003e\n  \u003c/a\u003e\n\u003c/div\u003e\n\u003cp\u003e\nThere is topic about it - \u003ca href=\"https://discourse.urho3d.io/t/models-dissolving-like-doom-3/1625\" class=\"inline-onebox\"\u003eModels dissolving like Doom 3\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAt the moment of dismemberment, add the second model - a duplicate of the first. Both assign this shader, for one model we ask to draw one part, for another - another.\u003cbr\u003e\nBonus - you will be able to portray the tearing of a zombie anywhere, not only along the joints \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=10\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2018-11-09T06:22:21.486Z","reply_count":0,"reply_to_post_number":13,"quote_count":1,"incoming_link_count":3,"reads":36,"readers_count":35,"score":37.2,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://discourse.urho3d.io/t/models-dissolving-like-doom-3/1625","internal":true,"reflection":false,"title":"Models dissolving like Doom 3","clicks":8},{"url":"https://www.youtube.com/watch?v=SmR_Xa-_Cgs","internal":false,"reflection":false,"title":"YouTube","clicks":1}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":584,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26752,"name":"lhlvieira","username":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png","created_at":"2018-12-04T01:43:57.619Z","cooked":"\u003cp\u003eJust to show off what I came up with.  See it as a poor proof of concept:\u003c/p\u003e\n\u003cp\u003eThings to note:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIt is a hack, it has bugs, it is slow and therefore should not be used in production, at least not the way I implemented it.\u003c/li\u003e\n\u003cli\u003eThe good thing about it is that it is pretty scalable technique and doesn’t need any mesh setup, and it can probably work with any skeleton you throw at it.\u003c/li\u003e\n\u003cli\u003eIt will kill draw calls because each detached limb is a separate AnimatedModel.\u003c/li\u003e\n\u003cli\u003eThe code is a mess, sorry, so don’t try to understand it just run it.\u003c/li\u003e\n\u003cli\u003eDecals disabled.\u003c/li\u003e\n\u003cli\u003eLeft mouse throws ball, Right mouse dismembers.\u003c/li\u003e\n\u003cli\u003eDismember only occurs when ragdoll is on.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e!!! VIRTUAL GORE AHEAD !!!\u003c/p\u003e\n\u003cdiv class=\"spoiler\"\u003e\n\u003cp\u003e\u003cimg src=\"//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/8/873ca10783ddc90fd86762e40051ab446238091b.png\" alt=\"deadJack1\" width=\"690\" height=\"471\"\u003e \u003cimg src=\"//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/4/4cae44aeca1b1c2ea14b30ae6e65b079879c24a5.png\" alt=\"deadJack2\" width=\"690\" height=\"482\"\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003eLUA Code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003erequire \"LuaScripts/Utilities/Sample\"\n\nfunction Start()\n    cache.autoReloadResources = true\n    -- Execute the common startup for samples\n    SampleStart()\n\n    -- Create the scene content\n    CreateScene()\n\n    -- Create the UI content\n    CreateInstructions()\n\n    -- Setup the viewport for displaying the scene\n    SetupViewport()\n\n    -- Set the mouse mode to use in the sample\n    SampleInitMouseMode(MM_RELATIVE)\n\n    -- Hook up to the frame update and render post-update events\n    SubscribeToEvents()\nend\n\nfunction CreateScene()\n    scene_ = Scene()\n\n    -- Create octree, use default volume (-1000, -1000, -1000) to (1000, 1000, 1000)\n    -- Create a physics simulation world with default parameters, which will update at 60fps. Like the Octree must\n    -- exist before creating drawable components, the PhysicsWorld must exist before creating physics components.\n    -- Finally, create a DebugRenderer component so that we can draw physics debug geometry\n    scene_:CreateComponent(\"Octree\")\n    scene_:CreateComponent(\"PhysicsWorld\")\n    scene_:CreateComponent(\"DebugRenderer\")\n\n    -- Create a Zone component for ambient lighting \u0026amp; fog control\n    local zoneNode = scene_:CreateChild(\"Zone\")\n    local zone = zoneNode:CreateComponent(\"Zone\")\n    zone.boundingBox = BoundingBox(-1000.0, 1000.0)\n    zone.ambientColor = Color(0.15, 0.15, 0.15)\n    zone.fogColor = Color(0.5, 0.5, 0.7)\n    zone.fogStart = 100.0\n    zone.fogEnd = 300.0\n\n    -- Create a directional light to the world. Enable cascaded shadows on it\n    local lightNode = scene_:CreateChild(\"DirectionalLight\")\n    lightNode.direction = Vector3(0.6, -1.0, 0.8)\n    local light = lightNode:CreateComponent(\"Light\")\n    light.lightType = LIGHT_DIRECTIONAL\n    light.castShadows = true\n    light.shadowBias = BiasParameters(0.00025, 0.5)\n    -- Set cascade splits at 10, 50 and 200 world units, fade shadows out at 80% of maximum shadow distance\n    light.shadowCascade = CascadeParameters(10.0, 50.0, 200.0, 0.0, 0.8)\n\n    -- Create a floor object, 500 x 500 world units. Adjust position so that the ground is at zero Y\n    local floorNode = scene_:CreateChild(\"Floor\")\n    floorNode.position = Vector3(0.0, -0.5, 0.0)\n    floorNode.scale = Vector3(500.0, 1.0, 500.0)\n    local floorObject = floorNode:CreateComponent(\"StaticModel\")\n    floorObject.model = cache:GetResource(\"Model\", \"Models/Box.mdl\")\n    floorObject.material = cache:GetResource(\"Material\", \"Materials/StoneTiled.xml\")\n\n    -- Make the floor physical by adding RigidBody and CollisionShape components\n    local body = floorNode:CreateComponent(\"RigidBody\")\n    -- We will be spawning spherical objects in this sample. The ground also needs non-zero rolling friction so that\n    -- the spheres will eventually come to rest\n    local shape = floorNode:CreateComponent(\"CollisionShape\")\n    -- Set a box shape of size 1 x 1 x 1 for collision. The shape will be scaled with the scene node scale, so the\n    -- rendering and physics representation sizes should match (the box model is also 1 x 1 x 1.)\n    shape:SetBox(Vector3(1.0, 1.0, 1.0))\n\n    -- Create animated models\n    for z = -1, 1 do\n        for x = -4, 4 do\n            local modelNode = scene_:CreateChild(\"Jack\")\n            modelNode.position = Vector3(x * 5.0, 0.0, z * 5.0)\n            modelNode.rotation = Quaternion(0.0, 180.0, 0.0)\n            local modelObject = modelNode:CreateComponent(\"AnimatedModel\")\n            local model = cache:GetResource(\"Model\", \"Models/Jack.mdl\")\n            modelObject.model = model\n            modelObject.material = cache:GetResource(\"Material\", \"Materials/Jack.xml\")\n            modelObject.castShadows = true\n            -- Set the model to also update when invisible to avoid staying invisible when the model should come into\n            -- view, but does not as the bounding box is not updated\n            modelObject.updateInvisible = true\n\n            -- Create a rigid body and a collision shape. These will act as a trigger for transforming the\n            -- model into a ragdoll when hit by a moving object\n            local body = modelNode:CreateComponent(\"RigidBody\")\n            -- The trigger mode makes the rigid body only detect collisions, but impart no forces on the\n            -- colliding objects\n            body.trigger = true\n            local shape = modelNode:CreateComponent(\"CollisionShape\")\n            -- Create the capsule shape with an offset so that it is correctly aligned with the model, which\n            -- has its origin at the feet\n            shape:SetCapsule(0.7, 2.0, Vector3(0.0, 1.0, 0.0))\n\n            -- Create a custom script object that reacts to collisions and creates the ragdoll\n            modelNode:CreateScriptObject(\"CreateRagdoll\")\n        end\n    end\n\n    -- Create the camera. Limit far clip distance to match the fog. Note: now we actually create the camera node outside\n    -- the scene, because we want it to be unaffected by scene load / save\n    cameraNode = Node()\n    local camera = cameraNode:CreateComponent(\"Camera\")\n    camera.farClip = 300.0\n\n    -- Set an initial position for the camera scene node above the floor\n    cameraNode.position = Vector3(0.0, 5.0, -20.0)\nend\n\nfunction CreateInstructions()\n    -- Construct new Text object, set string to display and font to use\n    local instructionText = ui.root:CreateChild(\"Text\")\n    instructionText:SetText(\n        \"Use WASD keys and mouse to move\\n\"..\n        \"LMB to spawn physics objects\\n\"..\n        \"F5 to save scene, F7 to load\\n\"..\n        \"Space to toggle physics debug geometry\")\n    instructionText:SetFont(cache:GetResource(\"Font\", \"Fonts/Anonymous Pro.ttf\"), 15)\n    -- The text has multiple rows. Center them in relation to each other\n    instructionText.textAlignment = HA_CENTER\n\n    -- Position the text relative to the screen center\n    instructionText.horizontalAlignment = HA_CENTER\n    instructionText.verticalAlignment = VA_CENTER\n    instructionText:SetPosition(0, ui.root.height / 4)\nend\n\nfunction SetupViewport()\n    -- Set up a viewport to the Renderer subsystem so that the 3D scene can be seen\n    local viewport = Viewport:new(scene_, cameraNode:GetComponent(\"Camera\"))\n    renderer:SetViewport(0, viewport)\nend\n\nfunction SubscribeToEvents()\n    -- Subscribe HandleUpdate() function for processing update events\n    SubscribeToEvent(\"Update\", \"HandleUpdate\")\n\n    -- Subscribe HandlePostRenderUpdate() function for processing the post-render update event, during which we request\n    -- debug geometry\n    SubscribeToEvent(\"PostRenderUpdate\", \"HandlePostRenderUpdate\")\nend\n\nfunction DrawDecalAt(ray)\n    local result = scene_:GetComponent(\"Octree\"):RaycastSingle(ray, RAY_TRIANGLE, 10000, DRAWABLE_GEOMETRY)\n    if not result then\n        return\n    end\n    \n    local node = result.drawable.node\n    local ds = node:GetComponent(\"DecalSet\")\n    if not ds then\n        ds = node:CreateComponent(\"DecalSet\")\n        ds:SetMaterial(cache:GetResource(\"Material\",\"Materials/wound1.xml\"))\n        ds:SetMaxIndices(1024 * 100)\n        ds:SetMaxVertices(1024 * 100)\n    end\n    ds:AddDecal(result.drawable, result.position, cameraNode.rotation, 0.5, 1, 0.5, Vector2(0,0), Vector2(1,1), 0, 0.1)\nend\n\nfunction PushRay(dismember)\n    local ray = cameraNode:GetComponent(\"Camera\"):GetScreenRay(0.5,0.5)\n    local resultPhys = scene_:GetComponent(\"PhysicsWorld\"):RaycastSingle(ray, 10000)\n    \n    if resultPhys then\n        local node = resultPhys.body.node\n        if not resultPhys.body.active then\n            resultPhys.body:Activate()\n        end\n        \n        local force = 3\n        resultPhys.body:ApplyImpulse(ray.direction * force, node:WorldToLocal(resultPhys.position))\n        \n        if dismember and not node:HasTag(\"dismembered\") then\n            DismemberLimb(node)\n        end\n        --DrawDecalAt(ray)\n    end\n    \nend\n\nfunction DismemberLimb(node)\n    local constraint = node:GetComponent(\"Constraint\")\n    if constraint then\n        constraint.enabled = false\n        SeparateLimb1(node)\n    end\nend\n\nfunction SeparateLimb1(node)\n    node:AddTag(\"dismembered\") -- add tag so we dont do process this bone again\n    \n    local nodeClone = node:Clone()\n    local limbNode = scene_:CreateChild(\"limb\") -- contains the limb\n    local bodiesNode = limbNode:CreateChild(\"bodies\") -- contains rigid bodies\n    nodeClone.parent = bodiesNode\n    \n    -- ORIGINAL MODEL TWEAK\n    local children = node:GetChildrenWithComponent(\"RigidBody\",true)\n    for i=1, #children, 1 do\n        children[i]:RemoveAllComponents()\n    end\n    node:RemoveAllComponents()\n    node:SetScale(0)\n    -- END ORIGINAL MODEL TWEAK\n    \n    local skelNode = nodeClone:CreateChild(\"skeleton\") -- node that holds the skel bones\n    local am = skelNode:CreateComponent(\"AnimatedModel\") -- create the skell bones\n    local model = cache:GetResource(\"Model\", \"Models/Jack.mdl\")\n    am.model = model\n    \n    local skelBone = skelNode:GetChild(node.name, true) -- get same node as our cloned node\n    \n    local reparentNode = skelNode:CreateChild(\"reparent\") -- this is the node that stores the bones that get scaled to 0\n    \n    -- reparent\n    children = skelNode:GetChildren(false)\n    for i=1, #children, 1 do\n        children[i].parent = reparentNode\n    end\n    \n    FixSkeleton(bodiesNode, skelNode) -- Fix and assigns each new bone to it repective rigidbodied bone that was cloned (nodeClone)\n    reparentNode:SetScale(0) -- set the rest of the body to scale 0\n    skelBone.parent = skelNode -- take detached limbBone out of the reparentNode\n    \n    -- so basically in the end we probably have this \n    -- limbNode (Main node where the detached limbs resides)\n        -- bodiesNode (has the rigidbodies tha we cloned)\n            -- nodeClone (the clonned node)\n                -- skelNode\u0026lt;AnimatedModel\u0026gt; (has the new skeleton + animated model)\n                    -- skelBone (aka the actual detached limb)\n                    -- reparentNode (every bone that is not the detached limb should be here)\nend\n\nfunction FixSkeleton(bodiesNode, skelNode) -- goes through each rigidbody, gets the respective node of our new AnimatedModel that matches rigidbodies name, and set it as a child of the rigidibody, so it can follow it around. This whole process could be avoided if I could 'retarget' or 'replace' bone nodes, but since I cant, we need to grab the automatically created bone node and set it to be child of its respective 'rigidbody'\n    local bodies = bodiesNode:GetChildren()\n    for i = 1, #bodies, 1 do\n        FixSkeleton(bodies[i], skelNode)\n        local bone = skelNode:GetChild(bodies[i].name, true)\n        if bone then\n            bone.parent = bodies[i]\n            bone:SetTransform(Vector3.ZERO, Quaternion.IDENTITY)\n            bone:SetScale(1)\n        end\n    end\nend\n\nfunction MoveCamera(timeStep)\n    -- Do not move if the UI has a focused element (the console)\n    if ui.focusElement ~= nil then\n        return\n    end\n\n    -- Movement speed as world units per second\n    local MOVE_SPEED = 20.0\n    -- Mouse sensitivity as degrees per pixel\n    local MOUSE_SENSITIVITY = 0.1\n\n    -- Use this frame's mouse motion to adjust camera node yaw and pitch. Clamp the pitch between -90 and 90 degrees\n    local mouseMove = input.mouseMove\n    yaw = yaw + MOUSE_SENSITIVITY * mouseMove.x\n    pitch = pitch  +MOUSE_SENSITIVITY * mouseMove.y\n    pitch = Clamp(pitch, -90.0, 90.0)\n\n    -- Construct new orientation for the camera scene node from yaw and pitch. Roll is fixed to zero\n    cameraNode.rotation = Quaternion(pitch, yaw, 0.0)\n\n    -- Read WASD keys and move the camera scene node to the corresponding direction if they are pressed\n    if input:GetKeyDown(KEY_W) then\n        cameraNode:Translate(Vector3(0.0, 0.0, 1.0) * MOVE_SPEED * timeStep)\n    end\n    if input:GetKeyDown(KEY_S) then\n        cameraNode:Translate(Vector3(0.0, 0.0, -1.0) * MOVE_SPEED * timeStep)\n    end\n    if input:GetKeyDown(KEY_A) then\n        cameraNode:Translate(Vector3(-1.0, 0.0, 0.0) * MOVE_SPEED * timeStep)\n    end\n    if input:GetKeyDown(KEY_D) then\n        cameraNode:Translate(Vector3(1.0, 0.0, 0.0) * MOVE_SPEED * timeStep)\n    end\n\n    -- \"Shoot\" a physics object with left mousebutton\n    if input:GetMouseButtonPress(MOUSEB_LEFT) then\n        SpawnObject()\n    end\n    \n    if input:GetMouseButtonPress(MOUSEB_RIGHT) then\n        nClock = os.clock()\n        PushRay(true)\n        print(\"Elapsed time is: \" .. os.clock()-nClock)\n    end\n\n    -- Check for loading/saving the scene. Save the scene to the file Data/Scenes/Physics.xml relative to the executable\n    -- directory\n    if input:GetKeyPress(KEY_F5) then\n        scene_:SaveXML(fileSystem:GetProgramDir()..\"Data/Scenes/Ragdolls.xml\")\n    end\n    if input:GetKeyPress(KEY_F7) then\n        scene_:LoadXML(fileSystem:GetProgramDir()..\"Data/Scenes/Ragdolls.xml\")\n    end\n\n    -- Toggle debug geometry with space\n    if input:GetKeyPress(KEY_SPACE) then\n        drawDebug = not drawDebug\n    end\nend\n\nfunction SpawnObject()\n    local boxNode = scene_:CreateChild(\"Sphere\")\n    boxNode.position = cameraNode.position\n    boxNode.rotation = cameraNode.rotation\n    boxNode:SetScale(0.25)\n    local boxObject = boxNode:CreateComponent(\"StaticModel\")\n    boxObject.model = cache:GetResource(\"Model\", \"Models/Sphere.mdl\")\n    boxObject.material = cache:GetResource(\"Material\", \"Materials/StoneSmall.xml\")\n    boxObject.castShadows = true\n\n    local body = boxNode:CreateComponent(\"RigidBody\")\n    body.mass = 1.0\n    body.rollingFriction = 0.15\n    local shape = boxNode:CreateComponent(\"CollisionShape\")\n    shape:SetSphere(1.0)\n\n    local OBJECT_VELOCITY = 10.0\n\n    -- Set initial velocity for the RigidBody based on camera forward vector. Add also a slight up component\n    -- to overcome gravity better\n    body.linearVelocity = cameraNode.rotation * Vector3(0.0, 0.25, 1.0) * OBJECT_VELOCITY\nend\n\nfunction HandleUpdate(eventType, eventData)\n    -- Take the frame time step, which is stored as a float\n    local timeStep = eventData[\"TimeStep\"]:GetFloat()\n\n    -- Move the camera, scale movement with time step\n    MoveCamera(timeStep)\nend\n\nfunction HandlePostRenderUpdate(eventType, eventData)\n    -- If draw debug mode is enabled, draw physics debug geometry. Use depth test to make the result easier to interpret\n    if drawDebug then\n        renderer:DrawDebugGeometry(true)\n        scene_:GetComponent(\"PhysicsWorld\"):DrawDebugGeometry(true)\n    end\nend\n\n-- CreateRagdoll script object class\nCreateRagdoll = ScriptObject()\n\nfunction CreateRagdoll:Start()\n    -- Subscribe physics collisions that concern this scene node\n    self:SubscribeToEvent(self.node, \"NodeCollision\", \"CreateRagdoll:HandleNodeCollision\")\nend\n\nfunction CreateRagdoll:HandleNodeCollision(eventType, eventData)\n    -- Get the other colliding body, make sure it is moving (has nonzero mass)\n    local otherBody = eventData[\"OtherBody\"]:GetPtr(\"RigidBody\")\n\n    if otherBody.mass \u0026gt; 0.0 then\n        -- We do not need the physics components in the AnimatedModel's root scene node anymore\n        self.node:RemoveComponent(\"RigidBody\")\n        self.node:RemoveComponent(\"CollisionShape\")\n\n        -- Create RigidBody \u0026amp; CollisionShape components to bones\n        self:CreateRagdollBone(\"Bip01_Pelvis\", SHAPE_BOX, Vector3(0.3, 0.2, 0.25), Vector3(0.0, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 0.0))\n        self:CreateRagdollBone(\"Bip01_Spine1\", SHAPE_BOX, Vector3(0.35, 0.2, 0.3), Vector3(0.15, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 0.0))\n        self:CreateRagdollBone(\"Bip01_L_Thigh\", SHAPE_CAPSULE, Vector3(0.175, 0.45, 0.175), Vector3(0.25, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_R_Thigh\", SHAPE_CAPSULE, Vector3(0.175, 0.45, 0.175), Vector3(0.25, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_L_Calf\", SHAPE_CAPSULE, Vector3(0.15, 0.55, 0.15), Vector3(0.25, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_R_Calf\", SHAPE_CAPSULE, Vector3(0.15, 0.55, 0.15), Vector3(0.25, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_Head\", SHAPE_CAPSULE, Vector3(0.2, 0.2, 0.2), Vector3(0.1, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 0.0))\n        self:CreateRagdollBone(\"Bip01_L_UpperArm\", SHAPE_CAPSULE, Vector3(0.15, 0.35, 0.15), Vector3(0.1, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_R_UpperArm\", SHAPE_CAPSULE, Vector3(0.15, 0.35, 0.15), Vector3(0.1, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_L_Forearm\", SHAPE_CAPSULE, Vector3(0.125, 0.4, 0.125), Vector3(0.2, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_R_Forearm\", SHAPE_CAPSULE, Vector3(0.125, 0.4, 0.125), Vector3(0.2, 0.0, 0.0),\n            Quaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_L_Hand\", SHAPE_BOX, Vector3(0.1, 0.2, 0.1), Vector3(0.1, 0.0, 0.0),\n\t\t\tQuaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_R_Hand\", SHAPE_BOX, Vector3(0.1, 0.2, 0.1), Vector3(0.1, 0.0, 0.0),\n\t\t\tQuaternion(0.0, 0.0, 90.0))\n        self:CreateRagdollBone(\"Bip01_L_Foot\", SHAPE_BOX, Vector3(0.125, 0.3, 0.07), Vector3(0.1, 0.075, 0.0),\n\t\t\tQuaternion(0.0, 0.0, 0.0))\n        self:CreateRagdollBone(\"Bip01_R_Foot\", SHAPE_BOX, Vector3(0.125, 0.3, 0.07), Vector3(0.1, 0.075, 0.0),\n\t\t\tQuaternion(0.0, 0.0, 0.0))\n\n        -- Create Constraints between bones\n        self:CreateRagdollConstraint(\"Bip01_L_Thigh\", \"Bip01_Pelvis\", CONSTRAINT_CONETWIST, Vector3(0.0, 0.0, -1.0),\n            Vector3(0.0, 0.0, 1.0), Vector2(45.0, 45.0), Vector2(0.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_R_Thigh\", \"Bip01_Pelvis\", CONSTRAINT_CONETWIST, Vector3(0.0, 0.0, -1.0),\n            Vector3(0.0, 0.0, 1.0), Vector2(45.0, 45.0), Vector2(0.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_L_Calf\", \"Bip01_L_Thigh\", CONSTRAINT_HINGE, Vector3(0.0, 0.0, -1.0),\n            Vector3(0.0, 0.0, -1.0), Vector2(90.0, 0.0), Vector2(0.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_R_Calf\", \"Bip01_R_Thigh\", CONSTRAINT_HINGE, Vector3(0.0, 0.0, -1.0),\n            Vector3(0.0, 0.0, -1.0), Vector2(90.0, 0.0), Vector2(0.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_Spine1\", \"Bip01_Pelvis\", CONSTRAINT_HINGE, Vector3(0.0, 0.0, 1.0),\n            Vector3(0.0, 0.0, 1.0), Vector2(45.0, 0.0), Vector2(-10.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_Head\", \"Bip01_Spine1\", CONSTRAINT_CONETWIST, Vector3(-1.0, 0.0, 0.0),\n            Vector3(-1.0, 0.0, 0.0), Vector2(0.0, 30.0), Vector2(0.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_L_UpperArm\", \"Bip01_Spine1\", CONSTRAINT_CONETWIST, Vector3(0.0, -1.0, 0.0),\n            Vector3(0.0, 1.0, 0.0), Vector2(45.0, 45.0), Vector2(0.0, 0.0), false)\n        self:CreateRagdollConstraint(\"Bip01_R_UpperArm\", \"Bip01_Spine1\", CONSTRAINT_CONETWIST, Vector3(0.0, -1.0, 0.0),\n            Vector3(0.0, 1.0, 0.0), Vector2(45.0, 45.0), Vector2(0.0, 0.0), false)\n        self:CreateRagdollConstraint(\"Bip01_L_Forearm\", \"Bip01_L_UpperArm\", CONSTRAINT_HINGE, Vector3(0.0, 0.0, -1.0),\n            Vector3(0.0, 0.0, -1.0), Vector2(90.0, 0.0), Vector2(0.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_R_Forearm\", \"Bip01_R_UpperArm\", CONSTRAINT_HINGE, Vector3(0.0, 0.0, -1.0),\n            Vector3(0.0, 0.0, -1.0), Vector2(90.0, 0.0), Vector2(0.0, 0.0), true)\n        self:CreateRagdollConstraint(\"Bip01_L_Hand\", \"Bip01_L_Forearm\", CONSTRAINT_CONETWIST, Vector3(0.0, 0.0, -1.0), \n            Vector3(0.0, 0.0, -1.0), Vector2(45, 0), Vector2(0, 0), true);\n        self:CreateRagdollConstraint(\"Bip01_R_Hand\", \"Bip01_R_Forearm\", CONSTRAINT_CONETWIST, Vector3(0.0, 0.0, -1.0), \n            Vector3(0.0, 0.0, -1.0), Vector2(45, 0), Vector2(0, 0), true);\n        self:CreateRagdollConstraint(\"Bip01_L_Foot\", \"Bip01_L_Calf\", CONSTRAINT_CONETWIST, Vector3(0.0, 0.0, -1.0), \n            Vector3(0.0, 0.0, -1.0), Vector2(45, 0), Vector2(0, 0), true);\n        self:CreateRagdollConstraint(\"Bip01_R_Foot\", \"Bip01_R_Calf\", CONSTRAINT_CONETWIST, Vector3(0.0, 0.0, -1.0), \n            Vector3(0.0, 0.0, -1.0), Vector2(45, 0), Vector2(0, 0), true);\n\n        -- Disable keyframe animation from all bones so that they will not interfere with the ragdoll\n        local model = self.node:GetComponent(\"AnimatedModel\")\n        local skeleton = model.skeleton\n        for i = 0, skeleton.numBones - 1 do\n            skeleton:GetBone(i).animated = false\n        end\n\n        -- Finally remove self (the ScriptInstance which holds this script object) from the scene node. Note that this must\n        -- be the last operation performed in the function\n        self.instance:Remove()\n    end\nend\n\nfunction CreateRagdoll:CreateRagdollBone(boneName, type, size, position, rotation)\n    -- Find the correct child scene node recursively\n    local boneNode = self.node:GetChild(boneName, true)\n    if boneNode == nil then\n        print(\"Could not find bone \" .. boneName .. \" for creating ragdoll physics components\\n\")\n        return\n    end\n\n    local body = boneNode:CreateComponent(\"RigidBody\")\n    -- Set mass to make movable\n    body.mass = 1.0\n    body.restitution = 1\n    body.friction = 1\n    -- Set damping parameters to smooth out the motion\n    body.rollingFriction = 0.01\n    body.linearDamping = 0.05\n    body.angularDamping = 0.2\n    -- Set rest thresholds to ensure the ragdoll rigid bodies come to rest to not consume CPU endlessly\n    body.linearRestThreshold = 2\n    body.angularRestThreshold = 3\n\n    local shape = boneNode:CreateComponent(\"CollisionShape\")\n    -- We use either a box or a capsule shape for all of the bones\n    if type == SHAPE_BOX then\n        shape:SetBox(size, position, rotation)\n    else\n        shape:SetCapsule(size.x, size.y, position, rotation)\n    end\nend\n\nfunction CreateRagdoll:CreateRagdollConstraint(boneName, parentName, type, axis, parentAxis, highLimit, lowLimit, disableCollision)\n    local boneNode = self.node:GetChild(boneName, true)\n    local parentNode = self.node:GetChild(parentName, true)\n    if boneNode == nil then\n        print(\"Could not find bone \" .. boneName .. \" for creating ragdoll constraint\\n\")\n        return\n    end\n    if parentNode == nil then\n        print(\"Could not find bone \" .. parentName .. \" for creating ragdoll constraint\\n\")\n        return\n    end\n\n    local constraint = boneNode:CreateComponent(\"Constraint\")\n    constraint.constraintType = type\n    -- Most of the constraints in the ragdoll will work better when the connected bodies don't collide against each other\n    constraint.disableCollision = disableCollision\n    -- The connected body must be specified before setting the world position\n    constraint.otherBody = parentNode:GetComponent(\"RigidBody\")\n    -- Position the constraint at the child bone we are connecting\n    constraint.worldPosition = boneNode.worldPosition\n    -- Configure axes and limits\n    constraint.axis = axis\n    constraint.otherAxis = parentAxis\n    constraint.highLimit = highLimit\n    constraint.lowLimit = lowLimit\nend\n\n-- Create XML patch instructions for screen joystick layout specific to this sample app\nfunction GetScreenJoystickPatchString()\n    return\n        \"\u0026lt;patch\u0026gt;\" ..\n        \"    \u0026lt;remove sel=\\\"/element/element[./attribute[@name='Name' and @value='Button0']]/attribute[@name='Is Visible']\\\" /\u0026gt;\" ..\n        \"    \u0026lt;replace sel=\\\"/element/element[./attribute[@name='Name' and @value='Button0']]/element[./attribute[@name='Name' and @value='Label']]/attribute[@name='Text']/@value\\\"\u0026gt;Spawn\u0026lt;/replace\u0026gt;\" ..\n        \"    \u0026lt;add sel=\\\"/element/element[./attribute[@name='Name' and @value='Button0']]\\\"\u0026gt;\" ..\n        \"        \u0026lt;element type=\\\"Text\\\"\u0026gt;\" ..\n        \"            \u0026lt;attribute name=\\\"Name\\\" value=\\\"MouseButtonBinding\\\" /\u0026gt;\" ..\n        \"            \u0026lt;attribute name=\\\"Text\\\" value=\\\"LEFT\\\" /\u0026gt;\" ..\n        \"        \u0026lt;/element\u0026gt;\" ..\n        \"    \u0026lt;/add\u0026gt;\" ..\n        \"    \u0026lt;remove sel=\\\"/element/element[./attribute[@name='Name' and @value='Button1']]/attribute[@name='Is Visible']\\\" /\u0026gt;\" ..\n        \"    \u0026lt;replace sel=\\\"/element/element[./attribute[@name='Name' and @value='Button1']]/element[./attribute[@name='Name' and @value='Label']]/attribute[@name='Text']/@value\\\"\u0026gt;Debug\u0026lt;/replace\u0026gt;\" ..\n        \"    \u0026lt;add sel=\\\"/element/element[./attribute[@name='Name' and @value='Button1']]\\\"\u0026gt;\" ..\n        \"        \u0026lt;element type=\\\"Text\\\"\u0026gt;\" ..\n        \"            \u0026lt;attribute name=\\\"Name\\\" value=\\\"KeyBinding\\\" /\u0026gt;\" ..\n        \"            \u0026lt;attribute name=\\\"Text\\\" value=\\\"SPACE\\\" /\u0026gt;\" ..\n        \"        \u0026lt;/element\u0026gt;\" ..\n        \"    \u0026lt;/add\u0026gt;\" ..\n        \"\u0026lt;/patch\u0026gt;\"\nend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHow it works, let’s say I shot an Arm:\u003cbr\u003e\nPS: you will see me using the word bone and node interchangeably, because they kinda are.\u003cbr\u003e\n1- Get the node that was hit, an arm for example.\u003cbr\u003e\n2- Clone the node. This will also clone children, great.\u003cbr\u003e\n3- Remove unnecessary components from original node (rigid bodies, contraints, etc.)\u003cbr\u003e\n4- Scale original node to 0, now there is no arm.\u003cbr\u003e\n5- Reparent cloned node for a cleaner hierarchy.\u003cbr\u003e\nWhat we have so far is:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOriginal AnimatedModel without the arm, because it got scaled to 0 and has no components.\u003c/li\u003e\n\u003cli\u003eA cloned node that has no other component but the rigidbodies and constraints, therefore, no way to render it.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd this is where the dirty hack begins. The most correct way to attach geometry to the arm would be something like this:\u003cbr\u003e\n6- Create a new AnimatedModel, obvious step.\u003cbr\u003e\nNow we need the arm of this AnimatedModel to follow our cloned arm right ? in other words, we need to bind our cloned arm node to the AnimatedModel. So we would do something like\u003cbr\u003e\n7- Use a function like “ReplaceBone(originalBoneNode, newBoneNode)” that could recursively replace each original bone node of the AnimatedModel with our cloned arm bone nodes.\u003c/p\u003e\n\u003cp\u003eBut the above 2 steps did not happen exactly like that, because there is no such function that replaces a bone with another (at least not in LUA). When you create an AnimatedModel, it automatically creates the bone nodes for you, and there is no way to replace them with custom ones. So there is no way to ‘bind’ our cloned arm node to the AnimatedModel we just created…\u003cbr\u003e\nSo I had to hack this out, and the way I did it was by, pay attention: Reparenting each new bone to their respective cloned arm bone. So each new bone gets to be a child of their respective cloned arm bone.\u003c/p\u003e\n\u003cp\u003e8- Scale the rest of the body in relation to the cloned arm (the inverse of step 4), so that there is no body, but jut the arm.\u003c/p\u003e","post_number":15,"post_type":1,"updated_at":"2018-12-04T01:46:48.168Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":33,"readers_count":32,"score":16.6,"yours":false,"topic_id":4655,"topic_slug":"how-to-detach-disconnect-skinned-geometry","display_username":"lhlvieira","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1059,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[26539,26540,26541,26542,26544,26545,26546,26550,26551,26552,26553,26566,26567,26571,26752]},"timeline_lookup":[[1,1476],[12,1475],[15,1450]],"suggested_topics":[{"id":7278,"title":"Compile Urho3D With LLVM-MINGW","fancy_title":"Compile Urho3D With LLVM-MINGW","slug":"compile-urho3d-with-llvm-mingw","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-06-06T14:35:21.445Z","last_posted_at":"2022-06-17T13:40:34.662Z","bumped":true,"bumped_at":"2022-06-17T13:40:34.662Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":133,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":745,"username":"ChunFengTsin","name":"Chun Feng Tsin","avatar_template":"/user_avatar/discourse.urho3d.io/chunfengtsin/{size}/450_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":461,"username":"Victor","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/3e96dc/{size}.png"}}]},{"id":7065,"title":"Angelscript: Loading a char file into a 2D array: how?","fancy_title":"Angelscript: Loading a char file into a 2D array: how?","slug":"angelscript-loading-a-char-file-into-a-2d-array-how","posts_count":7,"reply_count":4,"highest_post_number":7,"image_url":null,"created_at":"2021-11-24T09:20:05.420Z","last_posted_at":"2021-11-28T11:19:39.689Z","bumped":true,"bumped_at":"2021-11-28T11:26:00.375Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":239,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1491,"username":"xlat","name":"Alex Kuch","avatar_template":"/user_avatar/discourse.urho3d.io/xlat/{size}/3620_2.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":983,"username":"tarzeron","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ecae2f/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7098,"title":"Cartoon Fire Effect","fancy_title":"Cartoon Fire Effect","slug":"cartoon-fire-effect","posts_count":6,"reply_count":0,"highest_post_number":6,"image_url":null,"created_at":"2021-12-10T04:08:49.887Z","last_posted_at":"2021-12-12T02:49:51.076Z","bumped":true,"bumped_at":"2021-12-12T02:49:51.076Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":274,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7204,"title":"How handle with multiple scenes?","fancy_title":"How handle with multiple scenes?","slug":"how-handle-with-multiple-scenes","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-02-23T16:15:02.697Z","last_posted_at":"2022-02-23T16:15:02.762Z","bumped":true,"bumped_at":"2022-02-23T16:15:02.762Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":131,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1508,"username":"killinbassou","name":"killin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/848f3c/{size}.png"}}]},{"id":7284,"title":"[Solved] Moving a Navigation Mesh","fancy_title":"[Solved] Moving a Navigation Mesh","slug":"solved-moving-a-navigation-mesh","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-06-20T20:10:14.786Z","last_posted_at":"2022-06-21T21:25:22.088Z","bumped":true,"bumped_at":"2022-06-21T21:25:22.088Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":138,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":null,"description":"Original Poster, Accepted Answer","user":{"id":1228,"username":"PsychoCircuitry","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/p/a9a28c/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]}],"tags_descriptions":{},"id":4655,"title":"How to detach/disconnect skinned geometry?","fancy_title":"How to detach/disconnect skinned geometry?","posts_count":15,"created_at":"2018-11-07T21:10:25.874Z","views":991,"reply_count":9,"like_count":2,"last_posted_at":"2018-12-04T01:43:57.619Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"how-to-detach-disconnect-skinned-geometry","category_id":10,"word_count":6280,"deleted_at":null,"user_id":1059,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_4655","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":15,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":4,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":584,"username":"orefkov","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/orefkov/{size}/1164_2.png","post_count":6,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":1059,"username":"lhlvieira","name":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png","post_count":6,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":669,"username":"Sinoid","name":"Jonathan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/{size}.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":863,"username":"fnadalt","name":"Fernando Nadal Testa","avatar_template":"/user_avatar/discourse.urho3d.io/fnadalt/{size}/2113_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":1059,"username":"lhlvieira","name":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png"},"last_poster":{"id":1059,"username":"lhlvieira","name":"lhlvieira","avatar_template":"/user_avatar/discourse.urho3d.io/lhlvieira/{size}/1832_2.png"},"links":[{"url":"https://www.panda3d.org/manual/index.php/Multi-Part_Actors","title":"Multi-Part Actors - Panda3D Manual","internal":false,"attachment":false,"reflection":false,"clicks":13,"user_id":863,"domain":"www.panda3d.org","root_domain":"panda3d.org"},{"url":"https://discourse.urho3d.io/t/models-dissolving-like-doom-3/1625","title":"Models dissolving like Doom 3","internal":true,"attachment":false,"reflection":false,"clicks":8,"user_id":584,"domain":"discourse.urho3d.io","root_domain":"urho3d.io"},{"url":"https://www.youtube.com/watch?v=SmR_Xa-_Cgs","title":"YouTube","internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":584,"domain":"www.youtube.com","root_domain":"youtube.com"}]}}