{"post_stream":{"posts":[{"id":39403,"name":"SirNate0","username":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","created_at":"2020-10-26T22:52:21.226Z","cooked":"\u003cp\u003eAs you may know, Euler angles are one way to represent a rotation, by specifying rotation angles around the X, Y, and Z axes, and then applying all 3 of those rotations. As rotations are not commutative, the different order of you X, Y, and Z rotations form different sets of Euler angles for the same rotation. Urho3D implements one such ordering, but because of how I was forming some rotations in a project of mine, I needed a different decomposition. As such, I wrote some code to give you all 6 possible Euler angles (the permutations of [X,Y,Z]). Though rotations can also be given as a rotation around X, then around Y, then around X again, for example, this latter form I did not handle (however, I include the python code used to generate the C++ code, so those could be added if you had a use for it - just install the cogapp with PIP to use the code generation).\u003c/p\u003e\n\u003cp\u003eAs you can see, I don‚Äôt specially handle the Gimble-lock sort of cases as the normal code does except for the one ordering that I needed. That said, here‚Äôs the actual code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-cpp\"\u003e// QuaternionRotation.h\n\n#pragma once\n\n#include \u0026lt;Urho3D/Math/Quaternion.h\u0026gt;\n#include \u0026lt;array\u0026gt;\n\nstd::array\u0026lt;Urho3D::Vector3,6\u0026gt; AllEulerAngles(const Urho3D::Quaternion\u0026amp; q);\n\nUrho3D::Vector3 EulerAnglesYXZ(const Urho3D::Quaternion\u0026amp; q);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"lang-cpp\"\u003e// QuaternionRotation.cpp\n#include \"QuaternionRotation.h\"\n\nusing namespace Urho3D;\n\nstd::array\u0026lt;Urho3D::Vector3,6\u0026gt; AllEulerAngles(const Urho3D::Quaternion\u0026amp; q)\n{\n    return {\n\n/*[[[cog\n#!/bin/python3\n\nfrom numpy import *\nfrom sympy import *\n#q = [q0, iq1, jq2, kq3]\n\nq0,q1,q2,q3 = symbols('q0 q1 q2 q3')\nq0,q1,q2,q3 = symbols('q.w_ q.x_ q.y_ q.z_')\ninit_printing()\n\nq = [q0,q1,q2,q3]\nqi = q[1:]\n\nR = diag(*(q0**2+sum([qx**2 * (1 if i == j else -1) for i,qx in enumerate(qi)]) for j in range(3)))\n\nfor i in range(3):\n    for j in range(3):\n        if i==j:\n            continue\n        k = [0,1,2]\n        k.remove(i)\n        k.remove(j)\n        k = k[0]\n        sgn = 1 if (i+j)%2 == 0 else -1\n        sgn *= -1 if i \u0026gt; j else 1\n        var = 2*(qi[i]*qi[j] + sgn*q0*qi[k])\n        R[i,j] = var\n\npprint(R)\n\n# that was the homogeneous R\n# for inhomogeneous R\nR = R + eye(3) * (1 - sum(dot(q,q)))\n\na,b,c = symbols('a b c')\n\nRx,Ry,Rz = [rot_axis1(-a),rot_axis2(-b),rot_axis3(-c)]\n\neuler = [Rx,Ry,Rz]\n\nfor r in [Rx,Ry,Rz]:\n    pprint(r)\n    \nfrom itertools import permutations\n\norder = list(range(3))\ntriples = list(permutations(order))\ndoubles = list(permutations(order,2))\n\nprint(triples)\n\nsines = {s*sin(ang):(ang,s,angidx) for angidx,ang in enumerate([a,b,c]) for s in [-1,1]}\ndef findSine(mat):\n    for i,m in enumerate(mat):\n        if m in sines:\n            return unravel_index(i,mat.shape),sines[m]\n\ntoEulerWithOrder = {}\ntoEulerWithOrderCpp = {}\n\nfor o in triples:\n    xyz = ''.join('xyz'[i] for i in o)\n    print(xyz)\n    Rorder = [euler[i] for i in o]\n    Re = prod(Rorder) # prod([A,B,C]) = A*B*C and not C*B*A\n    pprint(Re)\n    fs = findSine(Re)\n    sineRowCol,(angle,signOfSine, angIdx) = fs\n    print(fs)\n    pprint(R[sineRowCol])\n    \n    # We have found the sine(angle_i)\n    # Now we grab the row and column of the matrix excluding that element to calculate the angles _j and _k\n    # angle_j is from the side with no j index and angle_k is from the side with no _k idx. I.e. angle_i would come from the matrix column if C==i\n    # the cosine is from the diagonal, and the sine is the other element. Both are multiplied by cos(angle_i).\n    allI = {0,1,2} # a set\n    Row,C = sineRowCol\n    #Rcs = allI - {C}\n    #Crs = allI - {R}\n    offDiag = (allI - {Row,C}).pop()\n    \n    # Column\n    Cdiag = (C,C)\n    CoffDiag = (offDiag,C)\n    Cangle = [a,b,c][Row]\n    Cangle_i = Row\n    Ccos = R[Cdiag]\n    Csin = R[CoffDiag]\n    \n    print(Cangle,Cangle_i)\n    pprint(Csin)\n    pprint(Ccos)\n    \n    # Row\n    Rdiag = (Row,Row)\n    RoffDiag = (Row,offDiag)\n    Rangle = [a,b,c][C]\n    Rangle_i = C\n    Rcos = R[Rdiag]\n    Rsin = R[RoffDiag]\n    \n    print(Rangle,Rangle_i)\n    pprint(Rsin)\n    pprint(Rcos)\n    \n    # Construct vector of euler angles\n    ea = [0]*3\n    ea[angIdx] = signOfSine * asin(R[sineRowCol])\n    ea[Rangle_i] = atan2(Rsin,Rcos)#*signOfSine\n    ea[Cangle_i] = atan2(Csin,Ccos)#*signOfSine\n    \n    pprint(ea)\n    print(python(ea))\n    print(ccode(ea))\n    \n    def urho(vec):\n        import re\n        out = []\n        for v in vec:\n            c = ccode(v)\n            cpp=re.sub(r'pow\\(([^,]+), 2\\)',r'\\1*\\1',c)\n            cpp = cpp.replace('atan2','Atan2').replace('asin','Asin')\n            #cpp = re.sub(r'q(\\d)','q[\\d]')\n            out.append(cpp)\n        return out\n    print(urho(ea))\n    \n    toEulerWithOrder[xyz] = ea\n    toEulerWithOrderCpp[xyz] = urho(ea)\n    \n    print('')\n    \n    print('')\n\npprint(R)\n\nprint(toEulerWithOrder)\n\n\n# confirm ordering\n#print(prod([diag(1,0),Matrix([[0,1],[1,0]]),Matrix([[1,2],[3,4]])][::-1]))\n#print(prod([diag(1,0),Matrix([[0,1],[1,0]]),Matrix([[1,2],[3,4]])]))\n#print(diag(1,0)*Matrix([[0,1],[1,0]])*Matrix([[1,2],[3,4]]))\n\n#print(findSine(Re))\n#pprint(Re)\n\nfor order in toEulerWithOrderCpp:\n    cog.outl(f'//{order}')\n    val = ', '.join(toEulerWithOrderCpp[order])\n    cog.outl(f'Vector3({val}),')\n]]]*/\n//xyz\nVector3(Atan2(-2*q.w_*q.x_ + 2*q.y_*q.z_, -2*q.x_*q.x_ - 2*q.y_*q.y_ + 1), Asin(2*q.w_*q.y_ + 2*q.x_*q.z_), Atan2(-2*q.w_*q.z_ + 2*q.x_*q.y_, -2*q.y_*q.y_ - 2*q.z_*q.z_ + 1)),\n//xzy\nVector3(Atan2(2*q.w_*q.x_ + 2*q.y_*q.z_, -2*q.x_*q.x_ - 2*q.z_*q.z_ + 1), Atan2(2*q.w_*q.y_ + 2*q.x_*q.z_, -2*q.y_*q.y_ - 2*q.z_*q.z_ + 1), Asin(2*q.w_*q.z_ - 2*q.x_*q.y_)),\n//yxz\nVector3(Asin(2*q.w_*q.x_ - 2*q.y_*q.z_), Atan2(2*q.w_*q.y_ + 2*q.x_*q.z_, -2*q.x_*q.x_ - 2*q.y_*q.y_ + 1), Atan2(2*q.w_*q.z_ + 2*q.x_*q.y_, -2*q.x_*q.x_ - 2*q.z_*q.z_ + 1)),\n//yzx\nVector3(Atan2(-2*q.w_*q.x_ + 2*q.y_*q.z_, -2*q.x_*q.x_ - 2*q.z_*q.z_ + 1), Atan2(-2*q.w_*q.y_ + 2*q.x_*q.z_, -2*q.y_*q.y_ - 2*q.z_*q.z_ + 1), Asin(2*q.w_*q.z_ + 2*q.x_*q.y_)),\n//zxy\nVector3(Asin(2*q.w_*q.x_ + 2*q.y_*q.z_), Atan2(-2*q.w_*q.y_ + 2*q.x_*q.z_, -2*q.x_*q.x_ - 2*q.y_*q.y_ + 1), Atan2(-2*q.w_*q.z_ + 2*q.x_*q.y_, -2*q.x_*q.x_ - 2*q.z_*q.z_ + 1)),\n//zyx\nVector3(Atan2(2*q.w_*q.x_ + 2*q.y_*q.z_, -2*q.x_*q.x_ - 2*q.y_*q.y_ + 1), Asin(2*q.w_*q.y_ - 2*q.x_*q.z_), Atan2(2*q.w_*q.z_ + 2*q.x_*q.y_, -2*q.y_*q.y_ - 2*q.z_*q.z_ + 1)),\n//[[[end]]]\n    };\n}\n\nVector3 EulerAnglesYXZ(const Quaternion \u0026amp;q)\n{\n    float sine = 2*q.w_*q.x_ - 2*q.y_*q.z_;\n    if (sine \u0026gt; 0.9995f)\n        return Vector3(90,\n                       0,\n                       Atan2(2*q.w_*q.z_ + 2*q.x_*q.y_, -2*q.x_*q.x_ - 2*q.z_*q.z_ + 1)\n                    );\n    else if (sine \u0026lt; -0.9995f)\n        return Vector3(-90,\n                       0,\n                       -Atan2(2*q.w_*q.z_ + 2*q.x_*q.y_, -2*q.x_*q.x_ - 2*q.z_*q.z_ + 1)\n                    );\n    return Vector3(Asin(sine),\n                   Atan2(2*q.w_*q.y_ + 2*q.x_*q.z_, -2*q.x_*q.x_ - 2*q.y_*q.y_ + 1),\n                   Atan2(2*q.w_*q.z_ + 2*q.x_*q.y_, -2*q.x_*q.x_ - 2*q.z_*q.z_ + 1));\n}\n\u003c/code\u003e\u003c/pre\u003e","post_number":1,"post_type":1,"updated_at":"2020-10-26T22:52:21.226Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":4,"reads":34,"readers_count":33,"score":86.8,"yours":false,"topic_id":6462,"topic_slug":"other-euler-angles","display_username":"SirNate0","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":2}],"moderator":false,"admin":false,"staff":false,"user_id":628,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[39403]},"timeline_lookup":[[1,757]],"suggested_topics":[{"id":7120,"title":"Log Error Once Macro","fancy_title":"Log Error Once Macro","slug":"log-error-once-macro","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-01-04T02:24:37.857Z","last_posted_at":"2022-01-04T02:24:37.925Z","bumped":true,"bumped_at":"2022-01-04T02:24:37.925Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":143,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7099,"title":":fallen_leaf: Polynomials \u0026 Harmonics","fancy_title":":fallen_leaf: Polynomials \u0026amp; Harmonics","slug":"polynomials-harmonics","posts_count":6,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2021-12-13T05:06:04.641Z","last_posted_at":"2021-12-27T23:27:39.489Z","bumped":true,"bumped_at":"2021-12-27T23:27:39.489Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"üçÇ Polynomials \u0026 Harmonics","tags_descriptions":{},"like_count":6,"views":392,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7103,"title":":test_tube: DebugRenderer as GUI","fancy_title":":test_tube: DebugRenderer as GUI","slug":"debugrenderer-as-gui","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-17T02:25:06.606Z","last_posted_at":"2021-12-18T01:09:27.738Z","bumped":true,"bumped_at":"2021-12-18T01:09:27.738Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"üß™ DebugRenderer as GUI","tags_descriptions":{},"like_count":4,"views":267,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7110,"title":"Resource fetch define","fancy_title":"Resource fetch define","slug":"resource-fetch-define","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-27T12:28:55.126Z","last_posted_at":"2021-12-27T17:00:37.699Z","bumped":true,"bumped_at":"2021-12-27T17:00:37.699Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":7,"views":184,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}}]},{"id":7290,"title":"Using HDR skies in scenes?","fancy_title":"Using HDR skies in scenes?","slug":"using-hdr-skies-in-scenes","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-07-01T22:10:02.015Z","last_posted_at":"2022-07-02T02:10:20.785Z","bumped":true,"bumped_at":"2022-07-02T02:10:20.785Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":133,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1529,"username":"hunkalloc","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/hunkalloc/{size}/3817_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":6462,"title":"Other Euler Angles","fancy_title":"Other Euler Angles","posts_count":1,"created_at":"2020-10-26T22:52:21.125Z","views":336,"reply_count":0,"like_count":2,"last_posted_at":"2020-10-26T22:52:21.226Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"other-euler-angles","category_id":13,"word_count":1314,"deleted_at":null,"user_id":628,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_6462","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":1,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"},"last_poster":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}}