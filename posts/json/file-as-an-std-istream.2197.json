{"post_stream":{"posts":[{"id":13330,"name":"Sir Nate","username":"Sir_Nate","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ba9def/{size}.png","created_at":"2016-08-22T00:53:30.000Z","cooked":"\u003cp\u003eI needed to use an Urho3D::File (for resource cache support) as an std::istream (for a 3rd party library). This seems to work (though I’ve not thoroughly tested it)\u003cbr\u003e\nFileStream.hpp\u003c/p\u003e\n\u003cp\u003e[code]\u003cspan class=\"hashtag\"\u003e#pragma\u003c/span\u003e once\u003c/p\u003e\n\u003cp\u003e//based on \u003ca href=\"http://www.mr-edd.co.uk/blog/beginners_guide_streambuf\" rel=\"nofollow noopener\"\u003ehttp://www.mr-edd.co.uk/blog/beginners_guide_streambuf\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e \u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e \u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e \u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e \u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e \u0026lt;IO/Deserializer.h\u0026gt;\u003c/p\u003e\n\u003cp\u003eclass FileStream : public std::streambuf\u003cbr\u003e\n{\u003cbr\u003e\npublic:\u003cbr\u003e\nexplicit FileStream(Urho3D::Deserializer \u0026amp;src, std::size_t buff_sz = 256, std::size_t put_back = 8);\u003cbr\u003e\nvirtual ~FileStream() {};\u003cbr\u003e\nprivate:\u003cbr\u003e\n// overrides base class underflow()\u003cbr\u003e\nint_type underflow();\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    // copy ctor and assignment not implemented;\n    // copying not allowed\n    FileStream(const FileStream \u0026amp;);\n    FileStream \u0026amp;operator= (const FileStream \u0026amp;);\n\nprivate:\n    Urho3D::Deserializer\u0026amp; src_;\n    const std::size_t put_back_;\n    std::vector\u0026lt;char\u0026gt; buffer_;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e};\u003cbr\u003e\n[/code]\u003c/p\u003e\n\u003cp\u003eFileStream.cpp\u003c/p\u003e\n\u003cp\u003e[code]\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e “FileStream.hpp”\u003c/p\u003e\n\u003cp\u003e#include \u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e \u003c/p\u003e\n\u003cp\u003eusing std::size_t;\u003c/p\u003e\n\u003cp\u003eFileStream::FileStream(Urho3D::Deserializer \u0026amp;src, size_t buff_sz, size_t put_back) :\u003cbr\u003e\nsrc_(src),\u003cbr\u003e\nput_back_(std::max(put_back, size_t(1))),\u003cbr\u003e\nbuffer_(std::max(buff_sz, put_back_) + put_back_)\u003cbr\u003e\n{\u003cbr\u003e\nchar *end = \u0026amp;buffer_.front() + buffer_.size();\u003cbr\u003e\nsetg(end, end, end);\u003cbr\u003e\n}\u003c/p\u003e\n\u003cp\u003estd::streambuf::int_type FileStream::underflow()\u003cbr\u003e\n{\u003cbr\u003e\nif (gptr() \u0026lt; egptr()) // buffer not exhausted\u003cbr\u003e\nreturn traits_type::to_int_type(*gptr());\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003echar *base = \u0026amp;buffer_.front();\nchar *start = base;\n\nif (eback() == base) // true when this isn't the first fill\n{\n    // Make arrangements for putback characters\n    std::memmove(base, egptr() - put_back_, put_back_);\n    start += put_back_;\n}\n\n// start is now the start of the buffer, proper.\n// Read from fptr_ in to the provided buffer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e//    size_t n = std::fread(start, 1, buffer_.size() - (start - base), fptr_);\u003cbr\u003e\nunsigned n = src_.Read(start,buffer_.size() - (start - base));\u003cbr\u003e\nif (n == 0)\u003cbr\u003e\nreturn traits_type::eof();\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// Set buffer pointers\nsetg(base, start, start + n);\n\nreturn traits_type::to_int_type(*gptr());\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}\u003cbr\u003e\n[/code].\u003cbr\u003e\nYou can then create an istream like:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\n    File f(context_,filename,FILE_READ);\n    FileStream fs(f);\n    std::istream is(\u0026amp;fs);\u003c/code\u003e\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:13:51.899Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":20,"reads":12,"readers_count":11,"score":102.4,"yours":false,"topic_id":2197,"topic_slug":"file-as-an-std-istream","display_username":"Sir Nate","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://www.mr-edd.co.uk/blog/beginners_guide_streambuf","internal":false,"reflection":false,"title":"500 – Internal Server Error","clicks":1},{"url":"http://discourse.urho3d.io/t/read-csv-as-urho3d-file-to-2d-array/2698/3","internal":true,"reflection":true,"title":"Read CSV as Urho3D File to 2d array","clicks":1},{"url":"http://discourse.urho3d.io/t/c-style-file-from-urho3d-file/3000","internal":true,"reflection":true,"title":"C style FILE* from Urho3D::File*?","clicks":1}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":242,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[13330]},"timeline_lookup":[[1,2284]],"suggested_topics":[{"id":7099,"title":":fallen_leaf: Polynomials \u0026 Harmonics","fancy_title":":fallen_leaf: Polynomials \u0026amp; Harmonics","slug":"polynomials-harmonics","posts_count":6,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2021-12-13T05:06:04.641Z","last_posted_at":"2021-12-27T23:27:39.489Z","bumped":true,"bumped_at":"2021-12-27T23:27:39.489Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"🍂 Polynomials \u0026 Harmonics","tags_descriptions":{},"like_count":6,"views":392,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7103,"title":":test_tube: DebugRenderer as GUI","fancy_title":":test_tube: DebugRenderer as GUI","slug":"debugrenderer-as-gui","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-17T02:25:06.606Z","last_posted_at":"2021-12-18T01:09:27.738Z","bumped":true,"bumped_at":"2021-12-18T01:09:27.738Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"unicode_title":"🧪 DebugRenderer as GUI","tags_descriptions":{},"like_count":4,"views":267,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7110,"title":"Resource fetch define","fancy_title":"Resource fetch define","slug":"resource-fetch-define","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-27T12:28:55.126Z","last_posted_at":"2021-12-27T17:00:37.699Z","bumped":true,"bumped_at":"2021-12-27T17:00:37.699Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":7,"views":184,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}}]},{"id":7120,"title":"Log Error Once Macro","fancy_title":"Log Error Once Macro","slug":"log-error-once-macro","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-01-04T02:24:37.857Z","last_posted_at":"2022-01-04T02:24:37.925Z","bumped":true,"bumped_at":"2022-01-04T02:24:37.925Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":143,"category_id":13,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7129,"title":"Best Model Import Pipeline as of Jan 2022?","fancy_title":"Best Model Import Pipeline as of Jan 2022?","slug":"best-model-import-pipeline-as-of-jan-2022","posts_count":7,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2022-01-17T09:27:23.432Z","last_posted_at":"2022-01-17T20:37:59.458Z","bumped":true,"bumped_at":"2022-01-17T20:37:59.458Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":170,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}}]}],"tags_descriptions":{},"id":2197,"title":"File as an std::istream","fancy_title":"File as an std::istream","posts_count":1,"created_at":"2016-08-22T00:53:30.000Z","views":620,"reply_count":0,"like_count":0,"last_posted_at":"2016-08-22T00:53:30.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"file-as-an-std-istream","category_id":13,"word_count":284,"deleted_at":null,"user_id":242,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_2197","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":1,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":242,"username":"Sir_Nate","name":"Sir Nate","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ba9def/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":242,"username":"Sir_Nate","name":"Sir Nate","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ba9def/{size}.png"},"last_poster":{"id":242,"username":"Sir_Nate","name":"Sir Nate","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/ba9def/{size}.png"},"links":[{"url":"http://discourse.urho3d.io/t/c-style-file-from-urho3d-file/3000","title":"C style FILE* from Urho3D::File*?","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":278,"domain":"discourse.urho3d.io","root_domain":"urho3d.io"},{"url":"http://discourse.urho3d.io/t/read-csv-as-urho3d-file-to-2d-array/2698/3","title":"Read CSV as Urho3D File to 2d array","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":628,"domain":"discourse.urho3d.io","root_domain":"urho3d.io"},{"url":"http://www.mr-edd.co.uk/blog/beginners_guide_streambuf","title":"500 – Internal Server Error","internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":242,"domain":"www.mr-edd.co.uk","root_domain":"mr-edd.co.uk"}]}}