{"post_stream":{"posts":[{"id":367,"name":"","username":"Andy51","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/90ced4/{size}.png","created_at":"2014-02-11T13:08:11.000Z","cooked":"\u003cp\u003eHi again everyone!\u003c/p\u003e\n\u003cp\u003eToday I was trying to develop some scripted component with FSM inside. Everything went great if not for some strange bug causing FSM to stop, and eventually I found that two of my events are handled concurrently in the script.\u003cbr\u003e\nI was expecting that events should be handled sequently, queued in the object, but seems like that’s not the case. Here’s what happening:\u003cbr\u003e\nEvent1 is sent to the script from another entity in FixedUpdate\u003cbr\u003e\nWhile Event1 is being handled, a timer method fires from DelayedExecute (initiated from the same script) and throws Event2 to self for FSM input. But it actually seems to be handled concurrently to Event1, producing most unexpected results in FSM.\u003c/p\u003e\n\u003cp\u003eI am not familiar with internal engine cycle, so does that mean that Update and FixedUpdate run in separate threads?\u003cbr\u003e\nAnd how do i solve the concurrency issue in my case?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T00:57:54.569Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":41,"reads":17,"readers_count":16,"score":208.4,"yours":false,"topic_id":89,"topic_slug":"event-handler-concurrency","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://discourse.urho3d.io/t/scene-management/1994/8","internal":true,"reflection":true,"title":"Scene management","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":43,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":370,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-11T15:58:15.000Z","cooked":"\u003cp\u003eThink of events as immediate function calls, which may be nested. Update() \u0026amp; FixedUpdate() both run in the main thread and there shouldn’t be actual concurrency. ScriptInstance’s scene update event handling (which is responsible for Update() being called) proceeds in the following order:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eExecute delayed calls whose timer has expired\u003c/li\u003e\n\u003cli\u003eCall script object’s DelayedStart() method if necessary\u003c/li\u003e\n\u003cli\u003eCall script object’s Update() method\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFixedUpdate() comes after that, along with the physics world simulation steps (on some engine frames there may be none, when rendering FPS is above physics FPS.)\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T00:57:54.774Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":89,"topic_slug":"event-handler-concurrency","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":372,"name":"","username":"Andy51","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/90ced4/{size}.png","created_at":"2014-02-11T16:36:38.000Z","cooked":"\u003cp\u003eOh, i just found that i was actually invoking SendEvent from one of the event handlers, that explains the concurrency effect. But i still cannot agree that sending event will interrupt the current flow to process the handler (especially when sending events to self) is expected behavior. I foresee a huge amount of frustration with a newbies like myself over such nested calls and related bugs. This would definitely cause issues in multithreaded setups also.\u003cbr\u003e\nAnyway, thanks for the quick reply with the newb questions again \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e Now i have to think of the other way to somehow organize a queue of events to feed to FSM without relying on native events system…\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T00:57:54.912Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":89,"topic_slug":"event-handler-concurrency","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":43,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":373,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-11T17:22:18.000Z","cooked":"\u003cp\u003eExecuting the entire engine frame is based on nested events, as is much of the UI functionality. So having script object event handlers not be nested would require a queuing mechanism and make it behave differently than the rest of the engine, which also would be confusing.\u003c/p\u003e\n\u003cp\u003eCreating your own “game event” system sounds like a solid approach. I think you might be able to use DelayedExecute() with 0 delay, as those are always queued to the next scene update event.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T00:57:54.971Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":12,"readers_count":11,"score":7.4,"yours":false,"topic_id":89,"topic_slug":"event-handler-concurrency","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":375,"name":"","username":"Andy51","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/90ced4/{size}.png","created_at":"2014-02-11T18:43:03.000Z","cooked":"\u003cp\u003eOk, thank you! My FSM finally works alright. Though i believe it would be great to introduce a convenient timer interface…\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T00:57:55.112Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":11,"readers_count":10,"score":2.2,"yours":false,"topic_id":89,"topic_slug":"event-handler-concurrency","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":43,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[367,370,372,373,375]},"timeline_lookup":[[1,3207],[5,3206]],"suggested_topics":[{"id":7086,"title":"Handling CrowdAgents that get stuck","fancy_title":"Handling CrowdAgents that get stuck","slug":"handling-crowdagents-that-get-stuck","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-04T01:26:23.062Z","last_posted_at":"2021-12-05T04:37:54.143Z","bumped":true,"bumped_at":"2021-12-05T04:37:54.143Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7104,"title":"Bug in my partial-model copying code","fancy_title":"Bug in my partial-model copying code","slug":"bug-in-my-partial-model-copying-code","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/5367e370779d64989e5c3ff2c1ebfb0689908c87.png","created_at":"2021-12-17T03:50:19.405Z","last_posted_at":"2021-12-17T13:50:49.662Z","bumped":true,"bumped_at":"2021-12-17T13:50:49.662Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":144,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7087,"title":"Android how to get error message sometimes little change gives me just crash","fancy_title":"Android how to get error message sometimes little change gives me just crash","slug":"android-how-to-get-error-message-sometimes-little-change-gives-me-just-crash","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-05T16:59:59.376Z","last_posted_at":"2021-12-05T18:17:02.335Z","bumped":true,"bumped_at":"2021-12-05T18:17:02.335Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":153,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1436,"username":"Maco","name":"Maco","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/90ced4/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]},{"id":7129,"title":"Best Model Import Pipeline as of Jan 2022?","fancy_title":"Best Model Import Pipeline as of Jan 2022?","slug":"best-model-import-pipeline-as-of-jan-2022","posts_count":7,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2022-01-17T09:27:23.432Z","last_posted_at":"2022-01-17T20:37:59.458Z","bumped":true,"bumped_at":"2022-01-17T20:37:59.458Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":170,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}}]},{"id":7160,"title":"RayCast trouble","fancy_title":"RayCast trouble","slug":"raycast-trouble","posts_count":17,"reply_count":9,"highest_post_number":19,"image_url":null,"created_at":"2022-01-29T00:06:00.367Z","last_posted_at":"2022-01-30T00:29:39.356Z","bumped":true,"bumped_at":"2022-01-30T00:29:39.356Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":260,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":627,"username":"George1","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/9e8a1a/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]}],"tags_descriptions":{},"id":89,"title":"Event handler concurrency","fancy_title":"Event handler concurrency","posts_count":5,"created_at":"2014-02-11T13:08:11.000Z","views":500,"reply_count":0,"like_count":0,"last_posted_at":"2014-02-11T18:43:03.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"event-handler-concurrency","category_id":10,"word_count":456,"deleted_at":null,"user_id":43,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_89","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":5,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":43,"username":"Andy51","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/90ced4/{size}.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2}],"created_by":{"id":43,"username":"Andy51","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/90ced4/{size}.png"},"last_poster":{"id":43,"username":"Andy51","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/90ced4/{size}.png"}}}