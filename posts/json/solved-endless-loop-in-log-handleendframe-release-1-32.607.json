{"post_stream":{"posts":[{"id":3339,"name":"","username":"Stymgade","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/839c29/{size}.png","created_at":"2014-12-01T17:42:27.000Z","cooked":"\u003cp\u003eThis is actually a two-parter: I made a test .exe that does nothing but do the ‘Hello World’ without using the Sample class - this works perfectly fine.\u003c/p\u003e\n\u003cp\u003eMy existing design  (migrating from Ogre) has 3 binaries involved:\u003cbr\u003e\n[ul]\u003cbr\u003e\n[li]The main exe, which calls a GraphicsEngine::Run[/li]\u003cbr\u003e\n[li]The Urho3D ‘Interaction’ dll, which contains the class inheriting from Urho3D::Application[/li]\u003cbr\u003e\n[li]The dll where the bulk of the code resides, which contains the GraphicsEngine class, and which creates the Urho3D::Application subclass.[/li][/ul]\u003c/p\u003e\n\u003cp\u003eUsing the exact code from the test exe, putting it into the aforementioned dll (and exporting it), and running the application, results in an endless loop due to it apparently not being the ‘main thread’ (I’ve created no threads in my own code at this stage). I can post code if this isn’t clear, which I don’t think it is  \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/smiley.png?v=5\" title=\":smiley:\" class=\"emoji\" alt=\":smiley:\"\u003e\u003c/p\u003e\n\u003cp\u003eWhich results my main question: Why does it not register as a main thread, or how can I make it do so? I had a quick look over the documentation but could only see the multithreading reference.\u003c/p\u003e\n\u003cp\u003eThis leads onto the problem in the actual code:\u003c/p\u003e\n\u003cp\u003eLine 252 in Log.cpp:\u003c/p\u003e\n\u003cp\u003e[code]void Log::HandleEndFrame(StringHash eventType, VariantMap\u0026amp; eventData)\u003cbr\u003e\n{\u003cbr\u003e\nMutexLock lock(logMutex_);\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// Process messages accumulated from other threads (if any)\nwhile (!threadMessages_.Empty())\t\n{\n    const StoredLogMessage\u0026amp; stored = threadMessages_.Front();\n    \n    if (stored.level_ != LOG_RAW)\n        Write(stored.level_, stored.message_);\n    else\n        WriteRaw(stored.message_, stored.error_);\n    \n    threadMessages_.PopFront();\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}[/code]\u003cbr\u003e\nThis obviously pops off one message each time, decrementing the total - fair enough.\u003c/p\u003e\n\u003cp\u003eThe problem is in the called Log::Write, line 132:\u003c/p\u003e\n\u003cp\u003e[code]void Log::Write(int level, const String\u0026amp; message)\u003cbr\u003e\n{\u003cbr\u003e\nassert(level \u0026gt;= LOG_DEBUG \u0026amp;\u0026amp; level \u0026lt; LOG_NONE);\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// If not in the main thread, store message for later processing\nif (!Thread::IsMainThread())\n{\n    if (logInstance)\n    {\n        MutexLock lock(logInstance-\u0026gt;logMutex_);\n        logInstance-\u0026gt;threadMessages_.Push(StoredLogMessage(message, level, false));\n    }\n    \n    return;\n}\n...[/code]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf it’s not the main thread, and logInstance is valid, the log entry gets pushed back onto the list. This results in the endless loop I was encountering. I’m only getting this due to the incorrect main thread assignment (which I’d appreciate for how to fix!), but it’s clearly possible to result in the endless loop in other situations.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:01:38.756Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":5,"reads":4,"readers_count":3,"score":25.8,"yours":false,"topic_id":607,"topic_slug":"solved-endless-loop-in-log-handleendframe-release-1-32","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":169,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":3344,"name":"","username":"Stymgade","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/839c29/{size}.png","created_at":"2014-12-02T00:07:49.000Z","cooked":"\u003cp\u003eOk, after much debugging I found the issue: crossing DLL boundaries.\u003c/p\u003e\n\u003cp\u003eIt seems the second it entered any function within the DLL, the mainThreadID was 0, hence triggering the invalid main thread - despite the fact the same compiler was used for all projects, and to compile the engine itself. The answers here provide a decent explanation: \u003ca href=\"http://stackoverflow.com/questions/22797418/how-do-i-safely-pass-objects-especially-stl-objects-to-and-from-a-dll\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003ehttp://stackoverflow.com/questions/22797418/how-do-i-safely-pass-objects-especially-stl-objects-to-and-from-a-dll\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eLuckily, I have no real need to have it in a separate DLL, so I’ve just converted the project to a static library and am linking to it with the main exe as a workaround.\u003c/p\u003e\n\u003cp\u003eThe potential for the endless loop still exists however, so I’ll add it to the issue tracker separately.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:01:39.159Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":3,"readers_count":2,"score":0.6,"yours":false,"topic_id":607,"topic_slug":"solved-endless-loop-in-log-handleendframe-release-1-32","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://stackoverflow.com/questions/22797418/how-do-i-safely-pass-objects-especially-stl-objects-to-and-from-a-dll","internal":false,"reflection":false,"title":"c++ - How do I safely pass objects, especially STL objects, to and from a DLL? - Stack Overflow","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":169,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[3339,3344]},"timeline_lookup":[[1,2913]],"suggested_topics":[{"id":7086,"title":"Handling CrowdAgents that get stuck","fancy_title":"Handling CrowdAgents that get stuck","slug":"handling-crowdagents-that-get-stuck","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-04T01:26:23.062Z","last_posted_at":"2021-12-05T04:37:54.143Z","bumped":true,"bumped_at":"2021-12-05T04:37:54.143Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":137,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7127,"title":"Switching ribbon trails emission glitches transparent materials","fancy_title":"Switching ribbon trails emission glitches transparent materials","slug":"switching-ribbon-trails-emission-glitches-transparent-materials","posts_count":8,"reply_count":3,"highest_post_number":8,"image_url":null,"created_at":"2022-01-13T17:17:46.847Z","last_posted_at":"2022-02-10T08:10:49.330Z","bumped":true,"bumped_at":"2022-02-10T08:10:49.330Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":323,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1188,"username":"Taqer","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}}]},{"id":7138,"title":"Build fails (linking phase) on Linux","fancy_title":"Build fails (linking phase) on Linux","slug":"build-fails-linking-phase-on-linux","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-01-20T03:08:29.663Z","last_posted_at":"2022-01-21T15:27:41.192Z","bumped":true,"bumped_at":"2022-01-21T15:27:41.192Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":178,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1502,"username":"jasperry","name":"Jason Perry","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/5fc32e/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}}]},{"id":7156,"title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","fancy_title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","slug":"manual-mesh-part-animation-e-g-rotate-a-propeller","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-01-26T23:50:29.343Z","last_posted_at":"2022-01-27T05:31:02.766Z","bumped":true,"bumped_at":"2022-01-27T05:31:02.766Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":155,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]}],"tags_descriptions":{},"id":607,"title":"[SOLVED] Endless Loop in Log::HandleEndFrame, Release 1.32","fancy_title":"[SOLVED] Endless Loop in Log::HandleEndFrame, Release 1.32","posts_count":2,"created_at":"2014-12-01T17:42:27.000Z","views":198,"reply_count":0,"like_count":0,"last_posted_at":"2014-12-02T00:07:49.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"solved-endless-loop-in-log-handleendframe-release-1-32","category_id":10,"word_count":508,"deleted_at":null,"user_id":169,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_607","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":2,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":169,"username":"Stymgade","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/839c29/{size}.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":169,"username":"Stymgade","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/839c29/{size}.png"},"last_poster":{"id":169,"username":"Stymgade","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/839c29/{size}.png"}}}