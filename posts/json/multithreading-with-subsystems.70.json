{"post_stream":{"posts":[{"id":241,"name":"","username":"NemesisFS","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/d2c977/{size}.png","created_at":"2014-01-31T13:59:13.000Z","cooked":"\u003cp\u003eHi,\u003c/p\u003e\n\u003cp\u003eI just read some of the documentation about Multithreading and now I`m wondering why the Subsystems dont utilize those more often. Wouldnt it be nice if i.e. the renderer, physics and i/o subsystems would each have an own thread?\u003cbr\u003e\nAlso I havent found info about allocation. How does it work inside a thread? Does the whole Engine use the default allocater at the moment?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T00:57:45.600Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":125,"reads":18,"readers_count":17,"score":628.6,"yours":false,"topic_id":70,"topic_slug":"multithreading-with-subsystems","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":19,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":242,"name":"","username":"Azalrion","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/f04885/{size}.png","created_at":"2014-01-31T14:15:02.000Z","cooked":"\u003cp\u003eHad a bit of a discussion about this before when looking at multi-threaded resource loading. Currently there are limitations due on:\u003c/p\u003e\n\u003cp\u003e[ul]Logging\u003cbr\u003e\nProfiling\u003cbr\u003e\nSending events\u003cbr\u003e\nDoing anything with the GPU[/ul]\u003c/p\u003e\n\u003cp\u003eWe’re pretty busy on doing video, text formatting and a few other things so we dropped multi-threaded loading for now but some of the conclusions we made were that urho could be made thread safe for certain areas in a number of ways.\u003c/p\u003e\n\u003cp\u003eLogging - Logging can be made thread safe because the current std lib function is already thread safe the only aspect of it that is not thread safe is the event system for capturing log messages, so its dependent on that being made safe.\u003c/p\u003e\n\u003cp\u003eEvent System - Event system could be made thread safe but weren’t happy with our solution as it involves the event handling functions locking each object as it handles the events and anything that touches on the gpu would need to be queued to handle at the start of the next rendering phase.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T00:57:45.653Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":21,"readers_count":20,"score":9.2,"yours":false,"topic_id":70,"topic_slug":"multithreading-with-subsystems","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":8,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":244,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-01-31T14:50:36.000Z","cooked":"\u003cp\u003eTying eg. the application update logic, scripts and physics into threading would be quite hard. Currently there’s a strictly sequential update, which I’ll illustrate with script functions but it would be the same with C++:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eScene update (with deltatime dt)\u003c/li\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003eFor each script object which uses it: Update(dt)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003ePhysics update, which is split into multiple fixed timestep updates if necessary\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003eFor each script object which uses it: FixedUpdate(fixedDt)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003eUpdate Bullet world with fixedDt\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003eFor each script object which uses it: FixedPostUpdate(fixedDt)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003eFor each script object which uses it: PostUpdate(dt)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn this scenario, if the physics was on another thread, the fixed updates still couldn’t proceed before the physics step is ready. We could make varying timestep script update and physics update happen simultaneously, but that would lose the control to apply logic per physics step, which is often essential for things like character control.\u003c/p\u003e\n\u003cp\u003eI’m hesitant to do any multithreading which either introduces more latency into the frame overall, or makes programming the logic harder. The renderer could however be made to utilize threads better, for example preparation of multiple views could happen simultaneously on threads. I now have a development machine with a very beefy GPU but somewhat poor CPU and I see the framerate doubling when I \u003cem\u003edisable\u003c/em\u003e occlusion in the water example (2 views), which certainly is not optimal.\u003c/p\u003e\n\u003cp\u003eMemory allocation happens with default new and delete, which are threadsafe. However note that the SharedPtr’s have no thread safety, so their reference counts aren’t safe to increase/decrease from multiple threads. It’s best to use raw pointers in all threaded work (this also assumes the objects being worked on won’t be born or killed during threaded updates)\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T00:57:45.784Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":19,"readers_count":18,"score":8.8,"yours":false,"topic_id":70,"topic_slug":"multithreading-with-subsystems","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":246,"name":"","username":"NemesisFS","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/d2c977/{size}.png","created_at":"2014-01-31T15:36:51.000Z","cooked":"\u003cp\u003eOkay, I think I`ve underestimated the difficulties implied my making greater use of multithreading.\u003c/p\u003e\n\u003cp\u003eNevertheless I fancy the architecture of having Subsystems which are thread-safe and have an own memory-pool and use a event/message-system for communication…\u003cbr\u003e\nI think it would be pretty robust (once its implemented) and with the increasing number of processor-cores even in low end devices it makes sense.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T00:57:45.926Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":19,"readers_count":18,"score":3.8,"yours":false,"topic_id":70,"topic_slug":"multithreading-with-subsystems","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":19,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":248,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-01-31T16:20:25.000Z","cooked":"\u003cp\u003eIt depends on the programming model you’re willing to take into use, and the latency you’re willing to accept. For example raycasts, are you OK with not receiving the result instantly, but instead you get a pointer to a pending raycast task which will signal itself when it has been completed. Also, you could be calculating logic ahead of time in a separate thread, but you cannot receive user input from the future, so it would actually be using old inputs and thus introducing latency.\u003c/p\u003e\n\u003cp\u003eIn my opinion Urho3D may already be a bit inflexible (due to the large amount of functionality it already implements) for threading model experiments, of course if you don’t mind tearing down a large part of it and rebuilding the functionality, then it’s OK \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/wink.png?v=5\" title=\":wink:\" class=\"emoji\" alt=\":wink:\"\u003e\u003c/p\u003e\n\u003cp\u003eAs realistic steps for better thread usage, without destroying anything from the API, I would see:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBackground loading of resources up to the point when they have to be uploaded to the GPU by the main thread\u003c/li\u003e\n\u003cli\u003eTasks/threads utilized more for render view preparation. This could include the UI, provided it happens at a point in the frame where UI modification is guaranteed to not happen\u003c/li\u003e\n\u003c/ul\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T00:57:46.042Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":18,"readers_count":17,"score":8.6,"yours":false,"topic_id":70,"topic_slug":"multithreading-with-subsystems","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[241,242,244,246,248]},"timeline_lookup":[[1,3218]],"suggested_topics":[{"id":7344,"title":"Do we give up supporting dx11？","fancy_title":"Do we give up supporting dx11？","slug":"do-we-give-up-supporting-dx11","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-11-03T09:37:37.893Z","last_posted_at":"2022-11-03T13:09:15.153Z","bumped":true,"bumped_at":"2022-11-03T15:28:58.128Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":78,"category_id":9,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1510,"username":"SoNewBee","name":"So New Bee","avatar_template":"/user_avatar/discourse.urho3d.io/sonewbee/{size}/3755_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]},{"id":7347,"title":"How does Urho handle script objects each frame?","fancy_title":"How does Urho handle script objects each frame?","slug":"how-does-urho-handle-script-objects-each-frame","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-11-08T02:33:56.461Z","last_posted_at":"2022-11-08T14:46:09.857Z","bumped":true,"bumped_at":"2022-11-08T14:46:09.857Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":64,"category_id":9,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1292,"username":"evolgames","name":"evol","avatar_template":"/user_avatar/discourse.urho3d.io/evolgames/{size}/3169_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7304,"title":"Urho3D is crashing on Android 12","fancy_title":"Urho3D is crashing on Android 12","slug":"urho3d-is-crashing-on-android-12","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-28T10:03:51.280Z","last_posted_at":"2022-07-28T10:03:51.349Z","bumped":true,"bumped_at":"2022-07-28T10:38:06.014Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":126,"category_id":9,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":809,"username":"elix22","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/elix22/{size}/1437_2.png"}}]},{"id":7243,"title":"Android compile fails","fancy_title":"Android compile fails","slug":"android-compile-fails","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2022-04-25T08:46:07.947Z","last_posted_at":"2022-05-06T08:22:51.592Z","bumped":true,"bumped_at":"2022-05-06T08:22:51.592Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":181,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7297,"title":"GetDrawables() can only return 1 result","fancy_title":"GetDrawables() can only return 1 result","slug":"getdrawables-can-only-return-1-result","posts_count":9,"reply_count":6,"highest_post_number":9,"image_url":null,"created_at":"2022-07-18T19:01:06.052Z","last_posted_at":"2022-07-20T05:17:38.044Z","bumped":true,"bumped_at":"2022-07-20T05:17:38.044Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":143,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1528,"username":"cqrtxwd","name":"QR C","avatar_template":"/user_avatar/discourse.urho3d.io/cqrtxwd/{size}/3814_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1358,"username":"JSandusky","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jsandusky/{size}/3220_2.png"}}]}],"tags_descriptions":{},"id":70,"title":"Multithreading with Subsystems?","fancy_title":"Multithreading with Subsystems?","posts_count":5,"created_at":"2014-01-31T13:59:13.000Z","views":538,"reply_count":0,"like_count":0,"last_posted_at":"2014-01-31T16:20:25.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"multithreading-with-subsystems","category_id":9,"word_count":802,"deleted_at":null,"user_id":19,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_70","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":5,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":19,"username":"NemesisFS","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/d2c977/{size}.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":8,"username":"Azalrion","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/f04885/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":19,"username":"NemesisFS","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/d2c977/{size}.png"},"last_poster":{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png"}}}