{"post_stream":{"posts":[{"id":102,"name":"","username":"Mike","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","created_at":"2014-01-25T08:14:22.000Z","cooked":"\u003cp\u003eI’m trying to implement local node collisions.\u003c/p\u003e\n\u003cp\u003ePlaying with example#18, I’ve put a phantom RigidBody to Head node and subscribed HeadNode to NodeCollision event.\u003cbr\u003e\nCollisions with Jack itself are accurately reported, but no other collisions are reported.\u003cbr\u003e\nI’ve checked my physics settings by drawing physics debug geometry and the phantom is moving/rotating adequately, so I don’t understand what’s going on.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T00:57:35.602Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":137,"reads":24,"readers_count":23,"score":691.8,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":9,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":108,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-01-25T13:12:12.000Z","cooked":"\u003cp\u003eIs the head “inside” the character’s collision cylinder? Then I believe other objects will collide always with the cylinder first and never with the head’s collision shape.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T00:57:36.048Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":24,"readers_count":23,"score":4.8,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":113,"name":"","username":"Mike","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","created_at":"2014-01-25T20:11:27.000Z","cooked":"\u003cp\u003eYes, the head is inside the character’s collision capsule.\u003c/p\u003e\n\u003cp\u003eI’ve tried to “magnify” the HeadNode shape so that it’s mostly out of the capsule but to no avail. Idem using a collisionMask to disable “self” collision.\u003cbr\u003e\nNext I’ll try to reduce the capsule/offset HeadNode body to avoid overlap but even if it works, this is not optimal as I want more nodes to collide.\u003c/p\u003e\n\u003cp\u003eIs there a hack or an alternative solution to do the job?\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T00:57:36.396Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":23,"readers_count":22,"score":14.6,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":9,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":115,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-01-25T20:30:15.000Z","cooked":"\u003cp\u003eIt depends on what you want the head collisions for. For something like bullet ray hit detection in a shooter game, you can use octree (drawable) raycast, as it will automatically collide against the bone hitboxes of an AnimatedModel and you’ll get the bone index in the subObject variable of the RayQueryResult.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T00:57:36.524Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":22,"readers_count":21,"score":4.4,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":120,"name":"","username":"Mike","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","created_at":"2014-01-25T21:03:32.000Z","cooked":"\u003cp\u003eMany thanks for suggestion, so we don’t necessarily need bodies if I understand correctly.\u003cbr\u003e\nIdeally what I’d like to achieve is to check if a particular bone collides with another one from a different animated model.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T00:57:36.864Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":20,"readers_count":19,"score":9.0,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":9,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":123,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-01-25T22:18:59.000Z","cooked":"\u003cp\u003eYeah, the physics simulation will take less CPU hit if you don’t add rigidbodies for bones for this, and if you don’t need the bones to actually physically simulate (ragdoll is another matter, in that case you do need per-bone physics simulation)\u003c/p\u003e\n\u003cp\u003eI haven’t verified if you can actually do it in Lua script, but you should be able to do a box octree query with your AnimatedModel’s bounding box, check if other AnimatedModels are present in the result (for a coarse test), then proceed to manually check bone bounding boxes for overlap according to the coarse test.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T00:57:37.075Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":18,"readers_count":17,"score":8.6,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":127,"name":"","username":"Mike","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","created_at":"2014-01-26T07:41:16.000Z","cooked":"\u003cp\u003eThis looks very exciting.\u003c/p\u003e\n\u003cp\u003eFor now I’ve managed to get the target bone using\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCorrect me if I’m overcomplicating things.\u003c/p\u003e\n\u003cp\u003eNow I’ll try to implement BoxOctreeQuery, this sounds promising.\u003c/p\u003e\n\u003cp\u003eEDIT: is BoxOctreeQuery exposed to script at all?\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-01-02T00:57:37.328Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":18,"readers_count":17,"score":3.6,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":9,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":128,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-01-26T11:05:16.000Z","cooked":"\u003cp\u003eNo it doesn’t seem to be. In AngelScript fictional Octree functions (GetDrawables()) have been added for each shape such as BoundingBox, similar Lua functions need to be added.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-01-02T00:57:37.397Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":130,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-01-26T14:35:57.000Z","cooked":"\u003cp\u003eGetDrawables() functions have been added to Octree Lua bindings. Because an array of pointers couldn’t be exposed directly, they return an array of OctreeQueryResult, a fictional struct that is only used for Lua bindings, which has drawable \u0026amp; node properties.\u003c/p\u003e\n\u003cp\u003eExample: bounding box query around a Vector3 hitPos\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003elocal octree = scene_:GetComponent(\"Octree\");\nlocal result = octree:GetDrawables(result, BoundingBox(hitPos + Vector3(-10,-10,-10), hitPos + Vector3(10,10,10)), DRAWABLE_GEOMETRY);\nprint(\"Octree bbox hits: \" .. result:Size() .. \" at position \" .. hitPos:ToString());\nfor i = 0, result:Size() - 1 do\n    print(\"Result \" .. i .. \" Drawable type: \" .. result[i].drawable.typeName .. \" node name: \" .. result[i].node.name .. \" node pos: \" .. result[i].node.position:ToString());\nend\u003c/code\u003e\u003c/pre\u003e","post_number":9,"post_type":1,"updated_at":"2017-01-02T00:57:37.549Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":18,"readers_count":17,"score":8.6,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":132,"name":"","username":"Mike","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","created_at":"2014-01-26T18:22:39.000Z","cooked":"\u003cp\u003eAwesome! \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/stuck_out_tongue.png?v=5\" title=\":stuck_out_tongue:\" class=\"emoji\" alt=\":stuck_out_tongue:\"\u003e\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2017-01-02T00:57:37.668Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":3.4,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":9,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":145,"name":"","username":"Mike","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","created_at":"2014-01-27T10:13:30.000Z","cooked":"\u003cp\u003eCongrats Lasse, it works perfectly.\u003c/p\u003e\n\u003cp\u003eThe only caveat is that for movable StaticModels, the BoundingBox doesn’t rotate, so that if for example a box is rotated, collisions become inaccurate.\u003c/p\u003e\n\u003cp\u003eHere is my code so far for checking collision between Batman’s right hand (this AnimatedModel has a fight animation) and Jack’s head :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003ehitTest(characterNode:GetChild(\"mixamorig:RightHand\", true).worldPosition) -- called in HandleUpdate\n\nfunction boundingBoxescollision(bbox1, bbox2) -- Check if 2 BoundingBoxes overlap (3D AABB collision test)\n\tif bbox2.min.x \u0026gt;= bbox1.max.x\t-- too much @left\n\tor bbox2.max.x \u0026lt;= bbox1.min.x\t-- too much @right\n\tor bbox2.min.y \u0026gt;= bbox1.max.y\t-- too high\n\tor bbox2.max.y \u0026lt;= bbox1.min.y\t-- too low \n\tor bbox2.min.z \u0026gt;= bbox1.max.z\t-- too forward\n\tor bbox2.max.z \u0026lt;= bbox1.min.z\t-- too backward\n\n\tthen return false\n\telse return true end\nend\n\nfunction customBoundingBox(position, size, visible)\n\tlocal bboxSize = Vector3(size, size, size) -- Size of the BoundingBox\n\tlocal bbox = BoundingBox(position -bboxSize, position + bboxSize) -- Set BoundingBox position \u0026amp; size\n\n\tif visible == true then scene_:GetComponent(\"DebugRenderer\"):AddBoundingBox(bbox, Color(0.5, 0.5, 0.5)) end -- Draw BoundingBox\n\n\treturn bbox\nend\n\nfunction hitTest(hitPos)\n\tlocal bbox = customBoundingBox(hitPos, 0.1, true) -- Get BoundingBox from hitPos \u0026amp; size and draw it\n\tlocal result = octree:GetDrawables(bbox, DRAWABLE_GEOMETRY)\n\n\tfor i = 0, result:Size() -1 do\n\t\tif result[i].node.name ~= \"Batman\" and result[i].node.name ~= \"Sky\" then -- Exclude Skybox \u0026amp; Self (Batman)\n\t\t\tif result[i].node:GetComponent(\"StaticModel\") ~= nil then scene_:GetComponent(\"DebugRenderer\"):AddBoundingBox(result[i].node:GetComponent(\"StaticModel\").worldBoundingBox, Color(1, 1, 1)) end -- Draw node BoundingBox\n\t\t\tif result[i].node:GetComponent(\"AnimatedModel\") ~= nil then -- For AnimatedModel, check if specified bones are colliding with the BoundingBox\n\t\t\t\tprint(boundingBoxescollision(customBoundingBox(result[i].node:GetChild(\"Bip01_Head\", true).worldPosition, 0.1, true), bbox)) -- Check collision between the 2 BoundingBoxes \u0026amp; draw them\n\t\t\tend\n\t\tend\n\tend\n\nend\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNB:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eI’ve added drawing of BoundingBoxes to help debug\u003c/li\u003e\n\u003cli\u003eI check boxes overlap by using a custom 3D AABB collision test function, maybe it is already available somewhere.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI’ll post an example using Ninja \u0026amp; Jack characters ASAP.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2017-01-02T00:57:38.578Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":22,"readers_count":21,"score":4.4,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":9,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":153,"name":"","username":"Mike","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","created_at":"2014-01-27T13:43:31.000Z","cooked":"\u003cp\u003eI’ve extended example#18 (with external file BoneCollisions.lua, content below) so that Jack is attacked by a ninja when pressing key B\u003c/p\u003e\n\u003cp\u003eModifications to file 18_CharacterDemo.lua:\u003c/p\u003e\n\u003cp\u003erequire “LuaScripts/BoneCollisions”\u003c/p\u003e\n\u003cp\u003ein HandleUpdate function:\u003cbr\u003e\nif input:GetKeyPress(KEY_B) then CreateEnemy() end – Create ennemy (ninja)\u003cbr\u003e\nhitTest(characterNode:GetChild(“Bip01_Head”, true).worldPosition) – Check Jack’s head collisions\u003c/p\u003e\n\u003cp\u003eWhat’s strange is that using “self.node:LookAt(dir, Vector3(0,1,0))” to rotate the ninja toward Jack produces a Bullet AABB overflow.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e-- BoneCollisions.lua\n\n-- Demonstrates:\n--    - accurate bone collisions\n--    - enemy head always facing the main character\n--    - playing context animation\n\nlocal BRAKE_FORCE = 0.3 -- Set slightly upper than Jack so that Jack is faster\n\nfunction boundingBoxescollision(bbox1, bbox2) -- Check if 2 BoundingBoxes overlap (3D AABB collision test)\n\tif bbox2.min.x \u0026gt;= bbox1.max.x\t\t-- too much @left\n\tor bbox2.max.x \u0026lt;= bbox1.min.x\t-- too much @right\n\tor bbox2.min.y \u0026gt;= bbox1.max.y\t-- too high\n\tor bbox2.max.y \u0026lt;= bbox1.min.y\t-- too low \n\tor bbox2.min.z \u0026gt;= bbox1.max.z\t-- too forward\n\tor bbox2.max.z \u0026lt;= bbox1.min.z\t-- too backward\n\n\tthen return false\n\telse return true end\nend\n\nfunction customBoundingBox(position, size, visible)\n \tlocal bboxSize = Vector3(size, size, size) -- Size of the BoundingBox\n\tlocal bbox = BoundingBox(position -bboxSize, position + bboxSize) -- Set BoundingBox position \u0026amp; size\n\n\tif visible == true then scene_:GetComponent(\"DebugRenderer\"):AddBoundingBox(bbox, Color(0.5, 0.5, 0.5)) end -- Draw BoundingBox\n\n\treturn bbox\nend\n\nfunction hitTest(hitPos)\n\tlocal bbox = customBoundingBox(hitPos, 0.1, true) -- Get BoundingBox from hitPos \u0026amp; size and draw it\n\tlocal result = scene_:GetComponent(\"Octree\"):GetDrawables(bbox, DRAWABLE_GEOMETRY)\n\n--\tprint(\"Octree bbox hits: \" .. result:Size() .. \" at position \" .. hitPos:ToString())\n\tfor i = 0, result:Size() -1 do\n\t\tif result[i].node.name ~= \"Jack\" then -- Exclude Self (Jack)\n\t\t\tif result[i].node:GetComponent(\"StaticModel\") ~= nil then scene_:GetComponent(\"DebugRenderer\"):AddBoundingBox(result[i].node:GetComponent(\"StaticModel\").worldBoundingBox, Color(1, 1, 1)) end -- Draw node BoundingBox\n\t\t\tif result[i].node:GetComponent(\"AnimatedModel\") ~= nil then -- For AnimatedModel, check if specified bones are colliding with the BoundingBox\n\t\t\t\tprint(boundingBoxescollision(customBoundingBox(result[i].node:GetChild(\"Joint13\", true).worldPosition, 0.1, true), bbox)) -- Check collision between the 2 BoundingBoxes \u0026amp; draw them\n\t\t\t\tif boundingBoxescollision(customBoundingBox(result[i].node:GetChild(\"Joint13\", true).worldPosition, 0.1, true), bbox) then\n\t\t\t\t\t--headShot()\n\t\t\t\tend\n\t\t\tend\n--\t\t\tprint(\"Result \" .. i .. \" Drawable type: \" .. result[i].drawable.typeName .. \" node name: \" .. result[i].node.name .. \" node pos: \" .. result[i].node.position:ToString())\n\t\tend\n\tend\nend\n\nfunction headShot()\n\t-- do something with Jack (context animation, move backward, rotate head backward...)\nend\n\nfunction CreateEnemy()\n\tlocal EnemyNode = scene_:CreateChild(\"Enemy\")\n\tEnemyNode.position = Vector3(0, 0, 10)\n\tlocal object = EnemyNode:CreateComponent(\"AnimatedModel\")\n\tobject.model = cache:GetResource(\"Model\", \"Models/Ninja.mdl\")\n\tobject.material = cache:GetResource(\"Material\", \"Materials/Ninja.xml\")\n\tobject.castShadows = true\n\tlocal body = EnemyNode:CreateComponent(\"RigidBody\")\n\tbody.mass = 1 -- Set non-zero mass so that the body becomes dynamic\n\tbody.angularFactor = Vector3(0, 0, 0) -- Keep Enemy always upright\n\tlocal shape = EnemyNode:CreateComponent(\"CollisionShape\")\n\tshape:SetCapsule(0.7, 1.8, Vector3(0, 0.9, 0)) -- diameter/height/position\n\tshape.offset = Vector3(0,1,0)\n\n\tEnemyNode:CreateScriptObject(\"Enemy\") -- Create the Enemy logic object, which takes care of steering the rigidbody\n\tEnemyNode:CreateComponent(\"AnimationController\") -- Create the animation controller\nend\n\n-- Enemy script object class\nEnemy = ScriptObject()\n\nfunction Enemy:Start()\n\tself.isFighting = false\n\tself:SubscribeToEvent(self.node, \"NodeCollision\", \"Enemy:HandleNodeCollision\") -- Subscribe to NodeCollision physics event\nend\n\nfunction Enemy:Load(deserializer)\n\tself.isFighting = deserializer:ReadBool()\nend\n\nfunction Enemy:Save(serializer)\n\tserializer:WriteBool(self.isFighting)\nend\n\nfunction Enemy:HandleNodeCollision(eventType, eventData)\n\tlocal otherBody = eventData:GetPtr(\"RigidBody\", \"OtherBody\") -- Get the other colliding body\n\tlocal otherNode = eventData:GetPtr(\"Node\", \"OtherNode\") -- Get the other colliding node\n\n\tif otherNode.name == \"Jack\" then self.isFighting = true else self.isFighting = false end -- Check if fighting to trigger appropriate animation\nend\n\n\nfunction Enemy:FixedPostUpdate(timeStep)\t\t-- NB: FixedPostUpdate in reaction to Jack's FixedUpdate\n\tlocal body = self.node:GetComponent(\"RigidBody\")\n\n\tif not self.isFighting then -- When fighting, don't move Enemy\n\n\t\tlocal dir = characterNode.position - self.node.position\n\t\t--self.node:LookAt(dir, Vector3(0,1,0)) -- Uncommenting this line produces an AABB overflow\n\n\t\t-- Rotate Enemy head toward Jack\n\t\tlocal skeleton = self.node:GetComponent(\"AnimatedModel\").skeleton\n\t\tskeleton:GetBone(\"Joint8\").animated = false -- Disable head animation\n\t\tlocal headNode = self.node:GetChild(\"Joint8\", true)\n\t\theadNode:LookAt(characterNode.position + Vector3(0, 1.7, 0), Vector3(0, 1 ,0)) -- Look at head level\n\t\t--Todo: restrict lateral rotation\n\n\t\t-- Update movement\n\t\tlocal velocity = body.linearVelocity\n\n\t\tlocal planeVelocity = Vector3(velocity.x, 0, velocity.z) -- Velocity on the XZ plane\n\t\tlocal brakeForce = planeVelocity * -BRAKE_FORCE\n\n\t\tbody:ApplyImpulse(dir:Normalized())\n\t\tbody:ApplyImpulse(brakeForce)\n\tend\n\n\t-- Update Animations\n\tlocal animCtrl = self.node:GetComponent(\"AnimationController\")\n\n\tif self.isFighting then animCtrl:PlayExclusive(\"Models/Ninja_Attack3.ani\", 0, true, 0.2)\n\telse animCtrl:PlayExclusive(\"Models/Ninja_Walk.ani\", 0, true, 0.3) end\n\n\tanimCtrl:SetSpeed(\"Models/Ninja_Walk.ani\", 1)\nend\u003c/code\u003e\u003c/pre\u003e","post_number":12,"post_type":1,"updated_at":"2017-01-02T00:57:39.139Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":22,"readers_count":21,"score":9.4,"yours":false,"topic_id":49,"topic_slug":"solved-local-node-collisions","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Contributor","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":9,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[102,108,113,115,120,123,127,128,130,132,145,153]},"timeline_lookup":[[1,3224],[3,3223],[10,3222]],"suggested_topics":[{"id":7092,"title":"Finding the World Space Coordinates of the Screen Edges","fancy_title":"Finding the World Space Coordinates of the Screen Edges","slug":"finding-the-world-space-coordinates-of-the-screen-edges","posts_count":6,"reply_count":2,"highest_post_number":6,"image_url":null,"created_at":"2021-12-07T20:53:49.453Z","last_posted_at":"2021-12-08T12:33:52.510Z","bumped":true,"bumped_at":"2021-12-08T12:33:52.510Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":210,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]},{"id":7156,"title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","fancy_title":"Manual Mesh Part Animation (e.g. Rotate a propeller)","slug":"manual-mesh-part-animation-e-g-rotate-a-propeller","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-01-26T23:50:29.343Z","last_posted_at":"2022-01-27T05:31:02.766Z","bumped":true,"bumped_at":"2022-01-27T05:31:02.766Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":155,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7160,"title":"RayCast trouble","fancy_title":"RayCast trouble","slug":"raycast-trouble","posts_count":17,"reply_count":9,"highest_post_number":19,"image_url":null,"created_at":"2022-01-29T00:06:00.367Z","last_posted_at":"2022-01-30T00:29:39.356Z","bumped":true,"bumped_at":"2022-01-30T00:29:39.356Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":260,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":627,"username":"George1","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/9e8a1a/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7138,"title":"Build fails (linking phase) on Linux","fancy_title":"Build fails (linking phase) on Linux","slug":"build-fails-linking-phase-on-linux","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-01-20T03:08:29.663Z","last_posted_at":"2022-01-21T15:27:41.192Z","bumped":true,"bumped_at":"2022-01-21T15:27:41.192Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":178,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1502,"username":"jasperry","name":"Jason Perry","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/5fc32e/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1304,"username":"lebrewer","name":"lebrewer","avatar_template":"/user_avatar/discourse.urho3d.io/lebrewer/{size}/2811_2.png"}}]},{"id":7325,"title":"Unable to use external GPU for Urho3D app on Mac OS Monterey","fancy_title":"Unable to use external GPU for Urho3D app on Mac OS Monterey","slug":"unable-to-use-external-gpu-for-urho3d-app-on-mac-os-monterey","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/5/5f906b318833e198a50421d1068fb2d87d17c231_2_1024x585.jpeg","created_at":"2022-09-13T10:07:14.458Z","last_posted_at":"2022-09-14T07:07:26.247Z","bumped":true,"bumped_at":"2022-09-14T07:07:26.247Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":84,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1424,"username":"daokoder","name":"Limin Fu","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/d/898d66/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":49,"title":"[SOLVED] Local Node collisions","fancy_title":"[SOLVED] Local Node collisions","posts_count":12,"created_at":"2014-01-25T08:14:22.000Z","views":704,"reply_count":0,"like_count":0,"last_posted_at":"2014-01-27T13:43:31.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"solved-local-node-collisions","category_id":10,"word_count":1710,"deleted_at":null,"user_id":9,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_49","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":12,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":9,"username":"Mike","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png","post_count":7,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"moderator":true,"trust_level":2},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":5,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2}],"created_by":{"id":9,"username":"Mike","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png"},"last_poster":{"id":9,"username":"Mike","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/m/58f4c7/{size}.png"}}}