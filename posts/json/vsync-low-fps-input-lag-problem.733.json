{"post_stream":{"posts":[{"id":4023,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-01-09T12:33:24.000Z","cooked":"\u003cp\u003eHi,\u003c/p\u003e\n\u003cp\u003eI’m experiencing severe input lag with vsync on.\u003cbr\u003e\nFew things I noticed about it:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHolding down more button causes the lag to increase.\u003c/li\u003e\n\u003cli\u003eThere’s more lag in full screen than in window mode.\u003c/li\u003e\n\u003cli\u003eIn windowed mode it can cause the mouse to travel far enough to leave the window. (suggesting something prevents it from re-centering)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eYou can experience it in the ninja snow war game or character demo. try looking around fast with your mouse, then try to hold down WASD (all of them) and look around fast again. You’ll notice it’s slightly more laggy.\u003cbr\u003e\nIn my game I experience extreme case of this lag which makes the game unplayable since it requires very responsive controls.\u003c/p\u003e\n\u003cp\u003eI noticed that when I enabled vsync and use SetMaxFps(60); the lag is greatly reduced and capped at a lower point (i.e. I don’t get extremely long freezes). It may suggest that there’s some sort of desync between input polling and updates.\u003cbr\u003e\nAnother thing that may cause it is lost mouse messages. I barely know anything about it but if the vsync busy polling doesn’t check for mouse messages, that could mean mouse messages are missed?\u003c/p\u003e\n\u003cp\u003eAnother thing I noticed is that when I reduce the frame rate to something low such as 20-30, hold down any button and move the mouse, the mouse speed slows down and resets in intervals of few seconds.\u003cbr\u003e\nI tested it and the values I get from input-\u0026gt;GetMouseMoveX() and input-\u0026gt;GetMouseMoveY() are the ones that scale down.\u003cbr\u003e\nIn windowed mode the mouse can leave the window when the mouse speed is slow enough.\u003c/p\u003e\n\u003cp\u003eNote that I don’t experience anything similar with other games, only when I use Urho3D.\u003c/p\u003e\n\u003cp\u003eWhat can cause this problem and how can it be fixed?\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"bbcode-b\"\u003e\u003cspan class=\"bbcode-u\"\u003eEDIT\u003c/span\u003e\u003c/span\u003e\u003cbr\u003e\nRight now SDL2’s event queue is the main suspect.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:02:32.087Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":321,"reads":12,"readers_count":11,"score":1607.4,"yours":false,"topic_id":733,"topic_slug":"vsync-low-fps-input-lag-problem","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4050,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-01-10T16:45:44.000Z","cooked":"\u003cp\u003eI found the sources of the lag.\u003c/p\u003e\n\u003cp\u003eThe first one is SDL_PeepEvents. Switching to SDL_PollEvent greatly reduced the lag.\u003cbr\u003e\nThe only main difference is that SDL_PeepEvents is thread safe, but that shouldn’t be a problem since the input Update() isn’t threaded.\u003c/p\u003e\n\u003cp\u003eThe second cause is the following line in D3D9Graphics.cpp:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor some reason when using vsync option via Urho3D that lag occurs, but when I set it through my graphics card settings (Nvidia GTX670) I get vsync without the input lag.\u003c/p\u003e\n\u003cp\u003eUsing max FPS 60(my monitor refresh rate) or 59(slightly less lag) with vsync does reduce the lag to almost unnoticeable level, but vsync still introduces some lag that doesn’t happen with the hardware configured vsync.\u003c/p\u003e\n\u003cp\u003eI tried forcing OpenGL and I it doesn’t have the lag problem.\u003cbr\u003e\nI noticed that OpenGL uses SDL_GL_SetSwapInterval() to enable/disable vsync, that may suggest that it changes something with SDL that prevents the lag.\u003cbr\u003e\nOpenGL build still lags if SDL_PeepEvents is used, so SDL_PollEvent is a must.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:02:34.254Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":4,"reads":12,"readers_count":11,"score":22.4,"yours":false,"topic_id":733,"topic_slug":"vsync-low-fps-input-lag-problem","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4052,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-01-10T18:00:51.000Z","cooked":"\u003cp\u003eWe already pump events once to fill SDL’s internal event queue from OS, then process all of them. PollEvents() would call PumpEvents() on its own, and could theoretically loop forever if new OS-level events are being added all the time, so I’m reluctant to change this.\u003c/p\u003e\n\u003cp\u003eOn D3D9 you should try calling Graphics::SetFlushGPU(true). This will force the CPU to not get ahead of GPU and therefore reduce the apparent input lag, but will cost some performance due to the syncing/stalling that will be happening each frame.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:02:34.401Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":12,"readers_count":11,"score":2.4,"yours":false,"topic_id":733,"topic_slug":"vsync-low-fps-input-lag-problem","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4056,"name":"","username":"Enhex","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","created_at":"2015-01-10T18:49:55.000Z","cooked":"\u003cp\u003eThe lag happens in both OpenGL and DirectX when using SDL_PeepEvents.\u003cbr\u003e\nI did profiling with the Urho profiler when using vsync and with SDL_PollEvent I get between 0.3-1.5 ms max when moving the mouse and/or pressing buttons, while with SDL_PeepEvents I get 16-18 ms max. In my experience the lag was much worse and could cause halt which were as long as several 100’s of miliseconds and inconsistent mouse speed.\u003cbr\u003e\nI also tested it with an empty project using the external lib guide and I got the same result.\u003c/p\u003e\n\u003cp\u003eMaybe there’s a way to configure SDL so the lag won’t happen with SDL_PeepEvents (maybe using threading), but until it’s found SDL_PollEvent will work better.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:02:34.721Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":12,"readers_count":11,"score":2.4,"yours":false,"topic_id":733,"topic_slug":"vsync-low-fps-input-lag-problem","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":184,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":4057,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2015-01-10T20:04:57.000Z","cooked":"\u003cp\u003eThe internal SDL code is almost the same, maybe the difference is that SDL_PollEvent() will call SDL_PumpEvents() again for each received event.\u003c/p\u003e\n\u003cp\u003eHowever, I observed subjectively smoother mouse input under Windows with vsync on when using SDL_PollEvent(), so I’ll commit the change you suggested. It can always be reverted if it leads into trouble. Can’t comment on the subject of lag difference though.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:02:34.801Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":11,"readers_count":10,"score":12.2,"yours":false,"topic_id":733,"topic_slug":"vsync-low-fps-input-lag-problem","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[4023,4050,4052,4056,4057]},"timeline_lookup":[[1,2875],[2,2874],[3,2873]],"suggested_topics":[{"id":7097,"title":"View Physics event for ConvexCast","fancy_title":"View Physics event for ConvexCast","slug":"view-physics-event-for-convexcast","posts_count":11,"reply_count":5,"highest_post_number":11,"image_url":null,"created_at":"2021-12-09T23:56:27.507Z","last_posted_at":"2021-12-12T20:20:02.788Z","bumped":true,"bumped_at":"2021-12-12T20:20:02.788Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":206,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7107,"title":"Error: SDL/SDL_gamecontroller.h: No such file or directory #include \u003cSDL/SDL_gamecontroller.h\u003e","fancy_title":"Error: SDL/SDL_gamecontroller.h: No such file or directory #include \u0026lt;SDL/SDL_gamecontroller.h\u0026gt;","slug":"error-sdl-sdl-gamecontroller-h-no-such-file-or-directory-include-sdl-sdl-gamecontroller-h","posts_count":6,"reply_count":1,"highest_post_number":6,"image_url":null,"created_at":"2021-12-21T15:29:52.810Z","last_posted_at":"2021-12-22T15:32:44.818Z","bumped":true,"bumped_at":"2021-12-22T15:32:44.818Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":271,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1497,"username":"timob256","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/b782af/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7123,"title":"Character hitboxes","fancy_title":"Character hitboxes","slug":"character-hitboxes","posts_count":24,"reply_count":16,"highest_post_number":24,"image_url":null,"created_at":"2022-01-10T19:34:24.617Z","last_posted_at":"2022-01-12T22:44:20.744Z","bumped":true,"bumped_at":"2022-01-12T22:44:20.744Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":275,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"}}]},{"id":7160,"title":"RayCast trouble","fancy_title":"RayCast trouble","slug":"raycast-trouble","posts_count":17,"reply_count":9,"highest_post_number":19,"image_url":null,"created_at":"2022-01-29T00:06:00.367Z","last_posted_at":"2022-01-30T00:29:39.356Z","bumped":true,"bumped_at":"2022-01-30T00:29:39.356Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":3,"views":260,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":627,"username":"George1","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/9e8a1a/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}}]},{"id":7178,"title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","fancy_title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","slug":"medium-quality-technique-for-semi-reflective-specular-glass-in-urho","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/51408fe152ba02eb8b92237cc9a9411c8ee922e6.jpeg","created_at":"2022-01-31T22:57:50.134Z","last_posted_at":"2022-02-01T04:32:37.418Z","bumped":true,"bumped_at":"2022-02-01T04:32:37.418Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":154,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]}],"tags_descriptions":{},"id":733,"title":"Vsync/Low FPS Input Lag Problem","fancy_title":"Vsync/Low FPS Input Lag Problem","posts_count":5,"created_at":"2015-01-09T12:33:24.000Z","views":1077,"reply_count":0,"like_count":0,"last_posted_at":"2015-01-10T20:04:57.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"vsync-low-fps-input-lag-problem","category_id":10,"word_count":777,"deleted_at":null,"user_id":184,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_733","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":5,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":184,"username":"Enhex","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2}],"created_by":{"id":184,"username":"Enhex","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/enhex/{size}/81_2.png"},"last_poster":{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png"}}}