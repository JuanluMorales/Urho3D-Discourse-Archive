{"post_stream":{"posts":[{"id":338,"name":"","username":"Kingsley","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/5f9b8f/{size}.png","created_at":"2014-02-09T20:48:00.000Z","cooked":"\u003cp\u003eJust what it says on the tin!\u003c/p\u003e\n\u003cp\u003eI’d like to have a generic initialization function for my components, similar to Start() in unity3d. OnNodeSet seems the best built-in option, but it’s not working out as I planned.\u003c/p\u003e\n\u003cp\u003eHere’s the code I’m using:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003evoid TestComponent::OnNodeSet(Node *node)\n{\n    //Calling Init here doesn't seem to properly create the rigidbody and/or collisionshape upon loading\n    if (node) Init(node);\n}\n\nvoid TestComponent::ApplyAttributes()\n{\n    //Uncommenting this Init() call and commenting out the OnNodeSet one results in save/load working fine,\n    //but initialization of instantiated objects becomes obviously borked.\n\n    //Interestingly it seems to have no effect when both are uncommented\n\n    //Init(node_);\n}\n\nvoid TestComponent::Init(Node* node)\n{\n    ResourceCache* cache = GetSubsystem\u0026lt;ResourceCache\u0026gt;();\n\n    StaticModel* model = node-\u0026gt;GetOrCreateComponent\u0026lt;StaticModel\u0026gt;();\n    model-\u0026gt;SetModel(cache-\u0026gt;GetResource\u0026lt;Model\u0026gt;(\"Models/Box.mdl\"));\n    model-\u0026gt;SetMaterial(cache-\u0026gt;GetResource\u0026lt;Material\u0026gt;(\"Materials/Stone.xml\"));\n    model-\u0026gt;SetCastShadows(true);\n\n    RigidBody* rigidbody = node-\u0026gt;GetOrCreateComponent\u0026lt;RigidBody\u0026gt;();\n    rigidbody-\u0026gt;SetMass(1.0f);\n\n    CollisionShape* shape = node-\u0026gt;GetOrCreateComponent\u0026lt;CollisionShape\u0026gt;();\n    shape-\u0026gt;SetBox(Vector3::ONE);\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhen I create objects, it works fine:\u003cbr\u003e\n\u003cdiv class=\"lightbox-wrapper\"\u003e\u003ca class=\"lightbox\" href=\"http://i.imgur.com/tMLirmH.png\" title=\"\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"http://i.imgur.com/tMLirmH.png\" alt=\"\" width=\"633\" height=\"500\"\u003e\u003cdiv class=\"meta\"\u003e\u003csvg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"\u003e\u003cuse xlink:href=\"#far-image\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003cspan class=\"filename\"\u003e\u003c/span\u003e\u003cspan class=\"informations\"\u003e1108×875\u003c/span\u003e\u003csvg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"\u003e\u003cuse xlink:href=\"#discourse-expand\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/div\u003e\u003c/a\u003e\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eHowever, when I save/load the scene, the collisionshapes seem to become detached from the node, and the model falls through the ground.\u003cbr\u003e\n\u003cdiv class=\"lightbox-wrapper\"\u003e\u003ca class=\"lightbox\" href=\"http://i.imgur.com/Zn8bj55.png\" title=\"\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"http://i.imgur.com/Zn8bj55.png\" alt=\"\" width=\"633\" height=\"500\"\u003e\u003cdiv class=\"meta\"\u003e\u003csvg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"\u003e\u003cuse xlink:href=\"#far-image\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003cspan class=\"filename\"\u003e\u003c/span\u003e\u003cspan class=\"informations\"\u003e1108×875\u003c/span\u003e\u003csvg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"\u003e\u003cuse xlink:href=\"#discourse-expand\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/div\u003e\u003c/a\u003e\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eMy test scene is available \u003ca href=\"https://db.tt/f1lxv51w\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIs this a bug, or should I not be using OnNodeSet to call other components’ functions? Is there a recommended approach?\u003c/p\u003e\n\u003cp\u003eThanks.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T00:57:52.603Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":10,"reads":5,"readers_count":4,"score":51.0,"yours":false,"topic_id":85,"topic_slug":"initialization-issues-in-onnodeset-on-scene-load","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://db.tt/f1lxv51w","internal":false,"reflection":false,"clicks":0},{"url":"http://i.imgur.com/tMLirmH.png","internal":false,"reflection":false,"title":"tMLirmH.png","clicks":0},{"url":"http://i.imgur.com/Zn8bj55.png","internal":false,"reflection":false,"title":"Zn8bj55.png","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":38,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":339,"name":"","username":"friesencr","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png","created_at":"2014-02-10T00:17:02.000Z","cooked":"\u003cp\u003eI have been digging around for a bit.  There isn’t a scene start event to subscribe to.  The start event happens on a script instance when the component is created.  What if the node isn’t attached to a scene? Should it start?  I haven’t gotten very advanced using multiple scenes but I bet there is trouble there. What if you attach a node to a scene that is paused?  There is maybe a difference to “Start” and “The first frame it participates”.  Does having a Start and Init event clear up the intent?  I really haven’t thought much about this.  The Start method on a ScriptInstance has always done what I have expected and I am just starting to move to c++.\u003c/p\u003e\n\u003cp\u003eSorry for not really answering your question and asking more questions.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T00:57:52.673Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":5,"readers_count":4,"score":1.0,"yours":false,"topic_id":85,"topic_slug":"initialization-issues-in-onnodeset-on-scene-load","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":15,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":340,"name":"","username":"Kingsley","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/5f9b8f/{size}.png","created_at":"2014-02-10T03:22:41.000Z","cooked":"\u003cp\u003efriesencr, interesting! OnSceneLoad seems like it would make more sense than ApplyAttributes. I suppose currently one could hack an event atop E_CLIENTSCENELOADED to mimic the functionality, but that would be…unpleasant, to be sure. :I\u003c/p\u003e\n\u003cp\u003eI’m looking for something more along the lines of \u003ca href=\"http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.Awake.html\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003eAwake()\u003c/a\u003e and \u003ca href=\"http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.Start.html\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003eStart()\u003c/a\u003e The idea in that engine is, after an object is instantiated, Awake is first called, and used to assign variables, and Start is then used to do setup work using those variables. Urho has OnNodeSet, which seems to wrap the functionality of Awake with \u003ca href=\"http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.OnDestroy.html\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003eOnDestroy\u003c/a\u003e into one function, eschewing delayed initialization completely. This seems a bit frightening, considering I might check the value of another component’s variable and get the wrong result due to race conditions.\u003c/p\u003e\n\u003cp\u003eI’d take a shot at resolving these issues, but I want to make sure I’m not blatently misunderstanding urho’s node constructor style. \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/smiley.png?v=5\" title=\":smiley:\" class=\"emoji\" alt=\":smiley:\"\u003e\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T00:57:52.739Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":5,"readers_count":4,"score":1.0,"yours":false,"topic_id":85,"topic_slug":"initialization-issues-in-onnodeset-on-scene-load","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.Start.html","internal":false,"reflection":false,"title":"Unity - Scripting API: MonoBehaviour.Start()","clicks":0},{"url":"http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.OnDestroy.html","internal":false,"reflection":false,"title":"Unity - Scripting API: MonoBehaviour.OnDestroy()","clicks":0},{"url":"http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.Awake.html","internal":false,"reflection":false,"title":"Unity - Scripting API: MonoBehaviour.Awake()","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":38,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":344,"name":"Lasse Öörni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-10T10:36:35.000Z","cooked":"\u003cp\u003eTheoretically it’s OK to create components in OnNodeSet(), for example physics components require the existence of the PhysicsWorld component in the root scene node, but the root node should already be loaded at that point. What I believe goes wrong here, while loading, is that you have the logic to GetOrCreate the physics components, and maybe your component will be loaded first, so it detects there are no physics components, and creates them. BUT a second set of physics components will be loaded into the scene node after your component’s initialization!\u003c/p\u003e\n\u003cp\u003eSo, I’d phrase it so that when you’re going to load and save scenes, do not make your custom components create other components. Instead compose them in higher-level code, or save the scene node (with all its components) as a “prefab” which you can load with Scene::Instantiate() or Scene::InstantiateXML().\u003c/p\u003e\n\u003cp\u003eUrho’s components are a bit lower level compared to Unity. Maybe you could create your own base class for “game components” that implements a Unity-like API, what it could do is that it subscribes to the scene update event, and on the first scene update it would call Start() before Update().\u003c/p\u003e\n\u003cp\u003eAlso, nothing prevents you calling ApplyAttributes() yourself when you have finished spawning a new node + components in your code. The reason why the engine doesn’t call it automatically, except when loading scenes, is that it cannot know when you are finished with all possible attribute changes. The editor, for example, calls it after each attribute edit to make sure all the attribute side-effects (such as recreating a CollisionShape’s Bullet object when shape parameters change) are applied correctly. For the editor this is acceptable, but the engine itself should not call ApplyAttributes() without reason.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T00:57:53.051Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":5,"readers_count":4,"score":6.0,"yours":false,"topic_id":85,"topic_slug":"initialization-issues-in-onnodeset-on-scene-load","display_username":"Lasse Öörni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[338,339,340,344]},"timeline_lookup":[[1,3208]],"suggested_topics":[{"id":7204,"title":"How handle with multiple scenes?","fancy_title":"How handle with multiple scenes?","slug":"how-handle-with-multiple-scenes","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-02-23T16:15:02.697Z","last_posted_at":"2022-02-23T16:15:02.762Z","bumped":true,"bumped_at":"2022-02-23T16:15:02.762Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":131,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1508,"username":"killinbassou","name":"killin","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/848f3c/{size}.png"}}]},{"id":7123,"title":"Character hitboxes","fancy_title":"Character hitboxes","slug":"character-hitboxes","posts_count":24,"reply_count":16,"highest_post_number":24,"image_url":null,"created_at":"2022-01-10T19:34:24.617Z","last_posted_at":"2022-01-12T22:44:20.744Z","bumped":true,"bumped_at":"2022-01-12T22:44:20.744Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":275,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"魔大农 𝞍𝞎𝝳 現招蜍","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"}}]},{"id":7125,"title":"Android mobile shows jaggies in the instersection plane-terrain","fancy_title":"Android mobile shows jaggies in the instersection plane-terrain","slug":"android-mobile-shows-jaggies-in-the-instersection-plane-terrain","posts_count":5,"reply_count":3,"highest_post_number":5,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/d/d36aedb4e8cf5409efca6c976aae7e4a5c499eb9.png","created_at":"2022-01-11T11:59:18.993Z","last_posted_at":"2022-01-11T21:27:40.692Z","bumped":true,"bumped_at":"2022-01-12T07:36:41.695Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":129,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7193,"title":"Can Z-Axis Feasibly be \"Up\"?","fancy_title":"Can Z-Axis Feasibly be \u0026ldquo;Up\u0026rdquo;?","slug":"can-z-axis-feasibly-be-up","posts_count":4,"reply_count":2,"highest_post_number":4,"image_url":null,"created_at":"2022-02-14T05:17:28.054Z","last_posted_at":"2022-02-14T07:26:53.817Z","bumped":true,"bumped_at":"2022-02-14T07:26:53.817Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":161,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7215,"title":"How to build rbfx?","fancy_title":"How to build rbfx?","slug":"how-to-build-rbfx","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2022-03-11T01:28:40.314Z","last_posted_at":"2022-03-12T19:16:39.360Z","bumped":true,"bumped_at":"2022-03-12T19:16:39.360Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":268,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1510,"username":"SoNewBee","name":"So New Bee","avatar_template":"/user_avatar/discourse.urho3d.io/sonewbee/{size}/3755_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1447,"username":"Batch","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/b/f17d59/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":85,"title":"Initialization issues in OnNodeSet on scene load","fancy_title":"Initialization issues in OnNodeSet on scene load","posts_count":4,"created_at":"2014-02-09T20:48:00.000Z","views":290,"reply_count":0,"like_count":0,"last_posted_at":"2014-02-10T10:36:35.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"initialization-issues-in-onnodeset-on-scene-load","category_id":10,"word_count":862,"deleted_at":null,"user_id":38,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_85","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":4,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":38,"username":"Kingsley","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/5f9b8f/{size}.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":15,"username":"friesencr","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":38,"username":"Kingsley","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/k/5f9b8f/{size}.png"},"last_poster":{"id":3,"username":"cadaver","name":"Lasse Öörni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png"}}}